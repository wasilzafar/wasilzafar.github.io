<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Master distributed systems fundamentals with CAP theorem and consistency models. Learn about eventual consistency, strong consistency, consensus algorithms, and real-world trade-offs." />
    <meta name="author" content="Wasil Zafar" />
    <meta name="keywords" content="CAP Theorem, Consistency, Availability, Partition Tolerance, Distributed Systems, Eventual Consistency, Strong Consistency, System Design" />
    <meta property="og:title" content="System Design Series Part 8: CAP Theorem & Consistency" />
    <meta property="og:description" content="Master CAP theorem and consistency models for building reliable distributed systems." />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2026-01-25" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />
    
    <title>System Design Series Part 8: CAP Theorem & Consistency - Wasil Zafar</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', { 'ad_storage': 'denied', 'ad_user_data': 'denied', 'ad_personalization': 'denied', 'analytics_storage': 'denied', 'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE'] });
        gtag('consent', 'default', { 'ad_storage': 'granted', 'ad_user_data': 'granted', 'ad_personalization': 'granted', 'analytics_storage': 'granted' });
        gtag('set', 'url_passthrough', true);
    </script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PBS8M2JR');</script>

    </head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div id="cookieBanner" class="light display-bottom" style="display: none;">
        <div class="content-wrap">
            <div class="msg-wrap"><p style="font-size: 14px; color: var(--color-navy);">We use cookies. See our <a href="/privacy-policy.html" style="color: var(--color-teal);">Privacy Policy</a>.</p></div>
            <div class="btn-wrap">
                <button id="cookieAccept" style="background: var(--color-teal); color: white;">Accept All</button>
                <button id="cookieReject" style="background: transparent; color: var(--color-navy); border: 2px solid var(--color-teal);">Reject All</button>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/"><span class="gradient-text">Wasil Zafar</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#skills">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#certifications">Certifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#interests">Interests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
                <h1 class="display-4 fw-bold mb-3">System Design Series Part 8: CAP Theorem & Consistency</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>January 25, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>35 min read</span>
                    <button onclick="window.print()" class="print-btn"><i class="fas fa-print"></i> Print</button>
                </div>
                <p class="lead">Master distributed systems fundamentals with CAP theorem and consistency models. Understand the trade-offs between consistency, availability, and partition tolerance in real-world systems.</p>
            </div>
        </div>
    </section>

    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents"><i class="fas fa-list"></i></button>

    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()">&times;</button>
        </div>
        <ol>
            <li><a href="#cap-theorem" onclick="closeNav()">CAP Theorem</a>
                <ul>
                    <li><a href="#cap-theorem" onclick="closeNav()">The Three Guarantees</a></li>
                    <li><a href="#cap-tradeoffs" onclick="closeNav()">CAP Trade-offs</a></li>
                </ul>
            </li>
            <li><a href="#consistency-models" onclick="closeNav()">Consistency Models</a>
                <ul>
                    <li><a href="#consistency-models" onclick="closeNav()">Strong Consistency</a></li>
                    <li><a href="#eventual" onclick="closeNav()">Eventual Consistency</a></li>
                </ul>
            </li>
            <li><a href="#consensus" onclick="closeNav()">Consensus Algorithms</a>
                <ul>
                    <li><a href="#consensus" onclick="closeNav()">Paxos & Raft</a></li>
                    <li><a href="#practical" onclick="closeNav()">Practical Applications</a></li>
                </ul>
            </li>
            <li><a href="#next-steps" onclick="closeNav()">Next Steps</a></li>
        </ol>
    </div>

    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <div id="cap-theorem" class="blog-content">
                    <h2><i class="fas fa-balance-scale me-2 text-teal"></i>CAP Theorem</h2>
                    
                    <div class="highlight-box" style="background: rgba(191, 9, 47, 0.1); border-left-color: var(--color-crimson);">
                        <i class="fas fa-book me-2"></i>
                        <strong>Series Navigation:</strong> This is Part 8 of the 15-part System Design Series. <a href="system-design-message-queues-event-driven.html">Review Part 7: Message Queues</a> first.
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">15-Part Series</span>
                            <span class="badge bg-crimson">System Design Mastery</span>
                        </div>
                        <div class="content">
                            <ol>
                                <li><a href="system-design-introduction.html">Introduction to System Design</a> - Fundamentals, why it matters, key concepts</li>
                                <li><a href="system-design-scalability-fundamentals.html">Scalability Fundamentals</a> - Horizontal vs vertical scaling, stateless design</li>
                                <li><a href="system-design-load-balancing-caching.html">Load Balancing & Caching</a> - Algorithms, Redis, CDN patterns</li>
                                <li><a href="system-design-database-sharding.html">Database Design & Sharding</a> - SQL vs NoSQL, replication, partitioning</li>
                                <li><a href="system-design-microservices-architecture.html">Microservices Architecture</a> - Service decomposition, API gateways, sagas</li>
                                <li><a href="system-design-api-rest-graphql.html">API Design & REST/GraphQL</a> - RESTful principles, GraphQL, gRPC</li>
                                <li><a href="system-design-message-queues-event-driven.html">Message Queues & Event-Driven</a> - Kafka, RabbitMQ, event sourcing</li>
                                <li><strong>CAP Theorem & Consistency (This Guide)</strong> - Distributed trade-offs, eventual consistency</li>
                                <li><a href="system-design-rate-limiting-security.html">Rate Limiting & Security</a> - Throttling algorithms, DDoS protection</li>
                                <li><a href="system-design-monitoring-observability.html">Monitoring & Observability</a> - Logging, metrics, distributed tracing</li>
                                <li><a href="system-design-real-world-case-studies.html">Real-World Case Studies</a> - URL shortener, chat, feed, video streaming</li>
                                <li><a href="system-design-low-level-design-patterns.html">Low-Level Design Patterns</a> - SOLID, OOP patterns, data modeling</li>
                                <li><a href="system-design-distributed-systems-deep-dive.html">Distributed Systems Deep Dive</a> - Consensus, Paxos, Raft, coordination</li>
                                <li><a href="system-design-authentication-security.html">Authentication & Security</a> - OAuth, JWT, zero trust, compliance</li>
                                <li><a href="system-design-interview-preparation.html">Interview Preparation</a> - 4-step framework, estimation, strategies</li>
                            </ol>
                        </div>
                    </div>
                    
                    <p>The <strong>CAP theorem</strong> states that a distributed system can provide at most two of three guarantees simultaneously: Consistency, Availability, and Partition tolerance. Understanding these trade-offs is fundamental to designing reliable distributed systems.</p>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Key Insight:</strong> In practice, partition tolerance is non-negotiable in distributed systems. The real choice is between consistency and availability during network partitions.
                    </div>

                    <h3>The Three Guarantees</h3>
                    <ul>
                        <li><strong>Consistency (C):</strong> Every read receives the most recent write or an error. All nodes see the same data at the same time.</li>
                        <li><strong>Availability (A):</strong> Every request receives a non-error response, without guarantee it's the most recent write.</li>
                        <li><strong>Partition Tolerance (P):</strong> System continues operating despite arbitrary message loss or failure between nodes.</li>
                    </ul>

                    <div class="experiment-card">
                        <h4><i class="fas fa-network-wired me-2"></i>CAP Visualization</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># CAP Theorem - You can only pick 2 out of 3

        Consistency (C)
             /\
            /  \
           /    \
          /  CA  \     # CA: Consistent + Available
         /________\    # (Not partition tolerant)
        /\        /\
       /  \      /  \
      / CP \    / AP \
     /______\  /______\
    Partition    Availability
    Tolerance (P)     (A)

# CP Systems: Consistent + Partition Tolerant
#   - May become unavailable during partitions
#   - Examples: MongoDB, HBase, Redis Cluster

# AP Systems: Available + Partition Tolerant  
#   - May return stale data during partitions
#   - Examples: Cassandra, DynamoDB, CouchDB

# CA Systems: Consistent + Available
#   - Cannot tolerate network partitions
#   - Examples: Traditional RDBMS (single node)</code></pre>
                        </div>
                    </div>
                </div>

                <div id="cap-tradeoffs" class="blog-content mt-5">
                    <h3>CAP Trade-offs</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-check-double me-2"></i>CP Systems (Consistency + Partition Tolerance)</h4>
                        <div class="experiment-content">
                            <p>Prioritize consistency over availability. During network partitions, the system may reject requests to maintain consistency.</p>
<pre><code class="language-python"># CP System Behavior During Partition

# Normal operation
Client --> Node A --> Node B --> Node C
           (Write)   (Replicate) (Replicate)
# All nodes have consistent data

# During network partition
Client --> Node A    [PARTITION]    Node B, C
# Node A can't confirm replication to B and C
# CP system OPTIONS:
# 1. Reject the write (preserve consistency)
# 2. Accept write but return error until sync
# 3. Block until partition heals

# Example: MongoDB with majority write concern
from pymongo import MongoClient, WriteConcern

client = MongoClient('mongodb://localhost:27017')
db = client.mydb

# Require majority of nodes to acknowledge write
collection = db.get_collection(
    'orders',
    write_concern=WriteConcern(w='majority', wtimeout=5000)
)

try:
    result = collection.insert_one({'order_id': '123', 'status': 'new'})
    print("Write acknowledged by majority")
except Exception as e:
    print(f"Write failed - partition or timeout: {e}")
    # System chose Consistency over Availability</code></pre>
                            <p><strong>Use when:</strong> Financial transactions, inventory systems, any data where correctness is critical</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">MongoDB</span>
                            <span class="bias-tag">HBase</span>
                            <span class="bias-tag">ZooKeeper</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-globe me-2"></i>AP Systems (Availability + Partition Tolerance)</h4>
                        <div class="experiment-content">
                            <p>Prioritize availability over consistency. During partitions, nodes continue serving requests with potentially stale data.</p>
<pre><code class="language-python"># AP System Behavior During Partition

# Normal operation
Client --> Node A --> Node B --> Node C
           (Write)   (Async)    (Async)
# Writes replicate asynchronously

# During network partition
Client A --> Node A    [PARTITION]    Node B <-- Client B
(Write X=1)                           (Read X=?)

# AP system response:
# - Node A accepts write (X=1)
# - Node B serves read with old value (X=0)
# - Both clients get responses (Available!)
# - Data is temporarily inconsistent
# - After partition heals: conflict resolution

# Example: Cassandra with eventual consistency
from cassandra.cluster import Cluster
from cassandra import ConsistencyLevel

cluster = Cluster(['node1', 'node2', 'node3'])
session = cluster.connect('mydb')

# Write with ONE consistency (highly available)
session.execute(
    "INSERT INTO orders (id, status) VALUES (%s, %s)",
    ('123', 'new'),
    consistency_level=ConsistencyLevel.ONE  # Just one node needed
)

# Read with ONE consistency (may get stale data)
result = session.execute(
    "SELECT * FROM orders WHERE id = %s",
    ('123',),
    consistency_level=ConsistencyLevel.ONE
)</code></pre>
                            <p><strong>Use when:</strong> Social media feeds, user sessions, analytics, shopping carts</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Cassandra</span>
                            <span class="bias-tag">DynamoDB</span>
                            <span class="bias-tag">CouchDB</span>
                        </div>
                    </div>

                    <h4>CAP in Practice: System Comparison</h4>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Database</th>
                                <th>Default</th>
                                <th>Configurable</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>MongoDB</strong></td>
                                <td>CP</td>
                                <td>Yes</td>
                                <td>Write concern adjustable</td>
                            </tr>
                            <tr>
                                <td><strong>Cassandra</strong></td>
                                <td>AP</td>
                                <td>Yes</td>
                                <td>Tunable consistency per query</td>
                            </tr>
                            <tr>
                                <td><strong>DynamoDB</strong></td>
                                <td>AP</td>
                                <td>Yes</td>
                                <td>Strong consistency option available</td>
                            </tr>
                            <tr>
                                <td><strong>Redis Cluster</strong></td>
                                <td>CP</td>
                                <td>Limited</td>
                                <td>Async replication with CP failover</td>
                            </tr>
                            <tr>
                                <td><strong>CockroachDB</strong></td>
                                <td>CP</td>
                                <td>No</td>
                                <td>Serializable isolation always</td>
                            </tr>
                            <tr>
                                <td><strong>PostgreSQL</strong></td>
                                <td>CA</td>
                                <td>N/A</td>
                                <td>Single node, no partition tolerance</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="consistency-models" class="blog-content mt-5">
                    <h2><i class="fas fa-sync me-2 text-teal"></i>Consistency Models</h2>
                    <p>Consistency models define the guarantees a distributed system provides about the order and visibility of operations across nodes.</p>

                    <h3>Strong Consistency</h3>
                    <div class="experiment-card">
                        <h4><i class="fas fa-lock me-2"></i>Linearizability</h4>
                        <div class="experiment-content">
                            <p>The strongest consistency model. Operations appear instantaneous and in a global order that respects real-time.</p>
<pre><code class="language-python"># Linearizability: Operations have a single, global order
# Once a write completes, all subsequent reads see it

Timeline:
Client A: |--Write(X=1)--|
Client B:                    |--Read(X)--|  # Must see X=1
Client C:               |--Read(X)--|       # May see X=0 or X=1
                        # (read started before write completed)

# Linearizable systems guarantee:
# 1. After write returns, all reads see new value
# 2. If read returns new value, all subsequent reads do too
# 3. Operations are totally ordered

# Implementation typically requires:
# - Consensus protocol (Raft, Paxos)
# - Quorum reads and writes
# - Coordination overhead (higher latency)</code></pre>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-database me-2"></i>Sequential Consistency</h4>
                        <div class="experiment-content">
                            <p>Operations appear in a global order consistent with each client's program order, but not necessarily real-time order.</p>
<pre><code class="language-python"># Sequential Consistency Example
# All clients see same order, but may not match wall-clock time

# Client A operations:
A1: Write(X=1)
A2: Write(Y=1)

# Client B operations:
B1: Read(Y) -> 1
B2: Read(X) -> 0  # This is VALID in sequential consistency!

# Valid global ordering: A1, B2, B1, A2
# - Respects A's order (A1 before A2)
# - Respects B's order (B1 before B2)
# - But doesn't respect real-time (A2 "happened before" B1)

# Sequential consistency is weaker than linearizability
# because it doesn't preserve real-time ordering</code></pre>
                        </div>
                    </div>
                </div>

                <div id="eventual" class="blog-content mt-5">
                    <h3>Eventual Consistency</h3>
                    <p>If no new updates are made, eventually all replicas will converge to the same value. The "eventually" can range from milliseconds to hours.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-clock me-2"></i>Eventual Consistency in Action</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># Eventual Consistency Example: DNS
# When you update a DNS record, it propagates gradually

# T=0: Update DNS record
update_dns("example.com", "1.2.3.4", "5.6.7.8")

# T=1s: Server 1 sees new IP (5.6.7.8)
# T=5s: Server 2 still has old IP (1.2.3.4)
# T=30s: Server 3 gets update (5.6.7.8)
# T=60s: All servers consistent (5.6.7.8)

# Another example: Shopping cart in DynamoDB
class ShoppingCart:
    def add_item(self, user_id, item):
        # Write to nearest region (low latency)
        self.db.put_item(
            TableName='carts',
            Item={
                'user_id': user_id,
                'items': self.get_items(user_id) + [item],
                'updated_at': time.time()
            }
        )
        # Replication to other regions happens async
        # User in another region may see stale cart briefly
    
    def get_items(self, user_id):
        # Eventually consistent read (fast, cheap)
        response = self.db.get_item(
            TableName='carts',
            Key={'user_id': user_id},
            ConsistentRead=False  # Eventually consistent
        )
        return response.get('Item', {}).get('items', [])</code></pre>
                        </div>
                    </div>

                    <h4>Tunable Consistency (Cassandra/DynamoDB)</h4>
<pre><code class="language-python"># Cassandra Tunable Consistency
# N = Total replicas, W = Write acknowledgments, R = Read acknowledgments

# Strong consistency: W + R > N
# Example: N=3, W=2, R=2 (quorum)
# At least one node in read overlaps with write

# Eventual consistency: W + R <= N  
# Example: N=3, W=1, R=1
# Reads may miss recent writes

# Common configurations:
# QUORUM: W=N/2+1, R=N/2+1 (strong, balanced)
# ONE/ONE: W=1, R=1 (fast, eventual)
# ALL/ONE: W=N, R=1 (write slow, read fast, strong)
# ONE/ALL: W=1, R=N (write fast, read slow, strong)</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>PACELC Extension:</strong> During Partition: choose Availability or Consistency. Else: choose Latency or Consistency. Even without partitions, there's a latency-consistency trade-off.
                    </div>
                </div>

                <div id="consensus" class="blog-content mt-5">
                    <h2><i class="fas fa-handshake me-2 text-teal"></i>Consensus Algorithms</h2>
                    <p>Consensus algorithms enable distributed nodes to agree on a single value even when some nodes fail. They are the foundation of consistent distributed systems.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-vote-yea me-2"></i>Raft Consensus</h4>
                        <div class="experiment-content">
                            <p>Raft is designed to be understandable. It uses leader election and log replication.</p>
<pre><code class="language-python"># Raft Consensus Overview

# Node States
class NodeState:
    FOLLOWER = "follower"   # Default state, follows leader
    CANDIDATE = "candidate"  # Seeking to become leader
    LEADER = "leader"        # Accepts writes, replicates to followers

# Key Components:
# 1. Leader Election
# 2. Log Replication
# 3. Safety

class RaftNode:
    def __init__(self, node_id, peers):
        self.node_id = node_id
        self.peers = peers
        self.state = NodeState.FOLLOWER
        self.current_term = 0
        self.voted_for = None
        self.log = []  # List of (term, command) entries
        self.commit_index = 0
        self.last_applied = 0
        self.election_timeout = random.uniform(150, 300)  # ms
    
    def start_election(self):
        """Follower timeout -> become candidate"""
        self.state = NodeState.CANDIDATE
        self.current_term += 1
        self.voted_for = self.node_id
        votes = 1  # Vote for self
        
        # Request votes from all peers
        for peer in self.peers:
            response = peer.request_vote(
                term=self.current_term,
                candidate_id=self.node_id,
                last_log_index=len(self.log) - 1,
                last_log_term=self.log[-1][0] if self.log else 0
            )
            if response.vote_granted:
                votes += 1
        
        # Majority wins
        if votes > len(self.peers) // 2:
            self.become_leader()
    
    def become_leader(self):
        """Won election -> start leading"""
        self.state = NodeState.LEADER
        # Send heartbeats to prevent new elections
        self.send_heartbeats()
    
    def append_entries(self, command):
        """Leader receives client command"""
        if self.state != NodeState.LEADER:
            return redirect_to_leader()
        
        # Append to local log
        self.log.append((self.current_term, command))
        
        # Replicate to followers
        success_count = 1
        for peer in self.peers:
            if peer.replicate_log(self.log):
                success_count += 1
        
        # Commit when majority has entry
        if success_count > len(self.peers) // 2:
            self.commit_index = len(self.log) - 1
            self.apply_command(command)
            return success</code></pre>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">etcd</span>
                            <span class="bias-tag">Consul</span>
                            <span class="bias-tag">CockroachDB</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-scroll me-2"></i>Paxos Consensus</h4>
                        <div class="experiment-content">
                            <p>Paxos is the original consensus algorithm. More complex but more flexible than Raft.</p>
<pre><code class="language-python"># Paxos Basic Protocol (Single-Decree)
# Three roles: Proposers, Acceptors, Learners

# Phase 1: Prepare
class Proposer:
    def prepare(self, proposal_number):
        """Send prepare request to acceptors"""
        promises = []
        for acceptor in self.acceptors:
            promise = acceptor.receive_prepare(proposal_number)
            if promise:
                promises.append(promise)
        
        # Need majority of promises to proceed
        if len(promises) > len(self.acceptors) // 2:
            return self.phase2(proposal_number, promises)

class Acceptor:
    def __init__(self):
        self.promised_number = 0
        self.accepted_number = 0
        self.accepted_value = None
    
    def receive_prepare(self, proposal_number):
        """Promise not to accept lower-numbered proposals"""
        if proposal_number > self.promised_number:
            self.promised_number = proposal_number
            return Promise(
                accepted_number=self.accepted_number,
                accepted_value=self.accepted_value
            )
        return None  # Reject

# Phase 2: Accept
class Proposer:
    def phase2(self, proposal_number, promises):
        """Send accept request with value"""
        # Use highest-numbered accepted value, or propose own
        value = self.choose_value(promises)
        
        accepts = 0
        for acceptor in self.acceptors:
            if acceptor.receive_accept(proposal_number, value):
                accepts += 1
        
        if accepts > len(self.acceptors) // 2:
            # Value is chosen! Notify learners
            self.notify_learners(value)

class Acceptor:
    def receive_accept(self, proposal_number, value):
        """Accept if we haven't promised higher"""
        if proposal_number >= self.promised_number:
            self.promised_number = proposal_number
            self.accepted_number = proposal_number
            self.accepted_value = value
            return True
        return False</code></pre>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Chubby</span>
                            <span class="bias-tag">Spanner</span>
                        </div>
                    </div>

                    <h4>Consensus Algorithm Comparison</h4>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Algorithm</th>
                                <th>Complexity</th>
                                <th>Performance</th>
                                <th>Used By</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Raft</strong></td>
                                <td>Understandable</td>
                                <td>Good</td>
                                <td>etcd, Consul, TiKV</td>
                            </tr>
                            <tr>
                                <td><strong>Paxos</strong></td>
                                <td>Complex</td>
                                <td>Good</td>
                                <td>Chubby, Spanner</td>
                            </tr>
                            <tr>
                                <td><strong>ZAB</strong></td>
                                <td>Moderate</td>
                                <td>Good</td>
                                <td>ZooKeeper</td>
                            </tr>
                            <tr>
                                <td><strong>PBFT</strong></td>
                                <td>High</td>
                                <td>Lower</td>
                                <td>Blockchain (Hyperledger)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="practical" class="blog-content mt-5">
                    <h3>Practical Applications</h3>

                    <div class="experiment-card">
                        <h4><i class="fas fa-shopping-cart me-2"></i>E-commerce Inventory</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># Problem: Prevent overselling during flash sales
# Solution: Strong consistency for inventory

class InventoryService:
    def __init__(self, db):
        self.db = db  # Using CP database (e.g., CockroachDB)
    
    def reserve_stock(self, product_id, quantity):
        """Atomic stock reservation with optimistic locking"""
        with self.db.transaction() as tx:
            # Read current stock with lock
            product = tx.execute(
                "SELECT stock, version FROM products WHERE id = %s FOR UPDATE",
                (product_id,)
            ).fetchone()
            
            if product['stock'] < quantity:
                raise InsufficientStockError()
            
            # Decrement stock with version check
            result = tx.execute("""
                UPDATE products 
                SET stock = stock - %s, version = version + 1
                WHERE id = %s AND version = %s
            """, (quantity, product_id, product['version']))
            
            if result.rowcount == 0:
                raise ConcurrencyConflictError("Retry")
            
            return ReservationConfirmed(product_id, quantity)</code></pre>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-comments me-2"></i>Social Media Timeline</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># Problem: Show user posts in timeline
# Solution: Eventual consistency is acceptable

class TimelineService:
    def __init__(self, cassandra):
        self.db = cassandra  # AP database
    
    def get_timeline(self, user_id):
        """Get timeline with eventual consistency (fast)"""
        # Eventual consistent read - may miss recent posts
        return self.db.execute(
            "SELECT * FROM timeline WHERE user_id = %s LIMIT 100",
            (user_id,),
            consistency_level=ConsistencyLevel.ONE
        )
    
    def post_update(self, user_id, content):
        """Write post, fan out asynchronously"""
        post_id = generate_id()
        
        # Write to posts table
        self.db.execute(
            "INSERT INTO posts (id, user_id, content, created_at) VALUES (%s, %s, %s, %s)",
            (post_id, user_id, content, datetime.now()),
            consistency_level=ConsistencyLevel.QUORUM  # Durable write
        )
        
        # Async fan-out to followers' timelines
        self.queue.publish('timeline-fanout', {
            'post_id': post_id,
            'author_id': user_id
        })</code></pre>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <i class="fas fa-balance-scale"></i>
                        <strong>Design Decision Framework:</strong>
                        <ul>
                            <li><strong>Financial data:</strong> Strong consistency (CP)</li>
                            <li><strong>User sessions:</strong> Eventual consistency (AP)</li>
                            <li><strong>Inventory:</strong> Strong consistency for decrements</li>
                            <li><strong>Analytics:</strong> Eventual consistency</li>
                            <li><strong>Configuration:</strong> Strong consistency (etcd/Consul)</li>
                        </ul>
                    </div>
                </div>

                <div id="next-steps" class="blog-content mt-5">
                    <h2><i class="fas fa-arrow-right me-2 text-teal"></i>Next Steps</h2>
                    
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 7: Message Queues & Event-Driven</h5>
                            <p class="text-muted small mb-2">Review message queues and event-driven architecture patterns.</p>
                            <a href="system-design-message-queues-event-driven.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 9: Rate Limiting & Security</h5>
                            <p class="text-muted small mb-2">Learn rate limiting algorithms and security best practices.</p>
                            <a href="system-design-rate-limiting-security.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 10: Monitoring & Observability</h5>
                            <p class="text-muted small mb-2">Master monitoring, logging, and distributed tracing.</p>
                            <a href="system-design-monitoring-observability.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">
                        I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest">
                            <i class="fab fa-pinterest-p"></i>
                        </a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <hr class="bg-secondary">

            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small">
                        <i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a>
                    </p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">
                        Enjoying this content? ☕ <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <button id="scrollToTop" class="scroll-to-top"><i class="fas fa-arrow-up"></i></button>
    <!-- Category Indicator -->
    <div id="categoryIndicator" class="category-indicator" title="Current Section">
        <i class="fas fa-tag"></i><span id="categoryText">Technology</span>
    </div>
    <script src="../../../js/cookie-consent.js"></script>
    <script src="../../../js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

            </body>
</html>
