<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Master database design patterns and sharding strategies for scalable systems. Learn SQL vs NoSQL, partitioning, replication, and distributed database architectures." />
    <meta name="author" content="Wasil Zafar" />
    <meta name="keywords" content="Database Design, Sharding, Partitioning, SQL, NoSQL, Replication, Distributed Databases, System Design, Data Modeling" />
    <meta property="og:title" content="System Design Series Part 4: Database Design & Sharding" />
    <meta property="og:description" content="Master database design patterns and sharding strategies for building scalable distributed systems." />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2026-01-25" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />
    
    <title>System Design Series Part 4: Database Design & Sharding - Wasil Zafar</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', { 'ad_storage': 'denied', 'ad_user_data': 'denied', 'ad_personalization': 'denied', 'analytics_storage': 'denied', 'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE'] });
        gtag('consent', 'default', { 'ad_storage': 'granted', 'ad_user_data': 'granted', 'ad_personalization': 'granted', 'analytics_storage': 'granted' });
        gtag('set', 'url_passthrough', true);
    </script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PBS8M2JR');</script>

    </head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div id="cookieBanner" class="light display-bottom" style="display: none;">
        <div class="content-wrap">
            <div class="msg-wrap"><p style="font-size: 14px; color: var(--color-navy);">We use cookies. See our <a href="/privacy-policy.html" style="color: var(--color-teal);">Privacy Policy</a>.</p></div>
            <div class="btn-wrap">
                <button id="cookieAccept" style="background: var(--color-teal); color: white;">Accept All</button>
                <button id="cookieReject" style="background: transparent; color: var(--color-navy); border: 2px solid var(--color-teal);">Reject All</button>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/"><span class="gradient-text">Wasil Zafar</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#skills">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#certifications">Certifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#interests">Interests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
                <h1 class="display-4 fw-bold mb-3">System Design Series Part 4: Database Design & Sharding</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>January 25, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>40 min read</span>
                    <button onclick="window.print()" class="print-btn"><i class="fas fa-print"></i> Print</button>
                </div>
                <p class="lead">Master database design patterns and sharding strategies for building scalable systems. Learn SQL vs NoSQL trade-offs, partitioning strategies, replication, and distributed database architectures.</p>
            </div>
        </div>
    </section>

    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents"><i class="fas fa-list"></i></button>

    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()">&times;</button>
        </div>
        <ol>
            <li><a href="#database-fundamentals" onclick="closeNav()">Database Fundamentals</a>
                <ul>
                    <li><a href="#database-fundamentals" onclick="closeNav()">SQL vs NoSQL</a></li>
                    <li><a href="#acid" onclick="closeNav()">ACID Properties</a></li>
                </ul>
            </li>
            <li><a href="#sharding" onclick="closeNav()">Sharding Strategies</a>
                <ul>
                    <li><a href="#sharding" onclick="closeNav()">Horizontal Partitioning</a></li>
                    <li><a href="#shard-keys" onclick="closeNav()">Choosing Shard Keys</a></li>
                </ul>
            </li>
            <li><a href="#replication" onclick="closeNav()">Replication</a>
                <ul>
                    <li><a href="#replication" onclick="closeNav()">Master-Slave</a></li>
                    <li><a href="#consistency" onclick="closeNav()">Consistency Models</a></li>
                </ul>
            </li>
            <li><a href="#next-steps" onclick="closeNav()">Next Steps</a></li>
        </ol>
    </div>

    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <div id="database-fundamentals" class="blog-content">
                    <h2><i class="fas fa-database me-2 text-teal"></i>Database Fundamentals</h2>
                    
                    <div class="highlight-box crimson">
                        <i class="fas fa-book me-2"></i>
                        <strong>Series Navigation:</strong> This is Part 4 of the 15-part System Design Series. <a href="system-design-load-balancing-caching.html">Review Part 3: Load Balancing & Caching</a> first.
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">15-Part Series</span>
                            <span class="badge bg-crimson">System Design Mastery</span>
                        </div>
                        <div class="content">
                            <ol>
                                <li><a href="system-design-introduction.html">Introduction to System Design</a> - Fundamentals, why it matters, key concepts</li>
                                <li><a href="system-design-scalability-fundamentals.html">Scalability Fundamentals</a> - Horizontal vs vertical scaling, stateless design</li>
                                <li><a href="system-design-load-balancing-caching.html">Load Balancing & Caching</a> - Algorithms, Redis, CDN patterns</li>
                                <li><strong>Database Design & Sharding (This Guide)</strong> - SQL vs NoSQL, replication, partitioning</li>
                                <li><a href="system-design-microservices-architecture.html">Microservices Architecture</a> - Service decomposition, API gateways, sagas</li>
                                <li><a href="system-design-api-rest-graphql.html">API Design & REST/GraphQL</a> - RESTful principles, GraphQL, gRPC</li>
                                <li><a href="system-design-message-queues-event-driven.html">Message Queues & Event-Driven</a> - Kafka, RabbitMQ, event sourcing</li>
                                <li><a href="system-design-cap-theorem-consistency.html">CAP Theorem & Consistency</a> - Distributed trade-offs, eventual consistency</li>
                                <li><a href="system-design-rate-limiting-security.html">Rate Limiting & Security</a> - Throttling algorithms, DDoS protection</li>
                                <li><a href="system-design-monitoring-observability.html">Monitoring & Observability</a> - Logging, metrics, distributed tracing</li>
                                <li><a href="system-design-real-world-case-studies.html">Real-World Case Studies</a> - URL shortener, chat, feed, video streaming</li>
                                <li><a href="system-design-low-level-design-patterns.html">Low-Level Design Patterns</a> - SOLID, OOP patterns, data modeling</li>
                                <li><a href="system-design-distributed-systems-deep-dive.html">Distributed Systems Deep Dive</a> - Consensus, Paxos, Raft, coordination</li>
                                <li><a href="system-design-authentication-security.html">Authentication & Security</a> - OAuth, JWT, zero trust, compliance</li>
                                <li><a href="system-design-interview-preparation.html">Interview Preparation</a> - 4-step framework, estimation, strategies</li>
                            </ol>
                        </div>
                    </div>
                    
                    <p><strong>Database design</strong> is one of the most critical decisions in system architecture. The choice between SQL and NoSQL, along with proper sharding strategies, directly impacts scalability, performance, and maintainability.</p>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Key Insight:</strong> There's no one-size-fits-all database. Understanding your data access patterns is crucial for making the right choice.
                    </div>

                    <h3>SQL vs NoSQL: The Fundamental Choice</h3>
                    <p>Before diving into advanced topics, understand the core differences:</p>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Aspect</th>
                                <th>SQL (Relational)</th>
                                <th>NoSQL (Non-Relational)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Schema</strong></td>
                                <td>Fixed schema, enforced structure</td>
                                <td>Dynamic/flexible schema</td>
                            </tr>
                            <tr>
                                <td><strong>Scaling</strong></td>
                                <td>Vertical (scale up)</td>
                                <td>Horizontal (scale out)</td>
                            </tr>
                            <tr>
                                <td><strong>Consistency</strong></td>
                                <td>Strong ACID guarantees</td>
                                <td>Eventually consistent (BASE)</td>
                            </tr>
                            <tr>
                                <td><strong>Query Language</strong></td>
                                <td>SQL (standardized)</td>
                                <td>Varies by database</td>
                            </tr>
                            <tr>
                                <td><strong>Joins</strong></td>
                                <td>Powerful multi-table joins</td>
                                <td>Limited/no joins</td>
                            </tr>
                            <tr>
                                <td><strong>Best For</strong></td>
                                <td>Complex queries, transactions</td>
                                <td>High volume, flexible data</td>
                            </tr>
                            <tr>
                                <td><strong>Examples</strong></td>
                                <td>PostgreSQL, MySQL, SQL Server</td>
                                <td>MongoDB, Cassandra, DynamoDB</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>NoSQL Database Types</h3>
                    <div class="experiment-card">
                        <h4><i class="fas fa-file-alt me-2"></i>Document Stores</h4>
                        <div class="experiment-content">
                            <p>Store data as JSON-like documents. Each document can have different structure.</p>
<pre><code class="language-json">// MongoDB document example
{
    "_id": "user_123",
    "name": "John Doe",
    "email": "john@example.com",
    "orders": [
        {"id": "ord_1", "total": 99.99, "items": 3},
        {"id": "ord_2", "total": 149.50, "items": 2}
    ],
    "preferences": {
        "newsletter": true,
        "notifications": ["email", "sms"]
    }
}</code></pre>
                            <p><strong>Use cases:</strong> Content management, user profiles, product catalogs<br>
                            <strong>Examples:</strong> MongoDB, CouchDB, Firestore</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Flexible Schema</span>
                            <span class="bias-tag">JSON Documents</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-key me-2"></i>Key-Value Stores</h4>
                        <div class="experiment-content">
                            <p>Simplest NoSQL type. Store data as key-value pairs with O(1) lookups.</p>
<pre><code class="language-python"># Redis key-value operations
import redis
r = redis.Redis()

# Simple string
r.set("user:123:name", "John Doe")
r.get("user:123:name")  # b"John Doe"

# Hash (object-like)
r.hset("user:123", mapping={
    "name": "John Doe",
    "email": "john@example.com",
    "login_count": 42
})
r.hgetall("user:123")</code></pre>
                            <p><strong>Use cases:</strong> Caching, session storage, real-time data<br>
                            <strong>Examples:</strong> Redis, Memcached, DynamoDB</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Ultra Fast</span>
                            <span class="bias-tag">Simple API</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-columns me-2"></i>Wide-Column Stores</h4>
                        <div class="experiment-content">
                            <p>Store data in column families. Optimized for queries over large datasets.</p>
<pre><code class="language-sql">-- Cassandra CQL example
CREATE TABLE user_activity (
    user_id UUID,
    timestamp TIMESTAMP,
    action TEXT,
    details MAP&lt;TEXT, TEXT&gt;,
    PRIMARY KEY (user_id, timestamp)
) WITH CLUSTERING ORDER BY (timestamp DESC);

-- Query last 100 activities for a user
SELECT * FROM user_activity 
WHERE user_id = ? 
LIMIT 100;</code></pre>
                            <p><strong>Use cases:</strong> Time-series data, IoT, logging, analytics<br>
                            <strong>Examples:</strong> Cassandra, HBase, ScyllaDB</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">High Write Throughput</span>
                            <span class="bias-tag">Time Series</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-project-diagram me-2"></i>Graph Databases</h4>
                        <div class="experiment-content">
                            <p>Optimized for storing and querying relationships between entities.</p>
<pre><code class="language-sql">-- Neo4j Cypher query example
// Find friends of friends who also like "Science Fiction"
MATCH (user:Person {name: "Alice"})-[:FRIEND]->(friend)-[:FRIEND]->(fof)
WHERE (fof)-[:LIKES]->(:Genre {name: "Science Fiction"})
AND NOT (user)-[:FRIEND]->(fof)
RETURN DISTINCT fof.name AS recommendation

// Find shortest path between two users
MATCH path = shortestPath(
    (a:Person {name: "Alice"})-[:FRIEND*]-(b:Person {name: "Bob"})
)
RETURN path</code></pre>
                            <p><strong>Use cases:</strong> Social networks, recommendations, fraud detection<br>
                            <strong>Examples:</strong> Neo4j, Amazon Neptune, JanusGraph</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Relationships</span>
                            <span class="bias-tag">Traversals</span>
                        </div>
                    </div>
                </div>

                <div id="acid" class="blog-content mt-5">
                    <h3>ACID Properties</h3>
                    <p><strong>ACID</strong> guarantees are fundamental to relational databases and critical for financial systems, inventory management, and any application where data integrity is paramount.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-atom me-2"></i>Atomicity</h4>
                        <div class="experiment-content">
                            <p>Transactions are "all or nothing." Either all operations succeed, or none do.</p>
<pre><code class="language-sql">-- Bank transfer: Must be atomic
BEGIN TRANSACTION;

-- Debit from source account
UPDATE accounts SET balance = balance - 100 WHERE id = 'account_A';

-- Credit to destination account
UPDATE accounts SET balance = balance + 100 WHERE id = 'account_B';

-- If both succeed, commit; otherwise rollback
COMMIT;  -- or ROLLBACK if any step fails</code></pre>
                            <p>Without atomicity, a system crash between the two UPDATEs could leave money "lost."</p>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-check-double me-2"></i>Consistency</h4>
                        <div class="experiment-content">
                            <p>Database moves from one valid state to another. All constraints (foreign keys, checks, triggers) are enforced.</p>
<pre><code class="language-sql">-- Consistency enforced by constraints
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(id),
    total DECIMAL(10,2) CHECK (total >= 0),
    status VARCHAR(20) CHECK (status IN ('pending', 'shipped', 'delivered'))
);

-- This INSERT will fail if user_id doesn't exist in users table
INSERT INTO orders (user_id, total, status) VALUES (999, 50.00, 'pending');
-- ERROR: violates foreign key constraint</code></pre>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-lock me-2"></i>Isolation</h4>
                        <div class="experiment-content">
                            <p>Concurrent transactions don't interfere with each other. Different isolation levels offer different guarantees:</p>
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Level</th>
                                        <th>Dirty Read</th>
                                        <th>Non-Repeatable Read</th>
                                        <th>Phantom Read</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>READ UNCOMMITTED</td>
                                        <td>⚠️ Yes</td>
                                        <td>⚠️ Yes</td>
                                        <td>⚠️ Yes</td>
                                    </tr>
                                    <tr>
                                        <td>READ COMMITTED</td>
                                        <td>✅ No</td>
                                        <td>⚠️ Yes</td>
                                        <td>⚠️ Yes</td>
                                    </tr>
                                    <tr>
                                        <td>REPEATABLE READ</td>
                                        <td>✅ No</td>
                                        <td>✅ No</td>
                                        <td>⚠️ Yes</td>
                                    </tr>
                                    <tr>
                                        <td>SERIALIZABLE</td>
                                        <td>✅ No</td>
                                        <td>✅ No</td>
                                        <td>✅ No</td>
                                    </tr>
                                </tbody>
                            </table>
<pre><code class="language-sql">-- Set isolation level in PostgreSQL
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
BEGIN;
-- Operations here see a consistent snapshot
COMMIT;</code></pre>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-hdd me-2"></i>Durability</h4>
                        <div class="experiment-content">
                            <p>Once committed, data survives system crashes. Achieved through:</p>
                            <ul>
                                <li><strong>Write-Ahead Logging (WAL):</strong> Log changes before applying them</li>
                                <li><strong>Checkpoints:</strong> Periodic snapshots to disk</li>
                                <li><strong>Replication:</strong> Copy data to multiple servers</li>
                            </ul>
<pre><code class="language-sql">-- PostgreSQL synchronous commit (maximum durability)
SET synchronous_commit = on;

-- For slightly faster writes with small durability window
SET synchronous_commit = off;  -- Commits may be lost in crash</code></pre>
                        </div>
                    </div>

                    <h4>BASE: The NoSQL Alternative</h4>
                    <p>NoSQL databases often follow <strong>BASE</strong> properties instead:</p>
                    <ul>
                        <li><strong>Basically Available:</strong> System guarantees availability (may return stale data)</li>
                        <li><strong>Soft state:</strong> State may change over time, even without input</li>
                        <li><strong>Eventually consistent:</strong> System will become consistent over time</li>
                    </ul>
                </div>

                <div id="sharding" class="blog-content mt-5">
                    <h2><i class="fas fa-layer-group me-2 text-teal"></i>Sharding Strategies</h2>
                    <p><strong>Sharding</strong> (horizontal partitioning) distributes data across multiple database servers. Each shard holds a subset of the data, enabling horizontal scaling.</p>

                    <h3>When to Shard</h3>
                    <p>Consider sharding when:</p>
                    <ul>
                        <li>Single database can't handle read/write load</li>
                        <li>Data size exceeds single server storage</li>
                        <li>Geographic distribution required for latency</li>
                        <li>Workload isolation needed (multi-tenant systems)</li>
                    </ul>

                    <div class="highlight-box crimson">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Warning:</strong> Sharding adds significant complexity. Exhaust other options first: query optimization, caching, read replicas, connection pooling.
                    </div>

                    <h3>Sharding Approaches</h3>

                    <div class="experiment-card">
                        <h4><i class="fas fa-hashtag me-2"></i>Hash-Based Sharding</h4>
                        <div class="experiment-content">
                            <p>Apply hash function to shard key, then modulo by number of shards.</p>
<pre><code class="language-python"># Hash-based sharding
import hashlib

class HashShardRouter:
    def __init__(self, num_shards):
        self.num_shards = num_shards
        self.shards = [Database(f"shard_{i}") for i in range(num_shards)]
    
    def get_shard(self, key):
        """Determine which shard holds data for given key"""
        hash_value = int(hashlib.md5(str(key).encode()).hexdigest(), 16)
        shard_index = hash_value % self.num_shards
        return self.shards[shard_index]
    
    def insert(self, user_id, data):
        shard = self.get_shard(user_id)
        shard.insert(data)
    
    def query(self, user_id):
        shard = self.get_shard(user_id)
        return shard.query(user_id)

# Usage
router = HashShardRouter(num_shards=4)
router.insert(user_id=12345, data={"name": "John"})  # Goes to shard 1
router.insert(user_id=67890, data={"name": "Jane"})  # Goes to shard 2</code></pre>
                            <p><strong>Pros:</strong> Even distribution, simple implementation<br>
                            <strong>Cons:</strong> Resharding is expensive (all data must move when adding shards)</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Even Distribution</span>
                            <span class="bias-tag">Resharding Pain</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-ruler-horizontal me-2"></i>Range-Based Sharding</h4>
                        <div class="experiment-content">
                            <p>Partition data by value ranges. Good when queries often filter by range.</p>
<pre><code class="language-python"># Range-based sharding
class RangeShardRouter:
    def __init__(self):
        self.ranges = [
            (0, 1000000, "shard_1"),
            (1000000, 2000000, "shard_2"),
            (2000000, 3000000, "shard_3"),
            (3000000, float('inf'), "shard_4"),
        ]
        self.shards = {name: Database(name) for _, _, name in self.ranges}
    
    def get_shard(self, user_id):
        for start, end, shard_name in self.ranges:
            if start <= user_id < end:
                return self.shards[shard_name]
        raise ValueError(f"No shard for user_id {user_id}")
    
    def range_query(self, start_id, end_id):
        """Query across multiple shards for range"""
        results = []
        for range_start, range_end, shard_name in self.ranges:
            if start_id < range_end and end_id > range_start:
                shard = self.shards[shard_name]
                results.extend(shard.range_query(
                    max(start_id, range_start),
                    min(end_id, range_end)
                ))
        return results</code></pre>
                            <p><strong>Pros:</strong> Efficient range queries, easy to add new ranges<br>
                            <strong>Cons:</strong> Hot spots if data isn't evenly distributed (e.g., recent user IDs)</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Range Queries</span>
                            <span class="bias-tag">Potential Hotspots</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-map me-2"></i>Geographic Sharding</h4>
                        <div class="experiment-content">
                            <p>Partition by geographic region. Reduces latency for users in specific regions.</p>
<pre><code class="language-python"># Geographic sharding
class GeoShardRouter:
    def __init__(self):
        self.region_shards = {
            "us-east": Database("us-east-db"),
            "us-west": Database("us-west-db"),
            "eu-west": Database("eu-west-db"),
            "ap-south": Database("ap-south-db"),
        }
    
    def get_user_region(self, user):
        # Based on user's country or preference
        country_to_region = {
            "US": "us-east",
            "CA": "us-west",
            "UK": "eu-west",
            "DE": "eu-west",
            "IN": "ap-south",
        }
        return country_to_region.get(user.country, "us-east")
    
    def get_shard(self, user):
        region = self.get_user_region(user)
        return self.region_shards[region]</code></pre>
                            <p><strong>Pros:</strong> Lower latency, data residency compliance (GDPR)<br>
                            <strong>Cons:</strong> Complex cross-region queries, imbalanced load</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Low Latency</span>
                            <span class="bias-tag">Compliance</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-sitemap me-2"></i>Directory-Based Sharding</h4>
                        <div class="experiment-content">
                            <p>Use a lookup service to map keys to shards. Most flexible but adds latency.</p>
<pre><code class="language-python"># Directory-based sharding
class DirectoryShardRouter:
    def __init__(self):
        # Lookup service (could be Redis, separate database, etc.)
        self.directory = redis.Redis()
        self.shards = {
            "shard_1": Database("shard_1"),
            "shard_2": Database("shard_2"),
            "shard_3": Database("shard_3"),
        }
    
    def get_shard(self, user_id):
        # Look up which shard holds this user
        shard_name = self.directory.get(f"user:{user_id}:shard")
        
        if shard_name is None:
            # New user - assign to shard with least data
            shard_name = self._assign_to_best_shard(user_id)
        
        return self.shards[shard_name.decode()]
    
    def _assign_to_best_shard(self, user_id):
        # Find shard with smallest size
        shard_sizes = {name: shard.size() for name, shard in self.shards.items()}
        best_shard = min(shard_sizes, key=shard_sizes.get)
        
        # Record mapping
        self.directory.set(f"user:{user_id}:shard", best_shard)
        return best_shard
    
    def migrate_user(self, user_id, new_shard):
        """Move user to different shard"""
        old_shard = self.get_shard(user_id)
        data = old_shard.get_all_data(user_id)
        
        self.shards[new_shard].insert_all(user_id, data)
        old_shard.delete(user_id)
        
        # Update directory
        self.directory.set(f"user:{user_id}:shard", new_shard)</code></pre>
                            <p><strong>Pros:</strong> Flexible, easy to rebalance, supports any sharding logic<br>
                            <strong>Cons:</strong> Directory is single point of failure, lookup latency</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Flexible</span>
                            <span class="bias-tag">Easy Rebalancing</span>
                        </div>
                    </div>
                </div>

                <div id="shard-keys" class="blog-content mt-5">
                    <h3>Choosing Shard Keys</h3>
                    <p>The shard key determines how data is distributed. A good shard key:</p>
                    <ul>
                        <li><strong>Has high cardinality:</strong> Many unique values for even distribution</li>
                        <li><strong>Avoids hotspots:</strong> Doesn't concentrate writes on single shard</li>
                        <li><strong>Matches query patterns:</strong> Most queries can target single shard</li>
                        <li><strong>Is immutable:</strong> Changing shard key requires moving data</li>
                    </ul>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Example:</strong> For a social media app, sharding by <code>user_id</code> is often ideal. All user data is co-located, and most queries are user-centric. Sharding by <code>timestamp</code> would be problematic—recent data would concentrate on one shard.
                    </div>

                    <h4>Shard Key Anti-Patterns</h4>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Anti-Pattern</th>
                                <th>Problem</th>
                                <th>Better Alternative</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Monotonically increasing ID</td>
                                <td>All new writes go to last shard</td>
                                <td>Hash the ID or use compound key</td>
                            </tr>
                            <tr>
                                <td>Timestamp</td>
                                <td>Hot shard for current time range</td>
                                <td>Combine with entity ID</td>
                            </tr>
                            <tr>
                                <td>Boolean field</td>
                                <td>Only 2 possible values</td>
                                <td>Use different field</td>
                            </tr>
                            <tr>
                                <td>Country code alone</td>
                                <td>US/CN get most traffic</td>
                                <td>Compound key with user_id</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>Compound Shard Keys</h4>
<pre><code class="language-python"># Compound shard key example
class CompoundShardRouter:
    def __init__(self, num_shards):
        self.num_shards = num_shards
    
    def get_shard(self, tenant_id, user_id):
        """Shard by (tenant_id, user_id) for multi-tenant SaaS"""
        compound_key = f"{tenant_id}:{user_id}"
        hash_value = hash(compound_key)
        return hash_value % self.num_shards

# Multi-tenant: Each tenant's data distributed across shards
# Queries within tenant are efficient
# Cross-tenant queries require scatter-gather</code></pre>
                </div>

                <div id="replication" class="blog-content mt-5">
                    <h2><i class="fas fa-clone me-2 text-teal"></i>Replication</h2>
                    <p><strong>Replication</strong> copies data across multiple servers for high availability and read scaling. Unlike sharding (which divides data), replication creates copies of the same data.</p>

                    <h3>Replication Topologies</h3>

                    <div class="experiment-card">
                        <h4><i class="fas fa-arrow-right me-2"></i>Primary-Replica (Master-Slave)</h4>
                        <div class="experiment-content">
                            <p>One primary handles all writes; replicas receive copies and serve reads.</p>
<pre><code class="language-python"># Primary-Replica pattern
class PrimaryReplicaDatabase:
    def __init__(self):
        self.primary = Database("primary")
        self.replicas = [
            Database("replica_1"),
            Database("replica_2"),
            Database("replica_3")
        ]
        self.read_index = 0
    
    def write(self, key, value):
        # All writes go to primary
        self.primary.write(key, value)
        # Primary replicates to replicas asynchronously
    
    def read(self, key, consistency="eventual"):
        if consistency == "strong":
            # Read from primary for latest data
            return self.primary.read(key)
        else:
            # Round-robin across replicas
            replica = self.replicas[self.read_index % len(self.replicas)]
            self.read_index += 1
            return replica.read(key)  # May be slightly stale</code></pre>
                            <p><strong>Pros:</strong> Simple, read scaling, automatic failover<br>
                            <strong>Cons:</strong> Single write bottleneck, replication lag</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Read Scaling</span>
                            <span class="bias-tag">Simple</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-arrows-alt-h me-2"></i>Multi-Primary (Master-Master)</h4>
                        <div class="experiment-content">
                            <p>Multiple nodes accept writes. Requires conflict resolution.</p>
<pre><code class="language-python"># Multi-Primary with conflict resolution
class MultiPrimaryDatabase:
    def __init__(self):
        self.nodes = [Database(f"node_{i}") for i in range(3)]
    
    def write(self, key, value, node_index=0):
        node = self.nodes[node_index]
        
        # Attach vector clock for conflict detection
        timestamp = time.time()
        node_id = node_index
        
        record = {
            "value": value,
            "vector_clock": {node_id: timestamp}
        }
        
        node.write(key, record)
        # Replicate to other nodes asynchronously
        self._replicate(key, record, exclude=node_index)
    
    def _resolve_conflict(self, record1, record2):
        # Last-Write-Wins (simplest strategy)
        ts1 = max(record1["vector_clock"].values())
        ts2 = max(record2["vector_clock"].values())
        return record1 if ts1 > ts2 else record2
        
        # Alternative: Merge both values (application-specific)</code></pre>
                            <p><strong>Pros:</strong> Write scaling, no single point of failure<br>
                            <strong>Cons:</strong> Conflict resolution complexity, eventual consistency</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Write Scaling</span>
                            <span class="bias-tag">Conflict Resolution</span>
                        </div>
                    </div>

                    <h3>Synchronous vs Asynchronous Replication</h3>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Aspect</th>
                                <th>Synchronous</th>
                                <th>Asynchronous</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Write Latency</strong></td>
                                <td>High (wait for replicas)</td>
                                <td>Low (return immediately)</td>
                            </tr>
                            <tr>
                                <td><strong>Data Safety</strong></td>
                                <td>No data loss on primary failure</td>
                                <td>May lose recent writes</td>
                            </tr>
                            <tr>
                                <td><strong>Read Consistency</strong></td>
                                <td>Strong (replicas always current)</td>
                                <td>Eventual (replication lag)</td>
                            </tr>
                            <tr>
                                <td><strong>Availability</strong></td>
                                <td>Lower (replica failure blocks writes)</td>
                                <td>Higher (replicas independent)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Hybrid Approach:</strong> Many systems use <strong>semi-synchronous</strong> replication—wait for at least one replica to acknowledge before committing. This balances durability and performance.
                    </div>
                </div>

                <div id="consistency" class="blog-content mt-5">
                    <h3>Consistency Models</h3>
                    <p>Different consistency models offer different guarantees about when writes become visible to reads:</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-check-circle me-2"></i>Strong Consistency</h4>
                        <div class="experiment-content">
                            <p>All reads return the most recent write. System appears as single copy.</p>
<pre><code class="language-python"># Strong consistency (at cost of availability)
# Client always sees latest value

write(x, 1)  # At time T1
# Wait for all replicas to acknowledge
read(x)  # Always returns 1, even from replica</code></pre>
                            <p><strong>Example:</strong> Google Spanner uses synchronized clocks and 2PC for global strong consistency.</p>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-clock me-2"></i>Eventual Consistency</h4>
                        <div class="experiment-content">
                            <p>If no new updates, all replicas will eventually converge. Reads may return stale data.</p>
<pre><code class="language-python"># Eventual consistency
write(x, 1)  # At time T1
read(x)  # May return old value for a while
# ...time passes...
read(x)  # Eventually returns 1</code></pre>
                            <p><strong>Example:</strong> Amazon DynamoDB, Cassandra. Good for high availability when stale reads are acceptable.</p>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-user me-2"></i>Read-Your-Writes Consistency</h4>
                        <div class="experiment-content">
                            <p>A user always sees their own writes immediately, even if other users see stale data.</p>
<pre><code class="language-python"># Read-your-writes implementation
class ReadYourWritesDB:
    def __init__(self):
        self.primary = Database("primary")
        self.replicas = [Database(f"replica_{i}") for i in range(3)]
        # Track last write timestamp per user
        self.user_timestamps = {}
    
    def write(self, user_id, key, value):
        timestamp = time.time()
        self.primary.write(key, value, timestamp)
        self.user_timestamps[user_id] = timestamp
    
    def read(self, user_id, key):
        last_write = self.user_timestamps.get(user_id, 0)
        
        for replica in self.replicas:
            if replica.last_sync_time >= last_write:
                return replica.read(key)
        
        # Fallback to primary if replicas too stale
        return self.primary.read(key)</code></pre>
                        </div>
                    </div>

                    <h4>Consistency Spectrum</h4>
                    <p>From strongest to weakest:</p>
                    <ol>
                        <li><strong>Linearizability:</strong> Real-time ordering, strictest guarantee</li>
                        <li><strong>Sequential Consistency:</strong> Operations appear in program order</li>
                        <li><strong>Causal Consistency:</strong> Causally related operations ordered</li>
                        <li><strong>Read-Your-Writes:</strong> See your own writes</li>
                        <li><strong>Monotonic Reads:</strong> Never see older values after seeing newer</li>
                        <li><strong>Eventual Consistency:</strong> Will converge, eventually</li>
                    </ol>
                </div>

                <div id="next-steps" class="blog-content mt-5">
                    <h2><i class="fas fa-arrow-right me-2 text-teal"></i>Next Steps</h2>
                    
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 3: Load Balancing & Caching</h5>
                            <p class="text-muted small mb-2">Review load balancing algorithms and caching strategies.</p>
                            <a href="system-design-load-balancing-caching.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 5: Microservices Architecture</h5>
                            <p class="text-muted small mb-2">Master microservices patterns and service mesh architectures.</p>
                            <a href="system-design-microservices-architecture.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 6: API Design & REST/GraphQL</h5>
                            <p class="text-muted small mb-2">Learn API design best practices and when to use REST vs GraphQL.</p>
                            <a href="system-design-api-rest-graphql.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">
                        I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest">
                            <i class="fab fa-pinterest-p"></i>
                        </a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <hr class="bg-secondary">

            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small">
                        <i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a>
                    </p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">
                        Enjoying this content? ☕ <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <button id="scrollToTop" class="scroll-to-top"><i class="fas fa-arrow-up"></i></button>
    <!-- Category Indicator -->
    <div id="categoryIndicator" class="category-indicator" title="Current Section">
        <i class="fas fa-tag"></i><span id="categoryText">Technology</span>
    </div>
    <script src="../../../js/cookie-consent.js"></script>
    <script src="../../../js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

            </body>
</html>
