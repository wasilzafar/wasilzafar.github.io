<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Master NASM assembler: syntax rules, sections (.text, .data, .bss), data directives (db, dw, dd, dq), labels, constants, macros, conditional assembly, and producing ELF binaries." />
    <meta name="author" content="Wasil Zafar" />
    <meta name="keywords" content="NASM, NASM Tutorial, NASM Syntax, Assembly Macros, db dw dd dq, ELF Binary, Assembly Sections, NASM Directives, Conditional Assembly" />
    <meta property="og:title" content="x86 Assembly Series Part 5: NASM Syntax, Directives & Macros" />
    <meta property="og:description" content="Master NASM assembler syntax, sections, data directives, macros, and conditional assembly for producing ELF binaries." />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2026-02-06" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />
    
    <title>x86 Assembly Series Part 5: NASM Syntax, Directives & Macros - Wasil Zafar</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', { 'ad_storage': 'denied', 'ad_user_data': 'denied', 'ad_personalization': 'denied', 'analytics_storage': 'denied', 'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE'] });
        gtag('consent', 'default', { 'ad_storage': 'granted', 'ad_user_data': 'granted', 'ad_personalization': 'granted', 'analytics_storage': 'granted' });
    </script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PBS8M2JR');</script>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/"><span class="gradient-text">Wasil Zafar</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#skills">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#certifications">Certifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#interests">Interests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
                <h1 class="display-4 fw-bold mb-3">x86 Assembly Series Part 5: NASM Syntax, Directives & Macros</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>February 6, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>28 min read</span>
                    <button onclick="window.print()" class="print-btn"><i class="fas fa-print"></i> Print</button>
                </div>
                <p class="lead">Master the NASM (Netwide Assembler) syntax including sections, data directives, labels, symbols, macros, conditional assembly, and producing ELF32/ELF64 binaries for Linux development.</p>
            </div>
        </div>
    </section>

    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents"><i class="fas fa-list"></i></button>

    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()">&times;</button>
        </div>
        <ol>
            <li><a href="#syntax" onclick="closeNav()">NASM Syntax Rules</a>
                <ul>
                    <li><a href="#intel-syntax" onclick="closeNav()">Intel Syntax</a></li>
                    <li><a href="#line-format" onclick="closeNav()">Line Format</a></li>
                </ul>
            </li>
            <li><a href="#sections" onclick="closeNav()">Sections</a>
                <ul>
                    <li><a href="#text" onclick="closeNav()">.text Section</a></li>
                    <li><a href="#data" onclick="closeNav()">.data Section</a></li>
                    <li><a href="#bss" onclick="closeNav()">.bss Section</a></li>
                </ul>
            </li>
            <li><a href="#directives" onclick="closeNav()">Data Directives</a>
                <ul>
                    <li><a href="#db-dw-dd-dq" onclick="closeNav()">db, dw, dd, dq</a></li>
                    <li><a href="#resb-resw" onclick="closeNav()">resb, resw, resd, resq</a></li>
                </ul>
            </li>
            <li><a href="#labels" onclick="closeNav()">Labels, Scope & Symbols</a></li>
            <li><a href="#constants" onclick="closeNav()">Constants & Equates</a></li>
            <li><a href="#macros" onclick="closeNav()">Macros</a></li>
            <li><a href="#conditional" onclick="closeNav()">Conditional Assembly</a></li>
            <li><a href="#output" onclick="closeNav()">Producing ELF Binaries</a></li>
        </ol>
    </div>
    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <div id="syntax" class="blog-content">
                    <h2><i class="fas fa-code me-2 text-teal"></i>NASM Syntax Rules</h2>
                    
                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-terminal me-2"></i>
                        <strong>NASM Basics:</strong> NASM uses Intel syntax (destination, source) and is case-insensitive for instructions/registers but case-sensitive for labels and symbols.
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">25-Part Series</span>
                            <span class="badge bg-crimson">x86 Assembly Mastery</span>
                        </div>
                        <div class="content">
                            <p><strong>Foundation & Environment Setup</strong></p>
                            <ol start="0">
                                <li><a href="asm-part00-environment-setup.html">Development Environment, Tooling & Workflow</a></li>
                                <li><a href="asm-part01-fundamentals.html">Assembly Language Fundamentals & Toolchain Setup</a></li>
                                <li><a href="asm-part02-cpu-architecture.html">x86 CPU Architecture Overview</a></li>
                                <li><a href="asm-part03-registers.html">Registers – Complete Deep Dive</a></li>
                                <li><a href="asm-part04-instruction-encoding.html">Instruction Encoding & Binary Layout</a></li>
                            </ol>
                            <p class="mt-3"><strong>Assemblers, Syntax & Memory</strong></p>
                            <ol start="5">
                                <li><strong>NASM Syntax, Directives & Macros (This Guide)</strong></li>
                                <li><a href="asm-part06-masm.html">Complete Assembler Comparison</a></li>
                                <li><a href="asm-part07-memory-addressing.html">Memory Addressing Modes</a></li>
                            </ol>
                            <p class="mt-3"><strong>Control Flow, Stack & Computation</strong></p>
                            <ol start="8">
                                <li><a href="asm-part08-stack-calling.html">Stack Internals & Calling Conventions</a></li>
                                <li><a href="asm-part09-control-flow.html">Control Flow & Procedures</a></li>
                                <li><a href="asm-part10-arithmetic.html">Integer, Bitwise & Arithmetic Operations</a></li>
                            </ol>
                            <p class="mt-3"><strong>Floating Point, SIMD & Performance</strong></p>
                            <ol start="11">
                                <li><a href="asm-part11-floating-point.html">Floating Point & SIMD Foundations</a></li>
                                <li><a href="asm-part12-simd.html">SIMD, Vectorization & Performance</a></li>
                            </ol>
                            <p class="mt-3"><strong>OS Interaction & Debugging</strong></p>
                            <ol start="13">
                                <li><a href="asm-part13-syscalls-interrupts.html">System Calls, Interrupts & Privilege Transitions</a></li>
                                <li><a href="asm-part14-debugging.html">Debugging & Reverse Engineering</a></li>
                                <li><a href="asm-part15-linking.html">Linking, Relocation & Loader Behavior</a></li>
                            </ol>
                            <p class="mt-3"><strong>Advanced Architecture & Interoperability</strong></p>
                            <ol start="16">
                                <li><a href="asm-part16-long-mode.html">x86-64 Long Mode & Advanced Features</a></li>
                                <li><a href="asm-part17-c-interop.html">Assembly + C/C++ Interoperability</a></li>
                                <li><a href="asm-part18-security.html">Memory Protection & Security Concepts</a></li>
                            </ol>
                            <p class="mt-3"><strong>Bare Metal, Kernel & Virtualization</strong></p>
                            <ol start="19">
                                <li><a href="asm-part19-bootloader.html">Bootloaders & Bare-Metal Programming</a></li>
                                <li><a href="asm-part20-kernel.html">Kernel-Level Assembly</a></li>
                                <li><a href="asm-part21-qemu.html">Complete Emulator & Simulator Guide</a></li>
                            </ol>
                            <p class="mt-3"><strong>CPU Microarchitecture & Optimization</strong></p>
                            <ol start="22">
                                <li><a href="asm-part22-optimization.html">Advanced Optimization & CPU Internals</a></li>
                            </ol>
                            <p class="mt-3"><strong>Real-World Application & Mastery</strong></p>
                            <ol start="23">
                                <li><a href="asm-part23-projects.html">Real-World Assembly Projects</a></li>
                                <li><a href="asm-part24-capstone.html">Assembly Mastery Capstone</a></li>
                            </ol>
                        </div>
                    </div>

                    <h3 id="intel-syntax">Intel Syntax</h3>
                    
                    <div class="experiment-card">
                        <div class="card-meta mb-2"><span class="badge bg-teal text-white">Syntax</span></div>
                        <h4>Intel vs AT&T Syntax</h4>
                        <pre><code class="language-nasm">; NASM (Intel Syntax): destination, source
mov rax, rbx        ; Copy RBX to RAX
mov [rax], 42       ; Store 42 at address in RAX

; AT&T Syntax (GAS): source, destination
; movq %rbx, %rax   ; Same operation</code></pre>
                    </div>

                    <h3 id="line-format">Line Format</h3>
                    
                    <pre><code class="language-nasm">label:    instruction operands    ; comment
_start:   mov        rax, 60      ; syscall number for exit</code></pre>
                </div>

                <div id="sections" class="blog-content mt-5">
                    <h2><i class="fas fa-layer-group me-2 text-teal"></i>Sections</h2>
                    
                    <h3 id="text">.text Section (Code)</h3>
                    
                    <pre><code class="language-nasm">section .text
    global _start

_start:
    ; Executable code goes here
    mov rax, 60     ; exit syscall
    xor rdi, rdi    ; return 0
    syscall</code></pre>

                    <div class="highlight-box mt-3">
                        <h5><i class="fas fa-terminal me-2"></i>Save &amp; Compile: <code>exit.asm</code></h5>
                        <p><span class="badge bg-teal"><i class="fab fa-linux me-1"></i>Linux</span></p>
<pre><code class="language-bash">nasm -f elf64 exit.asm -o exit.o
ld exit.o -o exit
./exit</code></pre>
                        <p><span class="badge bg-navy"><i class="fab fa-apple me-1"></i>macOS</span> <small class="text-muted">(change <code>_start</code> → <code>_main</code>, use syscall <code>0x2000001</code> for exit)</small></p>
<pre><code class="language-bash">nasm -f macho64 exit.asm -o exit.o
ld -macos_version_min 10.13 -e _main -static exit.o -o exit</code></pre>
                        <p><span class="badge bg-crimson"><i class="fab fa-windows me-1"></i>Windows</span> <small class="text-muted">(use <code>ExitProcess</code> API instead of syscall 60)</small></p>
<pre><code class="language-bash">nasm -f win64 exit.asm -o exit.obj
link /subsystem:console /entry:_start exit.obj /out:exit.exe</code></pre>
                    </div>

                    <h3 id="data">.data Section (Initialized Data)</h3>
                    
                    <pre><code class="language-nasm">section .data
    msg     db  "Hello, World!", 10    ; String with newline
    len     equ $ - msg                 ; Calculate length
    num     dd  12345                   ; 32-bit integer
    pi      dq  3.14159                 ; 64-bit float</code></pre>

                    <h3 id="bss">.bss Section (Uninitialized Data)</h3>
                    
                    <pre><code class="language-nasm">section .bss
    buffer  resb 256    ; Reserve 256 bytes
    count   resd 1      ; Reserve 1 dword (4 bytes)
    array   resq 100    ; Reserve 100 qwords (800 bytes)</code></pre>
                </div>

                <div id="directives" class="blog-content mt-5">
                    <h2><i class="fas fa-database me-2 text-teal"></i>Data Directives</h2>
                    
                    <h3 id="db-dw-dd-dq">Define Data (db, dw, dd, dq)</h3>
                    
                    <div class="experiment-card">
                        <div class="card-meta mb-2"><span class="badge bg-crimson text-white">Reference</span></div>
                        <h4>Data Definition Directives</h4>
                        <table class="table table-bordered table-sm">
                            <thead class="table-dark">
                                <tr><th>Directive</th><th>Size</th><th>Example</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>db</td><td>1 byte</td><td><code>db 0x41, 'A', 65</code></td></tr>
                                <tr><td>dw</td><td>2 bytes (word)</td><td><code>dw 0x1234</code></td></tr>
                                <tr><td>dd</td><td>4 bytes (dword)</td><td><code>dd 0x12345678</code></td></tr>
                                <tr><td>dq</td><td>8 bytes (qword)</td><td><code>dq 0x123456789ABCDEF0</code></td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 id="resb-resw">Reserve Space (resb, resw, resd, resq)</h3>
                    
                    <p>Reserve directives allocate uninitialized space in the <code>.bss</code> section:</p>

                    <pre><code class="language-nasm">section .bss
    buffer resb 256       ; Reserve 256 bytes
    count  resd 1         ; Reserve 1 dword (4 bytes)
    array  resq 100       ; Reserve 100 qwords (800 bytes)
    flags  resw 16        ; Reserve 16 words (32 bytes)

; .bss is NOT stored in the executable file!
; The OS zeros this memory when loading the program</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Define vs Reserve:</strong>
                        <ul class="mb-0 mt-2">
                            <li><code>db</code>, <code>dw</code>, <code>dd</code>, <code>dq</code> — Define data with initial values (goes in <code>.data</code> or <code>.rodata</code>)</li>
                            <li><code>resb</code>, <code>resw</code>, <code>resd</code>, <code>resq</code> — Reserve uninitialized space (goes in <code>.bss</code>)</li>
                        </ul>
                    </div>

                    <pre><code class="language-nasm">; Calculating sizes
struc Point
    .x: resd 1
    .y: resd 1
endstruc

section .bss
    points resb Point_size * 100  ; Array of 100 Point structures
    ; Point_size is automatically defined by NASM</code></pre>
                </div>

                <div id="labels" class="blog-content mt-5">
                    <h2><i class="fas fa-tag me-2 text-teal"></i>Labels, Scope & Symbols</h2>
                    
                    <h3>Global Labels</h3>

                    <pre><code class="language-nasm">; Global labels are visible to the linker
global _start              ; Export symbol (visible to linker)
global my_function         ; Another exported symbol

extern printf              ; Import symbol from another object
extern malloc

_start:                    ; Define the label
    call my_function
    ; ...

my_function:
    push rbp
    ; ...
    ret</code></pre>

                    <h3>Local Labels (Dot Prefix)</h3>

                    <pre><code class="language-nasm">; Local labels start with a dot and belong to the previous global label
process_array:
    xor rcx, rcx           ; i = 0
.loop:                     ; Local to process_array
    cmp rcx, rax
    jge .done              ; Jump to process_array.done
    ; Process element...
    inc rcx
    jmp .loop
.done:
    ret

process_string:
    ; Can reuse .loop and .done names!
.loop:                     ; Local to process_string (different from above)
    ; ...
.done:
    ret</code></pre>

                    <h3>Anonymous Labels ($$ and $)</h3>

                    <pre><code class="language-nasm">; $ = current address, $$ = section start
section .text
message db "Hello", 0
msg_len equ $ - message    ; Length calculation

; Boot sector example
times 510 - ($ - $$) db 0  ; Pad to 510 bytes
dw 0xAA55                  ; Boot signature</code></pre>

                    <h3>Symbol Visibility for Shared Libraries</h3>

                    <pre><code class="language-nasm">; Control symbol visibility for dynamic linking
global public_api:function           ; Visible, typed as function  
global internal_helper:function hidden ; Hidden from dynamic linker

; In ELF output, you can also use:
global my_data:data</code></pre>

                    <div class="experiment-card">
                        <h4><i class="fas fa-flask me-2"></i>Exercise: Label Scope</h4>
                        <div class="content">
                            <pre><code class="language-nasm">; What labels are accessible where?
func_a:
    jmp .loop    ; Valid - same function
func_a.loop:
    jmp func_b.loop  ; Valid - fully qualified name
    ret

func_b:
    jmp .loop    ; Valid - different .loop
.loop:
    ret</code></pre>
                        </div>
                    </div>
                </div>

                <div id="constants" class="blog-content mt-5">
                    <h2><i class="fas fa-equals me-2 text-teal"></i>Constants & Equates</h2>
                    
                    <h3>EQU — Assemble-Time Constants</h3>

                    <pre><code class="language-nasm">; EQU creates a constant that cannot be changed later
BUFFER_SIZE equ 4096
MAX_ITEMS   equ 100
NULL        equ 0

; EQU with expressions
HEADER_SIZE equ 16
DATA_OFFSET equ HEADER_SIZE + 4

; System call numbers
SYS_READ    equ 0
SYS_WRITE   equ 1  
SYS_EXIT    equ 60

; Use them like constants
mov rax, SYS_WRITE
mov rdi, BUFFER_SIZE</code></pre>

                    <h3>%define — Preprocessor Macros</h3>

                    <pre><code class="language-nasm">; %define creates text substitution (like C #define)
%define STDIN  0
%define STDOUT 1
%define STDERR 2

; Can include expressions
%define KB(n) ((n) * 1024)
%define MB(n) ((n) * 1024 * 1024)

mov rax, KB(4)         ; Expands to ((4) * 1024) = 4096

; String constants
%define NEWLINE 10
%define GREETING "Hello, World!", NEWLINE, 0

; How GREETING expands:
; When you write:   db GREETING
; NASM substitutes: db "Hello, World!", 10, 0
;
; This produces 15 bytes in memory:
;   48 65 6C 6C 6F 2C 20 57 6F 72 6C 64 21  ("Hello, World!")
;   0A                                         (10 = newline '\n')
;   00                                         (0 = null terminator)
;
; The comma-separated list works because db accepts multiple values:
;   db "text", byte, byte  →  string bytes followed by individual bytes
;
; This is a common pattern for defining printable C-style strings:
;   %define CR    13       ; Carriage return '\r'
;   %define LF    10       ; Line feed '\n'
;   %define CRLF  CR, LF   ; Windows-style line ending
;   %define NULL  0        ; Null terminator
;
; Usage in .data section:
;   section .data
;       msg db GREETING           ; "Hello, World!\n\0" (15 bytes)
;       err db "Error", CRLF, 0   ; "Error\r\n\0" (8 bytes)</code></pre>

                    <h3>EQU vs %define</h3>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Aspect</th>
                                <th>EQU</th>
                                <th>%define</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Evaluation time</td>
                                <td>Assembly time (once)</td>
                                <td>Preprocessor (text substitution)</td>
                            </tr>
                            <tr>
                                <td>Can redefine?</td>
                                <td>No</td>
                                <td>Yes (with %undef first)</td>
                            </tr>
                            <tr>
                                <td>Parameters?</td>
                                <td>No</td>
                                <td>Yes (macro-like)</td>
                            </tr>
                            <tr>
                                <td>Use case</td>
                                <td>Numeric constants</td>
                                <td>Flexible substitutions</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Best Practice:</strong> Use <code>equ</code> for simple numeric constants (syscall numbers, sizes). Use <code>%define</code> for parametric macros or when you need text substitution.
                    </div>
                </div>

                <div id="macros" class="blog-content mt-5">
                    <h2><i class="fas fa-cubes me-2 text-teal"></i>Macros</h2>
                    
                    <h3>Single-Line Macros (%define)</h3>

                    <pre><code class="language-nasm">; Simple text substitution
%define EXIT_SUCCESS 0
%define EXIT_FAILURE 1

; Parametric macros
%define SYSCALL(n) mov rax, n
%define ALIGN16(x) (((x) + 15) & ~15)

SYSCALL(60)              ; Expands to: mov rax, 60
mov rdi, ALIGN16(13)     ; Expands to: mov rdi, (((13) + 15) & ~15) = 16</code></pre>

                    <h3>Multi-Line Macros (%macro / %endmacro)</h3>

                    <pre><code class="language-nasm">; Basic multi-line macro: syscall wrapper
%macro exit 1              ; Name 'exit', takes 1 parameter
    mov rax, 60            ; sys_exit
    mov rdi, %1            ; First parameter
    syscall
%endmacro

; Usage
exit 0                     ; Expands to: mov rax, 60 / mov rdi, 0 / syscall
exit EXIT_FAILURE          ; Works with constants too</code></pre>

                    <h3>Macro with Multiple Parameters</h3>

                    <pre><code class="language-nasm">; Write string to file descriptor  
%macro write 3             ; fd, buffer, length
    mov rax, 1             ; sys_write
    mov rdi, %1            ; fd
    mov rsi, %2            ; buffer
    mov rdx, %3            ; length
    syscall
%endmacro

; Usage
write STDOUT, message, msg_len
write 2, error_msg, err_len  ; Write to stderr</code></pre>

                    <h3>Local Labels in Macros</h3>

                    <pre><code class="language-nasm">; Use %%label for labels local to each macro expansion
%macro repeat_char 2       ; char, count
    mov rcx, %2
%%loop:
    mov al, %1
    ; ... print character ...
    loop %%loop            ; Each expansion gets unique %%loop
%endmacro

; Multiple uses don't conflict:
repeat_char 'A', 5         ; %%loop becomes ..@1.loop
repeat_char 'B', 3         ; %%loop becomes ..@2.loop</code></pre>

                    <h3>Macro Overloading</h3>

                    <pre><code class="language-nasm">; Same name, different parameter counts
%macro print 1             ; print buffer (null-terminated)
    mov rsi, %1
    ; ... calculate length and print ...
%endmacro

%macro print 2             ; print buffer, length
    mov rsi, %1
    mov rdx, %2
    ; ... print ...
%endmacro

; NASM selects based on argument count
print message              ; Calls 1-parameter version
print buffer, 100          ; Calls 2-parameter version</code></pre>

                    <div class="experiment-card">
                        <h4><i class="fas fa-flask me-2"></i>Exercise: Create a Stack Frame Macro</h4>
                        <div class="content">
                            <pre><code class="language-nasm">; Create macros for function prologue/epilogue
%macro prologue 1          ; local_bytes
    push rbp
    mov rbp, rsp
    sub rsp, %1            ; Reserve stack space
%endmacro

%macro epilogue 0
    leave                  ; mov rsp, rbp; pop rbp
    ret
%endmacro

; Usage:
my_function:
    prologue 32            ; Reserve 32 bytes
    ; ... function body ...
    epilogue</code></pre>
                        </div>
                    </div>
                </div>

                <div id="conditional" class="blog-content mt-5">
                    <h2><i class="fas fa-code-branch me-2 text-teal"></i>Conditional Assembly</h2>
                    
                    <p>Conditionally include or exclude code at assembly time, useful for multi-platform or debug/release builds.</p>

                    <h3>%if / %elif / %else / %endif</h3>

                    <pre><code class="language-nasm">; Compile-time conditionals based on expressions
%define TARGET_BITS 64

%if TARGET_BITS == 64
    mov rax, [rbx]         ; 64-bit code
%elif TARGET_BITS == 32
    mov eax, [ebx]         ; 32-bit code
%else
    %error "Unsupported target"
%endif</code></pre>

                    <h3>%ifdef / %ifndef (Check if Defined)</h3>

                    <pre><code class="language-nasm">; Check if a symbol is defined
%define DEBUG 1

%ifdef DEBUG
    ; Include debug output
    call debug_print
    call dump_registers
%endif

%ifndef RELEASE
    ; Extra checks for non-release builds
    call validate_input
%endif

; Can also use command line: nasm -DDEBUG program.asm</code></pre>

                    <h3>Platform-Specific Code</h3>

                    <pre><code class="language-nasm">; Assemble different code for Linux vs Windows
%ifdef LINUX
    %define SYS_WRITE 1
    %define SYS_EXIT 60
%elifdef WINDOWS
    ; Windows uses different approach (WinAPI)
    extern WriteFile
    extern ExitProcess
%else
    %error "Define LINUX or WINDOWS"
%endif

; Build: nasm -DLINUX -f elf64 program.asm
;    or: nasm -DWINDOWS -f win64 program.asm</code></pre>

                    <h3>%ifid / %ifnum / %ifstr (Type Checking)</h3>

                    <pre><code class="language-nasm">; Check argument types in macros
%macro safe_mov 2
    %ifnum %2
        mov %1, %2              ; Immediate value
    %else
        lea %1, [%2]            ; Memory reference (assume address)
    %endif
%endmacro

safe_mov rax, 42             ; Expands to: mov rax, 42
safe_mov rax, my_buffer      ; Expands to: lea rax, [my_buffer]</code></pre>

                    <h3>Repetition: %rep / %endrep</h3>

                    <pre><code class="language-nasm">; Generate repeated code or data
%assign i 0
%rep 10
    db i                       ; Generates: db 0, db 1, ..., db 9
    %assign i i+1
%endrep

; Unrolled loop
%rep 4
    add rax, [rsi]
    add rsi, 8
%endrep</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>%assign vs EQU:</strong> Use <code>%assign</code> for mutable preprocessor variables (can be reassigned). Use <code>equ</code> for fixed constants that never change.
                    </div>
                </div>

                <div id="output" class="blog-content mt-5">
                    <h2><i class="fas fa-file-export me-2 text-teal"></i>Producing ELF Binaries</h2>
                    
                    <h3>NASM Output Formats (-f)</h3>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Format</th>
                                <th>Option</th>
                                <th>Use Case</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ELF64</td>
                                <td><code>-f elf64</code></td>
                                <td>Linux 64-bit executable/object</td>
                            </tr>
                            <tr>
                                <td>ELF32</td>
                                <td><code>-f elf32</code> or <code>-f elf</code></td>
                                <td>Linux 32-bit</td>
                            </tr>
                            <tr>
                                <td>Win64</td>
                                <td><code>-f win64</code></td>
                                <td>Windows 64-bit COFF object</td>
                            </tr>
                            <tr>
                                <td>Win32</td>
                                <td><code>-f win32</code></td>
                                <td>Windows 32-bit COFF object</td>
                            </tr>
                            <tr>
                                <td>Binary</td>
                                <td><code>-f bin</code></td>
                                <td>Raw binary (boot sectors, firmware)</td>
                            </tr>
                            <tr>
                                <td>Mach-O 64</td>
                                <td><code>-f macho64</code></td>
                                <td>macOS 64-bit</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Complete Build Example (Linux)</h3>

                    <pre><code class="language-bash"># Simple standalone program
nasm -f elf64 hello.asm -o hello.o
ld hello.o -o hello
./hello

# With debug symbols
nasm -f elf64 -g -F dwarf hello.asm -o hello.o
ld hello.o -o hello
gdb ./hello

# Linking with libc
nasm -f elf64 program.asm -o program.o
gcc program.o -o program -no-pie  # Use GCC to link with C runtime

# Or with ld (specify C library path)
ld -dynamic-linker /lib64/ld-linux-x86-64.so.2 \
   -lc program.o -o program</code></pre>

                    <h3>Complete Build Example (Windows)</h3>

                    <pre><code class="language-bash"># Windows with MSVC linker
nasm -f win64 hello_win.asm -o hello_win.obj
link /SUBSYSTEM:CONSOLE /ENTRY:main hello_win.obj kernel32.lib

# Windows with GoLink (simpler)
nasm -f win64 hello_win.asm -o hello_win.obj
golink /console /entry main hello_win.obj kernel32.dll</code></pre>

                    <h3>Listing Files and Debugging</h3>

                    <pre><code class="language-bash"># Generate listing file (shows assembled bytes)
nasm -f elf64 -l listing.lst program.asm

# Listing file shows:
# Line   Address   Machine Code    Source
#   10   00000000  B802000000      mov eax, 2
#   11   00000005  48C7C102000000  mov rcx, 2

# Generate map file (symbol addresses)
ld -Map=program.map program.o -o program</code></pre>

                    <div class="experiment-card">
                        <h4><i class="fas fa-terminal me-2"></i>Quick Reference: Build Commands</h4>
                        <div class="content">
                            <pre><code class="language-bash"># Linux standalone (no libc)
nasm -f elf64 prog.asm -o prog.o && ld prog.o -o prog

# Linux with libc
nasm -f elf64 prog.asm -o prog.o && gcc prog.o -o prog -no-pie

# Linux shared library
nasm -f elf64 -DPIC lib.asm -o lib.o
gcc -shared lib.o -o libmylib.so

# Boot sector (raw binary)
nasm -f bin boot.asm -o boot.bin
qemu-system-x86_64 -drive format=raw,file=boot.bin

# Debug build
nasm -f elf64 -g -F dwarf prog.asm -o prog.o
ld prog.o -o prog && gdb ./prog</code></pre>
                        </div>
                    </div>
                </div>

                <div class="blog-content mt-5">
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 4: Instruction Encoding & Binary Layout</h5>
                            <p class="text-muted small mb-2">Understand how instructions are encoded into machine code.</p>
                            <a href="asm-part04-instruction-encoding.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 6: Complete Assembler Comparison</h5>
                            <p class="text-muted small mb-2">Compare MASM, NASM, and GAS syntax for Windows and cross-platform development.</p>
                            <a href="asm-part06-masm.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 7: Memory Addressing Modes</h5>
                            <p class="text-muted small mb-2">Master x86 addressing modes including RIP-relative addressing.</p>
                            <a href="asm-part07-memory-addressing.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">
                        I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest"><i class="fab fa-pinterest-p"></i></a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email"><i class="fas fa-envelope"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-secondary">
            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small"><i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a></p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">Enjoying this content? ☕ <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <button id="scrollToTop" class="scroll-to-top"><i class="fas fa-arrow-up"></i></button>
    <div id="categoryIndicator" class="category-indicator"><span id="categoryText"></span></div>
    <script src="../../../js/cookie-consent.js"></script>
    <script src="../../../js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-nasm.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
</body>
</html>
