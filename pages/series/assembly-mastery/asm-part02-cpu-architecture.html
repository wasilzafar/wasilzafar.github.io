<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Understand x86 CPU architecture from 8086 to x86-64. Learn about CISC philosophy, execution modes (Real, Protected, Long Mode), privilege rings, and CPU internals including pipelines and microcode." />
    <meta name="author" content="Wasil Zafar" />
    <meta name="keywords" content="x86 Architecture, CPU History, Real Mode, Protected Mode, Long Mode, Privilege Rings, Ring 0, CISC, CPU Pipeline, Microcode, x86-64" />
    <meta property="og:title" content="x86 Assembly Series Part 2: x86 CPU Architecture Overview" />
    <meta property="og:description" content="Understand x86 CPU evolution, execution modes, privilege rings, and internal architecture for effective assembly programming." />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2026-02-06" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />
    
    <title>x86 Assembly Series Part 2: x86 CPU Architecture Overview - Wasil Zafar</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />

    <!-- Prism.js Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <!-- Google Consent Mode v2 -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied',
            'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE']
        });
        
        gtag('consent', 'default', {
            'ad_storage': 'granted',
            'ad_user_data': 'granted',
            'ad_personalization': 'granted',
            'analytics_storage': 'granted'
        });
        
        gtag('set', 'url_passthrough', true);
    </script>

    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PBS8M2JR');
    </script>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">
                <span class="gradient-text">Wasil Zafar</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#skills">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#certifications">Certifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#interests">Interests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link">
                    <i class="fas fa-arrow-left me-2"></i>Back to Technology
                </a>
                <h1 class="display-4 fw-bold mb-3">x86 Assembly Series Part 2: x86 CPU Architecture Overview</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>February 6, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>30 min read</span>
                    <button onclick="window.print()" class="print-btn" title="Print this article">
                        <i class="fas fa-print"></i> Print
                    </button>
                </div>
                <p class="lead">Explore the evolution of x86 from the 8086 to modern x86-64 processors. Understand CISC philosophy, execution modes, privilege rings, CPU pipelines, and the microcode layer that powers modern processors.</p>
            </div>
        </div>
    </section>

    <!-- Table of Contents Toggle Button -->
    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents" aria-label="Open Table of Contents">
        <i class="fas fa-list"></i>
    </button>

    <!-- Side Navigation Overlay -->
    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()" aria-label="Close Table of Contents">&times;</button>
        </div>
        <ol>
            <li>
                <a href="#evolution" onclick="closeNav()">x86 Evolution</a>
                <ul>
                    <li><a href="#8086" onclick="closeNav()">8086 Origins</a></li>
                    <li><a href="#ia32" onclick="closeNav()">IA-32 (386+)</a></li>
                    <li><a href="#x64" onclick="closeNav()">x86-64 / AMD64</a></li>
                </ul>
            </li>
            <li>
                <a href="#cisc" onclick="closeNav()">CISC Philosophy</a>
                <ul>
                    <li><a href="#cisc-vs-risc" onclick="closeNav()">CISC vs RISC</a></li>
                    <li><a href="#implications" onclick="closeNav()">Design Implications</a></li>
                </ul>
            </li>
            <li>
                <a href="#execution-modes" onclick="closeNav()">Execution Modes</a>
                <ul>
                    <li><a href="#real-mode" onclick="closeNav()">Real Mode</a></li>
                    <li><a href="#protected-mode" onclick="closeNav()">Protected Mode</a></li>
                    <li><a href="#long-mode" onclick="closeNav()">Long Mode</a></li>
                </ul>
            </li>
            <li>
                <a href="#privilege" onclick="closeNav()">Privilege Rings</a>
                <ul>
                    <li><a href="#ring-model" onclick="closeNav()">Ring 0-3 Model</a></li>
                    <li><a href="#transitions" onclick="closeNav()">Ring Transitions</a></li>
                </ul>
            </li>
            <li>
                <a href="#internals" onclick="closeNav()">CPU Internals</a>
                <ul>
                    <li><a href="#pipeline" onclick="closeNav()">Instruction Pipeline</a></li>
                    <li><a href="#decoder" onclick="closeNav()">Instruction Decoder</a></li>
                    <li><a href="#microcode" onclick="closeNav()">Microcode Layer</a></li>
                </ul>
            </li>
        </ol>
    </div>

    <!-- Overlay Backdrop -->
    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <!-- Main Content -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <!-- Evolution Section -->
                <div id="evolution" class="blog-content">
                    <h2><i class="fas fa-history me-2 text-teal"></i>x86 Evolution: From 8086 to x86-64</h2>
                    
                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-microchip me-2"></i>
                        <strong>Historical Context:</strong> The x86 architecture has maintained backward compatibility for over 45 years, making it one of the most successful processor architectures in computing history.
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">25-Part Series</span>
                            <span class="badge bg-crimson">x86 Assembly Mastery</span>
                        </div>
                        <div class="content">
                            <p><strong>Foundation & Environment Setup</strong></p>
                            <ol start="0">
                                <li><a href="asm-part00-environment-setup.html">Development Environment, Tooling & Workflow</a></li>
                                <li><a href="asm-part01-fundamentals.html">Assembly Language Fundamentals & Toolchain Setup</a></li>
                                <li><strong>x86 CPU Architecture Overview (This Guide)</strong></li>
                                <li><a href="asm-part03-registers.html">Registers – Complete Deep Dive</a></li>
                                <li><a href="asm-part04-instruction-encoding.html">Instruction Encoding & Binary Layout</a></li>
                            </ol>
                            <p class="mt-3"><strong>Assemblers, Syntax & Memory</strong></p>
                            <ol start="5">
                                <li><a href="asm-part05-nasm.html">NASM Syntax, Directives & Macros</a></li>
                                <li><a href="asm-part06-masm.html">Complete Assembler Comparison</a></li>
                                <li><a href="asm-part07-memory-addressing.html">Memory Addressing Modes</a></li>
                            </ol>
                            <p class="mt-3"><strong>Control Flow, Stack & Computation</strong></p>
                            <ol start="8">
                                <li><a href="asm-part08-stack-calling.html">Stack Internals & Calling Conventions</a></li>
                                <li><a href="asm-part09-control-flow.html">Control Flow & Procedures</a></li>
                                <li><a href="asm-part10-arithmetic.html">Integer, Bitwise & Arithmetic Operations</a></li>
                            </ol>
                            <p class="mt-3"><strong>Floating Point, SIMD & Performance</strong></p>
                            <ol start="11">
                                <li><a href="asm-part11-floating-point.html">Floating Point & SIMD Foundations</a></li>
                                <li><a href="asm-part12-simd.html">SIMD, Vectorization & Performance</a></li>
                            </ol>
                            <p class="mt-3"><strong>OS Interaction & Debugging</strong></p>
                            <ol start="13">
                                <li><a href="asm-part13-syscalls-interrupts.html">System Calls, Interrupts & Privilege Transitions</a></li>
                                <li><a href="asm-part14-debugging.html">Debugging & Reverse Engineering</a></li>
                                <li><a href="asm-part15-linking.html">Linking, Relocation & Loader Behavior</a></li>
                            </ol>
                            <p class="mt-3"><strong>Advanced Architecture & Interoperability</strong></p>
                            <ol start="16">
                                <li><a href="asm-part16-long-mode.html">x86-64 Long Mode & Advanced Features</a></li>
                                <li><a href="asm-part17-c-interop.html">Assembly + C/C++ Interoperability</a></li>
                                <li><a href="asm-part18-security.html">Memory Protection & Security Concepts</a></li>
                            </ol>
                            <p class="mt-3"><strong>Bare Metal, Kernel & Virtualization</strong></p>
                            <ol start="19">
                                <li><a href="asm-part19-bootloader.html">Bootloaders & Bare-Metal Programming</a></li>
                                <li><a href="asm-part20-kernel.html">Kernel-Level Assembly</a></li>
                                <li><a href="asm-part21-qemu.html">Complete Emulator & Simulator Guide</a></li>
                            </ol>
                            <p class="mt-3"><strong>CPU Microarchitecture & Optimization</strong></p>
                            <ol start="22">
                                <li><a href="asm-part22-optimization.html">Advanced Optimization & CPU Internals</a></li>
                            </ol>
                            <p class="mt-3"><strong>Real-World Application & Mastery</strong></p>
                            <ol start="23">
                                <li><a href="asm-part23-projects.html">Real-World Assembly Projects</a></li>
                                <li><a href="asm-part24-capstone.html">Assembly Mastery Capstone</a></li>
                            </ol>
                        </div>
                    </div>

                    <h3 id="8086">The 8086 Origins (1978)</h3>
                    
                    <div class="experiment-card">
                        <div class="card-meta mb-2">
                            <span class="badge bg-teal text-white">Historical</span>
                        </div>
                        <h4>Intel 8086 Specifications</h4>
                        <ul>
                            <li><strong>Word Size:</strong> 16-bit registers and data bus</li>
                            <li><strong>Address Bus:</strong> 20-bit (1 MB addressable memory)</li>
                            <li><strong>Registers:</strong> AX, BX, CX, DX, SI, DI, BP, SP</li>
                            <li><strong>Segmentation:</strong> Segment:Offset addressing</li>
                            <li><strong>Clock Speed:</strong> 5-10 MHz</li>
                        </ul>
                        <p>The 8086 established the instruction set that all x86 processors still support today.</p>
                    </div>

                    <h3 id="ia32">IA-32: The 32-bit Era (80386+)</h3>
                    
                    <p>The 80386 (1985) introduced 32-bit computing to x86:</p>
                    
                    <ul>
                        <li>32-bit registers (EAX, EBX, etc.)</li>
                        <li>4 GB addressable memory</li>
                        <li>Protected mode with ring-based security</li>
                        <li>Virtual memory with paging</li>
                        <li>Hardware task switching</li>
                    </ul>

                    <h3 id="x64">x86-64 / AMD64 (2003)</h3>
                    
                                        <p>AMD's bold move to extend x86 to 64-bit (rather than adopting Intel's Itanium) gave us today's dominant architecture:</p>

                    <h4>Key x86-64 Features</h4>
                    
                    <ul>
                        <li><strong>64-bit general-purpose registers:</strong> RAX, RBX, RCX, RDX, RSI, RDI, RBP, RSP</li>
                        <li><strong>8 new registers:</strong> R8-R15 (finally, more than 8 GPRs!)</li>
                        <li><strong>Virtual address space:</strong> 48-bit (256 TB) currently, 57-bit with LA57</li>
                        <li><strong>RIP-relative addressing:</strong> Position-independent code is easy</li>
                        <li><strong>Flat memory model:</strong> No more segment:offset headaches (mostly)</li>
                        <li><strong>Single OS model:</strong> Ring 0 and Ring 3 only</li>
                    </ul>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Register Naming Convention:</strong>
                        <pre class="mb-0 mt-2"><code class="language-plaintext">64-bit  32-bit  16-bit  8-bit (low)  8-bit (high)
RAX     EAX     AX      AL           AH
RBX     EBX     BX      BL           BH
RCX     ECX     CX      CL           CH
RDX     EDX     DX      DL           DH
RSI     ESI     SI      SIL          -
RDI     EDI     DI      DIL          -
R8      R8D     R8W     R8B          -
R9      R9D     R9W     R9B          -
...and so on for R10-R15</code></pre>
                    </div>

                    <h4>Long Mode Sub-Modes</h4>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Sub-Mode</th>
                                <th>Description</th>
                                <th>Use Case</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>64-bit Mode</strong></td>
                                <td>Full 64-bit OS and applications</td>
                                <td>Modern operating systems</td>
                            </tr>
                            <tr>
                                <td><strong>Compatibility Mode</strong></td>
                                <td>Run 32-bit apps on 64-bit OS</td>
                                <td>WoW64 (Windows on Windows 64)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- CISC Section -->
                <div id="cisc" class="blog-content mt-5">
                    <h2><i class="fas fa-cogs me-2 text-teal"></i>CISC Philosophy</h2>
                    
                    <h3 id="cisc-vs-risc">CISC vs RISC</h3>
                    
                    <div class="experiment-card">
                        <div class="card-meta mb-2">
                            <span class="badge bg-crimson text-white">Comparison</span>
                        </div>
                        <h4>Architecture Philosophies</h4>
                        <table class="table table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th>CISC (x86)</th>
                                    <th>RISC (ARM)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Complex, variable-length instructions</td>
                                    <td>Simple, fixed-length instructions</td>
                                </tr>
                                <tr>
                                    <td>Memory operands in most instructions</td>
                                    <td>Load/Store architecture</td>
                                </tr>
                                <tr>
                                    <td>Hardware microcode</td>
                                    <td>Hardwired control</td>
                                </tr>
                                <tr>
                                    <td>Fewer registers</td>
                                    <td>Many registers</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 id="implications">Design Implications</h3>
                    
                                        <p>CISC architecture profoundly affects how you write and think about assembly:</p>

                    <h4>Memory Operands Anywhere</h4>

                    <p>Unlike RISC (load/store), x86 allows memory operands directly in arithmetic:</p>

                    <pre><code class="language-nasm">; CISC style - memory in arithmetic
add [count], 5          ; Add 5 directly to memory location
mul dword [factor]      ; Multiply EAX by memory value

; RISC equivalent would need:
ldr r1, [count]         ; Load
add r1, r1, #5          ; Compute
str r1, [count]         ; Store</code></pre>

                    <h4>Rich Instruction Set</h4>

                    <pre><code class="language-nasm">; String operations
rep movsb               ; Copy RCX bytes from RSI to RDI
rep stosq               ; Fill RCX quadwords at RDI with RAX
repnz scasb             ; Search for AL in string at RDI

; Complex addressing
mov eax, [rbx + rsi*4 + 16]   ; Array[i] with base offset

; Atomic operations  
lock cmpxchg [mutex], ecx     ; Compare-and-swap for synchronization
lock xadd [counter], eax      ; Atomic fetch-and-add</code></pre>

                    <div class="experiment-card">
                        <h4><i class="fas fa-balance-scale me-2"></i>Trade-offs for Assembly Programmers</h4>
                        <table class="table table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th>Advantage</th>
                                    <th>Disadvantage</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Fewer instructions for same task</td>
                                    <td>Complex instruction encoding (1-15 bytes)</td>
                                </tr>
                                <tr>
                                    <td>Powerful addressing modes</td>
                                    <td>Harder to predict timing</td>
                                </tr>
                                <tr>
                                    <td>Rich built-in operations (REP, LOOP)</td>
                                    <td>Microcode overhead for complex ops</td>
                                </tr>
                                <tr>
                                    <td>Direct memory manipulation</td>
                                    <td>Limited registers (historical)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="highlight-box highlight-navy">
                        <i class="fas fa-info-circle"></i>
                        <strong>Modern Reality:</strong> Today's x86 CPUs are RISC internally. The decoder translates complex CISC instructions into simple micro-operations (μops) that execute on a RISC-like core. You get CISC convenience with RISC performance.
                    </div>
                </div>

                <!-- Execution Modes Section -->
                <div id="execution-modes" class="blog-content mt-5">
                    <h2><i class="fas fa-layer-group me-2 text-teal"></i>CPU Execution Modes</h2>
                    
                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Key Insight:</strong> Modern x86 processors boot in Real Mode (for BIOS compatibility), then transition to Protected Mode (for 32-bit OS) or Long Mode (for 64-bit OS). Understanding these modes is essential for bootloader and kernel development.
                    </div>

                    <h3 id="real-mode">Real Mode</h3>
                    
                    <div class="experiment-card">
                        <div class="card-meta mb-2">
                            <span class="badge bg-teal text-white">Mode</span>
                        </div>
                        <h4>Real Mode Characteristics</h4>
                        <ul>
                            <li><strong>Address Space:</strong> 1 MB (20-bit addresses)</li>
                            <li><strong>Segmentation:</strong> Segment × 16 + Offset</li>
                            <li><strong>Protection:</strong> None (direct hardware access)</li>
                            <li><strong>Use Case:</strong> BIOS, bootloaders, DOS compatibility</li>
                        </ul>
                    </div>

                    <h3 id="protected-mode">Protected Mode</h3>
                    
                                        <p>Introduced with the 80386, Protected Mode is where 32-bit operating systems live:</p>

                    <h4>Global Descriptor Table (GDT)</h4>

                    <p>The GDT defines memory segments with protection attributes:</p>

                    <pre><code class="language-plaintext">GDT Entry (8 bytes each):
┌──────────┬─────────┬─────────┬──────────┬──────────┐
│ Base[24:31] │ Flags     │ Access    │ Base[16:23] │ Base[0:15]  │
│ Limit[16:19]│ (G,D,L,0) │ (P,DPL,S..)│             │ Limit[0:15] │
└──────────┴─────────┴─────────┴──────────┴──────────┘

Typical GDT layout:
  Index 0: Null descriptor (required)
  Index 1: Kernel Code (Ring 0, Execute)
  Index 2: Kernel Data (Ring 0, Read/Write)
  Index 3: User Code   (Ring 3, Execute)
  Index 4: User Data   (Ring 3, Read/Write)
  Index 5: TSS         (Task State Segment)</code></pre>

                    <h4>Entering Protected Mode (Bootloader Pattern)</h4>

                    <pre><code class="language-nasm">; Minimal GDT for entering protected mode
gdt_start:
    dq 0                        ; Null descriptor (index 0)
gdt_code:                       ; Code segment descriptor (index 1)
    dw 0xFFFF                   ; Limit 0-15
    dw 0                        ; Base 0-15
    db 0                        ; Base 16-23
    db 10011010b                ; Access: Present, Ring 0, Code, Readable
    db 11001111b                ; Flags: 4K granularity, 32-bit
    db 0                        ; Base 24-31
gdt_data:                       ; Data segment descriptor (index 2)
    dw 0xFFFF
    dw 0
    db 0
    db 10010010b                ; Access: Present, Ring 0, Data, Writable
    db 11001111b
    db 0
gdt_end:

gdt_descriptor:
    dw gdt_end - gdt_start - 1  ; GDT size - 1
    dd gdt_start                ; GDT address

; Switch to protected mode
enter_protected:
    cli                         ; Disable interrupts
    lgdt [gdt_descriptor]       ; Load GDT
    mov eax, cr0
    or eax, 1                   ; Set PE (Protection Enable) bit
    mov cr0, eax
    jmp 0x08:protected_start    ; Far jump to flush pipeline, load CS</code></pre>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Protected Mode Gotchas:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Can't use BIOS interrupts (they're 16-bit real mode code)</li>
                            <li>Must set up an IDT before enabling interrupts</li>
                            <li>Segment registers hold selectors, not segment bases</li>
                            <li>The far jump after setting CR0.PE is mandatory to load CS properly</li>
                        </ul>
                    </div>

                    <h3 id="long-mode">Long Mode (64-bit)</h3>
                    
                                        <p>Long Mode is the native mode for 64-bit x86 processors. You must transition through Protected Mode to reach it:</p>

                    <h4>Entering Long Mode (From Protected Mode)</h4>

                    <pre><code class="language-nasm">; Prerequisites:
; 1. Already in Protected Mode with paging disabled
; 2. PAE (Physical Address Extension) enabled
; 3. 4-level page tables set up

enter_long_mode:
    ; Enable PAE in CR4
    mov eax, cr4
    or eax, (1 << 5)            ; Set PAE bit
    mov cr4, eax
    
    ; Load PML4 table address into CR3
    mov eax, pml4_table         ; Page-Map Level-4 Table
    mov cr3, eax
    
    ; Enable Long Mode in EFER MSR
    mov ecx, 0xC0000080         ; EFER MSR number
    rdmsr
    or eax, (1 << 8)            ; Set LME (Long Mode Enable)
    wrmsr
    
    ; Enable paging (this activates Long Mode)
    mov eax, cr0
    or eax, (1 << 31)           ; Set PG (Paging) bit
    mov cr0, eax
    
    ; Far jump to 64-bit code segment
    jmp 0x08:long_mode_start

[bits 64]
long_mode_start:
    ; Now in 64-bit mode!
    mov rsp, stack_top
    call kernel_main</code></pre>

                    <h4>64-bit Addressing</h4>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Feature</th>
                                <th>32-bit Protected</th>
                                <th>64-bit Long</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Virtual Address</td>
                                <td>32-bit (4 GB)</td>
                                <td>48-bit (256 TB) canonical</td>
                            </tr>
                            <tr>
                                <td>Physical Address</td>
                                <td>32-bit (36 with PAE)</td>
                                <td>52-bit (4 PB)</td>
                            </tr>
                            <tr>
                                <td>Page Tables</td>
                                <td>2-level (or 3 with PAE)</td>
                                <td>4-level (5 with LA57)</td>
                            </tr>
                            <tr>
                                <td>Segments</td>
                                <td>Full segmentation</td>
                                <td>Flat model (FS/GS for TLS)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Canonical Addresses:</strong> In 64-bit mode, only 48 bits of address are used. Bits 48-63 must be sign-extended (all 0s or all 1s). This creates a "canonical hole" in the middle of the address space - the kernel lives in high addresses (0xFFFF...), user space in low addresses (0x0000...).
                    </div>
                </div>

                <!-- Privilege Section -->
                <div id="privilege" class="blog-content mt-5">
                    <h2><i class="fas fa-shield-alt me-2 text-teal"></i>Privilege Rings</h2>
                    
                    <h3 id="ring-model">The Ring Model (0-3)</h3>
                    
                    <div class="experiment-card">
                        <div class="card-meta mb-2">
                            <span class="badge bg-crimson text-white">Security</span>
                        </div>
                        <h4>x86 Privilege Levels</h4>
                        <ul>
                            <li><strong>Ring 0 (Kernel):</strong> Full hardware access, OS kernel code</li>
                            <li><strong>Ring 1:</strong> Device drivers (rarely used)</li>
                            <li><strong>Ring 2:</strong> Device drivers (rarely used)</li>
                            <li><strong>Ring 3 (User):</strong> Application code, restricted access</li>
                        </ul>
                        <p>Most modern OSes use only Ring 0 (kernel) and Ring 3 (user), with hypervisors sometimes utilizing Ring -1 (hardware virtualization).</p>
                    </div>

                    <h3 id="transitions">Ring Transitions</h3>
                    
                                        <p>Code transitions between privilege levels through controlled gates:</p>

                    <h4>User to Kernel (Ring 3 → Ring 0)</h4>

                    <pre><code class="language-nasm">; Modern syscall instruction (64-bit Linux)
; Arguments: RDI, RSI, RDX, R10, R8, R9
; Syscall number: RAX
; Return value: RAX

mov rax, 1              ; sys_write
mov rdi, 1              ; fd = stdout
mov rsi, message        ; buffer
mov rdx, 13             ; length
syscall                 ; RING 3 → RING 0 → RING 3

; What happens:
; 1. CPU saves RIP to RCX, RFLAGS to R11
; 2. Loads kernel CS:RIP from STAR/LSTAR MSRs
; 3. Sets CPL to 0 (kernel mode)
; 4. Kernel handler executes
; 5. sysret instruction returns to user mode</code></pre>

                    <h4>Transition Mechanisms</h4>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Mechanism</th>
                                <th>Direction</th>
                                <th>Use Case</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>syscall</code> / <code>sysret</code></td>
                                <td>User ↔ Kernel</td>
                                <td>Fast system calls (64-bit)</td>
                            </tr>
                            <tr>
                                <td><code>sysenter</code> / <code>sysexit</code></td>
                                <td>User ↔ Kernel</td>
                                <td>Fast system calls (32-bit)</td>
                            </tr>
                            <tr>
                                <td><code>int 0x80</code></td>
                                <td>User → Kernel</td>
                                <td>Legacy Linux syscall</td>
                            </tr>
                            <tr>
                                <td><code>int 0x2e</code></td>
                                <td>User → Kernel</td>
                                <td>Legacy Windows syscall</td>
                            </tr>
                            <tr>
                                <td>Hardware interrupt</td>
                                <td>Any → Kernel</td>
                                <td>Device events, timer</td>
                            </tr>
                            <tr>
                                <td>Exception (fault/trap)</td>
                                <td>Any → Kernel</td>
                                <td>Page fault, divide error</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="experiment-card">
                        <h4><i class="fas fa-microscope me-2"></i>Exercise: Observe Ring Transitions</h4>
                        <div class="content">
                            <pre><code class="language-bash"># Count syscalls made by a program
strace -c ls /

# Example output:
# % time     calls     syscall
# 67.50%       101     read
# 12.00%        43     write
#  5.00%        25     openat
#  ...each is a Ring 3 → 0 → 3 transition!</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Internals Section -->
                <div id="internals" class="blog-content mt-5">
                    <h2><i class="fas fa-microchip me-2 text-teal"></i>CPU Internals</h2>
                    
                    <h3 id="pipeline">Instruction Pipeline</h3>
                    
                                        <p>Modern CPUs process instructions through a multi-stage pipeline to increase throughput:</p>

                    <pre><code class="language-plaintext">Classic 5-Stage Pipeline:

  ┌───────┐   ┌───────┐   ┌───────┐   ┌───────┐   ┌───────┐
  │ Fetch │ → │Decode │ → │Execute│ → │Memory │ → │Write- │
  │       │   │       │   │       │   │ Access│   │ back  │
  └───────┘   └───────┘   └───────┘   └───────┘   └───────┘
  
  Clock  1    2    3    4    5    6    7    8    9
  Inst1  IF   ID   EX   MEM  WB
  Inst2       IF   ID   EX   MEM  WB
  Inst3            IF   ID   EX   MEM  WB
  Inst4                 IF   ID   EX   MEM  WB
  
  Throughput: 1 instruction per cycle (ideally)</code></pre>

                    <h4>Pipeline Stages Explained</h4>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Stage</th>
                                <th>Action</th>
                                <th>Relevant to Assembly</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Fetch (IF)</strong></td>
                                <td>Read instruction bytes from memory/cache</td>
                                <td>Code alignment matters for cache lines</td>
                            </tr>
                            <tr>
                                <td><strong>Decode (ID)</strong></td>
                                <td>Parse instruction, read registers</td>
                                <td>Simpler instructions decode faster</td>
                            </tr>
                            <tr>
                                <td><strong>Execute (EX)</strong></td>
                                <td>Perform computation (ALU, FPU, etc.)</td>
                                <td>Some instructions take multiple cycles</td>
                            </tr>
                            <tr>
                                <td><strong>Memory (MEM)</strong></td>
                                <td>Load/store data from memory</td>
                                <td>Memory operations are slow (cache helps)</td>
                            </tr>
                            <tr>
                                <td><strong>Writeback (WB)</strong></td>
                                <td>Write results to registers</td>
                                <td>Register dependencies cause stalls</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Pipeline Hazards:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>Data hazard:</strong> <code>add rax, rbx; sub rcx, rax</code> — second instruction needs result from first</li>
                            <li><strong>Control hazard:</strong> Branches disrupt the pipeline (branch prediction helps)</li>
                            <li><strong>Structural hazard:</strong> Multiple instructions need same hardware unit</li>
                        </ul>
                    </div>

                    <h3 id="decoder">Instruction Decoder</h3>
                    
                                        <p>x86's variable-length instructions (1-15 bytes) create a decoding challenge:</p>

                    <pre><code class="language-plaintext">Instruction Length Examples:

nop                          ; 90                    (1 byte)
ret                          ; C3                    (1 byte)
mov eax, 1                   ; B8 01 00 00 00        (5 bytes)
mov rax, 1                   ; 48 B8 01 00 00 00 00 00 00 00  (10 bytes)
lock cmpxchg [rdi+rcx*8], rax ; F0 48 0F B1 04 CF   (6 bytes with prefix)

The decoder must:
1. Find instruction boundaries (no fixed size!)
2. Handle legacy prefixes (REX, VEX, EVEX)
3. Parse ModR/M and SIB bytes
4. Extract immediate values</code></pre>

                    <h4>Decoder Design</h4>

                    <p>Modern Intel/AMD CPUs use multiple parallel decoders:</p>

                    <pre><code class="language-plaintext">Intel Skylake Decoder:

┌──────────────────────────────────────────────┐
│          Instruction Fetch (16 bytes/cycle)  │
└──────────────────────────────────────────────┘
                      │
                      ▼
┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐
│Decode│ │Decode│ │Decode│ │Decode│ │Complex│
│  1   │ │  2   │ │  3   │ │  4   │ │Decode │
│simple│ │simple│ │simple│ │simple│ │(MSROM)│
└──────┘ └──────┘ └──────┘ └──────┘ └───────┘
  ↓                                    ↓
 1 µop                              Multiple
 each                                 µops

Simple: Can be decoded to 1 micro-op (fused)
Complex: Needs microcode ROM lookup</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Assembly Optimization Tip:</strong> Prefer instructions that decode to single µops. Avoid complex instructions like LOOP (which decodes to multiple µops and is slower than a manual DEC + JNZ sequence).
                    </div>

                    <h3 id="microcode">Microcode Layer</h3>
                    
                                        <p>Complex CISC instructions are internally translated to simple RISC-like operations called <strong>micro-operations (µops)</strong>:</p>

                    <h4>µop Translation Examples</h4>

                    <pre><code class="language-nasm">; Simple instruction → 1 µop
add rax, rbx             ; 1 µop: add

; Memory operand → 2 µops (fused in some cases)
add rax, [rbx]           ; 2 µops: load + add (may fuse to 1)

; Memory-memory (read-modify-write) → 4 µops
add [count], 5           ; load + add + store-address + store-data

; Complex string operation → many µops
rep movsb                ; ~100+ µops for copying 100 bytes
                         ; (internally loops in microcode)</code></pre>

                    <h4>Why Microcode Matters</h4>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Aspect</th>
                                <th>Hardwired</th>
                                <th>Microcoded</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Speed</td>
                                <td>Single-cycle (ideal)</td>
                                <td>Multiple cycles</td>
                            </tr>
                            <tr>
                                <td>Examples</td>
                                <td><code>add</code>, <code>mov</code>, <code>xor</code></td>
                                <td><code>div</code>, <code>cpuid</code>, <code>rep movs</code></td>
                            </tr>
                            <tr>
                                <td>Updatable</td>
                                <td>No (silicon)</td>
                                <td>Yes (microcode updates)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="experiment-card">
                        <h4><i class="fas fa-microscope me-2"></i>Exercise: Count µops with perf</h4>
                        <div class="content">
                            <pre><code class="language-bash"># Profile µops on Intel
perf stat -e uops_issued.any,uops_executed.thread ./program

# Sample output:
# 1,500,000,000   uops_issued.any
# 1,200,000,000   uops_executed.thread  
# 1.0 seconds elapsed

# More µops issued than executed = speculation wasted on mispredicts</code></pre>
                        </div>
                    </div>

                    <div class="highlight-box highlight-navy">
                        <i class="fas fa-shield-alt"></i>
                        <strong>Security:</strong> Microcode updates can patch CPU vulnerabilities like Spectre and Meltdown. Check your current microcode version with: <code>cat /proc/cpuinfo | grep microcode</code> on Linux.
                    </div>
                </div>

                <!-- Next Steps -->
                <div id="next-steps" class="blog-content mt-5">
                    <h2><i class="fas fa-forward me-2 text-teal"></i>Next Steps</h2>
                    
                    <p>With a solid understanding of CPU architecture, we'll now dive deep into the registers—the CPU's working memory for assembly programming.</p>

                    <!-- Related Posts -->
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 1: Assembly Language Fundamentals & Toolchain Setup</h5>
                            <p class="text-muted small mb-2">Learn what assembly really is, the build pipeline, and write your first programs.</p>
                            <a href="asm-part01-fundamentals.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 3: Registers – Complete Deep Dive</h5>
                            <p class="text-muted small mb-2">Master all x86/x64 registers: general-purpose, segment, control, debug, and MSRs.</p>
                            <a href="asm-part03-registers.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 4: Instruction Encoding & Binary Layout</h5>
                            <p class="text-muted small mb-2">Understand how assembly instructions are encoded into machine code bytes.</p>
                            <a href="asm-part04-instruction-encoding.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.</p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest"><i class="fab fa-pinterest-p"></i></a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email"><i class="fas fa-envelope"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-secondary">
            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small"><i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a></p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">Enjoying this content? ☕ <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Scroll-to-Top Button -->
    <button id="scrollToTop" class="scroll-to-top" title="Back to Top"><i class="fas fa-arrow-up"></i></button>
    
    <!-- Category Indicator -->
    <div id="categoryIndicator" class="category-indicator" title="Current Section"><i class="fas fa-tag"></i><span id="categoryText">Technology</span></div>
    
    <!-- Cookie Consent JS -->
    <script src="../../../js/cookie-consent.js"></script>
    
    <!-- Main JS -->
    <script src="../../../js/main.js"></script>

    <!-- Prism.js Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-nasm.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
</body>
</html>
