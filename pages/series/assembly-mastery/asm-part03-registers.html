<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Complete guide to x86/x86-64 registers: general-purpose (RAX, RBX, RCX, RDX), index/pointer, segment registers, control registers (CR0-CR4), EFLAGS/RFLAGS, debug registers, and MSRs." />
    <meta name="author" content="Wasil Zafar" />
    <meta name="keywords" content="x86 Registers, RAX, EAX, General Purpose Registers, Segment Registers, Control Registers, EFLAGS, RFLAGS, Debug Registers, MSR, x86-64 Registers" />
    <meta property="og:title" content="x86 Assembly Series Part 3: Registers – Complete Deep Dive" />
    <meta property="og:description" content="Master all x86/x64 registers including general-purpose, segment, control, debug, and model-specific registers for effective assembly programming." />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2026-02-06" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />
    
    <title>x86 Assembly Series Part 3: Registers – Complete Deep Dive - Wasil Zafar</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />

    <!-- Prism.js Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <!-- Google Consent Mode v2 -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', {
            'ad_storage': 'denied', 'ad_user_data': 'denied', 'ad_personalization': 'denied', 'analytics_storage': 'denied',
            'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE']
        });
        gtag('consent', 'default', { 'ad_storage': 'granted', 'ad_user_data': 'granted', 'ad_personalization': 'granted', 'analytics_storage': 'granted' });
        gtag('set', 'url_passthrough', true);
    </script>

    <!-- Google Tag Manager -->
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PBS8M2JR');
    </script>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/"><span class="gradient-text">Wasil Zafar</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#skills">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#certifications">Certifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#interests">Interests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
                <h1 class="display-4 fw-bold mb-3">x86 Assembly Series Part 3: Registers – Complete Deep Dive</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>February 6, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>35 min read</span>
                    <button onclick="window.print()" class="print-btn" title="Print this article"><i class="fas fa-print"></i> Print</button>
                </div>
                <p class="lead">Master all x86/x64 registers including general-purpose registers (RAX-R15), segment registers, control registers (CR0-CR4), the flags register, debug registers, and model-specific registers (MSRs).</p>
            </div>
        </div>
    </section>

    <!-- Table of Contents Toggle Button -->
    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents" aria-label="Open Table of Contents"><i class="fas fa-list"></i></button>

    <!-- Side Navigation Overlay -->
    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()" aria-label="Close Table of Contents">&times;</button>
        </div>
        <ol>
            <li><a href="#gp-registers" onclick="closeNav()">General-Purpose Registers</a>
                <ul>
                    <li><a href="#rax-family" onclick="closeNav()">RAX/EAX/AX/AH/AL</a></li>
                    <li><a href="#all-gp" onclick="closeNav()">Complete GP Register Set</a></li>
                    <li><a href="#sub-register" onclick="closeNav()">Sub-Register Access</a></li>
                </ul>
            </li>
            <li><a href="#index-pointer" onclick="closeNav()">Index & Pointer Registers</a>
                <ul>
                    <li><a href="#rsp-rbp" onclick="closeNav()">RSP & RBP</a></li>
                    <li><a href="#rsi-rdi" onclick="closeNav()">RSI & RDI</a></li>
                </ul>
            </li>
            <li><a href="#segment" onclick="closeNav()">Segment Registers</a>
                <ul>
                    <li><a href="#cs-ds-ss" onclick="closeNav()">CS, DS, SS, ES</a></li>
                    <li><a href="#fs-gs" onclick="closeNav()">FS & GS (TLS)</a></li>
                </ul>
            </li>
            <li><a href="#control" onclick="closeNav()">Control Registers</a>
                <ul>
                    <li><a href="#cr0" onclick="closeNav()">CR0 (Control)</a></li>
                    <li><a href="#cr3" onclick="closeNav()">CR3 (Page Table)</a></li>
                    <li><a href="#cr4" onclick="closeNav()">CR4 (Extensions)</a></li>
                </ul>
            </li>
            <li><a href="#flags" onclick="closeNav()">Flags Register</a>
                <ul>
                    <li><a href="#status-flags" onclick="closeNav()">Status Flags</a></li>
                    <li><a href="#control-flags" onclick="closeNav()">Control Flags</a></li>
                </ul>
            </li>
            <li><a href="#debug-msr" onclick="closeNav()">Debug & MSR Registers</a></li>
        </ol>
    </div>
    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <!-- Main Content -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <div id="gp-registers" class="blog-content">
                    <h2><i class="fas fa-memory me-2 text-teal"></i>General-Purpose Registers</h2>
                    
                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Core Concept:</strong> General-purpose registers are the CPU's working memory. x86-64 provides 16 64-bit general-purpose registers (RAX-R15) that can be accessed in different sizes for backward compatibility.
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">25-Part Series</span>
                            <span class="badge bg-crimson">x86 Assembly Mastery</span>
                        </div>
                        <div class="content">
                            <p><strong>Foundation & Environment Setup</strong></p>
                            <ol start="0">
                                <li><a href="asm-part00-environment-setup.html">Development Environment, Tooling & Workflow</a></li>
                                <li><a href="asm-part01-fundamentals.html">Assembly Language Fundamentals & Toolchain Setup</a></li>
                                <li><a href="asm-part02-cpu-architecture.html">x86 CPU Architecture Overview</a></li>
                                <li><strong>Registers – Complete Deep Dive (This Guide)</strong></li>
                                <li><a href="asm-part04-instruction-encoding.html">Instruction Encoding & Binary Layout</a></li>
                            </ol>
                            <p class="mt-3"><strong>Assemblers, Syntax & Memory</strong></p>
                            <ol start="5">
                                <li><a href="asm-part05-nasm.html">NASM Syntax, Directives & Macros</a></li>
                                <li><a href="asm-part06-masm.html">Complete Assembler Comparison</a></li>
                                <li><a href="asm-part07-memory-addressing.html">Memory Addressing Modes</a></li>
                            </ol>
                            <p class="mt-3"><strong>Control Flow, Stack & Computation</strong></p>
                            <ol start="8">
                                <li><a href="asm-part08-stack-calling.html">Stack Internals & Calling Conventions</a></li>
                                <li><a href="asm-part09-control-flow.html">Control Flow & Procedures</a></li>
                                <li><a href="asm-part10-arithmetic.html">Integer, Bitwise & Arithmetic Operations</a></li>
                            </ol>
                            <p class="mt-3"><strong>Floating Point, SIMD & Performance</strong></p>
                            <ol start="11">
                                <li><a href="asm-part11-floating-point.html">Floating Point & SIMD Foundations</a></li>
                                <li><a href="asm-part12-simd.html">SIMD, Vectorization & Performance</a></li>
                            </ol>
                            <p class="mt-3"><strong>OS Interaction & Debugging</strong></p>
                            <ol start="13">
                                <li><a href="asm-part13-syscalls-interrupts.html">System Calls, Interrupts & Privilege Transitions</a></li>
                                <li><a href="asm-part14-debugging.html">Debugging & Reverse Engineering</a></li>
                                <li><a href="asm-part15-linking.html">Linking, Relocation & Loader Behavior</a></li>
                            </ol>
                            <p class="mt-3"><strong>Advanced Architecture & Interoperability</strong></p>
                            <ol start="16">
                                <li><a href="asm-part16-long-mode.html">x86-64 Long Mode & Advanced Features</a></li>
                                <li><a href="asm-part17-c-interop.html">Assembly + C/C++ Interoperability</a></li>
                                <li><a href="asm-part18-security.html">Memory Protection & Security Concepts</a></li>
                            </ol>
                            <p class="mt-3"><strong>Bare Metal, Kernel & Virtualization</strong></p>
                            <ol start="19">
                                <li><a href="asm-part19-bootloader.html">Bootloaders & Bare-Metal Programming</a></li>
                                <li><a href="asm-part20-kernel.html">Kernel-Level Assembly</a></li>
                                <li><a href="asm-part21-qemu.html">Complete Emulator & Simulator Guide</a></li>
                            </ol>
                            <p class="mt-3"><strong>CPU Microarchitecture & Optimization</strong></p>
                            <ol start="22">
                                <li><a href="asm-part22-optimization.html">Advanced Optimization & CPU Internals</a></li>
                            </ol>
                            <p class="mt-3"><strong>Real-World Application & Mastery</strong></p>
                            <ol start="23">
                                <li><a href="asm-part23-projects.html">Real-World Assembly Projects</a></li>
                                <li><a href="asm-part24-capstone.html">Assembly Mastery Capstone</a></li>
                            </ol>
                        </div>
                    </div>

                    <h3 id="rax-family">The RAX Family (Accumulator)</h3>
                    
                    <div class="experiment-card">
                        <div class="card-meta mb-2"><span class="badge bg-teal text-white">Register</span></div>
                        <h4>RAX / EAX / AX / AH / AL</h4>
                        <pre><code class="language-nasm">; RAX (64-bit) = |63--------------------32|31---------16|15---8|7---0|
;                                          |    EAX      |  AX  |     |
;                                          |             |AH    |AL   |

mov rax, 0x123456789ABCDEF0  ; Full 64-bit
mov eax, 0x12345678          ; Lower 32-bit (zeros upper 32)
mov ax, 0x1234               ; Lower 16-bit
mov ah, 0x12                 ; High byte of AX
mov al, 0x34                 ; Low byte of AX</code></pre>
                    </div>

                    <h3 id="all-gp">Complete General-Purpose Set</h3>
                    
                    <div class="experiment-card">
                        <div class="card-meta mb-2"><span class="badge bg-crimson text-white">Reference</span></div>
                        <h4>x86-64 Register Map</h4>
                        <table class="table table-bordered table-sm">
                            <thead class="table-dark">
                                <tr><th>64-bit</th><th>32-bit</th><th>16-bit</th><th>8-bit High</th><th>8-bit Low</th><th>Traditional Use</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>RAX</td><td>EAX</td><td>AX</td><td>AH</td><td>AL</td><td>Accumulator</td></tr>
                                <tr><td>RBX</td><td>EBX</td><td>BX</td><td>BH</td><td>BL</td><td>Base</td></tr>
                                <tr><td>RCX</td><td>ECX</td><td>CX</td><td>CH</td><td>CL</td><td>Counter</td></tr>
                                <tr><td>RDX</td><td>EDX</td><td>DX</td><td>DH</td><td>DL</td><td>Data</td></tr>
                                <tr><td>RSI</td><td>ESI</td><td>SI</td><td>-</td><td>SIL</td><td>Source Index</td></tr>
                                <tr><td>RDI</td><td>EDI</td><td>DI</td><td>-</td><td>DIL</td><td>Destination Index</td></tr>
                                <tr><td>RBP</td><td>EBP</td><td>BP</td><td>-</td><td>BPL</td><td>Base Pointer</td></tr>
                                <tr><td>RSP</td><td>ESP</td><td>SP</td><td>-</td><td>SPL</td><td>Stack Pointer</td></tr>
                                <tr><td>R8-R15</td><td>R8D-R15D</td><td>R8W-R15W</td><td>-</td><td>R8B-R15B</td><td>x64 Extended</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 id="sub-register">Sub-Register Access Gotchas</h3>
                    
                    <p>Understanding how partial register writes behave is crucial to avoid subtle bugs:</p>

                    <h4>The Zero-Extension Rule (64-bit mode)</h4>

                    <pre><code class="language-nasm">; CRITICAL RULE: Writing to 32-bit register ZEROS the upper 32 bits!
mov rax, 0xFFFFFFFF_FFFFFFFF  ; RAX = full 64-bit value
mov eax, 0x12345678           ; RAX = 0x00000000_12345678 (!)

; But 8-bit and 16-bit writes DO NOT zero-extend:
mov rax, 0xFFFFFFFF_FFFFFFFF  ; RAX = full 64-bit value
mov ax, 0x1234                ; RAX = 0xFFFFFFFF_FFFF1234
mov al, 0x56                  ; RAX = 0xFFFFFFFF_FFFF1256</code></pre>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Common Bug Source:</strong> Forgetting that <code>mov eax, val</code> clears the upper 32 bits of RAX. This is intentional (avoids partial register stalls) but catches beginners. Use <code>mov rax, val</code> or explicit zero-extension when needed.
                    </div>

                    <h4>Performance: Partial Register Stalls</h4>

                    <pre><code class="language-nasm">; This code may stall on older CPUs:
mov rax, 0
mov ah, 1          ; Write to partial register (AH)
mov rbx, rax       ; Read full register - possible stall!

; Better: Avoid AH/BH/CH/DH in 64-bit code
movzx eax, byte [value]  ; Zero-extend to full register
shl eax, 8               ; Shift to "AH position" if needed</code></pre>

                    <h4>REX Prefix Impact</h4>

                    <pre><code class="language-nasm">; The high-byte registers (AH, BH, CH, DH) cannot be used
; when any REX prefix is present (which is required for R8-R15)

mov ah, 5           ; OK: no REX needed
mov r8b, 5          ; OK: uses REX prefix
mov ah, r8b         ; ERROR: Can't encode AH with REX prefix!

; New low-byte registers (SIL, DIL, BPL, SPL) require REX
mov sil, 5          ; OK: REX prefix generated automatically</code></pre>

                    <div class="experiment-card">
                        <h4><i class="fas fa-flask me-2"></i>Exercise: Predict the Output</h4>
                        <div class="content">
                            <pre><code class="language-nasm">xor rax, rax           ; RAX = ?
mov eax, 0xDEADBEEF    ; RAX = ?
mov ax, 0x1234         ; RAX = ?
mov al, 0xFF           ; RAX = ?
; Final RAX value?</code></pre>
                            <p>Answer: <code>0x00000000_DEAD12FF</code> — EAX write zeroed upper bits, AX write preserved upper 48 bits, AL write preserved upper 56 bits.</p>
                        </div>
                    </div>
                </div>

                <div id="index-pointer" class="blog-content mt-5">
                    <h2><i class="fas fa-arrows-alt me-2 text-teal"></i>Index & Pointer Registers</h2>
                    
                    <p>These registers have hardware-supported roles in memory addressing and stack operations.</p>

                    <h3>RSP — Stack Pointer</h3>

                    <pre><code class="language-nasm">; RSP always points to the TOP of the stack (last pushed value)
; Stack grows DOWNWARD on x86!

push rax            ; RSP -= 8, then [RSP] = RAX
pop rbx             ; RBX = [RSP], then RSP += 8

; Direct stack manipulation:
sub rsp, 32         ; Reserve 32 bytes on stack
mov [rsp+8], rdi    ; Store value in reserved space
add rsp, 32         ; Release reserved space

; CRITICAL: RSP must be 16-byte aligned before CALL on x86-64!
; The ABI expects it. Violating this crashes on some SIMD instructions.</code></pre>

                    <h3>RBP — Base Pointer (Frame Pointer)</h3>

                    <pre><code class="language-nasm">; Traditional stack frame setup
my_function:
    push rbp            ; Save caller's frame pointer
    mov rbp, rsp        ; Establish our frame
    sub rsp, 32         ; Local variables
    
    ; Access locals via RBP (constant offset throughout function)
    mov [rbp-8], rdi    ; First local variable
    mov [rbp-16], rsi   ; Second local variable
    
    ; Access parameters (after return address and saved RBP)
    ; Stack args (if any) at [rbp+16], [rbp+24], ...
    
    leave               ; Equivalent to: mov rsp, rbp; pop rbp
    ret

; Frame pointer can be omitted (-fomit-frame-pointer) for more registers
; But debugging becomes harder</code></pre>

                    <h3>RSI & RDI — Source & Destination Index</h3>

                    <pre><code class="language-nasm">; Originally for string operations (auto-increment/decrement)
mov rsi, source_buffer
mov rdi, dest_buffer
mov rcx, 100            ; Count
cld                     ; Clear direction flag (forward)
rep movsb               ; Copy RCX bytes from [RSI] to [RDI]

; Also used as first two arguments in System V AMD64 ABI:
; my_func(arg1, arg2) → RDI=arg1, RSI=arg2</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Calling Conventions:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>System V AMD64 (Linux, macOS):</strong> RDI, RSI, RDX, RCX, R8, R9</li>
                            <li><strong>Microsoft x64 (Windows):</strong> RCX, RDX, R8, R9</li>
                            <li><strong>Return value:</strong> RAX (and RDX for 128-bit returns)</li>
                        </ul>
                    </div>
                </div>

                <div id="segment" class="blog-content mt-5">
                    <h2><i class="fas fa-layer-group me-2 text-teal"></i>Segment Registers</h2>
                    
                    <p>Legacy from segmented memory days, but still relevant for special purposes in 64-bit mode.</p>

                    <h3>Segment Register Overview</h3>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Register</th>
                                <th>Name</th>
                                <th>64-bit Mode Use</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>CS</code></td>
                                <td>Code Segment</td>
                                <td>Required for privilege level (ring), not for addressing</td>
                            </tr>
                            <tr>
                                <td><code>DS</code>, <code>ES</code>, <code>SS</code></td>
                                <td>Data, Extra, Stack</td>
                                <td>Ignored (treated as base 0)</td>
                            </tr>
                            <tr>
                                <td><code>FS</code></td>
                                <td>Extra Segment</td>
                                <td><strong>Thread-Local Storage</strong> on Windows (TEB)</td>
                            </tr>
                            <tr>
                                <td><code>GS</code></td>
                                <td>Extra Segment</td>
                                <td><strong>TLS on Linux</strong>, kernel per-CPU data</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Using FS and GS for Thread-Local Storage</h3>

                    <pre><code class="language-nasm">; Linux: GS points to thread-local block
mov rax, [gs:0x28]       ; Read stack canary (security)

; Windows: FS points to Thread Environment Block (TEB)
mov rax, [fs:0x30]       ; Get PEB (Process Environment Block) pointer
mov rax, [fs:0x00]       ; Current SEH chain

; Kernel mode: GS often holds per-CPU data pointer
mov rax, [gs:0x00]       ; Per-CPU structure base</code></pre>

                    <h3>Setting Up Segment Base (Kernel/System Code)</h3>

                    <pre><code class="language-nasm">; MSR-based segment base (no GDT entry needed in 64-bit)
; FS base: MSR 0xC0000100
; GS base: MSR 0xC0000101  
; Kernel GS base: MSR 0xC0000102 (swapped on syscall)

; Write to FS base:
mov ecx, 0xC0000100      ; FS.base MSR
mov eax, tls_area        ; Low 32 bits
mov edx, 0               ; High 32 bits (or upper bits of address)
wrmsr                    ; Write MSR (Ring 0 only!)</code></pre>

                    <div class="highlight-box highlight-navy">
                        <i class="fas fa-info-circle"></i>
                        <strong>Security Note:</strong> The <code>swapgs</code> instruction (used in syscall handlers) atomically swaps GS base with the kernel's GS base. This prevents user mode from seeing kernel per-CPU data, critical for security.
                    </div>
                </div>

                <div id="control" class="blog-content mt-5">
                    <h2><i class="fas fa-sliders-h me-2 text-teal"></i>Control Registers</h2>
                    
                    <p>Control registers configure CPU operating modes and memory management. Access requires <strong>Ring 0</strong> (kernel) privilege.</p>

                    <h3>CR0 — System Control</h3>

                    <pre><code class="language-plaintext">CR0 Layout:
┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐
Bit: 31  30  29  28  ...  18  16   5   4   3   2   1   0
    │ PG │ CD │ NW │   │   │ AM │ WP │ NE │ ET │ TS │ EM │ MP │ PE │
    └─┴──┴──┴──┴───┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┘
     │     │     │                      │                        └─ PE: Protection Enable
     │     │     │                      └─ WP: Write Protect (Ring 0 can't write to R/O pages)
     └─────┴─────┴─ PG: Paging Enable, CD: Cache Disable, NW: Not Write-through</code></pre>

                    <pre><code class="language-nasm">; Enable Protected Mode (from real mode bootloader)
mov eax, cr0
or eax, 1           ; Set PE bit
mov cr0, eax

; Enable Paging (already in protected mode)
mov eax, cr0
or eax, (1 << 31)   ; Set PG bit
mov cr0, eax</code></pre>

                    <h3>CR2 — Page Fault Address</h3>

                    <pre><code class="language-nasm">; CR2 contains the address that caused the most recent page fault
; Used in page fault handlers:
page_fault_handler:
    mov rax, cr2     ; Get faulting address
    ; ... determine if it's valid, map the page, etc.
    iretq</code></pre>

                    <h3>CR3 — Page Table Base</h3>

                    <pre><code class="language-nasm">; CR3 holds the physical address of the top-level page table
; PML4 in 64-bit mode, Page Directory in 32-bit

mov eax, new_page_table_phys  ; Physical address of PML4
mov cr3, rax                   ; Flush TLB and switch address space

; Note: Writing to CR3 flushes the TLB (Translation Lookaside Buffer)
; Use INVLPG for selective TLB invalidation:
invlpg [address]               ; Invalidate TLB entry for specific address</code></pre>

                    <h3>CR4 — Extended Features</h3>

                    <pre><code class="language-nasm">; CR4 enables various CPU extensions
mov rax, cr4
or rax, (1 << 5)    ; PAE: Physical Address Extension
or rax, (1 << 7)    ; PGE: Page Global Enable
or rax, (1 << 9)    ; OSFXSR: FXSAVE/FXRSTOR support
or rax, (1 << 10)   ; OSXMMEXCPT: SIMD floating-point exceptions
mov cr4, rax</code></pre>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Ring 0 Only:</strong> Control registers can only be accessed from kernel mode. Attempting to read/write CRx from user mode triggers a General Protection Fault (#GP).
                    </div>
                </div>

                <div id="flags" class="blog-content mt-5">
                    <h2><i class="fas fa-flag me-2 text-teal"></i>Flags Register (EFLAGS/RFLAGS)</h2>
                    
                    <p>The flags register tracks arithmetic results and controls CPU behavior. Understanding flags is essential for conditional branching.</p>

                    <h3>RFLAGS Layout</h3>

                    <pre><code class="language-plaintext">   63         21  20  19  18  17  16   ...   11  10   9   8   7   6   4   2   0
  ┌───────────┬───┬───┬───┬───┬───┬───────┬───┬───┬───┬───┬───┬───┬───┬───┬───┐
  │ Reserved  │ ID│ VIP│ VIF│ AC│ VM│  ...  │ OF│ DF│ IF│ TF│ SF│ ZF│ AF│ PF│ CF│
  └───────────┴───┴───┴───┴───┴───┴───────┴───┴───┴───┴───┴───┴───┴───┴───┴───┘</code></pre>

                    <h3>Arithmetic Status Flags</h3>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Flag</th>
                                <th>Bit</th>
                                <th>Name</th>
                                <th>Set When</th>
                                <th>Use Case</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>CF</code></td>
                                <td>0</td>
                                <td>Carry Flag</td>
                                <td>Unsigned overflow/borrow</td>
                                <td><code>jc</code>, <code>jnc</code>, <code>adc</code>, <code>sbb</code></td>
                            </tr>
                            <tr>
                                <td><code>ZF</code></td>
                                <td>6</td>
                                <td>Zero Flag</td>
                                <td>Result is zero</td>
                                <td><code>je/jz</code>, <code>jne/jnz</code></td>
                            </tr>
                            <tr>
                                <td><code>SF</code></td>
                                <td>7</td>
                                <td>Sign Flag</td>
                                <td>Result is negative (MSB=1)</td>
                                <td><code>js</code>, <code>jns</code></td>
                            </tr>
                            <tr>
                                <td><code>OF</code></td>
                                <td>11</td>
                                <td>Overflow Flag</td>
                                <td>Signed overflow</td>
                                <td><code>jo</code>, <code>jno</code></td>
                            </tr>
                            <tr>
                                <td><code>PF</code></td>
                                <td>2</td>
                                <td>Parity Flag</td>
                                <td>Low byte has even 1-bits</td>
                                <td>Legacy, error checking</td>
                            </tr>
                            <tr>
                                <td><code>AF</code></td>
                                <td>4</td>
                                <td>Auxiliary Flag</td>
                                <td>Carry from bit 3 to 4</td>
                                <td>BCD arithmetic</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Control Flags</h3>

                    <pre><code class="language-nasm">; Direction Flag (DF) - controls string operation direction
cld                 ; Clear DF: strings go forward (SI++, DI++)
std                 ; Set DF: strings go backward (SI--, DI--)

; Interrupt Flag (IF) - enable/disable hardware interrupts
sti                 ; Enable interrupts (Ring 0 only)
cli                 ; Disable interrupts (Ring 0 only)

; Trap Flag (TF) - single-step debugging
; When set, CPU generates INT 1 after each instruction</code></pre>

                    <h3>Flag Operations</h3>

                    <pre><code class="language-nasm">; Saving and restoring flags
pushfq              ; Push RFLAGS onto stack
popfq               ; Pop stack into RFLAGS

; Read flags into AH (low 8 bits only)
lahf                ; AH = SF:ZF:0:AF:0:PF:1:CF
sahf                ; Restore those flags from AH

; Directly manipulating carry flag
stc                 ; Set CF = 1
clc                 ; Clear CF = 0  
cmc                 ; Complement (toggle) CF</code></pre>

                    <div class="experiment-card">
                        <h4><i class="fas fa-flask me-2"></i>Exercise: Understanding Flags</h4>
                        <div class="content">
                            <pre><code class="language-nasm">; What flags are set after each operation?
mov al, 0xFF
add al, 1           ; AL=?, CF=?, ZF=?, OF=?, SF=?

mov al, 127
add al, 1           ; AL=?, CF=?, ZF=?, OF=?, SF=?

mov al, 0
sub al, 1           ; AL=?, CF=?, ZF=?, OF=?, SF=?</code></pre>
                            <p><strong>Answers:</strong><br>
                            1. AL=0, CF=1 (carry out), ZF=1, OF=0, SF=0<br>
                            2. AL=128 (-128), CF=0, ZF=0, OF=1 (signed overflow!), SF=1<br>
                            3. AL=255 (-1), CF=1 (borrow), ZF=0, OF=0, SF=1</p>
                        </div>
                    </div>
                </div>

                <div id="debug-msr" class="blog-content mt-5">
                    <h2><i class="fas fa-bug me-2 text-teal"></i>Debug & MSR Registers</h2>
                    
                    <p>Hardware debugging and CPU configuration registers for system-level development.</p>

                    <h3>Debug Registers (DR0-DR7)</h3>

                    <pre><code class="language-plaintext">DR0-DR3: Hardware breakpoint addresses (up to 4 breakpoints)
DR4-DR5: Reserved (aliased to DR6-DR7 if not in debug extension mode)
DR6: Debug Status - which breakpoint triggered
DR7: Debug Control - enable/configure breakpoints

DR7 Breakpoint Types:
  00 = Execute (instruction fetch)
  01 = Write only (data)
  10 = I/O read/write (if CR4.DE=1)
  11 = Read/Write (data)</code></pre>

                    <h3>Setting Hardware Breakpoints</h3>

                    <pre><code class="language-nasm">; Set a hardware breakpoint on memory write (Ring 0 only)
mov rax, target_address      ; Address to watch
mov dr0, rax                 ; Load into DR0

; Configure DR7: enable DR0, write-only, 4-byte size
; Bits [1:0] = G0/L0 = global/local enable for DR0
; Bits [17:16] = R/W0 = condition (01 = write)
; Bits [19:18] = LEN0 = size (11 = 4 bytes)
mov rax, 0x000D0001          ; G0=1, R/W0=01, LEN0=11
mov dr7, rax

; When target_address is written, INT 1 fires
; DR6 will indicate which breakpoint triggered</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>GDB Uses These:</strong> When you set a hardware watchpoint in GDB (<code>watch variable</code>), it programs the debug registers. Software breakpoints (<code>break</code>) use <code>INT 3</code> (opcode 0xCC) instead.
                    </div>

                    <h3>Model-Specific Registers (MSRs)</h3>

                    <p>MSRs are CPU-specific configuration registers accessed via RDMSR/WRMSR:</p>

                    <pre><code class="language-nasm">; Read MSR (Ring 0 only)
; ECX = MSR number, result in EDX:EAX
mov ecx, 0x10               ; IA32_TIME_STAMP_COUNTER
rdmsr                        ; EDX:EAX = TSC value

; Write MSR  
; ECX = MSR number, EDX:EAX = value to write
mov ecx, 0xC0000080          ; IA32_EFER (Extended Feature Enable)
rdmsr
or eax, (1 << 8)             ; Set LME (Long Mode Enable)
wrmsr</code></pre>

                    <h3>Common MSRs</h3>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>MSR Number</th>
                                <th>Name</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>0x10</code></td>
                                <td>IA32_TIME_STAMP_COUNTER</td>
                                <td>CPU cycle counter (also accessible via RDTSC)</td>
                            </tr>
                            <tr>
                                <td><code>0xC0000080</code></td>
                                <td>IA32_EFER</td>
                                <td>Long mode enable, NX bit enable</td>
                            </tr>
                            <tr>
                                <td><code>0xC0000081</code></td>
                                <td>IA32_STAR</td>
                                <td>SYSCALL/SYSRET segment selectors</td>
                            </tr>
                            <tr>
                                <td><code>0xC0000082</code></td>
                                <td>IA32_LSTAR</td>
                                <td>SYSCALL entry point (64-bit)</td>
                            </tr>
                            <tr>
                                <td><code>0xC0000100</code></td>
                                <td>IA32_FS_BASE</td>
                                <td>FS segment base address</td>
                            </tr>
                            <tr>
                                <td><code>0xC0000101</code></td>
                                <td>IA32_GS_BASE</td>
                                <td>GS segment base address</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="experiment-card">
                        <h4><i class="fas fa-terminal me-2"></i>User-Space: RDTSC</h4>
                        <div class="content">
                            <pre><code class="language-nasm">; RDTSC is one MSR readable from user mode (Ring 3)
; Returns 64-bit timestamp in EDX:EAX

rdtsc                ; EDX:EAX = timestamp
shl rdx, 32          ; Move EDX to upper 32 bits
or rax, rdx          ; Combine into RAX

; Or use RDTSCP (serializing version, also returns processor ID)
rdtscp               ; EDX:EAX = timestamp, ECX = processor ID</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Related Posts -->
                <div class="blog-content mt-5">
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 2: x86 CPU Architecture Overview</h5>
                            <p class="text-muted small mb-2">Understand execution modes, privilege rings, and CPU internals.</p>
                            <a href="asm-part02-cpu-architecture.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 4: Instruction Encoding & Binary Layout</h5>
                            <p class="text-muted small mb-2">Learn how assembly instructions are encoded into machine code bytes.</p>
                            <a href="asm-part04-instruction-encoding.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 5: NASM Syntax, Directives & Macros</h5>
                            <p class="text-muted small mb-2">Master NASM assembler syntax, sections, data directives, and macros.</p>
                            <a href="asm-part05-nasm.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">
                        I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest"><i class="fab fa-pinterest-p"></i></a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email"><i class="fas fa-envelope"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-secondary">
            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small"><i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a></p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">Enjoying this content? ☕ <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <button id="scrollToTop" class="scroll-to-top" title="Back to Top"><i class="fas fa-arrow-up"></i></button>
    <div id="categoryIndicator" class="category-indicator"><span id="categoryText"></span></div>
    <script src="../../../js/cookie-consent.js"></script>
    <script src="../../../js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-nasm.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
</body>
</html>
