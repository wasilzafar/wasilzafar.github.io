<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Part 8: OS Architecture & Kernel Design - Learn about monolithic vs microkernel architectures, system calls, interrupt handling, and kernel modes." />
    <meta name="keywords" content="operating system architecture, kernel design, monolithic kernel, microkernel, system calls, interrupt handling, kernel mode, user mode, OS internals" />
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Part 8: OS Architecture & Kernel Design | Computer Architecture & OS Mastery" />
    <meta property="og:description" content="Master OS kernel architectures: monolithic vs microkernel, system calls, interrupts, and privilege levels." />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://wasilzafar.com/pages/series/computer-architecture/comp-arch-os-kernel.html" />
    <meta property="article:published_time" content="2026-01-31" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />

    <title>Part 8: OS Architecture & Kernel Design | Computer Architecture & OS Mastery - Wasil Zafar</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <!-- Prism.js Syntax Highlighting - Multiple Themes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />

    <!-- Google Consent Mode v2 -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied',
            'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE']
        });
        gtag('consent', 'default', {
            'ad_storage': 'granted',
            'ad_user_data': 'granted',
            'ad_personalization': 'granted',
            'analytics_storage': 'granted'
        });
        gtag('set', 'url_passthrough', true);
    </script>

    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PBS8M2JR');
    </script>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">
                <span class="gradient-text">Wasil Zafar</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#skills">Skills</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#certifications">Certifications</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#interests">Interests</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Blog Hero Section -->
    <section class="blog-hero">
        <div class="container py-5">
            <a href="../../categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
            <h1 class="display-4 fw-bold mt-4">Part 8: OS Architecture & Kernel Design</h1>
            <div class="blog-meta">
                <span><i class="fas fa-calendar me-2"></i>January 31, 2026</span>
                <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                <span class="reading-time"><i class="fas fa-clock me-1"></i>30 min read</span>
                <button onclick="window.print()" class="print-btn" title="Print this article"><i class="fas fa-print"></i> Print</button>
            </div>
            <p class="lead mt-3">Explore operating system architectures—from monolithic kernels to microkernels—and understand system calls, interrupt handling, and privilege levels.</p>
        </div>
    </section>

    <!-- Table of Contents Toggle Button -->
    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents" aria-label="Open Table of Contents">
        <i class="fas fa-list"></i>
    </button>

    <!-- Side Navigation TOC -->
    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()" aria-label="Close Table of Contents">&times;</button>
        </div>
        <ol>
            <li>
                <a href="#introduction" onclick="closeNav()">Introduction</a>
            </li>
            <li>
                <a href="#kernel-types" onclick="closeNav()">Kernel Types</a>
                <ul>
                    <li><a href="#monolithic" onclick="closeNav()">Monolithic Kernels</a></li>
                    <li><a href="#microkernel" onclick="closeNav()">Microkernels</a></li>
                    <li><a href="#hybrid" onclick="closeNav()">Hybrid Kernels</a></li>
                </ul>
            </li>
            <li>
                <a href="#system-calls" onclick="closeNav()">System Calls</a>
                <ul>
                    <li><a href="#syscall-mechanism" onclick="closeNav()">System Call Mechanism</a></li>
                    <li><a href="#syscall-categories" onclick="closeNav()">Categories of System Calls</a></li>
                    <li><a href="#syscall-implementation" onclick="closeNav()">Implementation Details</a></li>
                </ul>
            </li>
            <li>
                <a href="#interrupts" onclick="closeNav()">Interrupt Handling</a>
                <ul>
                    <li><a href="#interrupt-types" onclick="closeNav()">Interrupt Types</a></li>
                    <li><a href="#interrupt-processing" onclick="closeNav()">Interrupt Processing</a></li>
                    <li><a href="#interrupt-controllers" onclick="closeNav()">Interrupt Controllers</a></li>
                </ul>
            </li>
            <li>
                <a href="#privilege-levels" onclick="closeNav()">Privilege Levels</a>
                <ul>
                    <li><a href="#protection-rings" onclick="closeNav()">Protection Rings</a></li>
                    <li><a href="#mode-switching" onclick="closeNav()">Mode Switching</a></li>
                </ul>
            </li>
            <li><a href="#conclusion" onclick="closeNav()">Conclusion & Next Steps</a></li>
        </ol>
    </div>

    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <!-- Main Content -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <!-- Introduction -->
                <div id="introduction" class="blog-content">
                    <h2><i class="fas fa-cogs me-2 text-teal"></i>Introduction</h2>
                    
                    <p>The operating system kernel is the core of any OS—it manages hardware resources, provides services to applications, and enforces security boundaries. Understanding kernel architecture is essential for systems programming and performance optimization.</p>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-sitemap me-2"></i>
                        <strong>Series Context:</strong> This is <strong>Part 8 of 24</strong> in the Computer Architecture & Operating Systems Mastery series. Having covered CPU execution and pipelining, we now transition to operating system fundamentals.
                    </div>

                    <div class="experiment-card" id="series-nav">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">24-Part Series</span>
                            <span class="badge bg-crimson">Computer Architecture & OS Mastery</span>
                        </div>
                        <div class="content">
                            <ol>
                                <li><a href="comp-arch-foundations.html"><strong>Part 1:</strong> Foundations of Computer Systems</a> — System overview, architectures, OS role</li>
                                <li><a href="comp-arch-digital-logic.html"><strong>Part 2:</strong> Digital Logic & CPU Building Blocks</a> — Gates, registers, datapath, microarchitecture</li>
                                <li><a href="comp-arch-isa.html"><strong>Part 3:</strong> Instruction Set Architecture (ISA)</a> — RISC vs CISC, instruction formats, addressing</li>
                                <li><a href="comp-arch-assembly.html"><strong>Part 4:</strong> Assembly Language & Machine Code</a> — Registers, stack, calling conventions</li>
                                <li><a href="comp-arch-linkers-loaders.html"><strong>Part 5:</strong> Assemblers, Linkers & Loaders</a> — Object files, ELF, dynamic linking</li>
                                <li><a href="comp-arch-compilers.html"><strong>Part 6:</strong> Compilers & Program Translation</a> — Lexing, parsing, code generation</li>
                                <li><a href="comp-arch-cpu-pipelining.html"><strong>Part 7:</strong> CPU Execution & Pipelining</a> — Fetch-decode-execute, hazards, prediction</li>
                                <li><strong>Part 8: OS Architecture & Kernel Design (This Guide)</strong> — Monolithic, microkernel, system calls</li>
                                <li><a href="comp-arch-processes.html"><strong>Part 9:</strong> Processes & Program Execution</a> — Process lifecycle, PCB, fork/exec</li>
                                <li><a href="comp-arch-threads-concurrency.html"><strong>Part 10:</strong> Threads & Concurrency</a> — Threading models, pthreads, race conditions</li>
                                <li><a href="comp-arch-cpu-scheduling.html"><strong>Part 11:</strong> CPU Scheduling Algorithms</a> — FCFS, RR, CFS, real-time scheduling</li>
                                <li><a href="comp-arch-synchronization.html"><strong>Part 12:</strong> Synchronization & Coordination</a> — Locks, semaphores, classic problems</li>
                                <li><a href="comp-arch-deadlocks.html"><strong>Part 13:</strong> Deadlocks & Prevention</a> — Coffman conditions, Banker's algorithm</li>
                                <li><a href="comp-arch-cache-memory-hierarchy.html"><strong>Part 14:</strong> Memory Hierarchy & Cache</a> — L1/L2/L3, cache coherence, NUMA</li>
                                <li><a href="comp-arch-memory-management.html"><strong>Part 15:</strong> Memory Management Fundamentals</a> — Address spaces, fragmentation, allocation</li>
                                <li><a href="comp-arch-virtual-memory.html"><strong>Part 16:</strong> Virtual Memory & Paging</a> — Page tables, TLB, demand paging</li>
                                <li><a href="comp-arch-file-systems.html"><strong>Part 17:</strong> File Systems & Storage</a> — Inodes, journaling, ext4, NTFS</li>
                                <li><a href="comp-arch-io-devices.html"><strong>Part 18:</strong> I/O Systems & Device Drivers</a> — Interrupts, DMA, disk scheduling</li>
                                <li><a href="comp-arch-multiprocessor.html"><strong>Part 19:</strong> Multiprocessor Systems</a> — SMP, NUMA, cache coherence</li>
                                <li><a href="comp-arch-security.html"><strong>Part 20:</strong> OS Security & Protection</a> — Privilege levels, ASLR, sandboxing</li>
                                <li><a href="comp-arch-virtualization.html"><strong>Part 21:</strong> Virtualization & Containers</a> — Hypervisors, namespaces, cgroups</li>
                                <li><a href="comp-arch-kernel-internals.html"><strong>Part 22:</strong> Advanced Kernel Internals</a> — Linux subsystems, kernel debugging</li>
                                <li><a href="comp-arch-case-studies.html"><strong>Part 23:</strong> Case Studies</a> — Linux vs Windows vs macOS</li>
                                <li><a href="comp-arch-capstone-projects.html"><strong>Part 24:</strong> Capstone Projects</a> — Shell, thread pool, paging simulator</li>
                            </ol>
                        </div>
                    </div>

                    <!-- CONTENT PLACEHOLDER -->
                    <h3>What is the Kernel?</h3>
                    <p>The <strong>kernel</strong> is the core component of an operating system—the software that runs at the highest privilege level and has direct access to hardware. It's the bridge between applications and hardware.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-layer-group me-2"></i>OS Layer Model</h4>
                        <div class="content">
<pre class="language-text"><code>Operating System Architecture:
══════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────┐
│                      User Applications                       │
│              (Browser, Editor, Games, etc.)                  │
├─────────────────────────────────────────────────────────────┤
│                    System Libraries                          │
│               (libc, libm, libpthread)                       │
├─────────────────────────────────────────────────────────────┤
│                    System Call Interface                     │  ← User/Kernel boundary
╠═════════════════════════════════════════════════════════════╣
│                         KERNEL                               │
│  ┌─────────────┬─────────────┬─────────────┬──────────────┐ │
│  │  Process    │   Memory    │    File     │    Device    │ │
│  │  Management │  Management │   Systems   │   Drivers    │ │
│  └─────────────┴─────────────┴─────────────┴──────────────┘ │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │         Hardware Abstraction Layer (HAL)                │ │
│  └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│                        HARDWARE                              │
│              (CPU, Memory, Disks, Network)                   │
└─────────────────────────────────────────────────────────────┘

The kernel's responsibilities:
1. Process management: Create, schedule, terminate processes
2. Memory management: Virtual memory, allocation, protection
3. File systems: Organize data on storage devices
4. Device drivers: Communicate with hardware
5. Security: Enforce access controls and isolation</code></pre>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <i class="fas fa-key me-2"></i>
                        <strong>Kernel vs OS:</strong> The kernel is just one part of an OS. A complete OS also includes system utilities (ls, ps), libraries (libc), shells (bash), and services (systemd). Linux is technically just the kernel—GNU/Linux includes the complete OS.
                    </div>

                </div>

                <!-- Kernel Types Section -->
                <div id="kernel-types" class="blog-content mt-5">
                    <h2><i class="fas fa-layer-group me-2 text-teal"></i>Kernel Types</h2>
                    
                    <p>Operating systems use different kernel architectures, each with distinct trade-offs between performance, security, and complexity.</p>

                    <h3 id="monolithic">Monolithic Kernels</h3>
                    
                    <p>In a <strong>monolithic kernel</strong>, all OS services run in a single address space in kernel mode. The entire kernel is one large program.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-box me-2"></i>Monolithic Kernel Architecture</h4>
                        <div class="content">
<pre class="language-text"><code>Monolithic Kernel (Linux, FreeBSD, early Unix):
══════════════════════════════════════════════════════════════

User Space (Ring 3)
┌─────────────────────────────────────────────────────────────┐
│  Application A      Application B      Application C        │
└─────────────────────────────────────────────────────────────┘
                    │ System Call │
════════════════════╪═════════════╪════════════════════════════
Kernel Space (Ring 0)        ↓
┌─────────────────────────────────────────────────────────────┐
│ ┌───────────┬───────────┬───────────┬───────────┬────────┐ │
│ │ Scheduler │  Memory   │   VFS     │  Network  │  IPC   │ │
│ │           │  Manager  │           │  Stack    │        │ │
│ └───────────┴───────────┴───────────┴───────────┴────────┘ │
│ ┌───────────┬───────────┬───────────┬───────────┐          │
│ │   ext4    │   btrfs   │    NFS    │   procfs  │ File    │
│ │  driver   │  driver   │  driver   │  driver   │ Systems │
│ └───────────┴───────────┴───────────┴───────────┘          │
│ ┌───────────┬───────────┬───────────┬───────────┐          │
│ │   Disk    │  Network  │   USB     │   GPU     │ Device  │
│ │  Driver   │  Driver   │  Driver   │  Driver   │ Drivers │
│ └───────────┴───────────┴───────────┴───────────┘          │
│                    All run in Ring 0!                       │
└─────────────────────────────────────────────────────────────┘

Advantages:
✓ Fast - no context switches between kernel components
✓ Efficient - direct function calls, shared memory
✓ Proven - Linux, Unix have decades of refinement

Disadvantages:
✗ Large attack surface - bug anywhere can crash/compromise system
✗ No isolation - driver bug can corrupt entire kernel
✗ Hard to extend - changes require recompilation</code></pre>
                        </div>
                    </div>

                    <h3 id="microkernel">Microkernels</h3>
                    
                    <p>A <strong>microkernel</strong> provides only minimal services (IPC, scheduling, memory primitives). Everything else runs in user space as servers.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-microchip me-2"></i>Microkernel Architecture</h4>
                        <div class="content">
<pre class="language-text"><code>Microkernel (Minix, QNX, seL4, L4):
══════════════════════════════════════════════════════════════

User Space (Ring 3)
┌─────────────────────────────────────────────────────────────┐
│  Application A      Application B      Application C        │
│         │                 │                  │               │
│         └────────────────┼──────────────────┘               │
│                          ↓                                   │
│  ┌────────────┬────────────┬────────────┬────────────┐      │
│  │ File System│   Network  │   Device   │   Memory   │      │
│  │   Server   │   Server   │   Server   │   Server   │      │
│  │  (user)    │   (user)   │   (user)   │   (user)   │      │
│  └────────────┴────────────┴────────────┴────────────┘      │
│         │            │            │            │             │
│         └────────────┴────────────┴────────────┘             │
│                          ↓ IPC                               │
└──────────────────────────┼──────────────────────────────────┘
═══════════════════════════╪══════════════════════════════════
Kernel Space (Ring 0)      ↓
┌─────────────────────────────────────────────────────────────┐
│  ┌───────────────────────────────────────────────────────┐  │
│  │           MICROKERNEL (~10K lines of code)            │  │
│  │  • Basic scheduling    • IPC (message passing)       │  │
│  │  • Address space mgmt  • Basic memory primitives     │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

Advantages:
✓ Small trusted computing base - fewer bugs in Ring 0
✓ Isolation - driver crash doesn't crash kernel
✓ Security - minimal attack surface
✓ Flexibility - easy to swap/upgrade servers

Disadvantages:
✗ IPC overhead - user↔kernel↔user for every service
✗ Performance - historically 2-10x slower than monolithic
✗ Complexity - distributed system debugging is hard</code></pre>
                        </div>
                    </div>

                    <h3 id="hybrid">Hybrid Kernels</h3>
                    
                    <p><strong>Hybrid kernels</strong> combine aspects of both: a monolithic core with some services in user space. This is a practical compromise.</p>

<pre class="language-text"><code>Hybrid Kernel (Windows NT, macOS XNU):
══════════════════════════════════════════════════════════════
Windows NT Architecture:

User Mode
┌─────────────────────────────────────────────────────────────┐
│  Win32 Apps      .NET Apps      Windows Subsystem for Linux │
│         │            │                     │                 │
│         ↓            ↓                     ↓                 │
│  ┌───────────┬───────────┬───────────────────────┐          │
│  │  Win32    │   .NET    │    LXSS (Pico        │ Subsystem │
│  │ Subsystem │  Runtime  │    Provider)         │ Processes │
│  └───────────┴───────────┴───────────────────────┘          │
└─────────────────────────────────────────────────────────────┘
═══════════════════════════════════════════════════════════════
Kernel Mode
┌─────────────────────────────────────────────────────────────┐
│  Executive Layer (Object Manager, Security, I/O Manager)    │
│  ┌───────────┬───────────┬───────────┬───────────────────┐  │
│  │ Process   │  Memory   │   Cache   │   Plug & Play     │  │
│  │ Manager   │  Manager  │  Manager  │    Manager        │  │
│  └───────────┴───────────┴───────────┴───────────────────┘  │
│  ┌───────────────────────────────────────────────────────┐  │
│  │            Microkernel (scheduling, sync, IPC)        │  │
│  └───────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────┐  │
│  │        Hardware Abstraction Layer (HAL)               │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

Hybrid = Microkernel ideas with monolithic performance</code></pre>

                    <div class="experiment-card">
                        <h4><i class="fas fa-balance-scale me-2"></i>Kernel Architecture Comparison</h4>
                        <div class="content">
                            <table class="table table-striped">
                                <thead>
                                    <tr><th>Aspect</th><th>Monolithic</th><th>Microkernel</th><th>Hybrid</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Performance</strong></td>
                                        <td>✅ Excellent</td>
                                        <td>⚠️ IPC overhead</td>
                                        <td>✅ Good</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Security</strong></td>
                                        <td>⚠️ Large TCB</td>
                                        <td>✅ Small TCB</td>
                                        <td>✅ Moderate</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Reliability</strong></td>
                                        <td>⚠️ One bug = crash</td>
                                        <td>✅ Isolated failures</td>
                                        <td>✅ Moderate</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Code Size</strong></td>
                                        <td>Large (~25M LOC)</td>
                                        <td>Tiny (~10K LOC)</td>
                                        <td>Medium</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Examples</strong></td>
                                        <td>Linux, FreeBSD</td>
                                        <td>QNX, seL4, MINIX</td>
                                        <td>Windows, macOS</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>

                <!-- System Calls Section -->
                <div id="system-calls" class="blog-content mt-5">
                    <h2><i class="fas fa-terminal me-2 text-teal"></i>System Calls</h2>
                    
                    <p>Applications can't directly access hardware—they must request services from the kernel through <strong>system calls</strong> (syscalls). This is the controlled gateway between user space and kernel space.</p>

                    <h3 id="syscall-mechanism">System Call Mechanism</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-exchange-alt me-2"></i>System Call Flow</h4>
                        <div class="content">
<pre class="language-text"><code>System Call Execution (x86-64 Linux):
══════════════════════════════════════════════════════════════

Application calls write():
┌─────────────────────────────────────────────────────────────┐
│  User Space                                                  │
│                                                              │
│  printf("Hello")                                             │
│       │                                                      │
│       ↓                                                      │
│  libc: write(1, "Hello", 5)    ← Library wrapper            │
│       │                                                      │
│       ↓ Prepare syscall                                      │
│  mov rax, 1        # syscall number (1 = write)             │
│  mov rdi, 1        # fd = stdout                            │
│  mov rsi, buf      # buffer address                         │
│  mov rdx, 5        # count                                  │
│  syscall           # Trap to kernel!                        │
│       │                                                      │
└───────┼──────────────────────────────────────────────────────┘
        │ Hardware trap (interrupt)
        │ • Save user registers to kernel stack
        │ • Switch to kernel stack
        │ • Change privilege level (Ring 3 → Ring 0)
        ↓
┌───────┴──────────────────────────────────────────────────────┐
│  Kernel Space                                                │
│                                                              │
│  syscall_entry:                                              │
│       │                                                      │
│       ↓                                                      │
│  syscall_table[rax]()    ← Look up handler by syscall #     │
│       │                                                      │
│       ↓                                                      │
│  sys_write(fd=1, buf="Hello", count=5)                      │
│       │                                                      │
│       ↓ Validate parameters, perform operation              │
│  • Check fd is valid file descriptor                        │
│  • Check buffer is in user's address space                  │
│  • Write data to stdout                                     │
│       │                                                      │
│       ↓                                                      │
│  Return value → rax    (bytes written, or -errno)           │
│       │                                                      │
│  sysret / iret         ← Return to user mode                │
│       │                                                      │
└───────┼──────────────────────────────────────────────────────┘
        ↓
┌───────┴──────────────────────────────────────────────────────┐
│  User Space                                                  │
│  • Restore user registers                                   │
│  • Resume at instruction after syscall                      │
│  • Check return value (rax)                                 │
└─────────────────────────────────────────────────────────────┘</code></pre>
                        </div>
                    </div>

                    <h3 id="syscall-categories">Categories of System Calls</h3>
                    
<pre class="language-text"><code>System Call Categories:
══════════════════════════════════════════════════════════════

1. PROCESS CONTROL
   ├── fork()      Create new process (copy parent)
   ├── exec()      Replace process image with new program
   ├── wait()      Wait for child process to terminate
   ├── exit()      Terminate current process
   └── kill()      Send signal to process

2. FILE OPERATIONS
   ├── open()      Open file, return file descriptor
   ├── close()     Close file descriptor
   ├── read()      Read bytes from file descriptor
   ├── write()     Write bytes to file descriptor
   ├── lseek()     Move read/write position
   └── stat()      Get file metadata

3. DEVICE MANAGEMENT
   ├── ioctl()     Device-specific control operations
   ├── mmap()      Map file/device to memory
   └── poll()      Wait for events on file descriptors

4. INFORMATION MAINTENANCE
   ├── getpid()    Get process ID
   ├── getuid()    Get user ID
   ├── time()      Get current time
   └── uname()     Get system information

5. COMMUNICATION
   ├── pipe()      Create pipe for IPC
   ├── socket()    Create network socket
   ├── connect()   Connect to remote socket
   └── sendmsg()   Send message on socket

6. MEMORY MANAGEMENT
   ├── brk()       Change data segment size
   ├── mmap()      Map memory (anonymous or file-backed)
   └── mprotect()  Set memory protection</code></pre>

                    <h3 id="syscall-implementation">Implementation Details</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-code me-2"></i>Tracing System Calls</h4>
                        <div class="content">
<pre class="language-bash"><code># Linux: strace shows all system calls made by a program
$ strace -c ls /tmp
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 29.41    0.000050          50         1           execve
 17.65    0.000030           3        10           mmap
 11.76    0.000020           3         7           close
 11.76    0.000020           2         8           fstat
  5.88    0.000010           2         5           openat
  5.88    0.000010           2         5           read
...
------ ----------- ----------- --------- --------- ----------------
100.00    0.000170           2        72         4 total

# Show individual syscalls with arguments
$ strace ls /tmp 2>&amp;1 | head -20
execve("/bin/ls", ["ls", "/tmp"], 0x7ffd... /* 50 vars */) = 0
brk(NULL)                               = 0x55a8c8b52000
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f8
openat(AT_FDCWD, "/tmp", O_RDONLY|O_NONBLOCK|O_DIRECTORY|O_CLOEXEC) = 3
getdents64(3, /* 15 entries */, 32768)  = 456
write(1, "file1.txt  file2.txt\n", 21) = 21
close(3)                                = 0</code></pre>
                        </div>
                    </div>

                    <div class="highlight-box highlight-navy">
                        <i class="fas fa-stopwatch me-2"></i>
                        <strong>Syscall Cost:</strong> Each system call costs ~100-1000 CPU cycles due to mode switch, cache effects, and register saving. That's why buffered I/O (fwrite vs write) is faster—it batches many small writes into fewer syscalls.
                    </div>

                </div>

                <!-- Interrupts Section -->
                <div id="interrupts" class="blog-content mt-5">
                    <h2><i class="fas fa-bolt me-2 text-teal"></i>Interrupt Handling</h2>
                    
                    <p>Interrupts are signals that demand the CPU's immediate attention. They're how hardware devices communicate with the processor and how the OS implements multitasking.</p>

                    <h3 id="interrupt-types">Interrupt Types</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-list me-2"></i>Types of Interrupts</h4>
                        <div class="content">
<pre class="language-text"><code>Interrupt Classification:
══════════════════════════════════════════════════════════════

1. HARDWARE INTERRUPTS (External, Asynchronous)
   ┌─────────────────────────────────────────────────────────┐
   │ Device signals CPU via interrupt request (IRQ) line    │
   │                                                         │
   │ Examples:                                               │
   │ • Timer (IRQ 0)  - Periodic tick for scheduling        │
   │ • Keyboard (IRQ 1) - Key press/release                 │
   │ • Disk (IRQ 14/15) - I/O operation complete            │
   │ • Network (IRQ 11) - Packet arrived                    │
   │ • USB (varies) - Device connected/data ready           │
   └─────────────────────────────────────────────────────────┘

2. SOFTWARE INTERRUPTS / TRAPS (Internal, Synchronous)
   ┌─────────────────────────────────────────────────────────┐
   │ Triggered by executing instruction (INT, SYSCALL)      │
   │                                                         │
   │ Examples:                                               │
   │ • System calls (int 0x80 or syscall instruction)       │
   │ • Breakpoints (int 3) for debuggers                    │
   │ • Software-initiated timer                             │
   └─────────────────────────────────────────────────────────┘

3. EXCEPTIONS (CPU-generated, Synchronous)
   ┌─────────────────────────────────────────────────────────┐
   │ CPU detects error condition during instruction         │
   │                                                         │
   │ Types:                                                  │
   │ • Faults (recoverable): Page fault, GPF               │
   │   → Handler fixes problem, instruction re-executed    │
   │ • Traps (intentional): Breakpoint, syscall            │
   │   → Resume at next instruction                        │
   │ • Aborts (fatal): Hardware error, double fault        │
   │   → Process/system terminated                         │
   │                                                         │
   │ Common exceptions (x86):                               │
   │ • #DE (0) - Divide by zero                            │
   │ • #PF (14) - Page fault                               │
   │ • #GP (13) - General protection fault                 │
   │ • #UD (6) - Invalid opcode                            │
   └─────────────────────────────────────────────────────────┘</code></pre>
                        </div>
                    </div>

                    <h3 id="interrupt-processing">Interrupt Processing</h3>
                    
<pre class="language-text"><code>Interrupt Handling Sequence:
══════════════════════════════════════════════════════════════

1. Device raises interrupt (IRQ line goes high)
         ↓
2. CPU finishes current instruction
         ↓
3. CPU checks if interrupts are enabled (IF flag)
         ↓
4. CPU pushes state to stack:
   • Flags register (EFLAGS/RFLAGS)
   • Code segment (CS)
   • Instruction pointer (EIP/RIP)
   • (For privilege change: SS, ESP/RSP)
         ↓
5. CPU looks up handler in Interrupt Descriptor Table (IDT)
   Handler address = IDT[interrupt_number]
         ↓
6. CPU jumps to interrupt handler (ISR)
   • Interrupts may be disabled
   • Running in kernel mode
         ↓
7. ISR executes:
   • Save additional registers (if needed)
   • Identify interrupt source
   • Handle the interrupt
   • Acknowledge interrupt controller
   • Restore registers
         ↓
8. ISR executes IRET instruction:
   • Pop RIP, CS, RFLAGS from stack
   • Resume interrupted code
         ↓
9. Original program continues (unaware of interruption)</code></pre>

                    <h3 id="interrupt-controllers">Interrupt Controllers</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-microchip me-2"></i>APIC Architecture</h4>
                        <div class="content">
<pre class="language-text"><code>Modern Interrupt Architecture (x86 APIC):
══════════════════════════════════════════════════════════════

            ┌──────────────────────────────────────────────┐
            │              Devices                          │
            │  (Keyboard, Disk, Network, USB, etc.)        │
            └──────────────┬───────────────────────────────┘
                           │ Interrupt signals
                           ▼
            ┌──────────────────────────────────────────────┐
            │            I/O APIC                          │
            │  (Routes device interrupts to CPUs)          │
            │  • Interrupt redirection table               │
            │  • Priority-based routing                    │
            │  • Multi-CPU distribution                    │
            └──────────────┬───────────────────────────────┘
                           │ Messages over system bus
            ┌──────────────┴───────────────┬───────────────┐
            ▼                              ▼               ▼
    ┌──────────────┐              ┌──────────────┐  ┌──────────────┐
    │  Local APIC  │              │  Local APIC  │  │  Local APIC  │
    │   (CPU 0)    │              │   (CPU 1)    │  │   (CPU N)    │
    │              │              │              │  │              │
    │ • Timer      │              │ • Timer      │  │ • Timer      │
    │ • IPI        │              │ • IPI        │  │ • IPI        │
    │ • Priority   │              │ • Priority   │  │ • Priority   │
    └──────────────┘              └──────────────┘  └──────────────┘

Each CPU has a Local APIC for:
• Local timer interrupts (scheduling tick)
• Inter-Processor Interrupts (IPI) for CPU-to-CPU signaling
• Interrupt prioritization</code></pre>
                        </div>
                    </div>

                </div>

                <!-- Privilege Levels Section -->
                <div id="privilege-levels" class="blog-content mt-5">
                    <h2><i class="fas fa-shield-alt me-2 text-teal"></i>Privilege Levels</h2>
                    
                    <p>CPUs implement <strong>hardware-enforced privilege levels</strong> to isolate the kernel from user programs. This is fundamental to OS security.</p>

                    <h3 id="protection-rings">Protection Rings</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-circle-notch me-2"></i>x86 Protection Rings</h4>
                        <div class="content">
<pre class="language-text"><code>x86 Protection Rings:
══════════════════════════════════════════════════════════════

     ┌──────────────────────────────────────────────────────┐
     │                    Ring 3                            │
     │              User Applications                       │
     │      (Least privileged, restricted access)           │
     │   ┌──────────────────────────────────────────────┐   │
     │   │              Ring 2                          │   │
     │   │         Device Drivers (rarely used)        │   │
     │   │   ┌──────────────────────────────────────┐   │   │
     │   │   │           Ring 1                     │   │   │
     │   │   │    Device Drivers (rarely used)     │   │   │
     │   │   │   ┌──────────────────────────────┐   │   │   │
     │   │   │   │        Ring 0                │   │   │   │
     │   │   │   │   Operating System Kernel    │   │   │   │
     │   │   │   │  (Most privileged, full      │   │   │   │
     │   │   │   │   hardware access)           │   │   │   │
     │   │   │   └──────────────────────────────┘   │   │   │
     │   │   └──────────────────────────────────────┘   │   │
     │   └──────────────────────────────────────────────┘   │
     └──────────────────────────────────────────────────────┘

In practice, most OSes use only Ring 0 and Ring 3:
• Ring 0: Kernel (full access to CPU, memory, I/O)
• Ring 3: User applications (restricted)

Ring 0 can:                      Ring 3 cannot:
✓ Execute privileged instr       ✗ CLI/STI (interrupt control)
✓ Access I/O ports              ✗ IN/OUT (direct I/O)
✓ Access all memory             ✗ Access kernel memory
✓ Modify page tables            ✗ MOV to CR3 (page table base)
✓ Change privilege level        ✗ Direct hardware access</code></pre>
                        </div>
                    </div>

                    <h3 id="mode-switching">Mode Switching</h3>
                    
<pre class="language-text"><code>Mode Switching (Ring 3 ↔ Ring 0):
══════════════════════════════════════════════════════════════

User Mode (Ring 3)               Kernel Mode (Ring 0)
┌───────────────────┐            ┌───────────────────┐
│ Application       │            │ Kernel            │
│                   │   syscall  │                   │
│ printf("Hi")  ────┼───────────→│ sys_write()       │
│                   │            │                   │
│                   │   sysret   │                   │
│ (continues)   ←───┼────────────│ return            │
│                   │            │                   │
└───────────────────┘            └───────────────────┘

Transitions User → Kernel:
1. System call (syscall/int 0x80) - Intentional request
2. Exception (page fault, div-by-0) - Error condition
3. Hardware interrupt (timer, I/O) - External event

Transitions Kernel → User:
1. Return from syscall (sysret/iret)
2. Return from exception handler
3. Return from interrupt handler
4. Starting new user process

Mode Switch Overhead:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Operation                          Cycles (approximate)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Save/restore registers             ~20-50 cycles
Change privilege level             ~50-100 cycles  
TLB flush (if needed)              ~100-1000 cycles
Cache effects                      Variable
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Total syscall cost                 ~200-1000 cycles</code></pre>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-shield-alt me-2"></i>
                        <strong>Security Foundation:</strong> Privilege separation is the foundation of OS security. Without it, any program could read your passwords, install rootkits, or crash the system. Hardware enforcement means even a buggy/malicious program can't bypass these restrictions.
                    </div>

                </div>

                <!-- Conclusion -->
                <div id="conclusion" class="blog-content mt-5">
                    <h2><i class="fas fa-flag-checkered me-2 text-teal"></i>Conclusion & Next Steps</h2>
                    
                    <p>We've explored the fundamental architecture of operating system kernels—the software that bridges applications and hardware. Key takeaways:</p>

                    <ul>
                        <li><strong>Kernel Types:</strong> Monolithic (Linux) for performance, microkernels (seL4) for security, hybrids (Windows) for balance</li>
                        <li><strong>System Calls:</strong> The controlled gateway between user space and kernel space (~200-1000 cycles each)</li>
                        <li><strong>Interrupts:</strong> Hardware signals, software traps, and exceptions that demand CPU attention</li>
                        <li><strong>Privilege Levels:</strong> Hardware-enforced isolation (Ring 0/Ring 3) that protects the system</li>
                    </ul>

                    <div class="highlight-box">
                        <i class="fas fa-key me-2"></i>
                        <strong>Key Insight:</strong> The kernel is trusted code that runs with full hardware access. This design (user/kernel separation) is why you can run untrusted programs without them crashing your system or stealing your data.
                    </div>

                    <div class="series-next">
                        <h4><i class="fas fa-arrow-right me-2"></i>Next in the Series</h4>
                        <p>In <a href="comp-arch-processes.html"><strong>Part 9: Processes & Program Execution</strong></a>, we'll explore how the kernel creates and manages processes—the running instances of programs—including process states, context switching, and the fork/exec model.</p>
                    </div>
                </div>

                <!-- Related Posts -->
                <div class="related-posts">
                    <h3><i class="fas fa-book me-2"></i>Continue the Computer Architecture & OS Series</h3>
                    <div class="related-post-item">
                        <h5>Part 7: CPU Execution & Pipelining</h5>
                        <p>Fetch-decode-execute cycle, pipeline hazards, and branch prediction.</p>
                        <a href="comp-arch-cpu-pipelining.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                    </div>
                    <div class="related-post-item">
                        <h5>Part 9: Processes & Program Execution</h5>
                        <p>Process lifecycle, PCB, fork/exec, and process states.</p>
                        <a href="comp-arch-processes.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                    </div>
                    <div class="related-post-item">
                        <h5>Part 22: Advanced Kernel Internals</h5>
                        <p>Linux subsystems, kernel debugging, and kernel modules.</p>
                        <a href="comp-arch-kernel-internals.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.</p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email"><i class="fas fa-envelope"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-secondary">
            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small"><i class="fas fa-icons me-2"></i>Icons from <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a></p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">Enjoying this content? <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll-to-Top Button -->
    <button id="scrollToTop" class="scroll-to-top" title="Back to Top"><i class="fas fa-arrow-up"></i></button>

    <!-- Category Indicator -->
    <div id="categoryIndicator" class="category-indicator"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="../../../js/main.js"></script>
    <script src="../../../js/cookie-consent.js"></script>
    
    <!-- Prism.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

    <!-- Prism Theme Switcher -->
    <script>
        const themes = {
            'prism-theme': 'Tomorrow Night',
            'prism-default': 'Default',
            'prism-dark': 'Dark',
            'prism-twilight': 'Twilight',
            'prism-okaidia': 'Okaidia',
            'prism-solarizedlight': 'Solarized Light'
        };
        const savedTheme = localStorage.getItem('prism-theme') || 'prism-theme';
        function switchTheme(themeId) {
            Object.keys(themes).forEach(id => {
                const link = document.getElementById(id);
                if (link) link.disabled = true;
            });
            const selectedLink = document.getElementById(themeId);
            if (selectedLink) {
                selectedLink.disabled = false;
                localStorage.setItem('prism-theme', themeId);
            }
            document.querySelectorAll('div.code-toolbar select').forEach(dropdown => {
                dropdown.value = themeId;
            });
            setTimeout(() => Prism.highlightAll(), 10);
        }
        document.addEventListener('DOMContentLoaded', function() { switchTheme(savedTheme); });
        Prism.plugins.toolbar.registerButton('theme-switcher', function(env) {
            const select = document.createElement('select');
            select.setAttribute('aria-label', 'Select code theme');
            Object.keys(themes).forEach(themeId => {
                const option = document.createElement('option');
                option.value = themeId;
                option.textContent = themes[themeId];
                if (themeId === savedTheme) option.selected = true;
                select.appendChild(option);
            });
            select.addEventListener('change', function(e) { switchTheme(e.target.value); });
            return select;
        });
    </script>
</body>
</html>
