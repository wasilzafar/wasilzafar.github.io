<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Part 10: Threads & Concurrency - Learn about threading models, pthreads, race conditions, and concurrent programming fundamentals." />
    <meta name="keywords" content="threads, concurrency, threading models, pthreads, race conditions, thread safety, multithreading, parallel programming, user threads, kernel threads" />
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Part 10: Threads & Concurrency | Computer Architecture & OS Mastery" />
    <meta property="og:description" content="Master threading fundamentals: threading models, pthreads API, race conditions, and thread safety." />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://wasilzafar.com/pages/series/computer-architecture/comp-arch-threads-concurrency.html" />
    <meta property="article:published_time" content="2026-01-31" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />

    <title>Part 10: Threads & Concurrency | Computer Architecture & OS Mastery - Wasil Zafar</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <!-- Prism.js Syntax Highlighting - Multiple Themes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />

    <!-- Google Consent Mode v2 -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied',
            'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE']
        });
        gtag('consent', 'default', {
            'ad_storage': 'granted',
            'ad_user_data': 'granted',
            'ad_personalization': 'granted',
            'analytics_storage': 'granted'
        });
        gtag('set', 'url_passthrough', true);
    </script>

    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PBS8M2JR');
    </script>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">
                <span class="gradient-text">Wasil Zafar</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#skills">Skills</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#certifications">Certifications</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#interests">Interests</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Blog Hero Section -->
    <section class="blog-hero">
        <div class="container py-5">
            <a href="../../categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
            <h1 class="display-4 fw-bold mt-4">Part 10: Threads & Concurrency</h1>
            <div class="blog-meta">
                <span><i class="fas fa-calendar me-2"></i>January 31, 2026</span>
                <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                <span class="reading-time"><i class="fas fa-clock me-1"></i>32 min read</span>
                <button onclick="window.print()" class="print-btn" title="Print this article"><i class="fas fa-print"></i> Print</button>
            </div>
            <p class="lead mt-3">Master concurrent programming—from threading models and pthreads to race conditions and thread safety patterns.</p>
        </div>
    </section>

    <!-- Table of Contents Toggle Button -->
    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents" aria-label="Open Table of Contents">
        <i class="fas fa-list"></i>
    </button>

    <!-- Side Navigation TOC -->
    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()" aria-label="Close Table of Contents">&times;</button>
        </div>
        <ol>
            <li>
                <a href="#introduction" onclick="closeNav()">Introduction</a>
            </li>
            <li>
                <a href="#thread-basics" onclick="closeNav()">Thread Basics</a>
                <ul>
                    <li><a href="#threads-vs-processes" onclick="closeNav()">Threads vs Processes</a></li>
                    <li><a href="#thread-benefits" onclick="closeNav()">Benefits of Threads</a></li>
                    <li><a href="#thread-challenges" onclick="closeNav()">Challenges</a></li>
                </ul>
            </li>
            <li>
                <a href="#threading-models" onclick="closeNav()">Threading Models</a>
                <ul>
                    <li><a href="#user-threads" onclick="closeNav()">User-Level Threads</a></li>
                    <li><a href="#kernel-threads" onclick="closeNav()">Kernel-Level Threads</a></li>
                    <li><a href="#hybrid-models" onclick="closeNav()">Hybrid Models</a></li>
                </ul>
            </li>
            <li>
                <a href="#pthreads" onclick="closeNav()">POSIX Threads (pthreads)</a>
                <ul>
                    <li><a href="#thread-creation" onclick="closeNav()">Thread Creation</a></li>
                    <li><a href="#thread-joining" onclick="closeNav()">Joining & Detaching</a></li>
                    <li><a href="#thread-attributes" onclick="closeNav()">Thread Attributes</a></li>
                </ul>
            </li>
            <li>
                <a href="#race-conditions" onclick="closeNav()">Race Conditions</a>
                <ul>
                    <li><a href="#critical-sections" onclick="closeNav()">Critical Sections</a></li>
                    <li><a href="#data-races" onclick="closeNav()">Data Races</a></li>
                    <li><a href="#atomicity" onclick="closeNav()">Atomicity</a></li>
                </ul>
            </li>
            <li>
                <a href="#thread-safety" onclick="closeNav()">Thread Safety Patterns</a>
            </li>
            <li><a href="#conclusion" onclick="closeNav()">Conclusion & Next Steps</a></li>
        </ol>
    </div>

    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <!-- Main Content -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <!-- Introduction -->
                <div id="introduction" class="blog-content">
                    <h2><i class="fas fa-code-branch me-2 text-teal"></i>Introduction</h2>
                    
                    <p>Threads are lightweight units of execution within a process. They enable concurrent programming, allowing applications to perform multiple tasks simultaneously and take full advantage of multi-core processors.</p>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-sitemap me-2"></i>
                        <strong>Series Context:</strong> This is <strong>Part 10 of 24</strong> in the Computer Architecture & Operating Systems Mastery series. Building on process fundamentals, we now explore how multiple threads of execution share process resources.
                    </div>

                    <div class="experiment-card" id="series-nav">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">24-Part Series</span>
                            <span class="badge bg-crimson">Computer Architecture & OS Mastery</span>
                        </div>
                        <div class="content">
                            <ol>
                                <li><a href="comp-arch-foundations.html"><strong>Part 1:</strong> Foundations of Computer Systems</a> — System overview, architectures, OS role</li>
                                <li><a href="comp-arch-digital-logic.html"><strong>Part 2:</strong> Digital Logic & CPU Building Blocks</a> — Gates, registers, datapath, microarchitecture</li>
                                <li><a href="comp-arch-isa.html"><strong>Part 3:</strong> Instruction Set Architecture (ISA)</a> — RISC vs CISC, instruction formats, addressing</li>
                                <li><a href="comp-arch-assembly.html"><strong>Part 4:</strong> Assembly Language & Machine Code</a> — Registers, stack, calling conventions</li>
                                <li><a href="comp-arch-linkers-loaders.html"><strong>Part 5:</strong> Assemblers, Linkers & Loaders</a> — Object files, ELF, dynamic linking</li>
                                <li><a href="comp-arch-compilers.html"><strong>Part 6:</strong> Compilers & Program Translation</a> — Lexing, parsing, code generation</li>
                                <li><a href="comp-arch-cpu-pipelining.html"><strong>Part 7:</strong> CPU Execution & Pipelining</a> — Fetch-decode-execute, hazards, prediction</li>
                                <li><a href="comp-arch-os-kernel.html"><strong>Part 8:</strong> OS Architecture & Kernel Design</a> — Monolithic, microkernel, system calls</li>
                                <li><a href="comp-arch-processes.html"><strong>Part 9:</strong> Processes & Program Execution</a> — Process lifecycle, PCB, fork/exec</li>
                                <li><strong>Part 10: Threads & Concurrency (This Guide)</strong> — Threading models, pthreads, race conditions</li>
                                <li><a href="comp-arch-cpu-scheduling.html"><strong>Part 11:</strong> CPU Scheduling Algorithms</a> — FCFS, RR, CFS, real-time scheduling</li>
                                <li><a href="comp-arch-synchronization.html"><strong>Part 12:</strong> Synchronization & Coordination</a> — Locks, semaphores, classic problems</li>
                                <li><a href="comp-arch-deadlocks.html"><strong>Part 13:</strong> Deadlocks & Prevention</a> — Coffman conditions, Banker's algorithm</li>
                                <li><a href="comp-arch-cache-memory-hierarchy.html"><strong>Part 14:</strong> Memory Hierarchy & Cache</a> — L1/L2/L3, cache coherence, NUMA</li>
                                <li><a href="comp-arch-memory-management.html"><strong>Part 15:</strong> Memory Management Fundamentals</a> — Address spaces, fragmentation, allocation</li>
                                <li><a href="comp-arch-virtual-memory.html"><strong>Part 16:</strong> Virtual Memory & Paging</a> — Page tables, TLB, demand paging</li>
                                <li><a href="comp-arch-file-systems.html"><strong>Part 17:</strong> File Systems & Storage</a> — Inodes, journaling, ext4, NTFS</li>
                                <li><a href="comp-arch-io-devices.html"><strong>Part 18:</strong> I/O Systems & Device Drivers</a> — Interrupts, DMA, disk scheduling</li>
                                <li><a href="comp-arch-multiprocessor.html"><strong>Part 19:</strong> Multiprocessor Systems</a> — SMP, NUMA, cache coherence</li>
                                <li><a href="comp-arch-security.html"><strong>Part 20:</strong> OS Security & Protection</a> — Privilege levels, ASLR, sandboxing</li>
                                <li><a href="comp-arch-virtualization.html"><strong>Part 21:</strong> Virtualization & Containers</a> — Hypervisors, namespaces, cgroups</li>
                                <li><a href="comp-arch-kernel-internals.html"><strong>Part 22:</strong> Advanced Kernel Internals</a> — Linux subsystems, kernel debugging</li>
                                <li><a href="comp-arch-case-studies.html"><strong>Part 23:</strong> Case Studies</a> — Linux vs Windows vs macOS</li>
                                <li><a href="comp-arch-capstone-projects.html"><strong>Part 24:</strong> Capstone Projects</a> — Shell, thread pool, paging simulator</li>
                            </ol>
                        </div>
                    </div>

                    <!-- CONTENT PLACEHOLDER -->
                    <h3>Why Threads?</h3>
                    <p>While processes provide isolation, they're heavyweight—creating a process and switching between them is expensive. <strong>Threads</strong> are lightweight execution units that share the same address space, enabling efficient parallelism within a single program.</p>

                    <div class="highlight-box">
                        <i class="fas fa-bolt me-2"></i>
                        <strong>Analogy:</strong> If a process is like a house (with its own address, utilities, walls), threads are like roommates sharing that house. They can move around independently but share the same kitchen, bathroom, and living room—efficient but requiring coordination!
                    </div>

                </div>

                <!-- Thread Basics Section -->
                <div id="thread-basics" class="blog-content mt-5">
                    <h2><i class="fas fa-stream me-2 text-teal"></i>Thread Basics</h2>
                    
                    <h3 id="threads-vs-processes">Threads vs Processes</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-balance-scale me-2"></i>Process vs Thread Comparison</h4>
                        <div class="content">
<pre class="language-text"><code>Process vs Thread:
══════════════════════════════════════════════════════════════

PROCESS                              THREAD
────────────────────────────────     ────────────────────────────────
Own address space                    Shared address space
Own file descriptors                 Shared file descriptors
Own signal handlers                  Shared signal handlers
Own heap                             Shared heap
                                     
Own stack                            Own stack (each thread)
Own registers/PC                     Own registers/PC (each thread)
Own thread ID (TID)                  Own thread ID (TID)

Memory Layout Comparison:
══════════════════════════════════════════════════════════════

SEPARATE PROCESSES:                  SINGLE PROCESS, MULTIPLE THREADS:

Process A        Process B           Shared Process Space
┌─────────┐     ┌─────────┐         ┌─────────────────────────┐
│ Stack A │     │ Stack B │         │ Stack (Thread 1)        │
├─────────┤     ├─────────┤         ├─────────────────────────┤
│ Heap A  │     │ Heap B  │         │ Stack (Thread 2)        │
├─────────┤     ├─────────┤         ├─────────────────────────┤
│ Data A  │     │ Data B  │         │ Stack (Thread 3)        │
├─────────┤     ├─────────┤         ├═════════════════════════┤
│ Code A  │     │ Code B  │         │ Heap (SHARED)           │
└─────────┘     └─────────┘         ├─────────────────────────┤
                                    │ Data (SHARED)           │
Isolated!                           ├─────────────────────────┤
                                    │ Code (SHARED)           │
                                    └─────────────────────────┘</code></pre>
                        </div>
                    </div>

                    <h3 id="thread-benefits">Benefits of Threads</h3>
                    
<pre class="language-text"><code>Benefits of Multithreading:
══════════════════════════════════════════════════════════════

1. RESPONSIVENESS
   Main thread handles UI, worker threads do computation
   → UI stays responsive during heavy processing
   
   Example: Browser
   • Main thread: Render page, handle clicks
   • Network thread: Fetch resources
   • JavaScript thread: Run scripts

2. RESOURCE SHARING
   Threads share memory → Easy communication
   • No need for pipes, sockets, or shared memory setup
   • Just read/write shared variables (with synchronization!)
   
3. ECONOMY
   ┌─────────────────────────────────────────────────────────┐
   │ Operation              Process      Thread              │
   │ ─────────────────────────────────────────────────────── │
   │ Creation time          ~10ms        ~100μs (100× faster)│
   │ Context switch         ~5-10μs      ~1-2μs (5× faster) │
   │ Memory overhead        MBs          KBs (stack only)   │
   └─────────────────────────────────────────────────────────┘

4. SCALABILITY
   Threads can run on multiple CPU cores simultaneously
   → True parallelism on multicore systems
   
   4-core CPU, 4 threads → 4× speedup (ideal case)</code></pre>

                    <h3 id="thread-challenges">Challenges</h3>
                    
                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Threading is Hard!</strong> Shared memory is a double-edged sword:
                        <ul class="mb-0 mt-2">
                            <li><strong>Race conditions:</strong> Results depend on timing</li>
                            <li><strong>Deadlocks:</strong> Threads wait for each other forever</li>
                            <li><strong>Non-determinism:</strong> Bugs may not reproduce</li>
                            <li><strong>Debugging:</strong> Hard to track interleaved execution</li>
                        </ul>
                    </div>

                </div>

                <!-- Threading Models Section -->
                <div id="threading-models" class="blog-content mt-5">
                    <h2><i class="fas fa-layer-group me-2 text-teal"></i>Threading Models</h2>
                    
                    <p>There are different ways to implement threads, differing in where thread management happens.</p>

                    <h3 id="user-threads">User-Level Threads</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-user me-2"></i>User-Level Threading</h4>
                        <div class="content">
<pre class="language-text"><code>User-Level Threads (N:1 Model):
══════════════════════════════════════════════════════════════

User Space
┌─────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Thread Library (e.g., Green Threads)    │   │
│  │  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐               │   │
│  │  │ T1  │  │ T2  │  │ T3  │  │ T4  │  User threads │   │
│  │  └──┬──┘  └──┬──┘  └──┬──┘  └──┬──┘               │   │
│  │     └────────┴────────┴────────┘                    │   │
│  │                    │                                │   │
│  │              Thread Scheduler                       │   │
│  │              (in user space)                        │   │
│  └──────────────────────┬──────────────────────────────┘   │
└─────────────────────────┼───────────────────────────────────┘
══════════════════════════╪═══════════════════════════════════
Kernel Space              ▼
┌─────────────────────────────────────────────────────────────┐
│                Single Kernel Thread                         │
│                (OS sees one "process")                      │
└─────────────────────────────────────────────────────────────┘

Advantages:
✓ Fast context switch (no kernel involvement)
✓ Can implement custom scheduling
✓ Works on any OS (no kernel support needed)

Disadvantages:
✗ One thread blocks → entire process blocks
✗ Can't use multiple CPUs (all run on one kernel thread)
✗ Page fault in one thread blocks all

Examples: Go goroutines (initially), Java green threads (historical)</code></pre>
                        </div>
                    </div>

                    <h3 id="kernel-threads">Kernel-Level Threads</h3>
                    
<pre class="language-text"><code>Kernel-Level Threads (1:1 Model):
══════════════════════════════════════════════════════════════

User Space
┌─────────────────────────────────────────────────────────────┐
│  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐                        │
│  │ T1  │  │ T2  │  │ T3  │  │ T4  │  User threads          │
│  └──┬──┘  └──┬──┘  └──┬──┘  └──┬──┘                        │
└─────┼───────┼───────┼───────┼──────────────────────────────┘
══════╪═══════╪═══════╪═══════╪══════════════════════════════
Kernel│Space  │       │       │
┌─────┼───────┼───────┼───────┼──────────────────────────────┐
│  ┌──▼──┐ ┌──▼──┐ ┌──▼──┐ ┌──▼──┐                          │
│  │ KT1 │ │ KT2 │ │ KT3 │ │ KT4 │  Kernel threads          │
│  └─────┘ └─────┘ └─────┘ └─────┘  (1:1 mapping)           │
│                                                             │
│         Kernel Thread Scheduler                            │
└─────────────────────────────────────────────────────────────┘

Advantages:
✓ True parallelism on multicore
✓ One thread blocking doesn't block others
✓ Kernel can schedule on multiple CPUs

Disadvantages:
✗ Context switch requires kernel involvement (~1-2μs)
✗ Each thread uses kernel resources
✗ Thread creation slower

Examples: Linux pthreads, Windows threads, macOS threads</code></pre>

                    <h3 id="hybrid-models">Hybrid Models</h3>
                    
<pre class="language-text"><code>Hybrid M:N Model:
══════════════════════════════════════════════════════════════
M user threads mapped to N kernel threads (M &gt; N)

User Space
┌─────────────────────────────────────────────────────────────┐
│  ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐  (M user threads)    │
│  │UT1│ │UT2│ │UT3│ │UT4│ │UT5│ │UT6│                      │
│  └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘                      │
│    └─────┴──┬──┴─────┴──┬──┴─────┘                         │
│             │           │                                   │
│      User-Level Scheduler                                   │
└─────────────┼───────────┼───────────────────────────────────┘
══════════════╪═══════════╪═══════════════════════════════════
Kernel Space  ▼           ▼
┌─────────────────────────────────────────────────────────────┐
│         ┌─────┐     ┌─────┐                                 │
│         │ KT1 │     │ KT2 │    (N kernel threads)          │
│         └─────┘     └─────┘                                 │
│                                                             │
│         Kernel Scheduler                                    │
└─────────────────────────────────────────────────────────────┘

Examples: Go runtime (goroutines → OS threads), Solaris LWPs

Best of both worlds:
✓ Many lightweight user threads
✓ Multiple kernel threads for parallelism
✓ User-level scheduling is fast</code></pre>

                </div>

                <!-- pthreads Section -->
                <div id="pthreads" class="blog-content mt-5">
                    <h2><i class="fas fa-terminal me-2 text-teal"></i>POSIX Threads (pthreads)</h2>
                    
                    <p><strong>pthreads</strong> is the standard threading API for Unix-like systems (Linux, macOS, BSD). It provides 1:1 kernel-level threads.</p>

                    <h3 id="thread-creation">Thread Creation</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-code me-2"></i>Creating Threads with pthreads</h4>
                        <div class="content">
<pre class="language-c"><code>// Basic pthread example
#include &lt;stdio.h&gt;
#include &lt;pthread.h&gt;
#include &lt;unistd.h&gt;

// Thread function - runs in new thread
void *thread_function(void *arg) {
    int thread_num = *(int *)arg;
    printf("Thread %d: Starting\n", thread_num);
    sleep(1);  // Simulate work
    printf("Thread %d: Finishing\n", thread_num);
    return NULL;
}

int main() {
    pthread_t threads[3];
    int thread_args[3] = {1, 2, 3};
    
    // Create 3 threads
    for (int i = 0; i &lt; 3; i++) {
        int ret = pthread_create(
            &amp;threads[i],      // Thread ID (output)
            NULL,             // Attributes (NULL = default)
            thread_function,  // Function to run
            &amp;thread_args[i]   // Argument to function
        );
        if (ret != 0) {
            perror("pthread_create failed");
            return 1;
        }
    }
    
    printf("Main: All threads created\n");
    
    // Wait for all threads to complete
    for (int i = 0; i &lt; 3; i++) {
        pthread_join(threads[i], NULL);
    }
    
    printf("Main: All threads finished\n");
    return 0;
}

// Compile: gcc -pthread program.c -o program</code></pre>
<pre class="language-text"><code>Output (order may vary!):
Main: All threads created
Thread 1: Starting
Thread 3: Starting
Thread 2: Starting
Thread 2: Finishing
Thread 1: Finishing
Thread 3: Finishing
Main: All threads finished</code></pre>
                        </div>
                    </div>

                    <h3 id="thread-joining">Joining & Detaching</h3>
                    
<pre class="language-c"><code>// Thread joining - wait for completion and get return value
void *compute_sum(void *arg) {
    int *result = malloc(sizeof(int));
    *result = 42;  // Computed result
    return result;  // Return pointer (lives on heap!)
}

int main() {
    pthread_t thread;
    void *retval;
    
    pthread_create(&amp;thread, NULL, compute_sum, NULL);
    
    // Join: block until thread finishes, get return value
    pthread_join(thread, &amp;retval);
    
    int *result = (int *)retval;
    printf("Thread returned: %d\n", *result);  // 42
    free(result);
    
    return 0;
}

// Detached threads - run independently, can't be joined
void start_background_task() {
    pthread_t thread;
    pthread_create(&amp;thread, NULL, background_work, NULL);
    
    // Detach: thread resources freed automatically on exit
    pthread_detach(thread);
    // Can't join a detached thread!
}

// Or set detached at creation:
pthread_attr_t attr;
pthread_attr_init(&amp;attr);
pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_DETACHED);
pthread_create(&amp;thread, &amp;attr, func, NULL);</code></pre>

                    <h3 id="thread-attributes">Thread Attributes</h3>
                    
                    <div class="highlight-box highlight-navy">
                        <i class="fas fa-cog me-2"></i>
                        <strong>Common Thread Attributes:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>Stack size:</strong> Default ~8MB, can be reduced for many threads</li>
                            <li><strong>Detach state:</strong> Joinable (default) or detached</li>
                            <li><strong>Scheduling policy:</strong> SCHED_FIFO, SCHED_RR, SCHED_OTHER</li>
                            <li><strong>Priority:</strong> Scheduling priority within policy</li>
                        </ul>
                    </div>

                </div>

                <!-- Race Conditions Section -->
                <div id="race-conditions" class="blog-content mt-5">
                    <h2><i class="fas fa-exclamation-triangle me-2 text-teal"></i>Race Conditions</h2>
                    
                    <p>A <strong>race condition</strong> occurs when the behavior of a program depends on the relative timing of events (like thread scheduling). The result is non-deterministic and often buggy.</p>

                    <h3 id="critical-sections">Critical Sections</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-bug me-2"></i>Race Condition Example</h4>
                        <div class="content">
<pre class="language-c"><code>// BUGGY CODE - Race condition!
int counter = 0;  // Shared variable

void *increment(void *arg) {
    for (int i = 0; i &lt; 1000000; i++) {
        counter++;  // NOT atomic!
    }
    return NULL;
}

int main() {
    pthread_t t1, t2;
    pthread_create(&amp;t1, NULL, increment, NULL);
    pthread_create(&amp;t2, NULL, increment, NULL);
    pthread_join(t1, NULL);
    pthread_join(t2, NULL);
    
    // Expected: 2,000,000
    // Actual: Something less (race condition!)
    printf("Counter: %d\n", counter);
    return 0;
}</code></pre>
<pre class="language-text"><code>Why it's broken:
══════════════════════════════════════════════════════════════
counter++ is NOT atomic! It's actually 3 operations:

Thread 1                   Thread 2
─────────────────────────  ─────────────────────────
1. LOAD counter (= 5)      
2. ADD 1 (= 6)             1. LOAD counter (= 5)  ← Same value!
3. STORE counter (= 6)     2. ADD 1 (= 6)
                           3. STORE counter (= 6)

Both threads read 5, both write 6 → Lost update!
We incremented twice but counter only increased by 1.

Runs:
$ ./program → Counter: 1847293
$ ./program → Counter: 1923847
$ ./program → Counter: 1788234
Different every time! Non-deterministic bug.</code></pre>
                        </div>
                    </div>

                    <h3 id="data-races">Data Races</h3>
                    
<pre class="language-text"><code>Data Race Definition:
══════════════════════════════════════════════════════════════
A data race occurs when:
1. Two or more threads access the same memory location
2. At least one access is a write
3. The accesses are not synchronized

Data races lead to undefined behavior in C/C++!
The compiler can assume no data races and optimize accordingly.

Examples of data races:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
int x = 0;                  // Shared variable

Thread 1:     Thread 2:     Race?
─────────     ─────────     ──────
x = 1;        y = x;        YES - write/read without sync
x = 1;        x = 2;        YES - write/write without sync
y = x;        z = x;        NO  - both reads, no writes

CRITICAL SECTION:
A code region that accesses shared resources and must not be
executed by more than one thread at a time.</code></pre>

                    <h3 id="atomicity">Atomicity</h3>
                    
<pre class="language-c"><code>// Solution 1: Atomic operations (simple cases)
#include &lt;stdatomic.h&gt;

atomic_int counter = 0;  // Atomic integer

void *increment(void *arg) {
    for (int i = 0; i &lt; 1000000; i++) {
        atomic_fetch_add(&amp;counter, 1);  // Atomic increment
        // Or: counter++;  // Also atomic for atomic_int!
    }
    return NULL;
}

// Now counter will always be exactly 2,000,000!


// Solution 2: Mutex (for complex critical sections)
#include &lt;pthread.h&gt;

int counter = 0;
pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;

void *increment(void *arg) {
    for (int i = 0; i &lt; 1000000; i++) {
        pthread_mutex_lock(&amp;lock);    // Enter critical section
        counter++;                     // Safe!
        pthread_mutex_unlock(&amp;lock);  // Exit critical section
    }
    return NULL;
}</code></pre>

                </div>

                <!-- Thread Safety Section -->
                <div id="thread-safety" class="blog-content mt-5">
                    <h2><i class="fas fa-shield-alt me-2 text-teal"></i>Thread Safety Patterns</h2>
                    
                    <p>A function or class is <strong>thread-safe</strong> if it can be safely called from multiple threads simultaneously.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-check-circle me-2"></i>Thread Safety Techniques</h4>
                        <div class="content">
                            <table class="table table-striped">
                                <thead>
                                    <tr><th>Technique</th><th>Description</th><th>Example</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Immutability</strong></td>
                                        <td>Data never changes after creation</td>
                                        <td>const strings, config objects</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Thread-Local Storage</strong></td>
                                        <td>Each thread has its own copy</td>
                                        <td><code>__thread int x;</code></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Mutual Exclusion</strong></td>
                                        <td>Locks protect shared data</td>
                                        <td>Mutexes, spinlocks</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Atomic Operations</strong></td>
                                        <td>Hardware-supported indivisible ops</td>
                                        <td>atomic_int, CAS</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Message Passing</strong></td>
                                        <td>Communicate by sending messages</td>
                                        <td>Go channels, queues</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

<pre class="language-c"><code>// Thread-Local Storage example
#include &lt;pthread.h&gt;
#include &lt;stdio.h&gt;

// Each thread gets its own 'counter'
__thread int counter = 0;  // GCC extension
// Or: _Thread_local int counter = 0;  // C11 standard

void *thread_func(void *arg) {
    int id = *(int *)arg;
    for (int i = 0; i &lt; 5; i++) {
        counter++;  // Each thread increments its OWN copy
        printf("Thread %d: counter = %d\n", id, counter);
    }
    return NULL;
}

// Output: Each thread counts 1,2,3,4,5 independently!</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Design Principle:</strong> "Share nothing if possible." If you can avoid sharing state between threads, you avoid race conditions entirely. When sharing is necessary, minimize it and protect it carefully.
                    </div>

                </div>

                <!-- Conclusion -->
                <div id="conclusion" class="blog-content mt-5">
                    <h2><i class="fas fa-flag-checkered me-2 text-teal"></i>Conclusion & Next Steps</h2>
                    
                    <p>Threads enable parallelism within a process, but shared memory requires careful synchronization. Key takeaways:</p>

                    <ul>
                        <li><strong>Threads vs Processes:</strong> Threads share address space (fast but dangerous), processes are isolated (safe but slower)</li>
                        <li><strong>Threading Models:</strong> User-level (N:1), kernel-level (1:1), and hybrid (M:N) each have trade-offs</li>
                        <li><strong>pthreads:</strong> Standard API for thread creation, joining, and attributes</li>
                        <li><strong>Race Conditions:</strong> Non-atomic operations on shared data cause unpredictable bugs</li>
                        <li><strong>Thread Safety:</strong> Achieved through locks, atomics, immutability, or thread-local storage</li>
                    </ul>

                    <div class="highlight-box">
                        <i class="fas fa-key me-2"></i>
                        <strong>Golden Rule:</strong> If multiple threads access the same data and at least one writes, you MUST synchronize. The next part covers synchronization primitives in detail.
                    </div>

                    <div class="series-next">
                        <h4><i class="fas fa-arrow-right me-2"></i>Next in the Series</h4>
                        <p>In <a href="comp-arch-cpu-scheduling.html"><strong>Part 11: CPU Scheduling Algorithms</strong></a>, we'll explore how operating systems decide which process or thread runs next—FCFS, Round Robin, priority scheduling, and the Linux CFS scheduler.</p>
                    </div>
                </div>

                <!-- Related Posts -->
                <div class="related-posts">
                    <h3><i class="fas fa-book me-2"></i>Continue the Computer Architecture & OS Series</h3>
                    <div class="related-post-item">
                        <h5>Part 9: Processes & Program Execution</h5>
                        <p>Process lifecycle, PCB, fork/exec, and process states.</p>
                        <a href="comp-arch-processes.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                    </div>
                    <div class="related-post-item">
                        <h5>Part 11: CPU Scheduling Algorithms</h5>
                        <p>FCFS, Round Robin, CFS, and real-time scheduling.</p>
                        <a href="comp-arch-cpu-scheduling.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                    </div>
                    <div class="related-post-item">
                        <h5>Part 12: Synchronization & Coordination</h5>
                        <p>Locks, semaphores, and classic synchronization problems.</p>
                        <a href="comp-arch-synchronization.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.</p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email"><i class="fas fa-envelope"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-secondary">
            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small"><i class="fas fa-icons me-2"></i>Icons from <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a></p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">Enjoying this content? <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll-to-Top Button -->
    <button id="scrollToTop" class="scroll-to-top" title="Back to Top"><i class="fas fa-arrow-up"></i></button>

    <!-- Category Indicator -->
    <div id="categoryIndicator" class="category-indicator"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="../../../js/main.js"></script>
    <script src="../../../js/cookie-consent.js"></script>
    
    <!-- Prism.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

    <!-- Prism Theme Switcher -->
    <script>
        const themes = {
            'prism-theme': 'Tomorrow Night',
            'prism-default': 'Default',
            'prism-dark': 'Dark',
            'prism-twilight': 'Twilight',
            'prism-okaidia': 'Okaidia',
            'prism-solarizedlight': 'Solarized Light'
        };
        const savedTheme = localStorage.getItem('prism-theme') || 'prism-theme';
        function switchTheme(themeId) {
            Object.keys(themes).forEach(id => {
                const link = document.getElementById(id);
                if (link) link.disabled = true;
            });
            const selectedLink = document.getElementById(themeId);
            if (selectedLink) {
                selectedLink.disabled = false;
                localStorage.setItem('prism-theme', themeId);
            }
            document.querySelectorAll('div.code-toolbar select').forEach(dropdown => {
                dropdown.value = themeId;
            });
            setTimeout(() => Prism.highlightAll(), 10);
        }
        document.addEventListener('DOMContentLoaded', function() { switchTheme(savedTheme); });
        Prism.plugins.toolbar.registerButton('theme-switcher', function(env) {
            const select = document.createElement('select');
            select.setAttribute('aria-label', 'Select code theme');
            Object.keys(themes).forEach(themeId => {
                const option = document.createElement('option');
                option.value = themeId;
                option.textContent = themes[themeId];
                if (themeId === savedTheme) option.selected = true;
                select.appendChild(option);
            });
            select.addEventListener('change', function(e) { switchTheme(e.target.value); });
            return select;
        });
    </script>
</body>
</html>
