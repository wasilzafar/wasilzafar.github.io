<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Database Mastery Part 6: Query Optimization & Indexing | Wasil Zafar</title>
    <meta name="description" content="Master query optimization and indexing for database performance. Learn EXPLAIN plans, index design principles, composite indexes, query anti-patterns, partitioning, and profiling tools.">
    <meta name="keywords" content="query optimization, EXPLAIN, index design, composite index, covering index, query performance, partitioning, database profiling, query anti-patterns">
    <meta name="author" content="Wasil Zafar">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Complete Database Mastery Part 6: Query Optimization & Indexing">
    <meta property="og:description" content="Master query optimization and indexing for database performance. Learn EXPLAIN plans, index design, and profiling tools.">
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2026-01-31">
    <meta property="article:author" content="Wasil Zafar">
    <meta property="article:section" content="Technology">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <!-- Google Consent Mode v2 -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied',
            'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE']
        });
        
        gtag('consent', 'default', {
            'ad_storage': 'granted',
            'ad_user_data': 'granted',
            'ad_personalization': 'granted',
            'analytics_storage': 'granted'
        });
        
        gtag('set', 'url_passthrough', true);
    </script>

    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PBS8M2JR');
    </script>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />
    
    <!-- Prism.js Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>

    <!-- GDPR Cookie Consent Banner -->
    <div id="cookieBanner" class="light display-bottom" style="display: none;">
        <div id="closeIcon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path>
            </svg>
        </div>
        
        <div class="content-wrap">
            <div class="msg-wrap">
                <div class="title-wrap">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20">
                        <path fill="#3B9797" d="M510.52 255.82c-69.97-.85-126.47-57.69-126.47-127.86-70.17 0-127-56.49-127.86-126.45-27.26-4.14-55.13.3-79.72 12.82l-69.13 35.22a132.221 132.221 0 0 0-57.79 57.81l-35.1 68.88a132.645 132.645 0 0 0-12.82 80.95l12.08 76.27a132.521 132.521 0 0 0 37.16 70.37l54.64 54.64a132.036 132.036 0 0 0 70.37 37.16l76.27 12.15c27.51 4.36 55.7-.11 80.95-12.8l68.88-35.08a132.166 132.166 0 0 0 57.79-57.81l35.1-68.88c12.56-24.64 17.01-52.58 12.91-79.91zM176 368c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm32-160c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm160 128c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32z"></path>
                    </svg>
                    <h4 style="margin: 0; font-size: 18px; color: var(--color-navy); font-weight: 700;">Cookie Consent</h4>
                </div>
                <p style="font-size: 14px; line-height: 1.6; color: var(--color-navy); margin-bottom: 15px;">
                    We use cookies to enhance your browsing experience, serve personalized content, and analyze our traffic. 
                    By clicking "Accept All", you consent to our use of cookies. See our 
                    <a href="/privacy-policy.html" style="color: var(--color-teal); border-bottom: 1px dotted var(--color-teal);">Privacy Policy</a> 
                    for more information.
                </p>
                
                <div id="cookieSettings" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="14" height="14">
                        <path fill="currentColor" d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path>
                    </svg>
                    <span style="margin-left: 5px; font-size: 12px; font-weight: 600; color: var(--color-navy);">Customize Settings</span>
                </div>
                
                <div id="cookieTypes" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(59, 151, 151, 0.2);">
                    <h5 style="font-size: 12px; font-weight: 700; color: var(--color-navy); margin-bottom: 10px; text-transform: uppercase;">Cookie Preferences</h5>
                    
                    <div style="margin-bottom: 12px;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="checkbox" checked disabled style="margin-top: 2px; margin-right: 8px; cursor: not-allowed;">
                            <div>
                                <strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Essential Cookies (Required)</strong>
                                <span style="font-size: 12px; color: #666;">Necessary for the website to function properly.</span>
                            </div>
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="checkbox" id="analyticsCookies" checked style="margin-top: 2px; margin-right: 8px;">
                            <div>
                                <strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Analytics Cookies</strong>
                                <span style="font-size: 12px; color: #666;">Help us understand how you interact with the website.</span>
                            </div>
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="checkbox" id="marketingCookies" style="margin-top: 2px; margin-right: 8px;">
                            <div>
                                <strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Marketing Cookies</strong>
                                <span style="font-size: 12px; color: #666;">Used to deliver relevant advertisements.</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="btn-wrap">
                <button id="cookieAccept" style="background: var(--color-teal); color: white; font-weight: 600;">Accept All</button>
                <button id="cookieReject" style="background: transparent; color: var(--color-navy); border: 2px solid var(--color-teal); font-weight: 600;">Reject All</button>
                <button id="cookieSave" style="background: var(--color-blue); color: white; font-weight: 600; display: none;">Save Preferences</button>
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">
                <span class="gradient-text">Wasil Zafar</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#skills">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#certifications">Certifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#interests">Interests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
                <h1 class="display-4 fw-bold mb-3">Complete Database Mastery Part 6: Query Optimization & Indexing</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>January 31, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>45 min read</span>
                    <button onclick="window.print()" class="print-btn" title="Print this article"><i class="fas fa-print"></i> Print</button>
                </div>
                <p class="lead">Master query optimization and indexing for peak database performance. Learn EXPLAIN plans, index design principles, composite and covering indexes, query anti-patterns, partitioning strategies, and profiling tools.</p>
            </div>
        </div>
    </section>

    <!-- Table of Contents Toggle Button -->
    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents" aria-label="Open Table of Contents">
        <i class="fas fa-list"></i>
    </button>

    <!-- Side Navigation Overlay -->
    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()" aria-label="Close Table of Contents">&times;</button>
        </div>
        <ol>
            <li>
                <a href="#introduction" onclick="closeNav()">Introduction</a>
                <ul>
                    <li><a href="#introduction" onclick="closeNav()">Performance Fundamentals</a></li>
                    <li><a href="#series-nav" onclick="closeNav()">Series Navigation</a></li>
                </ul>
            </li>
            <li>
                <a href="#query-execution" onclick="closeNav()">Query Execution</a>
                <ul>
                    <li><a href="#how-queries-work" onclick="closeNav()">How Queries Work</a></li>
                    <li><a href="#query-planner" onclick="closeNav()">Query Planner</a></li>
                </ul>
            </li>
            <li>
                <a href="#explain-plans" onclick="closeNav()">EXPLAIN Plans</a>
                <ul>
                    <li><a href="#postgres-explain" onclick="closeNav()">PostgreSQL EXPLAIN</a></li>
                    <li><a href="#mysql-explain" onclick="closeNav()">MySQL EXPLAIN</a></li>
                </ul>
            </li>
            <li>
                <a href="#index-design" onclick="closeNav()">Index Design Principles</a>
                <ul>
                    <li><a href="#when-to-index" onclick="closeNav()">When to Index</a></li>
                    <li><a href="#index-types" onclick="closeNav()">Index Types</a></li>
                </ul>
            </li>
            <li>
                <a href="#composite-indexes" onclick="closeNav()">Composite & Covering Indexes</a>
                <ul>
                    <li><a href="#composite" onclick="closeNav()">Composite Indexes</a></li>
                    <li><a href="#covering" onclick="closeNav()">Covering Indexes</a></li>
                </ul>
            </li>
            <li><a href="#index-pitfalls" onclick="closeNav()">When Indexes Hurt Performance</a></li>
            <li><a href="#anti-patterns" onclick="closeNav()">Query Anti-Patterns</a></li>
            <li><a href="#partitioning" onclick="closeNav()">Partitioning Strategies</a></li>
            <li><a href="#caching" onclick="closeNav()">Caching Query Results</a></li>
            <li><a href="#profiling" onclick="closeNav()">Benchmarking & Profiling</a></li>
            <li><a href="#conclusion" onclick="closeNav()">Conclusion & Next Steps</a></li>
        </ol>
    </div>

    <!-- Overlay Backdrop -->
    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <!-- Main Content -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <!-- Introduction -->
                <div id="introduction" class="blog-content">
                    <h2><i class="fas fa-tachometer-alt me-2 text-teal"></i>Introduction: Performance Fundamentals</h2>
                    
                    <p><strong>Query optimization</strong> is the art and science of making database queries run faster. A well-optimized query can be 100x or even 1000x faster than a naive implementation—the difference between milliseconds and minutes.</p>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-sitemap me-2"></i>
                        <strong>Series Context:</strong> This is <strong>Part 6 of 15</strong> in the Complete Database Mastery series. We're unlocking the secrets of database performance.
                    </div>

                    <div class="experiment-card" id="series-nav">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">15-Part Series</span>
                            <span class="badge bg-crimson">Database Mastery</span>
                        </div>
                        <div class="content">
                            <ol>
                                <li><a href="database-mastery-sql-fundamentals.html"><strong>Part 1:</strong> SQL Fundamentals & Syntax</a> — Database basics, CRUD operations, joins, constraints</li>
                                <li><a href="database-mastery-advanced-sql.html"><strong>Part 2:</strong> Advanced SQL & Query Mastery</a> — CTEs, window functions, stored procedures</li>
                                <li><a href="database-mastery-postgresql.html"><strong>Part 3:</strong> PostgreSQL Deep Dive</a> — Advanced types, indexing, extensions, tuning</li>
                                <li><a href="database-mastery-mysql-mariadb.html"><strong>Part 4:</strong> MySQL & MariaDB</a> — Storage engines, replication, optimization</li>
                                <li><a href="database-mastery-transactions-concurrency.html"><strong>Part 5:</strong> Transactions & Concurrency</a> — ACID, isolation levels, locking, MVCC</li>
                                <li><strong>Part 6: Query Optimization & Indexing (This Guide)</strong> — EXPLAIN plans, index design, performance</li>
                                <li><a href="database-mastery-data-modeling.html"><strong>Part 7:</strong> Data Modeling & Normalization</a> — ERDs, normal forms, schema design</li>
                                <li><a href="database-mastery-mongodb-nosql.html"><strong>Part 8:</strong> MongoDB & Document Databases</a> — NoSQL, aggregation, sharding</li>
                                <li><a href="database-mastery-redis-caching.html"><strong>Part 9:</strong> Redis & Caching Strategies</a> — Data structures, caching patterns, pub/sub</li>
                                <li><a href="database-mastery-administration-migrations.html"><strong>Part 10:</strong> Database Administration & Migrations</a> — Backup, versioning, maintenance</li>
                                <li><a href="database-mastery-scaling-distributed.html"><strong>Part 11:</strong> Scaling & Distributed Systems</a> — Replication, sharding, CAP theorem</li>
                                <li><a href="database-mastery-cloud-databases.html"><strong>Part 12:</strong> Cloud Databases & Managed Services</a> — AWS, Azure, GCP database offerings</li>
                                <li><a href="database-mastery-security-governance.html"><strong>Part 13:</strong> Database Security & Governance</a> — Encryption, access control, compliance</li>
                                <li><a href="database-mastery-warehousing-analytics.html"><strong>Part 14:</strong> Data Warehousing & Analytics</a> — OLAP, star schemas, columnar DBs</li>
                                <li><a href="database-mastery-capstone-projects.html"><strong>Part 15:</strong> Capstone Projects</a> — Portfolio-ready database implementations</li>
                            </ol>
                        </div>
                    </div>

                    <p>Think of query optimization as finding the fastest route on a map. The database has many ways to get your data—your job is to help it choose the best path.</p>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-stopwatch me-2"></i>The Performance Gap</h4>
                        <div class="content">
                            <table class="table table-bordered">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Scenario</th>
                                        <th>Naive Query</th>
                                        <th>Optimized Query</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Find user by email (1M rows)</td>
                                        <td>~500ms (full scan)</td>
                                        <td>~1ms (index lookup)</td>
                                    </tr>
                                    <tr>
                                        <td>Report with JOIN (10M rows)</td>
                                        <td>~30 seconds</td>
                                        <td>~200ms</td>
                                    </tr>
                                    <tr>
                                        <td>Aggregation query</td>
                                        <td>~10 seconds</td>
                                        <td>~50ms (covering index)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="highlight-box">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Rule of Thumb:</strong> If a query takes more than 100ms for a typical web request, it needs optimization. Users notice delays over 200ms.
                    </div>

                </div>

                <!-- Query Execution Section -->
                <div id="query-execution" class="blog-content mt-5">
                    <h2><i class="fas fa-cog me-2 text-teal"></i>How Query Execution Works</h2>
                    
                    <h3 id="how-queries-work">Query Processing Pipeline</h3>
                    
                    <p>When you run a query, the database goes through several stages:</p>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-project-diagram me-2"></i>Query Execution Steps</h4>
                        <div class="content">
                            <ol>
                                <li><strong>Parser:</strong> Validates syntax, converts SQL to parse tree</li>
                                <li><strong>Analyzer:</strong> Resolves table/column names, checks permissions</li>
                                <li><strong>Rewriter:</strong> Applies rules, expands views, simplifies expressions</li>
                                <li><strong>Planner/Optimizer:</strong> Generates execution plans, estimates costs, chooses best plan</li>
                                <li><strong>Executor:</strong> Runs the chosen plan, returns results</li>
                            </ol>
                        </div>
                    </div>

                    <h3 id="query-planner">Query Planner & Optimizer</h3>
                    
                    <p>The <strong>query planner</strong> is the brain of query execution. It considers multiple strategies and picks the one with lowest estimated cost.</p>
                    
<pre><code class="language-sql">-- The planner considers:
-- 1. Table statistics (row counts, data distribution)
-- 2. Available indexes
-- 3. Join algorithms (nested loop, hash join, merge join)
-- 4. Memory available for sorting/hashing
-- 5. Disk I/O patterns

-- PostgreSQL: Update statistics for better plans
ANALYZE orders;           -- Analyze one table
ANALYZE;                  -- Analyze all tables

-- Check table statistics
SELECT 
    relname AS table,
    reltuples AS row_estimate,
    relpages AS page_count
FROM pg_class
WHERE relname = 'orders';

-- Check column statistics
SELECT 
    attname AS column,
    n_distinct,
    most_common_vals,
    most_common_freqs
FROM pg_stats
WHERE tablename = 'orders';
</code></pre>
                </div>

                <!-- EXPLAIN Plans Section -->
                <div id="explain-plans" class="blog-content mt-5">
                    <h2><i class="fas fa-search me-2 text-teal"></i>EXPLAIN Plans</h2>
                    
                    <p><strong>EXPLAIN</strong> is your X-ray vision into query execution. It shows exactly what the database plans to do (or did) with your query.</p>
                    
                    <h3 id="postgres-explain">PostgreSQL EXPLAIN ANALYZE</h3>
                    
<pre><code class="language-sql">-- Basic EXPLAIN (shows plan without executing)
EXPLAIN SELECT * FROM orders WHERE customer_id = 123;

-- EXPLAIN ANALYZE (executes query, shows actual times)
EXPLAIN ANALYZE SELECT * FROM orders WHERE customer_id = 123;

-- Full details with buffers (I/O stats)
EXPLAIN (ANALYZE, BUFFERS, FORMAT TEXT)
SELECT * FROM orders WHERE customer_id = 123;

-- Example output interpretation:
-- Index Scan using idx_orders_customer on orders  (cost=0.42..8.44 rows=5 width=48) (actual time=0.019..0.025 rows=5 loops=1)
--   Index Cond: (customer_id = 123)
--   Buffers: shared hit=4
-- Planning Time: 0.089 ms
-- Execution Time: 0.045 ms

-- Key metrics to watch:
-- cost: Estimated startup cost..total cost
-- rows: Estimated row count
-- actual time: Real execution time (start..end)
-- Buffers shared hit: Pages read from cache (good!)
-- Buffers shared read: Pages read from disk (slower)

-- Common scan types (best to worst):
-- Index Scan - Uses index, fetches rows from table
-- Index Only Scan - Uses index only, no table access (fastest!)
-- Bitmap Index Scan - Multiple index conditions combined
-- Seq Scan - Full table scan (often bad on large tables)
</code></pre>

                    <h3 id="mysql-explain">MySQL EXPLAIN</h3>
                    
<pre><code class="language-sql">-- MySQL EXPLAIN
EXPLAIN SELECT * FROM orders WHERE customer_id = 123;

-- MySQL 8.0+ EXPLAIN ANALYZE (actually runs query)
EXPLAIN ANALYZE SELECT * FROM orders WHERE customer_id = 123;

-- Format as JSON (more details)
EXPLAIN FORMAT=JSON SELECT * FROM orders WHERE customer_id = 123;

-- Key columns in MySQL EXPLAIN:
-- type: Access method
--   ALL - Full table scan (bad!)
--   index - Full index scan
--   range - Index range scan
--   ref - Index lookup (non-unique)
--   eq_ref - Index lookup (unique/primary key)
--   const - Single row lookup
--   system - Single row table

-- key: Which index is used (NULL = no index!)
-- rows: Estimated rows to examine
-- filtered: % of rows surviving WHERE clause
-- Extra: 
--   "Using index" - Covering index (great!)
--   "Using where" - Server filtering after fetch
--   "Using filesort" - Extra sort step (often slow)
--   "Using temporary" - Temp table needed (can be slow)
</code></pre>
                    
                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Warning:</strong> <code>EXPLAIN ANALYZE</code> actually executes the query! Don't use it on DELETE/UPDATE without wrapping in a transaction you'll rollback.
                    </div>
                </div>

                <!-- Index Design Section -->
                <div id="index-design" class="blog-content mt-5">
                    <h2><i class="fas fa-list-ol me-2 text-teal"></i>Index Design Principles</h2>
                    
                    <h3 id="when-to-index">When to Create Indexes</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-check-circle me-2"></i>Index These Columns</h4>
                        <div class="content">
                            <ul>
                                <li><strong>WHERE clauses:</strong> Columns used in filters</li>
                                <li><strong>JOIN conditions:</strong> Foreign key columns</li>
                                <li><strong>ORDER BY:</strong> Columns used for sorting</li>
                                <li><strong>High selectivity:</strong> Columns that filter many rows</li>
                                <li><strong>Unique constraints:</strong> Already indexed automatically</li>
                            </ul>
                        </div>
                    </div>
                    
<pre><code class="language-sql">-- Analyze query patterns before creating indexes
-- Look at your application's most frequent queries

-- 1. Filter columns
CREATE INDEX idx_orders_status ON orders(status);
-- SELECT * FROM orders WHERE status = 'pending';

-- 2. Join columns (foreign keys)
CREATE INDEX idx_orders_customer ON orders(customer_id);
-- SELECT * FROM orders o JOIN customers c ON o.customer_id = c.id;

-- 3. Sort columns
CREATE INDEX idx_orders_date ON orders(created_at);
-- SELECT * FROM orders ORDER BY created_at DESC LIMIT 10;

-- 4. Combination for common query pattern
CREATE INDEX idx_orders_cust_date ON orders(customer_id, created_at);
-- SELECT * FROM orders 
-- WHERE customer_id = 123 
-- ORDER BY created_at DESC;
</code></pre>

                    <h3 id="index-types">Choosing Index Types</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-sitemap me-2"></i>Index Type Guide</h4>
                        <div class="content">
                            <table class="table table-bordered">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Type</th>
                                        <th>Best For</th>
                                        <th>Example Use</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>B-Tree</strong></td>
                                        <td>=, <, >, BETWEEN, LIKE 'abc%'</td>
                                        <td>Default, most cases</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Hash</strong></td>
                                        <td>= only (exact match)</td>
                                        <td>Session lookups</td>
                                    </tr>
                                    <tr>
                                        <td><strong>GiST</strong></td>
                                        <td>Geometric, range, full-text</td>
                                        <td>PostGIS, tsquery</td>
                                    </tr>
                                    <tr>
                                        <td><strong>GIN</strong></td>
                                        <td>Arrays, JSONB, full-text</td>
                                        <td>Tag arrays, JSON keys</td>
                                    </tr>
                                    <tr>
                                        <td><strong>BRIN</strong></td>
                                        <td>Large sorted tables</td>
                                        <td>Time-series logs</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Composite Indexes Section -->
                <div id="composite-indexes" class="blog-content mt-5">
                    <h2><i class="fas fa-layer-group me-2 text-teal"></i>Composite & Covering Indexes</h2>
                    
                    <h3 id="composite">Composite Indexes (Multi-Column)</h3>
                    
                    <p>A <strong>composite index</strong> includes multiple columns. Column order matters critically—the index is sorted by the first column, then the second, etc.</p>
                    
<pre><code class="language-sql">-- Column order follows the "leftmost prefix" rule
CREATE INDEX idx_orders_multi ON orders(customer_id, status, created_at);

-- This index can be used for:
-- ✅ WHERE customer_id = 123
-- ✅ WHERE customer_id = 123 AND status = 'pending'
-- ✅ WHERE customer_id = 123 AND status = 'pending' AND created_at > '2024-01-01'
-- ✅ WHERE customer_id = 123 ORDER BY status, created_at

-- This index CANNOT be used efficiently for:
-- ❌ WHERE status = 'pending' (skips first column)
-- ❌ WHERE created_at > '2024-01-01' (skips first two columns)
-- ❌ WHERE customer_id = 123 AND created_at > '2024-01-01' (skips status)

-- Think of it like a phone book:
-- Sorted by: Last Name → First Name → Phone
-- Easy to find: "Smith, John"
-- Hard to find: All people named "John" (any last name)
</code></pre>

                    <h3 id="covering">Covering Indexes (Index-Only Scans)</h3>
                    
                    <p>A <strong>covering index</strong> includes all columns the query needs. The database can answer the query from the index alone, without touching the table!</p>
                    
<pre><code class="language-sql">-- Without covering index:
-- Query needs to: 1) Find rows in index, 2) Fetch from table

-- Regular index
CREATE INDEX idx_orders_customer ON orders(customer_id);
-- Query still needs table access for status:
EXPLAIN SELECT customer_id, status FROM orders WHERE customer_id = 123;
-- Index Scan → then fetch 'status' from table

-- Covering index (INCLUDE in PostgreSQL 11+)
CREATE INDEX idx_orders_covering 
ON orders(customer_id) 
INCLUDE (status, total);

-- Now the query can be answered entirely from the index!
EXPLAIN SELECT customer_id, status, total FROM orders WHERE customer_id = 123;
-- Index Only Scan (no table access needed!)

-- MySQL: Add columns to index itself
CREATE INDEX idx_orders_covering ON orders(customer_id, status, total);
-- Works the same, but index is larger
</code></pre>
                    
                    <div class="highlight-box">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Index-Only Scan:</strong> Look for this in EXPLAIN output—it means zero table access, which is often 10x faster than regular index scans.
                    </div>
                </div>

                <!-- Index Pitfalls Section -->
                <div id="index-pitfalls" class="blog-content mt-5">
                    <h2><i class="fas fa-exclamation-triangle me-2 text-teal"></i>When Indexes Hurt Performance</h2>
                    
                    <p>Indexes aren't free—they have costs. Knowing when NOT to index is as important as knowing when to index.</p>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-times-circle me-2"></i>Index Costs</h4>
                        <div class="content">
                            <ul>
                                <li><strong>Write overhead:</strong> Every INSERT/UPDATE/DELETE must update all indexes</li>
                                <li><strong>Storage:</strong> Indexes consume disk space (sometimes more than the table!)</li>
                                <li><strong>Memory:</strong> Hot indexes compete for buffer pool space</li>
                                <li><strong>Maintenance:</strong> Indexes can become bloated, need REINDEX</li>
                            </ul>
                        </div>
                    </div>
                    
<pre><code class="language-sql">-- When indexes are NOT used (even if they exist):

-- 1. Low selectivity (returns most rows)
SELECT * FROM orders WHERE status = 'completed';
-- If 90% of orders are 'completed', full scan is faster!

-- 2. Functions on indexed columns
SELECT * FROM users WHERE LOWER(email) = 'test@example.com';
-- Index on 'email' won't help! Need functional index:
CREATE INDEX idx_users_email_lower ON users(LOWER(email));

-- 3. OR conditions spanning indexes
SELECT * FROM orders WHERE customer_id = 1 OR status = 'pending';
-- May do full scan instead of using either index

-- 4. LIKE with leading wildcard
SELECT * FROM products WHERE name LIKE '%phone%';
-- B-tree index can't help. Consider full-text search.

-- 5. Type mismatches
SELECT * FROM orders WHERE id = '123';  -- id is INT
-- Implicit cast may prevent index use

-- 6. Very small tables
-- For tables under ~1000 rows, full scan is often faster than index lookup

-- Check for unused indexes (PostgreSQL)
SELECT 
    schemaname || '.' || relname AS table,
    indexrelname AS index,
    pg_size_pretty(pg_relation_size(indexrelid)) AS size,
    idx_scan AS times_used
FROM pg_stat_user_indexes
WHERE idx_scan = 0
ORDER BY pg_relation_size(indexrelid) DESC;
-- Consider dropping indexes with 0 scans!
</code></pre>
                </div>

                <!-- Anti-Patterns Section -->
                <div id="anti-patterns" class="blog-content mt-5">
                    <h2><i class="fas fa-ban me-2 text-teal"></i>Query Anti-Patterns</h2>
                    
<pre><code class="language-sql">-- ❌ ANTI-PATTERN 1: SELECT *
SELECT * FROM orders WHERE customer_id = 123;
-- Problems: Fetches unused columns, prevents index-only scans

-- ✅ FIX: Select only what you need
SELECT id, status, total FROM orders WHERE customer_id = 123;


-- ❌ ANTI-PATTERN 2: N+1 Queries (application-level)
-- for customer in customers:
--     orders = SELECT * FROM orders WHERE customer_id = customer.id

-- ✅ FIX: Batch with JOIN or IN clause
SELECT c.*, o.* 
FROM customers c
LEFT JOIN orders o ON c.id = o.customer_id
WHERE c.id IN (1, 2, 3, 4, 5);


-- ❌ ANTI-PATTERN 3: OR in WHERE (hard to optimize)
SELECT * FROM orders WHERE customer_id = 1 OR product_id = 100;

-- ✅ FIX: Use UNION ALL (can use separate indexes)
SELECT * FROM orders WHERE customer_id = 1
UNION ALL
SELECT * FROM orders WHERE product_id = 100 AND customer_id != 1;


-- ❌ ANTI-PATTERN 4: Correlated subquery
SELECT * FROM customers c
WHERE EXISTS (
    SELECT 1 FROM orders o 
    WHERE o.customer_id = c.id AND o.total > 1000
);

-- ✅ FIX: Use JOIN (often faster)
SELECT DISTINCT c.*
FROM customers c
JOIN orders o ON c.id = o.customer_id
WHERE o.total > 1000;


-- ❌ ANTI-PATTERN 5: ORDER BY RAND() 
SELECT * FROM products ORDER BY RAND() LIMIT 10;
-- Generates random number for EVERY row!

-- ✅ FIX: Pre-select random IDs
SELECT * FROM products
WHERE id >= (SELECT FLOOR(RAND() * MAX(id)) FROM products)
LIMIT 10;
</code></pre>
                    
                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Biggest Performance Killer:</strong> The N+1 query problem. One bad loop in your application code can generate thousands of database queries!
                    </div>
                </div>

                <!-- Partitioning Section -->
                <div id="partitioning" class="blog-content mt-5">
                    <h2><i class="fas fa-th-large me-2 text-teal"></i>Partitioning Strategies</h2>
                    
                    <p><strong>Partitioning</strong> splits a large table into smaller, more manageable pieces. The database can scan only relevant partitions, dramatically speeding up queries on huge tables.</p>
                    
<pre><code class="language-sql">-- PostgreSQL: Range partitioning by date (most common)
CREATE TABLE orders (
    id SERIAL,
    customer_id INT,
    created_at TIMESTAMP,
    total DECIMAL(10,2)
) PARTITION BY RANGE (created_at);

-- Create partitions for each month
CREATE TABLE orders_2024_01 PARTITION OF orders
    FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');
CREATE TABLE orders_2024_02 PARTITION OF orders
    FOR VALUES FROM ('2024-02-01') TO ('2024-03-01');
-- ... more partitions

-- Queries automatically use only relevant partitions:
EXPLAIN SELECT * FROM orders WHERE created_at >= '2024-02-15';
-- Scans only orders_2024_02 and later!

-- List partitioning (for categorical data)
CREATE TABLE orders_by_region (
    id SERIAL,
    region TEXT,
    data JSONB
) PARTITION BY LIST (region);

CREATE TABLE orders_us PARTITION OF orders_by_region FOR VALUES IN ('US');
CREATE TABLE orders_eu PARTITION OF orders_by_region FOR VALUES IN ('EU', 'UK');
CREATE TABLE orders_apac PARTITION OF orders_by_region FOR VALUES IN ('APAC');

-- Hash partitioning (even distribution)
CREATE TABLE events (
    id BIGSERIAL,
    user_id INT,
    data JSONB
) PARTITION BY HASH (user_id);

CREATE TABLE events_0 PARTITION OF events FOR VALUES WITH (MODULUS 4, REMAINDER 0);
CREATE TABLE events_1 PARTITION OF events FOR VALUES WITH (MODULUS 4, REMAINDER 1);
CREATE TABLE events_2 PARTITION OF events FOR VALUES WITH (MODULUS 4, REMAINDER 2);
CREATE TABLE events_3 PARTITION OF events FOR VALUES WITH (MODULUS 4, REMAINDER 3);
</code></pre>
                    
                    <div class="highlight-box">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>When to Partition:</strong> Tables over 100GB, time-series data where old data is rarely accessed, or when you need to efficiently drop old data (DROP PARTITION is instant vs. DELETE).
                    </div>
                </div>

                <!-- Caching Section -->
                <div id="caching" class="blog-content mt-5">
                    <h2><i class="fas fa-bolt me-2 text-teal"></i>Caching Query Results</h2>
                    
<pre><code class="language-sql">-- PostgreSQL: Materialized Views (pre-computed query results)
CREATE MATERIALIZED VIEW daily_sales AS
SELECT 
    DATE(created_at) AS date,
    COUNT(*) AS order_count,
    SUM(total) AS revenue
FROM orders
GROUP BY DATE(created_at);

-- Query the materialized view (instant!)
SELECT * FROM daily_sales WHERE date >= '2024-01-01';

-- Refresh when needed (recalculates everything)
REFRESH MATERIALIZED VIEW daily_sales;

-- Refresh concurrently (no lock, but needs unique index)
CREATE UNIQUE INDEX ON daily_sales(date);
REFRESH MATERIALIZED VIEW CONCURRENTLY daily_sales;


-- Application-level caching with Redis
-- 1. Check cache first
-- 2. If miss, query database
-- 3. Store result in cache with TTL

-- Cache key pattern
-- user:123:orders:recent → JSON of recent orders
-- product:456:details → Product details
-- dashboard:daily_stats:2024-02-15 → Daily stats

-- Invalidation strategies:
-- Time-based: TTL expiration (simple, may serve stale data)
-- Event-based: Invalidate on write (complex, always fresh)
-- Hybrid: Short TTL + event invalidation
</code></pre>
                </div>

                <!-- Profiling Section -->
                <div id="profiling" class="blog-content mt-5">
                    <h2><i class="fas fa-chart-bar me-2 text-teal"></i>Benchmarking & Profiling Tools</h2>
                    
<pre><code class="language-sql">-- PostgreSQL: Find slow queries with pg_stat_statements
CREATE EXTENSION pg_stat_statements;

-- Top 10 queries by total time
SELECT 
    substring(query, 1, 50) AS short_query,
    calls,
    round(total_exec_time::numeric, 2) AS total_ms,
    round(mean_exec_time::numeric, 2) AS avg_ms,
    rows
FROM pg_stat_statements
ORDER BY total_exec_time DESC
LIMIT 10;

-- Reset statistics
SELECT pg_stat_statements_reset();


-- MySQL: Slow query log
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;  -- Log queries over 1 second
SET GLOBAL log_queries_not_using_indexes = 'ON';

-- Performance Schema (MySQL 5.6+)
SELECT * FROM performance_schema.events_statements_summary_by_digest
ORDER BY SUM_TIMER_WAIT DESC
LIMIT 10;


-- PostgreSQL: Auto-explain (logs plans for slow queries)
-- In postgresql.conf:
-- shared_preload_libraries = 'auto_explain'
-- auto_explain.log_min_duration = '1s'


-- Benchmarking tool: pgbench (PostgreSQL built-in)
-- Initialize: pgbench -i mydb
-- Run: pgbench -c 10 -j 2 -t 1000 mydb
--   -c 10: 10 concurrent clients
--   -j 2: 2 threads
--   -t 1000: 1000 transactions per client
</code></pre>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-tools me-2"></i>Essential Monitoring Queries</h4>
                        <div class="content">
<pre><code class="language-sql">-- Current running queries (PostgreSQL)
SELECT 
    pid,
    now() - pg_stat_activity.query_start AS duration,
    query,
    state
FROM pg_stat_activity
WHERE state != 'idle'
ORDER BY duration DESC;

-- Table sizes
SELECT 
    relname AS table,
    pg_size_pretty(pg_total_relation_size(relid)) AS total_size,
    pg_size_pretty(pg_relation_size(relid)) AS table_size,
    pg_size_pretty(pg_indexes_size(relid)) AS index_size
FROM pg_catalog.pg_statio_user_tables
ORDER BY pg_total_relation_size(relid) DESC
LIMIT 10;

-- Index usage stats
SELECT 
    relname AS table,
    indexrelname AS index,
    idx_scan AS times_used,
    pg_size_pretty(pg_relation_size(indexrelid)) AS size
FROM pg_stat_user_indexes
ORDER BY idx_scan DESC;
</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Conclusion -->
                <div id="conclusion" class="blog-content mt-5">
                    <h2><i class="fas fa-flag-checkered me-2 text-teal"></i>Conclusion & Next Steps</h2>
                    
                    <p>Query optimization is a critical skill that separates good developers from great ones. Understanding EXPLAIN plans, designing proper indexes, and avoiding anti-patterns will dramatically improve your application's performance.</p>

                    <div class="series-next">
                        <h4><i class="fas fa-arrow-right me-2"></i>Next in the Series</h4>
                        <p>In <a href="database-mastery-data-modeling.html"><strong>Part 7: Data Modeling & Normalization</strong></a>, we'll master architect-level database design with ERDs, normal forms, and real-world schema patterns.</p>
                    </div>
                </div>

                <!-- Related Posts -->
                <div class="related-posts">
                    <h3><i class="fas fa-book me-2"></i>Continue the Database Mastery Series</h3>
                    <div class="related-post-item">
                        <h5>Part 5: Transactions & Concurrency</h5>
                        <p>Understand how transactions affect query performance.</p>
                        <a href="database-mastery-transactions-concurrency.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                    </div>
                    <div class="related-post-item">
                        <h5>Part 7: Data Modeling & Normalization</h5>
                        <p>Design schemas that optimize for your query patterns.</p>
                        <a href="database-mastery-data-modeling.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                    </div>
                    <div class="related-post-item">
                        <h5>Part 14: Data Warehousing & Analytics</h5>
                        <p>Apply optimization techniques to analytical workloads.</p>
                        <a href="database-mastery-warehousing-analytics.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">
                        I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest">
                            <i class="fab fa-pinterest-p"></i>
                        </a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <hr class="bg-secondary">

            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small">
                        <i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a>
                    </p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">
                        Enjoying this content?  <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll-to-Top Button -->
    <button id="scrollToTop" class="scroll-to-top" title="Back to Top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Category Indicator -->
    <div id="categoryIndicator" class="category-indicator" title="Current Section"><i class="fas fa-tag"></i><span id="categoryText">Technology</span></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="../../../js/main.js"></script>
    <script src="../../../js/cookie-consent.js"></script>
    
    <!-- Prism.js for Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

    <!-- Prism Theme Switcher -->
    <script>
        const themes = {
            'prism-theme': 'Tomorrow Night',
            'prism-default': 'Default',
            'prism-dark': 'Dark',
            'prism-twilight': 'Twilight',
            'prism-okaidia': 'Okaidia',
            'prism-solarizedlight': 'Solarized Light'
        };

        const savedTheme = localStorage.getItem('prism-theme') || 'prism-theme';

        function switchTheme(themeId) {
            Object.keys(themes).forEach(id => {
                const link = document.getElementById(id);
                if (link) link.disabled = true;
            });
            
            const selectedLink = document.getElementById(themeId);
            if (selectedLink) {
                selectedLink.disabled = false;
                localStorage.setItem('prism-theme', themeId);
            }

            document.querySelectorAll('div.code-toolbar select').forEach(dropdown => {
                dropdown.value = themeId;
            });

            setTimeout(() => Prism.highlightAll(), 10);
        }

        document.addEventListener('DOMContentLoaded', function() {
            switchTheme(savedTheme);
        });

        Prism.plugins.toolbar.registerButton('theme-switcher', function(env) {
            const select = document.createElement('select');
            select.setAttribute('aria-label', 'Select code theme');
            select.className = 'prism-theme-selector';
            
            Object.keys(themes).forEach(themeId => {
                const option = document.createElement('option');
                option.value = themeId;
                option.textContent = themes[themeId];
                if (themeId === savedTheme) option.selected = true;
                select.appendChild(option);
            });
            
            select.addEventListener('change', function(e) {
                switchTheme(e.target.value);
            });
            
            return select;
        });
    </script>

    <!-- Scroll-to-Top and Category Indicator Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scrollToTopBtn = document.getElementById('scrollToTop');
            const categoryIndicator = document.getElementById('categoryIndicator');
            
            const h2Elements = document.querySelectorAll('.blog-content h2');
            const sections = [];
            
            h2Elements.forEach(function(h2) {
                let text = h2.textContent.trim().replace(/^\d+\.\s*/, '');
                if (text.length > 25) text = text.substring(0, 22) + '...';
                sections.push({ element: h2, name: text });
            });
            
            window.addEventListener('scroll', function() {
                if (window.scrollY > 300) {
                    scrollToTopBtn.classList.add('show');
                    
                    if (sections.length > 0) {
                        let currentSection = sections[0].name;
                        for (let i = 0; i < sections.length; i++) {
                            const rect = sections[i].element.getBoundingClientRect();
                            if (rect.top <= 150) currentSection = sections[i].name;
                        }
                        categoryIndicator.textContent = currentSection;
                        categoryIndicator.classList.add('show');
                    }
                } else {
                    scrollToTopBtn.classList.remove('show');
                    categoryIndicator.classList.remove('show');
                }
            });
            
            scrollToTopBtn.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
