<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kernel Development Series - Phase 14: Advanced Input & Timing | Wasil Zafar</title>
    <meta name="description" content="Implement PS/2 and USB mouse drivers for GUI interaction, plus high-precision timers using HPET and APIC for accurate scheduling.">
    <meta name="keywords" content="kernel development, mouse driver, PS/2, HPET, APIC timer, USB HID, OS development">
    <meta name="author" content="Wasil Zafar">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Kernel Development Series - Phase 14: Advanced Input & Timing">
    <meta property="og:description" content="Implement PS/2 and USB mouse drivers for GUI interaction, plus high-precision timers using HPET and APIC for accurate scheduling.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://wasilzafar.com/pages/series/kernel-development/kernel-dev-phase-14-input-timing.html">
    <meta property="og:image" content="https://wasilzafar.com/images/og-kernel-dev.png">
    <meta property="article:published_time" content="2026-02-06">
    <meta property="article:author" content="Wasil Zafar">
    <meta property="article:section" content="Technology">

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PBS8M2JR');</script>
    
    <!-- Google Consent Mode v2 -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('consent', 'default', {
        'ad_storage': 'denied',
        'ad_user_data': 'denied',
        'ad_personalization': 'denied',
        'analytics_storage': 'denied',
        'wait_for_update': 500
      });
    </script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../../images/favicon_io/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Poppins:wght@400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Prism.js Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="../../../css/main.css">
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>

    <!-- GDPR Cookie Consent Banner -->
    <div id="cookieBanner" class="light display-bottom" style="display: none;">
        <div id="closeIcon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path>
            </svg>
        </div>
        
        <div class="content-wrap">
            <div class="msg-wrap">
                <div class="title-wrap">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20">
                        <path fill="#3B9797" d="M510.52 255.82c-69.97-.85-126.47-57.69-126.47-127.86-70.17 0-127-56.49-127.86-126.45-27.26-4.14-55.13.3-79.72 12.82l-69.13 35.22a132.221 132.221 0 0 0-57.79 57.81l-35.1 68.88a132.645 132.645 0 0 0-12.82 80.95l12.08 76.27a132.521 132.521 0 0 0 37.16 70.37l54.64 54.64a132.036 132.036 0 0 0 70.37 37.16l76.27 12.15c27.51 4.36 55.7-.11 80.95-12.8l68.88-35.08a132.166 132.166 0 0 0 57.79-57.81l35.1-68.88c12.56-24.64 17.01-52.58 12.91-79.91zM176 368c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm32-160c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm160 128c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32z"></path>
                    </svg>
                    <h4 style="margin: 0; font-size: 18px; color: var(--color-navy); font-weight: 700;">Cookie Consent</h4>
                </div>
                <p style="font-size: 14px; line-height: 1.6; color: var(--color-navy); margin-bottom: 15px;">
                    We use cookies to enhance your browsing experience, serve personalized content, and analyze our traffic. 
                    By clicking "Accept All", you consent to our use of cookies. See our 
                    <a href="/privacy-policy.html" style="color: var(--color-teal); border-bottom: 1px dotted var(--color-teal);">Privacy Policy</a> 
                    for more information.
                </p>
                
                <div id="cookieSettings" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="14" height="14">
                        <path fill="currentColor" d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path>
                    </svg>
                    <span style="margin-left: 5px; font-size: 12px; font-weight: 600; color: var(--color-navy);">Customize Settings</span>
                </div>
                
                <div id="cookieTypes" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(59, 151, 151, 0.2);">
                    <h5 style="font-size: 12px; font-weight: 700; color: var(--color-navy); margin-bottom: 10px; text-transform: uppercase;">Cookie Preferences</h5>
                    
                    <div style="margin-bottom: 12px;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="checkbox" checked disabled style="margin-top: 2px; margin-right: 8px; cursor: not-allowed;">
                            <div>
                                <strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Essential Cookies (Required)</strong>
                                <span style="font-size: 12px; color: #666;">Necessary for the website to function properly.</span>
                            </div>
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="checkbox" id="analyticsCookies" checked style="margin-top: 2px; margin-right: 8px;">
                            <div>
                                <strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Analytics Cookies</strong>
                                <span style="font-size: 12px; color: #666;">Help us understand how you interact with the website.</span>
                            </div>
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="checkbox" id="marketingCookies" style="margin-top: 2px; margin-right: 8px;">
                            <div>
                                <strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Marketing Cookies</strong>
                                <span style="font-size: 12px; color: #666;">Used to deliver relevant advertisements.</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="btn-wrap">
                <button id="cookieAccept" style="background: var(--color-teal); color: white; font-weight: 600;">Accept All</button>
                <button id="cookieReject" style="background: transparent; color: var(--color-navy); border: 2px solid var(--color-teal); font-weight: 600;">Reject All</button>
                <button id="cookieSave" style="background: var(--color-blue); color: white; font-weight: 600; display: none;">Save Preferences</button>
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">
                <span class="gradient-text">Wasil Zafar</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#skills">Skills</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#certifications">Certifications</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#interests">Interests</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link">
                    <i class="fas fa-arrow-left me-2"></i>Back to Technology
                </a>
                <h1 class="display-4 fw-bold mb-3">Phase 14: Advanced Input & Timing</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>February 6, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>30 min read</span>
                    <button onclick="window.print()" class="print-btn" title="Print this article">
                        <i class="fas fa-print"></i> Print
                    </button>
                </div>
                <p class="lead">Add mouse support for graphical interaction and implement high-precision timers using HPET and APIC for accurate scheduling and animations.</p>
            </div>
        </div>
    </section>

    <!-- Table of Contents Toggle Button -->
    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents" aria-label="Open Table of Contents">
        <i class="fas fa-list"></i>
    </button>

    <!-- Side Navigation Overlay -->
    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()" aria-label="Close Table of Contents">&times;</button>
        </div>
        <ol>
            <li>
                <a href="#introduction" onclick="closeNav()">Introduction</a>
                <ul>
                    <li><a href="#input-overview" onclick="closeNav()">Input Overview</a></li>
                    <li><a href="#timing-importance" onclick="closeNav()">Timing Importance</a></li>
                </ul>
            </li>
            <li>
                <a href="#ps2-mouse" onclick="closeNav()">PS/2 Mouse Driver</a>
                <ul>
                    <li><a href="#mouse-protocol" onclick="closeNav()">Mouse Protocol</a></li>
                    <li><a href="#mouse-packets" onclick="closeNav()">Packet Format</a></li>
                    <li><a href="#cursor" onclick="closeNav()">Cursor Rendering</a></li>
                </ul>
            </li>
            <li>
                <a href="#usb-hid" onclick="closeNav()">USB HID Input</a>
                <ul>
                    <li><a href="#usb-basics" onclick="closeNav()">USB Basics</a></li>
                    <li><a href="#hid-protocol" onclick="closeNav()">HID Protocol</a></li>
                </ul>
            </li>
            <li>
                <a href="#hpet" onclick="closeNav()">HPET Timer</a>
                <ul>
                    <li><a href="#hpet-acpi" onclick="closeNav()">ACPI Discovery</a></li>
                    <li><a href="#hpet-config" onclick="closeNav()">Configuration</a></li>
                </ul>
            </li>
            <li>
                <a href="#apic-timer" onclick="closeNav()">APIC Timer</a>
                <ul>
                    <li><a href="#local-apic" onclick="closeNav()">Local APIC</a></li>
                    <li><a href="#timer-calibration" onclick="closeNav()">Calibration</a></li>
                </ul>
            </li>
            <li><a href="#build" onclick="closeNav()">What You Can Build</a></li>
            <li><a href="#next-steps" onclick="closeNav()">Next Steps</a></li>
        </ol>
    </div>

    <!-- Overlay Backdrop -->
    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <!-- Main Content -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <!-- Introduction -->
                <div id="introduction" class="blog-content">
                    <h2><i class="fas fa-mouse-pointer me-2 text-teal"></i>Introduction: Input & Timing</h2>
                    
                    <div class="highlight-box crimson">
                        <i class="fas fa-flag me-2"></i>
                        <strong>Phase 14 Goals:</strong> By the end of this phase, your OS will have mouse support for GUI interaction, and high-precision timers for accurate scheduling, animations, and time-sensitive operations.
                    </div>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">18-Part Series</span>
                            <span class="badge bg-crimson">OS Development Mastery</span>
                        </div>
                        <div class="content">
                            <ol>
                                <li><a href="kernel-dev-phase-00-orientation.html">Phase 0: Orientation & Big Picture</a> - OS fundamentals, kernel architectures, learning path</li>
                                <li><a href="kernel-dev-phase-01-boot-process.html">Phase 1: How a Computer Starts</a> - BIOS/UEFI, boot sequence, dev environment</li>
                                <li><a href="kernel-dev-phase-02-real-mode.html">Phase 2: Real Mode - First Steps</a> - Real mode, bootloader, BIOS interrupts</li>
                                <li><a href="kernel-dev-phase-03-protected-mode.html">Phase 3: Entering Protected Mode</a> - GDT, 32-bit mode, C code execution</li>
                                <li><a href="kernel-dev-phase-04-display-input.html">Phase 4: Display, Input & Output</a> - VGA text mode, keyboard handling</li>
                                <li><a href="kernel-dev-phase-05-interrupts.html">Phase 5: Interrupts & CPU Control</a> - IDT, ISRs, PIC programming</li>
                                <li><a href="kernel-dev-phase-06-memory.html">Phase 6: Memory Management</a> - Paging, virtual memory, heap allocator</li>
                                <li><a href="kernel-dev-phase-07-filesystem.html">Phase 7: Disk Access & Filesystems</a> - Block devices, FAT, VFS layer</li>
                                <li><a href="kernel-dev-phase-08-processes.html">Phase 8: Processes & User Mode</a> - Task switching, system calls, user space</li>
                                <li><a href="kernel-dev-phase-09-elf.html">Phase 9: ELF Loading & Executables</a> - ELF format, program loading</li>
                                <li><a href="kernel-dev-phase-10-stdlib-shell.html">Phase 10: Standard Library & Shell</a> - C library, command-line shell</li>
                                <li><a href="kernel-dev-phase-11-long-mode.html">Phase 11: 64-Bit Long Mode</a> - x86-64, 64-bit paging, modern architecture</li>
                                <li><a href="kernel-dev-phase-12-uefi.html">Phase 12: Modern Booting with UEFI</a> - UEFI boot services, memory maps</li>
                                <li><a href="kernel-dev-phase-13-graphics.html">Phase 13: Graphics & GUI Systems</a> - Framebuffer, windowing, drawing</li>
                                <li><strong>Phase 14: Advanced Input & Timing (This Guide)</strong> - Mouse, high-precision timers</li>
                                <li><a href="kernel-dev-phase-15-hardware-drivers.html">Phase 15: Hardware Discovery & Drivers</a> - PCI, device drivers, NVMe</li>
                                <li><a href="kernel-dev-phase-16-performance.html">Phase 16: Performance & Optimization</a> - Caching, scheduler tuning</li>
                                <li><a href="kernel-dev-phase-17-security.html">Phase 17: Stability, Security & Finishing</a> - Debugging, hardening, completion</li>
                            </ol>
                        </div>
                    </div>
                    
                    <p>In Phase 13, we built a complete graphics system with framebuffer drawing, fonts, double buffering, and window management. But a graphical interface isn't truly usable until users can <strong>interact</strong> with it. In this phase, we add the two critical components that transform a static display into an interactive system: <strong>precise input handling</strong> (mouse) and <strong>high-precision timing</strong>.</p>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Key Insight:</strong> A graphical OS needs precise input handling and accurate timing. The mouse makes your GUI interactive, while high-precision timers enable smooth animations, proper scheduling, and accurate time measurement.
                    </div>

                    <!-- Input & Timing System Architecture -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═══════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">           INPUT & TIMING SYSTEM ARCHITECTURE                               </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═══════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                           <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌─────────────────────────────────────────────────────────────────┐</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  <span style="color: #50fa7b;">APPLICATION LAYER</span>                                              <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>    ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐    <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>    │  <span style="color: #ff79c6;">GUI Events</span>  │  │  <span style="color: #ff79c6;">Game Loop</span>   │  │ <span style="color: #ff79c6;">Time Functions</span>  │    <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>    │   (clicks)   │  │  (60 FPS)    │  │ (sleep, delay)   │    <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>    └──────┬───────┘  └──────┬───────┘  └────────┬─────────┘    <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└──────────┼──────────────────┼───────────────────┼──────────────┘</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>             │                  │                   │                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌──────────┴──────────────────┴───────────────────┴──────────────┐</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  <span style="color: #8be9fd;">KERNEL SERVICES</span>                                                <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  ┌────────────────────┐  ┌──────────────────────────────────┐  <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │  <span style="color: #bd93f9;">Input Subsystem</span>   │  │     <span style="color: #bd93f9;">Timing Subsystem</span>            │  <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │  • Event queue     │  │  • System timer (ticks)         │  <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │  • Cursor position │  │  • High-resolution time         │  <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │  • Button state    │  │  • Scheduler timer              │  <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  └─────────┬──────────┘  └───────────────┬──────────────────┘  <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└───────────┼────────────────────────────────┼──────────────────────┘</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>               │                              │                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌───────────┴──────────────────────────────────┴──────────────────────┐</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  <span style="color: #f1fa8c;">HARDWARE LAYER</span>                                                     <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  ┌──────────────┐  ┌──────────────┐  ┌──────────┐  ┌──────────┐   <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │ <span style="color: #ffb86c;">PS/2 Mouse</span>  │  │  <span style="color: #ffb86c;">USB HID</span>    │  │  <span style="color: #ffb86c;">HPET</span>    │  │ <span style="color: #ffb86c;">APIC</span>     │   <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │  IRQ 12      │  │  Keyboard   │  │  Timer   │  │  Timer   │   <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │  (Legacy)    │  │  Mouse      │  │ (Modern) │  │(Per-CPU) │   <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  └──────────────┘  └──────────────┘  └──────────┘  └──────────┘   <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└──────────────────────────────────────────────────────────────────────┘</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                           <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═══════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <h3 id="input-overview">Input Overview</h3>
                    
                    <p>Think of input devices like different languages that your OS needs to understand. Each device speaks its own protocol:</p>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Device Type</th>
                                <th>Interface</th>
                                <th>Interrupt</th>
                                <th>Data Format</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>PS/2 Keyboard</strong></td>
                                <td>8042 Controller</td>
                                <td>IRQ 1</td>
                                <td>Scan codes (1-3 bytes)</td>
                            </tr>
                            <tr>
                                <td><strong>PS/2 Mouse</strong></td>
                                <td>8042 Controller</td>
                                <td>IRQ 12</td>
                                <td>3-byte packets (dx, dy, buttons)</td>
                            </tr>
                            <tr>
                                <td><strong>USB Keyboard</strong></td>
                                <td>USB HID</td>
                                <td>USB IRQ</td>
                                <td>8-byte reports</td>
                            </tr>
                            <tr>
                                <td><strong>USB Mouse</strong></td>
                                <td>USB HID</td>
                                <td>USB IRQ</td>
                                <td>Variable HID reports</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Input Path Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                  INPUT EVENT FLOW                                           </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #50fa7b;">┌─────────┐</span>     <span style="color: #8be9fd;">┌─────────┐</span>     <span style="color: #bd93f9;">┌─────────┐</span>     <span style="color: #ff79c6;">┌─────────────┐</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #50fa7b;">│ Physical│</span>────▶<span style="color: #8be9fd;">│  IRQ    │</span>────▶<span style="color: #bd93f9;">│ Handler │</span>────▶<span style="color: #ff79c6;">│    Event    │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #50fa7b;">│  Mouse  │</span>     <span style="color: #8be9fd;">│Triggered│</span>     <span style="color: #bd93f9;">│  Runs   │</span>     <span style="color: #ff79c6;">│    Queue    │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #50fa7b;">└─────────┘</span>     <span style="color: #8be9fd;">└─────────┘</span>     <span style="color: #bd93f9;">└─────────┘</span>     <span style="color: #ff79c6;">└──────┬──────┘</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    <span style="color: #6272a4;">User clicks</span>    <span style="color: #6272a4;">IRQ 12</span>        <span style="color: #6272a4;">Parses packet</span>     <span style="color: #6272a4;">       │</span>          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    <span style="color: #6272a4;">or moves</span>       <span style="color: #6272a4;">fires</span>         <span style="color: #6272a4;">bytes</span>             <span style="color: #6272a4;">       ▼</span>          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                     <span style="color: #f1fa8c;">┌─────────────┐</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                     <span style="color: #f1fa8c;">│   Window    │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                     <span style="color: #f1fa8c;">│   Manager   │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                     <span style="color: #f1fa8c;">│  Dispatch   │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                     <span style="color: #f1fa8c;">└──────┬──────┘</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                            <span style="color: #6272a4;">│</span>            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                            <span style="color: #6272a4;">▼</span>            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                     <span style="color: #ffb86c;">┌─────────────┐</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                     <span style="color: #ffb86c;">│ Application │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                     <span style="color: #ffb86c;">│   Handler   │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                     <span style="color: #ffb86c;">└─────────────┘</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <p>The <strong>input subsystem</strong> performs several critical functions:</p>
                    <ul>
                        <li><strong>Device abstraction</strong>: Applications don't need to know if input comes from PS/2 or USB</li>
                        <li><strong>Event queuing</strong>: IRQ handlers are fast; event processing happens later</li>
                        <li><strong>State tracking</strong>: Maintaining cursor position, button states, modifier keys</li>
                        <li><strong>Focus management</strong>: Routing events to the correct window</li>
                    </ul>

                    <h3 id="timing-importance">Timing Importance</h3>
                    
                    <p>Accurate timing is the heartbeat of your OS. Without precise timing:</p>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Why Timing Matters:</strong> Animation stutters, audio glitches, network timeouts fail, multitasking becomes unfair—timing problems cascade into every subsystem.
                    </div>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Timer Source</th>
                                <th>Resolution</th>
                                <th>Use Case</th>
                                <th>Availability</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>PIT</strong></td>
                                <td>~1ms (1193182 Hz / 65536)</td>
                                <td>Legacy system timer</td>
                                <td>All x86</td>
                            </tr>
                            <tr>
                                <td><strong>TSC</strong></td>
                                <td>~1 CPU cycle</td>
                                <td>Benchmarking, profiling</td>
                                <td>Pentium+</td>
                            </tr>
                            <tr>
                                <td><strong>HPET</strong></td>
                                <td>~100ns (10+ MHz)</td>
                                <td>High-resolution time</td>
                                <td>Modern (2006+)</td>
                            </tr>
                            <tr>
                                <td><strong>APIC Timer</strong></td>
                                <td>Configurable</td>
                                <td>Per-CPU scheduling</td>
                                <td>SMP systems</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Timer Resolution Comparison -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">              TIMER RESOLUTION COMPARISON (1 second)                         </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">PIT (18.2 Hz default):</span>                                                   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓</span>  (~18 ticks per second)                               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">PIT (1000 Hz mode):</span>                                                      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓...▓▓▓▓▓▓</span> (1000 ticks)                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #bd93f9;">HPET (14.3 MHz):</span>                                                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓</span>             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">(14.3 million ticks - shown compressed)</span>                                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">TSC (3 GHz CPU):</span>                                                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">(3 billion cycles - ultimate resolution)</span>                                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <p>Different timer sources serve different purposes:</p>
                    <ul>
                        <li><strong>System timer (PIT/HPET)</strong>: Drives the scheduler, maintains system time</li>
                        <li><strong>APIC timer</strong>: Per-CPU timer for multiprocessor scheduling</li>
                        <li><strong>TSC</strong>: Ultra-high resolution for benchmarking (but may not be constant across CPUs)</li>
                        <li><strong>HPET</strong>: Best of both worlds—high resolution and system-wide consistency</li>
                    </ul>
                </div>

                <!-- PS/2 Mouse Section -->
                <div id="ps2-mouse" class="blog-content mt-5">
                    <h2><i class="fas fa-computer-mouse me-2 text-teal"></i>PS/2 Mouse Driver</h2>
                    
                    <p>The PS/2 mouse interface dates back to IBM's PS/2 computers (1987), but remains supported on virtually all PCs through USB-to-PS/2 emulation. It's the simplest way to add mouse support to your OS—no USB stack required!</p>

                    <h3 id="mouse-protocol">Mouse Protocol</h3>
                    
                    <p>The PS/2 mouse communicates through the same 8042 keyboard controller we used for keyboard input, but uses a separate data channel (the "auxiliary" port). Think of it like having two phone lines through one switchboard:</p>

                    <!-- 8042 Controller Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                   8042 KEYBOARD CONTROLLER                                  </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                        <span style="color: #f8f8f2;">┌────────────────────────┐</span>                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #50fa7b;">┌──────────┐</span>        <span style="color: #f8f8f2;">│     8042 Controller    │</span>        <span style="color: #8be9fd;">┌──────────┐</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #50fa7b;">│ Keyboard │</span>────────<span style="color: #f8f8f2;">│  Port 0x60: Data       │</span>────────<span style="color: #8be9fd;">│   CPU    │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #50fa7b;">│  (IRQ 1) │</span>        <span style="color: #f8f8f2;">│  Port 0x64: Command    │</span>        <span style="color: #8be9fd;">│          │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #50fa7b;">└──────────┘</span>        <span style="color: #f8f8f2;">│                        │</span>        <span style="color: #8be9fd;">└──────────┘</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                        <span style="color: #f8f8f2;">│  ┌─────────────────┐  │</span>                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #ff79c6;">┌──────────┐</span>        <span style="color: #f8f8f2;">│  │  Status Register │  │</span>                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #ff79c6;">│  Mouse   │</span>────────<span style="color: #f8f8f2;">│  │  Bit 0: Output   │  │</span>                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #ff79c6;">│ (IRQ 12) │</span>        <span style="color: #f8f8f2;">│  │  Bit 1: Input    │  │</span>                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #ff79c6;">└──────────┘</span>        <span style="color: #f8f8f2;">│  │  Bit 5: Aux data │  │</span>                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                        <span style="color: #f8f8f2;">│  └─────────────────┘  │</span>                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                        <span style="color: #f8f8f2;">└────────────────────────┘</span>                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">Commands to 0x64:</span>                    <span style="color: #6272a4;">Data via 0x60:</span>                      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">0xA8</span> = Enable auxiliary (mouse)     <span style="color: #f1fa8c;">0xF4</span> = Enable data reporting         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">0xA9</span> = Disable auxiliary            <span style="color: #f1fa8c;">0xF5</span> = Disable data reporting        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">0xD4</span> = Write to auxiliary device    <span style="color: #f1fa8c;">0xF6</span> = Set defaults                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">0x20</span> = Read controller config       <span style="color: #f1fa8c;">0xFF</span> = Reset mouse                   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <p>Before sending data to the mouse or reading from it, we must check the controller's status register:</p>

                    <pre><code class="language-c">/* Wait for 8042 controller to be ready */
static void mouse_wait(int type) {
    int timeout = 100000;
    while (timeout--) {
        if (type == 0) {
            // Wait for output buffer full (data ready to read)
            if (inb(0x64) & 0x01) return;
        } else {
            // Wait for input buffer empty (ready to receive command)
            if (!(inb(0x64) & 0x02)) return;
        }
    }
}

/* Write command to mouse */
static void mouse_write(uint8_t data) {
    mouse_wait(1);
    outb(0x64, 0xD4);   // Tell controller: next byte goes to mouse
    mouse_wait(1);
    outb(0x60, data);   // Send the actual command
}

/* Read response from mouse */
static uint8_t mouse_read(void) {
    mouse_wait(0);
    return inb(0x60);
}
</code></pre>

                    <p>The initialization sequence enables the mouse and tells the controller to generate IRQ 12 when mouse data arrives:</p>

                    <pre><code class="language-c">/* PS/2 Mouse State */
typedef struct {
    int x, y;               // Current position
    uint8_t buttons;        // Button state
    int8_t  packet[3];      // Current packet
    uint8_t cycle;          // Packet byte index (0-2)
} mouse_t;

mouse_t mouse = {0};

/* Initialize PS/2 mouse */
void mouse_init(void) {
    // Enable auxiliary device (mouse)
    mouse_wait(1);
    outb(0x64, 0xA8);
    
    // Enable interrupts
    mouse_wait(1);
    outb(0x64, 0x20);
    mouse_wait(0);
    uint8_t status = inb(0x60) | 2;
    mouse_wait(1);
    outb(0x64, 0x60);
    mouse_wait(1);
    outb(0x60, status);
    
    // Use default settings
    mouse_write(0xF6);
    mouse_read();
    
    // Enable data reporting
    mouse_write(0xF4);
    mouse_read();
}
</code></pre>
                    
                    <h3 id="mouse-packets">Packet Format</h3>
                    
                    <p>PS/2 mice send data in 3-byte packets. Each packet contains button state, X movement, and Y movement. The tricky part is that movement values are <strong>signed 9-bit</strong> numbers!</p>

                    <!-- Mouse Packet Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                   PS/2 MOUSE PACKET FORMAT (3 bytes)                        </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">BYTE 0 (Status/Buttons):</span>                                                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌───┬───┬───┬───┬───┬───┬───┬───┐</span>                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│YOF│XOF│YSN│XSN│ 1 │MID│RGT│LFT│</span>                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└───┴───┴───┴───┴───┴───┴───┴───┘</span>                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    <span style="color: #6272a4;">7   6   5   4   3   2   1   0</span>                                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">BYTE 1 (X Movement):</span>  Lower 8 bits of X delta                            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌───┬───┬───┬───┬───┬───┬───┬───┐</span>                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│ X7│ X6│ X5│ X4│ X3│ X2│ X1│ X0│</span>  Range: -256 to +255                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└───┴───┴───┴───┴───┴───┴───┴───┘</span>  (9th bit = XSN in byte 0)             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #bd93f9;">BYTE 2 (Y Movement):</span>  Lower 8 bits of Y delta                            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌───┬───┬───┬───┬───┬───┬───┬───┐</span>                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│ Y7│ Y6│ Y5│ Y4│ Y3│ Y2│ Y1│ Y0│</span>  Range: -256 to +255                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└───┴───┴───┴───┴───┴───┴───┴───┘</span>  (9th bit = YSN in byte 0)             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">STATUS BITS:</span>                                                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">LFT</span> (bit 0) = Left button pressed                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">RGT</span> (bit 1) = Right button pressed                                       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">MID</span> (bit 2) = Middle button pressed                                      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">Bit 3</span>       = Always 1 (sync marker)                                     <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">XSN</span> (bit 4) = X sign bit (1 = negative)                                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">YSN</span> (bit 5) = Y sign bit (1 = negative)                                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">XOF</span> (bit 6) = X overflow (movement too fast)                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">YOF</span> (bit 7) = Y overflow (movement too fast)                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Sync Marker:</strong> Bit 3 of byte 0 is always 1. If you see a byte with bit 3 clear, you've lost synchronization—discard bytes until you find one with bit 3 set.
                    </div>

                    <p>The IRQ 12 handler assembles packets one byte at a time. When all three bytes arrive, we process the complete packet:</p>

                    <pre><code class="language-c">/* Mouse IRQ12 Handler */
void mouse_handler(void) {
    uint8_t data = inb(0x60);
    
    switch (mouse.cycle) {
        case 0:
            // Byte 0: buttons + signs + overflow
            if (data & 0x08) {  // Must have bit 3 set
                mouse.packet[0] = data;
                mouse.cycle++;
            }
            break;
        case 1:
            // Byte 1: X movement
            mouse.packet[1] = data;
            mouse.cycle++;
            break;
        case 2:
            // Byte 2: Y movement - complete packet
            mouse.packet[2] = data;
            mouse.cycle = 0;
            
            // Update mouse state
            mouse.buttons = mouse.packet[0] & 0x07;
            
            int dx = mouse.packet[1];
            int dy = mouse.packet[2];
            
            // Handle sign extension
            if (mouse.packet[0] & 0x10) dx |= 0xFFFFFF00;
            if (mouse.packet[0] & 0x20) dy |= 0xFFFFFF00;
            
            // Update position (invert Y for screen coords)
            mouse.x = clamp(mouse.x + dx, 0, screen_width - 1);
            mouse.y = clamp(mouse.y - dy, 0, screen_height - 1);
            
            // Notify window manager
            wm_mouse_event(mouse.x, mouse.y, mouse.buttons);
            break;
    }
    
    pic_send_eoi(12);
}
</code></pre>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Y-Axis Inversion:</strong> The mouse reports +Y as "up" but screen coordinates have Y increasing downward. We subtract dy instead of adding it!
                    </div>
                    
                    <h3 id="cursor">Cursor Rendering</h3>
                    
                    <p>Rendering a mouse cursor requires careful handling. The cursor must appear on top of everything, move smoothly, and not leave visual artifacts. There are two approaches:</p>

                    <!-- Cursor Rendering Approaches -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">               CURSOR RENDERING APPROACHES                                   </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">SOFTWARE CURSOR (simple, portable):</span>                                      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│   Screen with   │      │  Save rect at   │      │  Draw cursor    │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│    windows      │─────▶│  old cursor pos │─────▶│  at new pos     │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│                 │      │  to buffer      │      │                 │</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└─────────────────┘      └─────────────────┘      └─────────────────┘</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                    │                       │              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                    └───────────────────────┘              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                           <span style="color: #6272a4;">On next move: restore old, save new, draw new</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">HARDWARE CURSOR (VGA/GPU feature):</span>                                       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌─────────────────┐      ┌─────────────────┐</span>                            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│   GPU overlays  │      │   Just update   │</span>  <span style="color: #6272a4;">No background save/restore</span> <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│  cursor sprite  │─────▶│   position reg  │</span>  <span style="color: #6272a4;">Hardware handles blending</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│   on scanout    │      │   (one write!)  │</span>  <span style="color: #6272a4;">Very fast and tear-free</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└─────────────────┘      └─────────────────┘</span>                            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <p>Here's a software cursor implementation with background preservation:</p>

                    <pre><code class="language-c">/* Mouse cursor data (16x16 pixels) */
typedef struct {
    int hotspot_x, hotspot_y;  // Click point offset
    uint32_t pixels[16][16];   // ARGB data (alpha for transparency)
    uint32_t background[16][16]; // Saved screen content
    int saved_x, saved_y;      // Position of saved background
} cursor_t;

/* Default arrow cursor bitmap */
static const uint8_t cursor_arrow[16][16] = {
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
    {1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
    {1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0},
    {1,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0},
    {1,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0},
    {1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0},
    {1,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0},
    {1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0},
    {1,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0},
    {1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0},
    {1,2,1,1,2,2,1,0,0,0,0,0,0,0,0,0},
    {1,1,0,0,1,2,1,0,0,0,0,0,0,0,0,0},
    {0,0,0,0,0,1,2,1,0,0,0,0,0,0,0,0},
    {0,0,0,0,0,1,2,1,0,0,0,0,0,0,0,0},
    {0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
};  // 0=transparent, 1=black, 2=white

cursor_t cursor;

/* Save screen area under cursor */
void cursor_save_background(int x, int y) {
    cursor.saved_x = x;
    cursor.saved_y = y;
    
    for (int dy = 0; dy < 16; dy++) {
        for (int dx = 0; dx < 16; dx++) {
            int px = x + dx, py = y + dy;
            if (px >= 0 && px < screen_width && py >= 0 && py < screen_height) {
                cursor.background[dy][dx] = get_pixel(px, py);
            }
        }
    }
}

/* Restore screen area from saved background */
void cursor_restore_background(void) {
    int x = cursor.saved_x, y = cursor.saved_y;
    
    for (int dy = 0; dy < 16; dy++) {
        for (int dx = 0; dx < 16; dx++) {
            int px = x + dx, py = y + dy;
            if (px >= 0 && px < screen_width && py >= 0 && py < screen_height) {
                put_pixel(px, py, cursor.background[dy][dx]);
            }
        }
    }
}

/* Draw cursor at position */
void cursor_draw(int x, int y) {
    cursor_save_background(x, y);
    
    for (int dy = 0; dy < 16; dy++) {
        for (int dx = 0; dx < 16; dx++) {
            uint8_t pixel = cursor_arrow[dy][dx];
            if (pixel == 0) continue;  // Transparent
            
            int px = x + dx, py = y + dy;
            if (px >= 0 && px < screen_width && py >= 0 && py < screen_height) {
                uint32_t color = (pixel == 1) ? 0x000000 : 0xFFFFFF;
                put_pixel(px, py, color);
            }
        }
    }
}

/* Update cursor position (called from mouse handler) */
void cursor_move(int new_x, int new_y) {
    cursor_restore_background();
    cursor_draw(new_x, new_y);
}
</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Double Buffering Integration:</strong> With double buffering from Phase 13, cursor handling becomes simpler—just redraw the entire scene including cursor each frame, then flip buffers. No save/restore needed!
                    </div>
                </div>

                <!-- USB HID Section -->
                <div id="usb-hid" class="blog-content mt-5">
                    <h2><i class="fas fa-usb me-2 text-teal"></i>USB HID Input</h2>
                    
                    <p>While PS/2 is simpler, most modern keyboards and mice use <strong>USB HID</strong> (Human Interface Device). USB is significantly more complex—it requires a host controller driver (UHCI, OHCI, EHCI, or xHCI), device enumeration, and understanding of USB descriptors.</p>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Complexity Warning:</strong> A full USB stack is thousands of lines of code. Here we'll cover the concepts and provide a simplified overview. Most hobbyist OS projects rely on PS/2 emulation (BIOS legacy support) initially.
                    </div>
                    
                    <h3 id="usb-basics">USB Basics</h3>
                    
                    <p>USB uses a hierarchical architecture with a host controller at the top:</p>

                    <!-- USB Architecture Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                     USB ARCHITECTURE                                        </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                       <span style="color: #50fa7b;">┌───────────────────┐</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                       <span style="color: #50fa7b;">│   USB Host        │</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                       <span style="color: #50fa7b;">│   Controller      │</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                       <span style="color: #50fa7b;">│  (xHCI/EHCI/...)  │</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                       <span style="color: #50fa7b;">└─────────┬─────────┘</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                 │                                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>              <span style="color: #8be9fd;">┌──────────────────┼──────────────────┐</span>                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>              │                  │                  │                       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>         <span style="color: #bd93f9;">┌────┴────┐</span>       <span style="color: #ff79c6;">┌────┴────┐</span>       <span style="color: #f1fa8c;">┌────┴────┐</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>         <span style="color: #bd93f9;">│  Root   │</span>       <span style="color: #ff79c6;">│   USB   │</span>       <span style="color: #f1fa8c;">│   USB   │</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>         <span style="color: #bd93f9;">│   Hub   │</span>       <span style="color: #ff79c6;">│   Hub   │</span>       <span style="color: #f1fa8c;">│ Device  │</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>         <span style="color: #bd93f9;">└────┬────┘</span>       <span style="color: #ff79c6;">└────┬────┘</span>       <span style="color: #f1fa8c;">│(direct) │</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>              │                  │            <span style="color: #f1fa8c;">└─────────┘</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #6272a4;">┌─────┴─────┐</span>      <span style="color: #6272a4;">┌────┴────┐</span>                                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        │           │      │         │                                     <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #ffb86c;">┌────┴────┐</span> <span style="color: #ffb86c;">┌────┴────┐</span> <span style="color: #ffb86c;">┌──┴──┐</span>                                     <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #ffb86c;">│Keyboard │</span> <span style="color: #ffb86c;">│  Mouse  │</span> <span style="color: #ffb86c;">│Flash│</span>  <span style="color: #6272a4;">Devices identified by:</span>              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #ffb86c;">│  HID    │</span> <span style="color: #ffb86c;">│  HID    │</span> <span style="color: #ffb86c;">│Drive│</span>  <span style="color: #6272a4;">• Vendor ID (VID)</span>                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>   <span style="color: #ffb86c;">└─────────┘</span> <span style="color: #ffb86c;">└─────────┘</span> <span style="color: #ffb86c;">└─────┘</span>  <span style="color: #6272a4;">• Product ID (PID)</span>                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                       <span style="color: #6272a4;">• Class/Subclass/Protocol</span>           <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Controller</th>
                                <th>USB Speed</th>
                                <th>Era</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>UHCI</strong></td>
                                <td>USB 1.x (12 Mbps)</td>
                                <td>Intel legacy</td>
                                <td>Simplest, schedule-based</td>
                            </tr>
                            <tr>
                                <td><strong>OHCI</strong></td>
                                <td>USB 1.x (12 Mbps)</td>
                                <td>Non-Intel legacy</td>
                                <td>Hardware does more work</td>
                            </tr>
                            <tr>
                                <td><strong>EHCI</strong></td>
                                <td>USB 2.0 (480 Mbps)</td>
                                <td>2000-2015</td>
                                <td>Companion controllers for 1.x</td>
                            </tr>
                            <tr>
                                <td><strong>xHCI</strong></td>
                                <td>USB 1.x-3.x</td>
                                <td>2010+</td>
                                <td>Modern unified controller</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h3 id="hid-protocol">HID Protocol</h3>
                    
                    <p>HID devices describe their data format using <strong>Report Descriptors</strong>. A keyboard report might look like:</p>

                    <!-- HID Report Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                USB HID KEYBOARD REPORT (8 bytes)                            </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┐</span>               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span><span style="color: #50fa7b;">Mods</span>  <span style="color: #f8f8f2;">│</span><span style="color: #6272a4;">Rsrvd</span> <span style="color: #f8f8f2;">│</span><span style="color: #8be9fd;">Key 0</span> <span style="color: #f8f8f2;">│</span><span style="color: #8be9fd;">Key 1</span> <span style="color: #f8f8f2;">│</span><span style="color: #8be9fd;">Key 2</span> <span style="color: #f8f8f2;">│</span><span style="color: #8be9fd;">Key 3</span> <span style="color: #f8f8f2;">│</span><span style="color: #8be9fd;">Key 4</span> <span style="color: #f8f8f2;">│</span><span style="color: #8be9fd;">Key 5</span> <span style="color: #f8f8f2;">│</span>               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┘</span>               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    <span style="color: #6272a4;">Byte 0  Byte 1  Byte 2  Byte 3  Byte 4  Byte 5  Byte 6  Byte 7</span>         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">Modifier Byte:</span>                          <span style="color: #8be9fd;">Key Bytes (USB Usage IDs):</span>       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">Bit 0</span> = Left Ctrl                        <span style="color: #f1fa8c;">0x04</span> = 'a'                       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">Bit 1</span> = Left Shift                       <span style="color: #f1fa8c;">0x05</span> = 'b'                       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">Bit 2</span> = Left Alt                         <span style="color: #f1fa8c;">...</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">Bit 3</span> = Left GUI (Win key)               <span style="color: #f1fa8c;">0x1D</span> = 'z'                       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">Bit 4</span> = Right Ctrl                       <span style="color: #f1fa8c;">0x28</span> = Enter                     <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">Bit 5</span> = Right Shift                      <span style="color: #f1fa8c;">0x2C</span> = Space                     <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">Bit 6</span> = Right Alt                        <span style="color: #6272a4;">(Up to 6 simultaneous keys)</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">Bit 7</span> = Right GUI                                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <p>A minimal HID keyboard polling function (assuming USB stack is set up):</p>

                    <pre><code class="language-c">/* USB HID Keyboard Report */
typedef struct {
    uint8_t modifiers;      // Ctrl, Shift, Alt, GUI
    uint8_t reserved;       // Always 0
    uint8_t keys[6];        // Up to 6 keys pressed
} __attribute__((packed)) hid_keyboard_report_t;

/* USB HID Mouse Report */
typedef struct {
    uint8_t buttons;        // Button bits
    int8_t x;               // X movement (-127 to +127)
    int8_t y;               // Y movement
    int8_t wheel;           // Scroll wheel (optional)
} __attribute__((packed)) hid_mouse_report_t;

/* Process keyboard report */
void usb_keyboard_process(hid_keyboard_report_t* report) {
    // Check modifiers
    bool shift = (report->modifiers & 0x22);  // Left or right shift
    bool ctrl = (report->modifiers & 0x11);   // Left or right ctrl
    
    // Process each key
    for (int i = 0; i < 6; i++) {
        uint8_t usage = report->keys[i];
        if (usage == 0) continue;  // No key
        
        // Convert USB usage ID to ASCII (simplified)
        char c = 0;
        if (usage >= 0x04 && usage <= 0x1D) {
            c = 'a' + (usage - 0x04);
            if (shift) c = c - 'a' + 'A';
        } else if (usage >= 0x1E && usage <= 0x27) {
            c = '1' + (usage - 0x1E);
            if (usage == 0x27) c = '0';
        }
        
        if (c) keyboard_queue_char(c);
    }
}
</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Practical Approach:</strong> Most BIOS/UEFI systems provide PS/2 emulation for USB keyboards/mice. You can use our PS/2 drivers until you're ready to implement a full USB stack!
                    </div>
                </div>

                <!-- HPET Section -->
                <div id="hpet" class="blog-content mt-5">
                    <h2><i class="fas fa-stopwatch me-2 text-teal"></i>HPET Timer</h2>
                    
                    <p>The <strong>High Precision Event Timer (HPET)</strong> is a modern timer standard (Intel, 2004) that provides significantly higher resolution than the ancient PIT. Think of it as upgrading from a grandfather clock to an atomic clock!</p>
                    
                    <h3 id="hpet-acpi">ACPI Discovery</h3>
                    
                    <p>The HPET is discovered through <strong>ACPI</strong>—there's a dedicated HPET table that tells us where the registers are mapped:</p>

                    <!-- HPET Discovery Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                    HPET DISCOVERY VIA ACPI                                  </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">┌──────────────────┐</span>     <span style="color: #8be9fd;">┌──────────────────┐</span>                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">│   ACPI RSDP      │</span>────▶<span style="color: #8be9fd;">│    ACPI RSDT     │</span>                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">│  (Root pointer)  │</span>     <span style="color: #8be9fd;">│   (Table list)   │</span>                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">└──────────────────┘</span>     <span style="color: #8be9fd;">└────────┬─────────┘</span>                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                    │                                       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>             <span style="color: #6272a4;">┌────────────────────┼────────────────────┐</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>             │                    │                    │                   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #bd93f9;">┌────┴────┐</span>         <span style="color: #ff79c6;">┌────┴────┐</span>         <span style="color: #f1fa8c;">┌────┴────┐</span>            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #bd93f9;">│  MADT   │</span>         <span style="color: #ff79c6;">│  HPET   │</span>         <span style="color: #f1fa8c;">│  FADT   │</span>            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #bd93f9;">│ (APICs) │</span>         <span style="color: #ff79c6;">│ (Timer) │</span>         <span style="color: #f1fa8c;">│ (Power) │</span>            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #bd93f9;">└─────────┘</span>         <span style="color: #ff79c6;">└────┬────┘</span>         <span style="color: #f1fa8c;">└─────────┘</span>            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                  │                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                  ▼                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                         <span style="color: #ffb86c;">┌────────────────┐</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                         <span style="color: #ffb86c;">│  HPET Table    │</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                         <span style="color: #ffb86c;">│ ┌────────────┐ │</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                         <span style="color: #ffb86c;">│ │Base Address│ │</span> → <span style="color: #6272a4;">0xFED00000 (typical)</span>       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                         <span style="color: #ffb86c;">│ │Hardware ID │ │</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                         <span style="color: #ffb86c;">│ │Sequence #  │ │</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                         <span style="color: #ffb86c;">│ │Min tick    │ │</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                         <span style="color: #ffb86c;">│ └────────────┘ │</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                         <span style="color: #ffb86c;">└────────────────┘</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <p>The ACPI HPET table structure:</p>

                    <pre><code class="language-c">/* ACPI HPET Table */
typedef struct {
    acpi_header_t header;    // Standard ACPI header
    uint32_t event_timer_block_id;
    struct {
        uint8_t  address_space_id;  // 0 = memory
        uint8_t  register_bit_width;
        uint8_t  register_bit_offset;
        uint8_t  reserved;
        uint64_t address;           // HPET register base
    } address;
    uint8_t  hpet_number;
    uint16_t minimum_tick;
    uint8_t  page_protection;
} __attribute__((packed)) acpi_hpet_t;

/* HPET Register Structure */
typedef struct {
    uint64_t capabilities;      // General caps and ID
    uint64_t reserved1;
    uint64_t configuration;     // General configuration
    uint64_t reserved2;
    uint64_t interrupt_status;  // General interrupt status
    uint64_t reserved3[25];
    uint64_t main_counter;      // Main counter value
    uint64_t reserved4;
    // Timer comparators follow...
} __attribute__((packed)) hpet_regs_t;

volatile hpet_regs_t* hpet = NULL;

/* Initialize HPET from ACPI */
void hpet_init(acpi_hpet_t* hpet_table) {
    hpet = (hpet_regs_t*)hpet_table->address.address;
    
    // Stop counter during configuration
    hpet->configuration &= ~1;
    
    // Reset main counter
    hpet->main_counter = 0;
    
    // Enable counter
    hpet->configuration |= 1;
    
    // Calculate frequency
    uint32_t period = hpet->capabilities >> 32;  // femtoseconds
    uint64_t freq = 1000000000000000ULL / period;  // Hz
}
</code></pre>
                    
                    <h3 id="hpet-config">Configuration</h3>
                    
                    <p>The HPET has a main counter that increments at a fixed frequency (typically 14.3 MHz or higher), plus multiple <strong>comparator timers</strong> that can trigger interrupts:</p>

                    <!-- HPET Architecture Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                    HPET ARCHITECTURE                                        </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌─────────────────────────────────────────────────────────────────────┐</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>                    <span style="color: #50fa7b;">MAIN COUNTER (64-bit)</span>                            <span style="color: #f8f8f2;">│</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  <span style="color: #8be9fd;">Increments at period specified in CAPABILITIES register</span>            <span style="color: #f8f8f2;">│</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  <span style="color: #6272a4;">Typical: ~70 femtoseconds = ~14.3 MHz</span>                              <span style="color: #f8f8f2;">│</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└───────────────────────────────┬─────────────────────────────────────┘</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                  │                                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>             <span style="color: #6272a4;">┌──────────────────┼──────────────────┐</span>                       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>             │                  │                  │                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #bd93f9;">┌────┴────┐</span>        <span style="color: #ff79c6;">┌────┴────┐</span>        <span style="color: #f1fa8c;">┌────┴────┐</span>                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #bd93f9;">│ Timer 0 │</span>        <span style="color: #ff79c6;">│ Timer 1 │</span>        <span style="color: #f1fa8c;">│ Timer 2 │</span>  <span style="color: #6272a4;">(3-32 timers)</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #bd93f9;">│Comparatr│</span>        <span style="color: #ff79c6;">│Comparatr│</span>        <span style="color: #f1fa8c;">│Comparatr│</span>                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #bd93f9;">└────┬────┘</span>        <span style="color: #ff79c6;">└────┬────┘</span>        <span style="color: #f1fa8c;">└────┬────┘</span>                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>             │                  │                  │                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>             ▼                  ▼                  ▼                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #ffb86c;">┌─────────┐</span>        <span style="color: #ffb86c;">┌─────────┐</span>        <span style="color: #ffb86c;">┌─────────┐</span>                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #ffb86c;">│   IRQ   │</span>        <span style="color: #ffb86c;">│   IRQ   │</span>        <span style="color: #ffb86c;">│   IRQ   │</span>                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #ffb86c;">│ (or MSI)│</span>        <span style="color: #ffb86c;">│ (or MSI)│</span>        <span style="color: #ffb86c;">│ (or MSI)│</span>                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>        <span style="color: #ffb86c;">└─────────┘</span>        <span style="color: #ffb86c;">└─────────┘</span>        <span style="color: #ffb86c;">└─────────┘</span>                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">Each timer can be:</span>                                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">• One-shot:</span> Fire once when counter reaches comparator                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">• Periodic:</span> Auto-reload comparator after fire                            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Register</th>
                                <th>Offset</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Capabilities</strong></td>
                                <td>0x000</td>
                                <td>Period (bits 63-32), vendor ID, timer count</td>
                            </tr>
                            <tr>
                                <td><strong>Configuration</strong></td>
                                <td>0x010</td>
                                <td>Bit 0: Enable counter, Bit 1: Legacy mode</td>
                            </tr>
                            <tr>
                                <td><strong>Main Counter</strong></td>
                                <td>0x0F0</td>
                                <td>64-bit free-running counter</td>
                            </tr>
                            <tr>
                                <td><strong>Timer N Config</strong></td>
                                <td>0x100 + N*0x20</td>
                                <td>Timer mode, IRQ routing, enable</td>
                            </tr>
                            <tr>
                                <td><strong>Timer N Comparator</strong></td>
                                <td>0x108 + N*0x20</td>
                                <td>Value to compare against main counter</td>
                            </tr>
                        </tbody>
                    </table>

                    <p>Here's how to set up a periodic timer using HPET:</p>

                    <pre><code class="language-c">/* HPET Timer N Configuration */
typedef struct {
    uint64_t config;        // Timer configuration
    uint64_t comparator;    // Comparator value
    uint64_t fsb_route;     // FSB interrupt routing (optional)
    uint64_t reserved;
} hpet_timer_t;

static uint64_t hpet_freq;  // Ticks per second

/* Get current time in nanoseconds */
uint64_t hpet_get_ns(void) {
    uint64_t ticks = hpet->main_counter;
    uint32_t period = hpet->capabilities >> 32;  // femtoseconds
    return (ticks * period) / 1000000;  // Convert to ns
}

/* Sleep for given microseconds */
void hpet_sleep_us(uint64_t us) {
    uint32_t period = hpet->capabilities >> 32;
    uint64_t ticks_to_wait = (us * 1000000000ULL) / period;
    uint64_t target = hpet->main_counter + ticks_to_wait;
    
    while (hpet->main_counter < target) {
        // Busy wait (or yield to scheduler in real OS)
    }
}

/* Set up periodic HPET interrupt (1ms) */
void hpet_setup_periodic(uint8_t timer_num, uint8_t irq) {
    hpet_timer_t* timer = (hpet_timer_t*)((uintptr_t)hpet + 0x100 + timer_num * 0x20);
    
    // Calculate ticks for 1ms
    uint32_t period = hpet->capabilities >> 32;
    uint64_t ticks_1ms = 1000000000000ULL / period;  // 1ms in ticks
    
    // Configure timer: periodic, level-triggered, enable interrupts
    timer->config = (irq << 9) |    // IRQ routing
                    (1 << 3) |       // Periodic mode
                    (1 << 2);        // Enable interrupts
                    
    timer->comparator = hpet->main_counter + ticks_1ms;
    
    // Enable timer
    timer->config |= (1 << 2);
}
</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>HPET vs PIT:</strong> HPET is ~70,000x more precise than the PIT at full resolution. Use HPET for high-resolution timing (games, multimedia), PIT for compatibility with older systems.
                    </div>
                </div>

                <!-- APIC Timer Section -->
                <div id="apic-timer" class="blog-content mt-5">
                    <h2><i class="fas fa-microchip me-2 text-teal"></i>APIC Timer</h2>
                    
                    <p>The <strong>Local APIC Timer</strong> is a per-CPU timer built into every x86 processor (from Pentium onwards). Unlike the PIT or HPET which are system-wide, each CPU has its own APIC timer—perfect for SMP scheduling!</p>
                    
                    <h3 id="local-apic">Local APIC</h3>
                    
                    <p>The Local APIC (Advanced Programmable Interrupt Controller) is part of the CPU itself. It handles interrupts locally and includes a built-in timer:</p>

                    <!-- APIC Architecture Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                    LOCAL APIC ARCHITECTURE                                  </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">CPU 0</span>                                    <span style="color: #8be9fd;">CPU 1</span>                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌────────────────────────┐</span>              <span style="color: #f8f8f2;">┌────────────────────────┐</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│         CPU Core       │</span>              <span style="color: #f8f8f2;">│         CPU Core       │</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">├────────────────────────┤</span>              <span style="color: #f8f8f2;">├────────────────────────┤</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>      <span style="color: #bd93f9;">Local APIC</span>        <span style="color: #f8f8f2;">│</span>              <span style="color: #f8f8f2;">│</span>      <span style="color: #bd93f9;">Local APIC</span>        <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  ┌───────────────────┐ <span style="color: #f8f8f2;">│</span>              <span style="color: #f8f8f2;">│</span>  ┌───────────────────┐ <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │ <span style="color: #ff79c6;">APIC Timer</span>        │ <span style="color: #f8f8f2;">│</span>              <span style="color: #f8f8f2;">│</span>  │ <span style="color: #ff79c6;">APIC Timer</span>        │ <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │ • Initial Count   │ <span style="color: #f8f8f2;">│</span>              <span style="color: #f8f8f2;">│</span>  │ • Initial Count   │ <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │ • Current Count   │ <span style="color: #f8f8f2;">│</span>              <span style="color: #f8f8f2;">│</span>  │ • Current Count   │ <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │ • Divider Config  │ <span style="color: #f8f8f2;">│</span>              <span style="color: #f8f8f2;">│</span>  │ • Divider Config  │ <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │ • LVT Entry       │ <span style="color: #f8f8f2;">│</span>              <span style="color: #f8f8f2;">│</span>  │ • LVT Entry       │ <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  └───────────────────┘ <span style="color: #f8f8f2;">│</span>              <span style="color: #f8f8f2;">│</span>  └───────────────────┘ <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │ Interrupt Handler │ <span style="color: #f8f8f2;">│</span>              <span style="color: #f8f8f2;">│</span>  │ Interrupt Handler │ <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  │ IPI Send/Receive  │ <span style="color: #f8f8f2;">│</span>              <span style="color: #f8f8f2;">│</span>  │ IPI Send/Receive  │ <span style="color: #f8f8f2;">│</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└────────────┬───────────┘</span>              <span style="color: #f8f8f2;">└────────────┬───────────┘</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>               │                                      │                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>               <span style="color: #6272a4;">└──────────────┬───────────────────────┘</span>                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                              │                                            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                     <span style="color: #f1fa8c;">┌────────┴────────┐</span>                                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                     <span style="color: #f1fa8c;">│    I/O APIC     │</span>  <span style="color: #6272a4;">Routes external IRQs</span>            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                     <span style="color: #f1fa8c;">│  (Motherboard)  │</span>  <span style="color: #6272a4;">to CPU Local APICs</span>             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                     <span style="color: #f1fa8c;">└─────────────────┘</span>                                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <p>The Local APIC is memory-mapped (default base: 0xFEE00000). Key timer-related registers:</p>

                    <pre><code class="language-c">/* Local APIC Registers (relative to base) */
#define LAPIC_ID        0x020   // APIC ID
#define LAPIC_TPR       0x080   // Task Priority
#define LAPIC_EOI       0x0B0   // End of Interrupt
#define LAPIC_SVR       0x0F0   // Spurious Vector
#define LAPIC_TIMER_LVT 0x320   // Timer Local Vector Table
#define LAPIC_TIMER_ICR 0x380   // Timer Initial Count
#define LAPIC_TIMER_CCR 0x390   // Timer Current Count
#define LAPIC_TIMER_DCR 0x3E0   // Timer Divide Configuration

volatile uint32_t* lapic_base = NULL;

/* Read LAPIC register */
static inline uint32_t lapic_read(uint32_t reg) {
    return lapic_base[reg / 4];
}

/* Write LAPIC register */
static inline void lapic_write(uint32_t reg, uint32_t val) {
    lapic_base[reg / 4] = val;
}
</code></pre>

                    <p>The Timer LVT (Local Vector Table) register controls timer behavior:</p>

                    <!-- Timer LVT Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">            APIC TIMER LVT REGISTER (0x320)                                  </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌────┬────┬────────┬───────┬─────────────────────────────────────────┐</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span><span style="color: #6272a4;">Rsvd</span><span style="color: #f8f8f2;">│</span><span style="color: #ff79c6;">Mode</span> <span style="color: #f8f8f2;">│</span> <span style="color: #8be9fd;">Mask</span>   <span style="color: #f8f8f2;">│</span> <span style="color: #bd93f9;">Status</span> <span style="color: #f8f8f2;">│</span>        <span style="color: #50fa7b;">Vector (bits 0-7)</span>             <span style="color: #f8f8f2;">│</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└────┴────┴────────┴───────┴─────────────────────────────────────────┘</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>     <span style="color: #6272a4;">31-19  17-18   16       12        7-0</span>                                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">Timer Mode (bits 17-18):</span>                                                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    <span style="color: #f1fa8c;">00</span> = One-shot (fire once, then stop)                                   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    <span style="color: #f1fa8c;">01</span> = Periodic (auto-reload Initial Count)                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    <span style="color: #f1fa8c;">10</span> = TSC-Deadline (fire when TSC reaches value)                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">Mask (bit 16):</span>                                                           <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    <span style="color: #f1fa8c;">0</span> = Interrupt enabled                                                   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    <span style="color: #f1fa8c;">1</span> = Interrupt disabled (masked)                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">Vector (bits 0-7):</span> IDT entry to invoke (32-255)                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>
                    
                    <h3 id="timer-calibration">Calibration</h3>
                    
                    <p>Unlike the PIT which runs at a known frequency (1.193182 MHz), the APIC timer's frequency depends on the CPU bus speed. We must <strong>calibrate</strong> it using a known time source:</p>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Calibration Strategy:</strong> Start the APIC timer, wait a known time using PIT (or HPET), then calculate how many APIC ticks elapsed. This tells us the timer's actual frequency.
                    </div>

                    <pre><code class="language-c">static uint32_t lapic_ticks_per_ms;  // Calibrated value

/* Calibrate APIC timer using PIT */
void lapic_timer_calibrate(void) {
    // Set divider to 16
    lapic_write(LAPIC_TIMER_DCR, 0x03);
    
    // Set initial count to max
    lapic_write(LAPIC_TIMER_ICR, 0xFFFFFFFF);
    
    // Wait 10ms using PIT
    pit_wait_ms(10);
    
    // Stop timer
    lapic_write(LAPIC_TIMER_LVT, 0x10000);
    
    // Calculate ticks per ms
    uint32_t elapsed = 0xFFFFFFFF - lapic_read(LAPIC_TIMER_CCR);
    lapic_ticks_per_ms = elapsed / 10;
    
    // Set up periodic timer (1ms interval)
    lapic_write(LAPIC_TIMER_LVT, 32 | 0x20000);  // Vector 32, periodic
    lapic_write(LAPIC_TIMER_DCR, 0x03);          // Divide by 16
    lapic_write(LAPIC_TIMER_ICR, lapic_ticks_per_ms);  // 1ms interval
}

/* Helper: Wait using PIT Channel 2 */
void pit_wait_ms(uint32_t ms) {
    // PIT frequency = 1193182 Hz
    // For ms milliseconds, need (1193182 / 1000) * ms ticks
    uint32_t ticks = (1193182 / 1000) * ms;
    
    // Configure PIT channel 2 for one-shot
    outb(0x61, (inb(0x61) & 0xFD) | 1);  // Enable gate
    outb(0x43, 0xB2);                     // Channel 2, mode 0
    outb(0x42, ticks & 0xFF);
    outb(0x42, ticks >> 8);
    
    // Wait for output to go high
    while (!(inb(0x61) & 0x20));
}
</code></pre>

                    <p>For SMP systems, each CPU needs its own timer. The APIC timer is perfect because each CPU's Local APIC has its own timer:</p>

                    <pre><code class="language-c">/* Initialize APIC timer on current CPU */
void lapic_timer_init_this_cpu(void) {
    // First CPU calibrates; others use the same value
    static bool calibrated = false;
    
    if (!calibrated) {
        lapic_timer_calibrate();
        calibrated = true;
    }
    
    // Set up periodic 1ms timer on this CPU
    lapic_write(LAPIC_TIMER_LVT, TIMER_VECTOR | 0x20000);  // Periodic
    lapic_write(LAPIC_TIMER_DCR, 0x03);                     // Divide by 16
    lapic_write(LAPIC_TIMER_ICR, lapic_ticks_per_ms);       // 1ms interval
}

/* Timer interrupt handler (runs on each CPU) */
void timer_handler(void) {
    // Update per-CPU tick counter
    cpu_local_t* cpu = get_cpu_local();
    cpu->ticks++;
    
    // Check if current process time slice expired
    if (current_process && --current_process->time_left == 0) {
        current_process->time_left = TIME_SLICE;
        schedule();  // Switch to next process
    }
    
    lapic_write(LAPIC_EOI, 0);  // End of interrupt
}
</code></pre>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>SMP Note:</strong> When using APIC timer for scheduling, remember to calibrate before bringing up other CPUs. TSC-deadline mode (modern CPUs) can avoid calibration entirely!
                    </div>
                </div>

                <!-- What You Can Build Section -->
                <div id="build" class="blog-content mt-5">
                    <h2><i class="fas fa-hammer me-2 text-teal"></i>What You Can Build</h2>
                    
                    <div class="highlight-box">
                        <i class="fas fa-rocket me-2"></i>
                        <strong>Phase 14 Project:</strong> A fully interactive graphical OS! Your system now has mouse support for clicking windows, dragging, and GUI interaction. High-precision timers enable smooth animations and accurate scheduling.
                    </div>
                    
                    <p>Here's a complete demo that brings together mouse input and precision timing to create an interactive drawing application:</p>

                    <pre><code class="language-c">/* interactive_demo.c - Mouse + Timing Demo */
#include "mouse.h"
#include "hpet.h"
#include "graphics.h"

#define CANVAS_X 50
#define CANVAS_Y 50
#define CANVAS_W 700
#define CANVAS_H 500

typedef struct {
    uint32_t fg_color;
    uint32_t bg_color;
    int brush_size;
    bool drawing;
    uint64_t last_frame_time;
    uint32_t frame_count;
    uint32_t fps;
} app_state_t;

app_state_t app = {
    .fg_color = 0x000000,
    .bg_color = 0xFFFFFF,
    .brush_size = 3,
    .drawing = false
};

/* Color palette */
uint32_t palette[] = {
    0x000000, 0xFF0000, 0x00FF00, 0x0000FF,
    0xFFFF00, 0xFF00FF, 0x00FFFF, 0xFFFFFF
};

void draw_toolbar(void) {
    // Draw palette
    for (int i = 0; i < 8; i++) {
        int x = 10 + i * 35;
        fill_rect(x, 10, 30, 30, palette[i]);
        draw_rect(x, 10, 30, 30, 0x000000);
    }
    
    // Draw brush size indicator
    draw_printf(320, 15, 0x000000, "Brush: %d", app.brush_size);
    
    // Draw FPS counter
    draw_printf(450, 15, 0x008000, "FPS: %d", app.fps);
    
    // Draw canvas border
    draw_rect(CANVAS_X - 1, CANVAS_Y - 1, CANVAS_W + 2, CANVAS_H + 2, 0x000000);
}

void handle_mouse_click(int x, int y) {
    // Check palette clicks
    for (int i = 0; i < 8; i++) {
        int px = 10 + i * 35;
        if (x >= px && x < px + 30 && y >= 10 && y < 40) {
            app.fg_color = palette[i];
            return;
        }
    }
}

void draw_brush(int x, int y) {
    // Only draw inside canvas
    if (x < CANVAS_X || x >= CANVAS_X + CANVAS_W ||
        y < CANVAS_Y || y >= CANVAS_Y + CANVAS_H) {
        return;
    }
    
    // Draw filled circle at cursor
    fill_circle(x, y, app.brush_size, app.fg_color);
}

void update_fps(void) {
    uint64_t now = hpet_get_ns();
    app.frame_count++;
    
    // Update FPS every second
    if (now - app.last_frame_time >= 1000000000ULL) {
        app.fps = app.frame_count;
        app.frame_count = 0;
        app.last_frame_time = now;
    }
}

void interactive_demo(void) {
    // Initialize subsystems
    graphics_init();
    mouse_init();
    hpet_init_from_acpi();
    
    // Clear canvas
    fill_rect(CANVAS_X, CANVAS_Y, CANVAS_W, CANVAS_H, app.bg_color);
    draw_toolbar();
    
    app.last_frame_time = hpet_get_ns();
    
    while (1) {
        // Process mouse state
        int mx = mouse.x, my = mouse.y;
        uint8_t buttons = mouse.buttons;
        
        // Handle left button for drawing
        if (buttons & 0x01) {
            if (!app.drawing) {
                handle_mouse_click(mx, my);
                app.drawing = true;
            }
            draw_brush(mx, my);
        } else {
            app.drawing = false;
        }
        
        // Handle right button for eraser
        if (buttons & 0x02) {
            uint32_t old_color = app.fg_color;
            app.fg_color = app.bg_color;
            draw_brush(mx, my);
            app.fg_color = old_color;
        }
        
        // Handle middle button for brush size
        static bool mid_pressed = false;
        if ((buttons & 0x04) && !mid_pressed) {
            app.brush_size = (app.brush_size % 10) + 1;
            mid_pressed = true;
            draw_toolbar();
        } else if (!(buttons & 0x04)) {
            mid_pressed = false;
        }
        
        // Draw cursor
        draw_rect(mx - 1, my - 1, 3, 3, 0xFF0000);
        
        // Update display
        gfx_flip();
        update_fps();
        
        // Cap frame rate to 60 FPS (~16.7ms per frame)
        hpet_sleep_us(16667);
    }
}
</code></pre>

                    <h3 class="mt-4"><i class="fas fa-dumbbell me-2"></i>Exercises</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-scroll me-2"></i>Exercise 1: Scroll Wheel Support</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">Input</span>
                            <span class="badge bg-crimson">Medium</span>
                        </div>
                        <div class="content">
                            <p>Extend the PS/2 mouse driver to support scroll wheel (IntelliMouse protocol):</p>
                            <ol>
                                <li>Send the "magic sequence" (set sample rate: 200, 100, 80) to enable scroll wheel</li>
                                <li>Mouse packets become 4 bytes (byte 3 = scroll delta)</li>
                                <li>Handle the Z-axis data in your mouse handler</li>
                                <li>Test by zooming in/out on the canvas</li>
                            </ol>
                            <pre><code class="language-c">// Enable IntelliMouse scroll wheel
void mouse_enable_scroll(void) {
    mouse_set_sample_rate(200);
    mouse_set_sample_rate(100);
    mouse_set_sample_rate(80);
    // Now packets are 4 bytes with scroll in byte 3
}</code></pre>
                        </div>
                    </div>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-clock me-2"></i>Exercise 2: Animation System</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">Timing</span>
                            <span class="badge bg-crimson">Medium</span>
                        </div>
                        <div class="content">
                            <p>Create a simple animation system using HPET for timing:</p>
                            <ol>
                                <li>Define an <code>animation_t</code> struct with start_time, duration, start_value, end_value</li>
                                <li>Implement <code>animation_update()</code> to calculate current value based on elapsed time</li>
                                <li>Support easing functions (linear, ease-in, ease-out)</li>
                                <li>Animate a window moving across the screen at 60 FPS</li>
                            </ol>
                            <pre><code class="language-c">// Animation easing functions
float ease_linear(float t) { return t; }
float ease_in_quad(float t) { return t * t; }
float ease_out_quad(float t) { return t * (2 - t); }</code></pre>
                        </div>
                    </div>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-mouse me-2"></i>Exercise 3: Custom Cursors</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">Graphics</span>
                            <span class="badge bg-crimson">Easy</span>
                        </div>
                        <div class="content">
                            <p>Implement context-sensitive cursors:</p>
                            <ol>
                                <li>Create multiple cursor bitmaps (arrow, hand, resize, text)</li>
                                <li>Track which cursor should be used based on mouse position</li>
                                <li>Change cursor when over clickable items (hand), resize borders (resize arrows), etc.</li>
                                <li>Implement smooth cursor animation (e.g., loading spinner)</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-gamepad me-2"></i>Exercise 4: Double-Click Detection</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">Input + Timing</span>
                            <span class="badge bg-crimson">Medium</span>
                        </div>
                        <div class="content">
                            <p>Implement double-click detection using HPET:</p>
                            <ol>
                                <li>Record timestamp of each click using <code>hpet_get_ns()</code></li>
                                <li>If two clicks are within 500ms and 5 pixels of each other, it's a double-click</li>
                                <li>Generate separate events for single-click, double-click, and triple-click</li>
                                <li>Test by double-clicking to select words in a text editor</li>
                            </ol>
                            <pre><code class="language-c">// Double-click detection state
typedef struct {
    uint64_t last_click_time;
    int last_click_x, last_click_y;
    int click_count;
} click_state_t;</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Next Steps Section -->
                <div id="next-steps" class="blog-content mt-5">
                    <h2><i class="fas fa-arrow-right me-2 text-teal"></i>Next Steps</h2>
                    
                    <p>With input and timing in place, your OS is now truly interactive! In Phase 15, we'll discover and interact with hardware—enumerating PCI devices, writing device drivers, and accessing modern storage like NVMe.</p>

                    <!-- Phase Transition Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                    PHASE 14 → PHASE 15 TRANSITION                           </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">Phase 14 Achievements:</span>                     <span style="color: #8be9fd;">Phase 15 Goals:</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌────────────────────────┐</span>               <span style="color: #f8f8f2;">┌────────────────────────┐</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│ ✓ PS/2 Mouse Driver   │</span>               <span style="color: #f8f8f2;">│ ○ PCI Enumeration     │</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│ ✓ Cursor Rendering    │</span>               <span style="color: #f8f8f2;">│ ○ Driver Model        │</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│ ✓ USB HID Concepts    │</span>───────────────<span style="color: #f8f8f2;">│ ○ NVMe/AHCI Storage   │</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│ ✓ HPET High-Res Timer │</span>               <span style="color: #f8f8f2;">│ ○ Network Cards       │</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│ ✓ APIC Timer per-CPU  │</span>               <span style="color: #f8f8f2;">│ ○ GPU Discovery       │</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│ ✓ Interactive Demo    │</span>               <span style="color: #f8f8f2;">│ ○ Hot-Plug Support    │</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└────────────────────────┘</span>               <span style="color: #f8f8f2;">└────────────────────────┘</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Concept</th>
                                <th>What You Learned</th>
                                <th>Used In Phase 15</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>PS/2 Protocol</strong></td>
                                <td>8042 controller, packet format, IRQ handling</td>
                                <td>Device driver patterns</td>
                            </tr>
                            <tr>
                                <td><strong>HPET</strong></td>
                                <td>ACPI discovery, high-res timing, comparators</td>
                                <td>Timeout handling in drivers</td>
                            </tr>
                            <tr>
                                <td><strong>APIC Timer</strong></td>
                                <td>Per-CPU timers, calibration, SMP scheduling</td>
                                <td>Driver polling, DMA timeouts</td>
                            </tr>
                            <tr>
                                <td><strong>USB Concepts</strong></td>
                                <td>HID protocol, descriptors, reports</td>
                                <td>USB host controller drivers</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Related Posts -->
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Phase 13: Graphics & GUI Systems</h5>
                            <p class="text-muted small mb-2">Review framebuffer graphics and window management.</p>
                            <a href="kernel-dev-phase-13-graphics.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Phase 15: Hardware Discovery & Drivers</h5>
                            <p class="text-muted small mb-2">Enumerate PCI devices and write drivers.</p>
                            <a href="kernel-dev-phase-15-hardware-drivers.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Phase 16: Performance & Optimization</h5>
                            <p class="text-muted small mb-2">Tune the scheduler and implement caching.</p>
                            <a href="kernel-dev-phase-16-performance.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">
                        I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest">
                            <i class="fab fa-pinterest-p"></i>
                        </a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <hr class="bg-secondary">

            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small">
                        <i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a>
                    </p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">
                        Enjoying this content? ☕ <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Scroll-to-Top Button -->
    <button id="scrollToTop" class="scroll-to-top" title="Back to Top">
        <i class="fas fa-arrow-up"></i>
    </button>
    <!-- Category Indicator -->
    <div id="categoryIndicator" class="category-indicator" title="Current Section">
        <i class="fas fa-tag"></i><span id="categoryText">Technology</span>
    </div>
    
    <!-- Cookie Consent JS -->
    <script src="../../../js/cookie-consent.js"></script>
    
    <!-- Main JS -->
    <script src="../../../js/main.js"></script>

    <!-- Prism.js Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-nasm.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
</body>
</html>
