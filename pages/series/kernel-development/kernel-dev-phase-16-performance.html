<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kernel Development Series - Phase 16: Performance & Optimization | Wasil Zafar</title>
    <meta name="description" content="Optimize your OS with caching strategies, scheduler tuning, memory optimizations, and profiling tools for maximum performance.">
    <meta name="keywords" content="kernel development, performance, optimization, caching, scheduler, profiling, OS development">
    <meta name="author" content="Wasil Zafar">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Kernel Development Series - Phase 16: Performance & Optimization">
    <meta property="og:description" content="Optimize your OS with caching strategies, scheduler tuning, memory optimizations, and profiling tools for maximum performance.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://wasilzafar.com/pages/series/kernel-development/kernel-dev-phase-16-performance.html">
    <meta property="og:image" content="https://wasilzafar.com/images/og-kernel-dev.png">
    <meta property="article:published_time" content="2026-02-06">
    <meta property="article:author" content="Wasil Zafar">
    <meta property="article:section" content="Technology">

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PBS8M2JR');</script>
    
    <!-- Google Consent Mode v2 -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('consent', 'default', {
        'ad_storage': 'denied',
        'ad_user_data': 'denied',
        'ad_personalization': 'denied',
        'analytics_storage': 'denied',
        'wait_for_update': 500
      });
    </script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../../images/favicon_io/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Poppins:wght@400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Prism.js Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="../../../css/main.css">
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>

    <!-- GDPR Cookie Consent Banner -->
    <div id="cookieBanner" class="light display-bottom" style="display: none;">
        <div id="closeIcon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path>
            </svg>
        </div>
        
        <div class="content-wrap">
            <div class="msg-wrap">
                <div class="title-wrap">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20">
                        <path fill="#3B9797" d="M510.52 255.82c-69.97-.85-126.47-57.69-126.47-127.86-70.17 0-127-56.49-127.86-126.45-27.26-4.14-55.13.3-79.72 12.82l-69.13 35.22a132.221 132.221 0 0 0-57.79 57.81l-35.1 68.88a132.645 132.645 0 0 0-12.82 80.95l12.08 76.27a132.521 132.521 0 0 0 37.16 70.37l54.64 54.64a132.036 132.036 0 0 0 70.37 37.16l76.27 12.15c27.51 4.36 55.7-.11 80.95-12.8l68.88-35.08a132.166 132.166 0 0 0 57.79-57.81l35.1-68.88c12.56-24.64 17.01-52.58 12.91-79.91zM176 368c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm32-160c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm160 128c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32z"></path>
                    </svg>
                    <h4 style="margin: 0; font-size: 18px; color: var(--color-navy); font-weight: 700;">Cookie Consent</h4>
                </div>
                <p style="font-size: 14px; line-height: 1.6; color: var(--color-navy); margin-bottom: 15px;">
                    We use cookies to enhance your browsing experience, serve personalized content, and analyze our traffic. 
                    By clicking "Accept All", you consent to our use of cookies. See our 
                    <a href="/privacy-policy.html" style="color: var(--color-teal); border-bottom: 1px dotted var(--color-teal);">Privacy Policy</a> 
                    for more information.
                </p>
                
                <div id="cookieSettings" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="14" height="14">
                        <path fill="currentColor" d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path>
                    </svg>
                    <span style="margin-left: 5px; font-size: 12px; font-weight: 600; color: var(--color-navy);">Customize Settings</span>
                </div>
                
                <div id="cookieTypes" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(59, 151, 151, 0.2);">
                    <h5 style="font-size: 12px; font-weight: 700; color: var(--color-navy); margin-bottom: 10px; text-transform: uppercase;">Cookie Preferences</h5>
                    
                    <div style="margin-bottom: 12px;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="checkbox" checked disabled style="margin-top: 2px; margin-right: 8px; cursor: not-allowed;">
                            <div>
                                <strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Essential Cookies (Required)</strong>
                                <span style="font-size: 12px; color: #666;">Necessary for the website to function properly.</span>
                            </div>
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="checkbox" id="analyticsCookies" checked style="margin-top: 2px; margin-right: 8px;">
                            <div>
                                <strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Analytics Cookies</strong>
                                <span style="font-size: 12px; color: #666;">Help us understand how you interact with the website.</span>
                            </div>
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <label style="display: flex; align-items: start; cursor: pointer;">
                            <input type="checkbox" id="marketingCookies" style="margin-top: 2px; margin-right: 8px;">
                            <div>
                                <strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Marketing Cookies</strong>
                                <span style="font-size: 12px; color: #666;">Used to deliver relevant advertisements.</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="btn-wrap">
                <button id="cookieAccept" style="background: var(--color-teal); color: white; font-weight: 600;">Accept All</button>
                <button id="cookieReject" style="background: transparent; color: var(--color-navy); border: 2px solid var(--color-teal); font-weight: 600;">Reject All</button>
                <button id="cookieSave" style="background: var(--color-blue); color: white; font-weight: 600; display: none;">Save Preferences</button>
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">
                <span class="gradient-text">Wasil Zafar</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#skills">Skills</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#certifications">Certifications</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#interests">Interests</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link">
                    <i class="fas fa-arrow-left me-2"></i>Back to Technology
                </a>
                <h1 class="display-4 fw-bold mb-3">Phase 16: Performance & Optimization</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>February 6, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>30 min read</span>
                    <button onclick="window.print()" class="print-btn" title="Print this article">
                        <i class="fas fa-print"></i> Print
                    </button>
                </div>
                <p class="lead">Make your OS fast with caching strategies, scheduler optimization, memory access patterns, and profiling tools.</p>
            </div>
        </div>
    </section>

    <!-- Table of Contents Toggle Button -->
    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents" aria-label="Open Table of Contents">
        <i class="fas fa-list"></i>
    </button>

    <!-- Side Navigation Overlay -->
    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()" aria-label="Close Table of Contents">&times;</button>
        </div>
        <ol>
            <li>
                <a href="#introduction" onclick="closeNav()">Introduction</a>
                <ul>
                    <li><a href="#perf-mindset" onclick="closeNav()">Performance Mindset</a></li>
                    <li><a href="#bottlenecks" onclick="closeNav()">Common Bottlenecks</a></li>
                </ul>
            </li>
            <li>
                <a href="#caching" onclick="closeNav()">Caching Strategies</a>
                <ul>
                    <li><a href="#block-cache" onclick="closeNav()">Block Cache</a></li>
                    <li><a href="#page-cache" onclick="closeNav()">Page Cache</a></li>
                    <li><a href="#lru" onclick="closeNav()">LRU Eviction</a></li>
                </ul>
            </li>
            <li>
                <a href="#scheduler" onclick="closeNav()">Scheduler Tuning</a>
                <ul>
                    <li><a href="#priority-queues" onclick="closeNav()">Priority Queues</a></li>
                    <li><a href="#cfs" onclick="closeNav()">Completely Fair Scheduler</a></li>
                </ul>
            </li>
            <li>
                <a href="#memory" onclick="closeNav()">Memory Optimization</a>
                <ul>
                    <li><a href="#tlb" onclick="closeNav()">TLB Efficiency</a></li>
                    <li><a href="#huge-pages" onclick="closeNav()">Huge Pages</a></li>
                    <li><a href="#slab" onclick="closeNav()">Slab Allocator</a></li>
                </ul>
            </li>
            <li>
                <a href="#profiling" onclick="closeNav()">Profiling Tools</a>
                <ul>
                    <li><a href="#counters" onclick="closeNav()">Performance Counters</a></li>
                    <li><a href="#tracing" onclick="closeNav()">Kernel Tracing</a></li>
                </ul>
            </li>
            <li><a href="#build" onclick="closeNav()">What You Can Build</a></li>
            <li><a href="#next-steps" onclick="closeNav()">Next Steps</a></li>
        </ol>
    </div>

    <!-- Overlay Backdrop -->
    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <!-- Main Content -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <!-- Introduction -->
                <div id="introduction" class="blog-content">
                    <h2><i class="fas fa-tachometer-alt me-2 text-teal"></i>Introduction: Performance Matters</h2>
                    
                    <div class="highlight-box crimson">
                        <i class="fas fa-flag me-2"></i>
                        <strong>Phase 16 Goals:</strong> By the end of this phase, your OS will have disk and page caching, an optimized scheduler, efficient memory allocation, and profiling tools to measure and improve performance.
                    </div>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">18-Part Series</span>
                            <span class="badge bg-crimson">OS Development Mastery</span>
                        </div>
                        <div class="content">
                            <ol>
                                <li><a href="kernel-dev-phase-00-orientation.html">Phase 0: Orientation & Big Picture</a> - OS fundamentals, kernel architectures, learning path</li>
                                <li><a href="kernel-dev-phase-01-boot-process.html">Phase 1: How a Computer Starts</a> - BIOS/UEFI, boot sequence, dev environment</li>
                                <li><a href="kernel-dev-phase-02-real-mode.html">Phase 2: Real Mode - First Steps</a> - Real mode, bootloader, BIOS interrupts</li>
                                <li><a href="kernel-dev-phase-03-protected-mode.html">Phase 3: Entering Protected Mode</a> - GDT, 32-bit mode, C code execution</li>
                                <li><a href="kernel-dev-phase-04-display-input.html">Phase 4: Display, Input & Output</a> - VGA text mode, keyboard handling</li>
                                <li><a href="kernel-dev-phase-05-interrupts.html">Phase 5: Interrupts & CPU Control</a> - IDT, ISRs, PIC programming</li>
                                <li><a href="kernel-dev-phase-06-memory.html">Phase 6: Memory Management</a> - Paging, virtual memory, heap allocator</li>
                                <li><a href="kernel-dev-phase-07-filesystem.html">Phase 7: Disk Access & Filesystems</a> - Block devices, FAT, VFS layer</li>
                                <li><a href="kernel-dev-phase-08-processes.html">Phase 8: Processes & User Mode</a> - Task switching, system calls, user space</li>
                                <li><a href="kernel-dev-phase-09-elf.html">Phase 9: ELF Loading & Executables</a> - ELF format, program loading</li>
                                <li><a href="kernel-dev-phase-10-stdlib-shell.html">Phase 10: Standard Library & Shell</a> - C library, command-line shell</li>
                                <li><a href="kernel-dev-phase-11-long-mode.html">Phase 11: 64-Bit Long Mode</a> - x86-64, 64-bit paging, modern architecture</li>
                                <li><a href="kernel-dev-phase-12-uefi.html">Phase 12: Modern Booting with UEFI</a> - UEFI boot services, memory maps</li>
                                <li><a href="kernel-dev-phase-13-graphics.html">Phase 13: Graphics & GUI Systems</a> - Framebuffer, windowing, drawing</li>
                                <li><a href="kernel-dev-phase-14-input-timing.html">Phase 14: Advanced Input & Timing</a> - Mouse, high-precision timers</li>
                                <li><a href="kernel-dev-phase-15-hardware-drivers.html">Phase 15: Hardware Discovery & Drivers</a> - PCI, device drivers, NVMe</li>
                                <li><strong>Phase 16: Performance & Optimization (This Guide)</strong> - Caching, scheduler tuning</li>
                                <li><a href="kernel-dev-phase-17-security.html">Phase 17: Stability, Security & Finishing</a> - Debugging, hardening, completion</li>
                            </ol>
                        </div>
                    </div>
                    
                    <p>We've built a functional operating system over 15 phases. But "works" isn't the same as "works <em>well</em>". An OS that freezes when copying files or stutters during video playback isn't usable. Performance optimization is what transforms a toy OS into something production-ready.</p>

                    <!-- Performance Hierarchy Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                    MEMORY & STORAGE LATENCY HIERARCHY                        </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">Access Time</span>          <span style="color: #f8f8f2;">Component</span>              <span style="color: #f8f8f2;">Typical Size</span>               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">─────────────</span>          <span style="color: #f8f8f2;">───────────────</span>          <span style="color: #f8f8f2;">────────────────</span>       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">~1 ns</span>               <span style="color: #50fa7b;">L1 Cache</span>                <span style="color: #6272a4;">32-64 KB</span>                   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">~4 ns</span>               <span style="color: #8be9fd;">L2 Cache</span>                <span style="color: #6272a4;">256 KB - 1 MB</span>              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">~10 ns</span>              <span style="color: #f1fa8c;">L3 Cache</span>                <span style="color: #6272a4;">8-64 MB</span>                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">~100 ns</span>             <span style="color: #ff79c6;">RAM (DDR4/5)</span>            <span style="color: #6272a4;">8-128 GB</span>                   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #bd93f9;">~10,000 ns</span>          <span style="color: #bd93f9;">NVMe SSD</span>                <span style="color: #6272a4;">256 GB - 8 TB</span>              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff5555;">~10,000,000 ns</span>      <span style="color: #ff5555;">HDD (Spinning)</span>          <span style="color: #6272a4;">1-20 TB</span>                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">HDD is 10,000,000x slower than L1 cache!</span>                                  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">Caching transforms disk access from unusable to instant.</span>                 <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Key Insight:</strong> Making an OS fast requires understanding where time is spent. Caching reduces disk latency, scheduler tuning improves responsiveness, and memory optimizations reduce allocation overhead.
                    </div>

                    <h3 id="perf-mindset">Performance Mindset</h3>
                    
                    <p>Before optimizing, you need to <em>measure</em>. Donald Knuth famously said: "Premature optimization is the root of all evil." The corollary is: <strong>profile first, optimize second</strong>.</p>

                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>Principle</th>
                                <th>Meaning</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Measure First</strong></td>
                                <td>Profile before optimizing</td>
                                <td>Find that 90% of time is in disk I/O, not CPU</td>
                            </tr>
                            <tr>
                                <td><strong>Amdahl's Law</strong></td>
                                <td>Speedup limited by serial portions</td>
                                <td>10% serial code limits speedup to 10x max</td>
                            </tr>
                            <tr>
                                <td><strong>Locality</strong></td>
                                <td>Access nearby data together</td>
                                <td>Array of structs vs struct of arrays</td>
                            </tr>
                            <tr>
                                <td><strong>Avoid Copies</strong></td>
                                <td>Zero-copy where possible</td>
                                <td>Pass pointers, use DMA for disk I/O</td>
                            </tr>
                            <tr>
                                <td><strong>Batch Operations</strong></td>
                                <td>Amortize overhead over many items</td>
                                <td>Write 100 sectors at once, not 1 at a time</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 id="bottlenecks">Common Bottlenecks</h3>
                    
                    <p>In an OS, the major performance bottlenecks are:</p>

                    <!-- Bottleneck Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                     OS PERFORMANCE BOTTLENECKS                               </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff5555;">┌───────────────────────────────────────────────────────────────────┐</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff5555;">│</span>  <span style="color: #ff5555;">1. DISK I/O</span> ─ Uncached disk reads are killers (~10ms each!)        <span style="color: #ff5555;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff5555;">│</span>     → Solution: Block cache, read-ahead, async I/O                  <span style="color: #ff5555;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff5555;">└───────────────────────────────────────────────────────────────────┘</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">┌───────────────────────────────────────────────────────────────────┐</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">│</span>  <span style="color: #ff79c6;">2. CONTEXT SWITCHES</span> ─ Task switching overhead adds up              <span style="color: #ff79c6;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">│</span>     → Solution: Smart scheduler, longer time slices where OK        <span style="color: #ff79c6;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">└───────────────────────────────────────────────────────────────────┘</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">┌───────────────────────────────────────────────────────────────────┐</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">│</span>  <span style="color: #f1fa8c;">3. MEMORY ALLOCATION</span> ─ malloc/free are surprisingly slow          <span style="color: #f1fa8c;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">│</span>     → Solution: Slab allocator, object pools                        <span style="color: #f1fa8c;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">└───────────────────────────────────────────────────────────────────┘</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">┌───────────────────────────────────────────────────────────────────┐</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">│</span>  <span style="color: #8be9fd;">4. TLB MISSES</span> ─ Page table walks are expensive (~100 cycles)     <span style="color: #8be9fd;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">│</span>     → Solution: Huge pages, minimize mappings, locality             <span style="color: #8be9fd;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">└───────────────────────────────────────────────────────────────────┘</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #bd93f9;">┌───────────────────────────────────────────────────────────────────┐</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #bd93f9;">│</span>  <span style="color: #bd93f9;">5. LOCK CONTENTION</span> ─ Threads waiting on each other                <span style="color: #bd93f9;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #bd93f9;">│</span>     → Solution: Lock-free structures, finer-grained locks           <span style="color: #bd93f9;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #bd93f9;">└───────────────────────────────────────────────────────────────────┘</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>
                </div>

                <!-- Caching Section -->
                <div id="caching" class="blog-content mt-5">
                    <h2><i class="fas fa-database me-2 text-teal"></i>Caching Strategies</h2>
                    
                    <p>Caching is the single most important performance optimization in an OS. By keeping frequently accessed data in memory, we avoid slow disk operations. A good cache can make your OS feel 100x faster!</p>

                    <!-- Cache Hierarchy Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                       OS CACHING LAYERS                                     </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">Application</span>                                                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>       │                                                                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>       ▼  <span style="color: #6272a4;">read("/home/user/file.txt")</span>                                     <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">┌─────────────────────────────┐</span>                                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">│</span>      <span style="color: #50fa7b;">Page Cache</span>            <span style="color: #50fa7b;">│</span>  <span style="color: #6272a4;">File data cached as memory pages</span>       <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">│</span>  <span style="color: #6272a4;">(virtual file pages)</span>     <span style="color: #50fa7b;">│</span>  <span style="color: #6272a4;">Serves most read() calls from RAM</span>      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">└─────────────┬───────────────┘</span>                                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                │                                                            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                ▼  <span style="color: #6272a4;">Page miss → lookup block number</span>                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">┌─────────────────────────────┐</span>                                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">│</span>      <span style="color: #8be9fd;">Block Cache</span>           <span style="color: #8be9fd;">│</span>  <span style="color: #6272a4;">Raw disk sectors cached in RAM</span>         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">│</span>  <span style="color: #6272a4;">(disk sectors/blocks)</span>    <span style="color: #8be9fd;">│</span>  <span style="color: #6272a4;">Indexed by (device, block_num)</span>         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">└─────────────┬───────────────┘</span>                                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                │                                                            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                ▼  <span style="color: #6272a4;">Block miss → actual disk I/O</span>                            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">┌─────────────────────────────┐</span>                                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">│</span>      <span style="color: #ff79c6;">Disk Driver</span>           <span style="color: #ff79c6;">│</span>  <span style="color: #6272a4;">AHCI/NVMe actually reads from disk</span>     <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">│</span>  <span style="color: #6272a4;">(SLOW! Avoid at all cost)</span><span style="color: #ff79c6;">│</span>  <span style="color: #6272a4;">HDD: ~10ms, SSD: ~0.1ms</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">└─────────────────────────────┘</span>                                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>
                    
                    <h3 id="block-cache">Block Cache</h3>
                    
                    <p>The <strong>block cache</strong> stores recently accessed disk sectors in memory. Before reading from disk, we check the cache—a hit returns instantly (nanoseconds vs. milliseconds).</p>

                    <pre><code class="language-c">/* Block Cache Entry */
typedef struct cache_entry {
    uint64_t block_num;         // Disk block number
    uint8_t* data;              // Block data (512/4096 bytes)
    uint32_t flags;             // Dirty, valid, etc.
    uint64_t access_time;       // For LRU eviction
    struct cache_entry* next;   // Hash chain
    struct cache_entry* lru_prev;
    struct cache_entry* lru_next;
} cache_entry_t;

/* Block Cache */
#define CACHE_SIZE 1024  // Number of cached blocks
#define HASH_SIZE  256

typedef struct {
    cache_entry_t* hash[HASH_SIZE];
    cache_entry_t* lru_head;
    cache_entry_t* lru_tail;
    uint32_t hits;
    uint32_t misses;
} block_cache_t;

/* Get cached block or read from disk */
cache_entry_t* cache_get(block_cache_t* cache, uint64_t block) {
    uint32_t hash = block % HASH_SIZE;
    
    // Search hash chain
    for (cache_entry_t* e = cache->hash[hash]; e; e = e->next) {
        if (e->block_num == block) {
            cache->hits++;
            lru_touch(cache, e);  // Move to front
            return e;
        }
    }
    
    // Cache miss - read from disk
    cache->misses++;
    cache_entry_t* entry = lru_evict_or_alloc(cache);
    entry->block_num = block;
    disk_read(block, entry->data);
    
    // Insert into hash
    entry->next = cache->hash[hash];
    cache->hash[hash] = entry;
    
    return entry;
}
</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-chart-pie me-2"></i>
                        <strong>Cache Hit Rate:</strong> Track <code>hits / (hits + misses)</code>. A good block cache achieves 90%+ hit rate for typical workloads. Even 90% means only 10% of accesses hit disk!
                    </div>
                    
                    <h3 id="page-cache">Page Cache</h3>
                    
                    <p>While the block cache stores raw sectors, the <strong>page cache</strong> stores file data as memory pages. This integrates with virtual memory—a memory-mapped file is just pages in the page cache!</p>

                    <pre><code class="language-c">/* Page Cache - Indexed by (inode, offset) */
typedef struct page_cache_entry {
    struct inode* inode;        // File inode
    uint64_t offset;            // Page offset within file
    void* page;                 // 4KB page of file data
    uint32_t flags;             // PG_DIRTY, PG_UPTODATE, etc.
    atomic_t ref_count;         // Reference count
    struct list_head lru;       // LRU list linkage
    struct hlist_node hash;     // Hash table linkage
} page_cache_entry_t;

/* Find or create page in cache */
page_cache_entry_t* page_cache_lookup(struct inode* inode, uint64_t offset) {
    uint64_t page_offset = offset & ~0xFFF;  // Align to page
    uint32_t hash = hash_page(inode, page_offset);
    
    // Search hash bucket
    spin_lock(&page_cache_lock);
    page_cache_entry_t* entry;
    hlist_for_each_entry(entry, &page_hash[hash], hash) {
        if (entry->inode == inode && entry->offset == page_offset) {
            atomic_inc(&entry->ref_count);
            lru_touch(entry);  // Move to front of LRU
            spin_unlock(&page_cache_lock);
            return entry;
        }
    }
    spin_unlock(&page_cache_lock);
    
    // Cache miss - allocate new page and read from disk
    entry = alloc_page_cache_entry();
    entry->inode = inode;
    entry->offset = page_offset;
    entry->page = alloc_page();
    
    // Read file data into page (uses block cache internally)
    inode->i_op->readpage(inode, entry->page, page_offset);
    
    // Insert into cache
    spin_lock(&page_cache_lock);
    hlist_add_head(&entry->hash, &page_hash[hash]);
    list_add(&entry->lru, &page_lru_list);
    spin_unlock(&page_cache_lock);
    
    return entry;
}

/* Memory-mapped file read - just returns cached page */
void* mmap_read(struct file* file, uint64_t offset) {
    page_cache_entry_t* entry = page_cache_lookup(file->f_inode, offset);
    return entry->page + (offset & 0xFFF);  // Return pointer within page
}
</code></pre>
                    
                    <h3 id="lru">LRU Eviction</h3>
                    
                    <p>When the cache is full, we need to evict old entries. <strong>LRU (Least Recently Used)</strong> is the classic algorithm—evict the entry that hasn't been accessed for the longest time.</p>

                    <!-- LRU Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                     LRU CACHE OPERATION                                      </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">Doubly-Linked List (head = most recent, tail = least recent)</span>            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">HEAD</span>                                                         <span style="color: #ff5555;">TAIL</span>        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    │                                                           │          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    ▼                                                           ▼          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐</span>        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span><span style="color: #50fa7b;">Blk 5</span><span style="color: #f8f8f2;">│───│</span><span style="color: #8be9fd;">Blk 2</span><span style="color: #f8f8f2;">│───│</span><span style="color: #f1fa8c;">Blk 9</span><span style="color: #f8f8f2;">│───│</span><span style="color: #bd93f9;">Blk 1</span><span style="color: #f8f8f2;">│───│</span><span style="color: #ff79c6;">Blk 7</span><span style="color: #f8f8f2;">│───│</span><span style="color: #ff5555;">Blk 3</span><span style="color: #f8f8f2;">│</span>        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└─────┘   └─────┘   └─────┘   └─────┘   └─────┘   └─────┘</span>        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">newest</span>                                                 <span style="color: #6272a4;">oldest</span>            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f1fa8c;">Operation: Access Block 1</span>                                                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  ──────────────────────────                                                   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  1. <span style="color: #6272a4;">Remove Block 1 from current position</span>                                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  2. <span style="color: #6272a4;">Insert Block 1 at HEAD</span>                                                   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">HEAD</span>                                                         <span style="color: #ff5555;">TAIL</span>        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    │                                                           │          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>    ▼                                                           ▼          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐</span>        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span><span style="color: #bd93f9;">Blk 1</span><span style="color: #f8f8f2;">│───│</span><span style="color: #50fa7b;">Blk 5</span><span style="color: #f8f8f2;">│───│</span><span style="color: #8be9fd;">Blk 2</span><span style="color: #f8f8f2;">│───│</span><span style="color: #f1fa8c;">Blk 9</span><span style="color: #f8f8f2;">│───│</span><span style="color: #ff79c6;">Blk 7</span><span style="color: #f8f8f2;">│───│</span><span style="color: #ff5555;">Blk 3</span><span style="color: #f8f8f2;">│</span>        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└─────┘   └─────┘   └─────┘   └─────┘   └─────┘   └─────┘</span>        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #bd93f9;">↑ moved</span>                                                 <span style="color: #6272a4;">evict me</span>          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <pre><code class="language-c">/* LRU List Operations - O(1) */
void lru_touch(block_cache_t* cache, cache_entry_t* entry) {
    // Remove from current position
    if (entry->lru_prev) entry->lru_prev->lru_next = entry->lru_next;
    if (entry->lru_next) entry->lru_next->lru_prev = entry->lru_prev;
    if (cache->lru_tail == entry) cache->lru_tail = entry->lru_prev;
    
    // Insert at head
    entry->lru_prev = NULL;
    entry->lru_next = cache->lru_head;
    if (cache->lru_head) cache->lru_head->lru_prev = entry;
    cache->lru_head = entry;
    if (!cache->lru_tail) cache->lru_tail = entry;
}

cache_entry_t* lru_evict(block_cache_t* cache) {
    cache_entry_t* victim = cache->lru_tail;
    if (!victim) return NULL;
    
    // Remove from tail
    cache->lru_tail = victim->lru_prev;
    if (cache->lru_tail) cache->lru_tail->lru_next = NULL;
    else cache->lru_head = NULL;
    
    // If dirty, write back to disk first
    if (victim->flags & CACHE_DIRTY) {
        disk_write(victim->block_num, victim->data);
    }
    
    // Remove from hash chain
    cache_hash_remove(cache, victim);
    
    return victim;
}
</code></pre>

                    <div class="highlight-box highlight-navy">
                        <i class="fas fa-sync-alt me-2"></i>
                        <strong>Write-Back vs Write-Through:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>Write-Through</strong>: Every write immediately goes to disk. Safe but slow.</li>
                            <li><strong>Write-Back</strong>: Writes stay in cache (marked dirty), flushed later. Fast but requires careful fsync.</li>
                        </ul>
                    </div>
                </div>

                <!-- Scheduler Section -->
                <div id="scheduler" class="blog-content mt-5">
                    <h2><i class="fas fa-clock me-2 text-teal"></i>Scheduler Tuning</h2>
                    
                    <p>The scheduler determines which process runs when. A bad scheduler makes the system feel sluggish even with a fast CPU. Good scheduling balances <strong>throughput</strong> (total work done) with <strong>latency</strong> (responsiveness to user input).</p>

                    <!-- Scheduler Goals Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                     SCHEDULER DESIGN TRADEOFFS                               </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">┌─────────────────────────────────┐</span>     <span style="color: #ff5555;">┌──────────────────────────────┐</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">│</span>        <span style="color: #50fa7b;">THROUGHPUT</span>              <span style="color: #50fa7b;">│</span>     <span style="color: #ff5555;">│</span>         <span style="color: #ff5555;">LATENCY</span>              <span style="color: #ff5555;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">│</span>  <span style="color: #6272a4;">Total work completed/second</span>    <span style="color: #50fa7b;">│</span>     <span style="color: #ff5555;">│</span>  <span style="color: #6272a4;">Time to respond to events</span>   <span style="color: #ff5555;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">│</span>                                 <span style="color: #50fa7b;">│</span>     <span style="color: #ff5555;">│</span>                              <span style="color: #ff5555;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">│</span>  <span style="color: #f8f8f2;">• Long time slices</span>             <span style="color: #50fa7b;">│</span>     <span style="color: #ff5555;">│</span>  <span style="color: #f8f8f2;">• Short time slices</span>         <span style="color: #ff5555;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">│</span>  <span style="color: #f8f8f2;">• Batch processing</span>             <span style="color: #50fa7b;">│</span>     <span style="color: #ff5555;">│</span>  <span style="color: #f8f8f2;">• Interactive priority</span>      <span style="color: #ff5555;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">│</span>  <span style="color: #f8f8f2;">• Minimize context switches</span>    <span style="color: #50fa7b;">│</span>     <span style="color: #ff5555;">│</span>  <span style="color: #f8f8f2;">• Preemption</span>                 <span style="color: #ff5555;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">└─────────────────────────────────┘</span>     <span style="color: #ff5555;">└──────────────────────────────┘</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">Server (compile farm): Throughput priority</span>                               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">Desktop (user interaction): Latency priority</span>                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">Real-time (audio): Hard latency guarantees</span>                               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>
                    
                    <h3 id="priority-queues">Priority Queues (MLFQ)</h3>
                    
                    <p><strong>Multi-Level Feedback Queue (MLFQ)</strong> is a classic scheduler that automatically categorizes processes. New processes start at high priority (assumed interactive). If they use their full time slice, they're demoted (likely CPU-bound batch). If they yield early, they stay high (likely I/O-bound interactive).</p>

                    <pre><code class="language-c">/* Multi-Level Feedback Queue Scheduler */
#define NUM_PRIORITIES 4
#define QUANTUM_MS 10

typedef struct {
    task_t* queues[NUM_PRIORITIES];
    uint32_t quantum[NUM_PRIORITIES];
} mlfq_scheduler_t;

mlfq_scheduler_t scheduler = {
    .quantum = {5, 10, 20, 40}  // ms per priority level
};

/* Schedule next task */
task_t* mlfq_schedule(void) {
    // Pick from highest priority non-empty queue
    for (int pri = 0; pri < NUM_PRIORITIES; pri++) {
        if (scheduler.queues[pri]) {
            task_t* task = scheduler.queues[pri];
            scheduler.queues[pri] = task->next;
            return task;
        }
    }
    return idle_task;
}

/* Handle quantum expiration */
void mlfq_quantum_expired(task_t* task) {
    // Demote to lower priority (if not already lowest)
    if (task->priority < NUM_PRIORITIES - 1) {
        task->priority++;
    }
    
    // Re-queue
    task->next = scheduler.queues[task->priority];
    scheduler.queues[task->priority] = task;
}
</code></pre>
                    
                    <h3 id="cfs">Completely Fair Scheduler (CFS)</h3>
                    
                    <p>Linux's <strong>Completely Fair Scheduler (CFS)</strong> uses a red-black tree to give each task a "fair" share of CPU. Instead of fixed priority queues, CFS tracks <strong>virtual runtime (vruntime)</strong>—the amount of CPU time a task "should" have received.</p>

                    <!-- CFS Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                  CFS RED-BLACK TREE (sorted by vruntime)                    </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                           <span style="color: #ff5555;">┌───────────┐</span>                                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                           <span style="color: #ff5555;">│</span>  Task C   <span style="color: #ff5555;">│</span>                                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                           <span style="color: #ff5555;">│</span> vrun=500  <span style="color: #ff5555;">│</span>                                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                           <span style="color: #ff5555;">└─────┬─────┘</span>                                    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                      ┌──────────┴──────────┐                               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                      ▼                     ▼                               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                <span style="color: #f8f8f2;">┌───────────┐</span>         <span style="color: #f8f8f2;">┌───────────┐</span>                      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                <span style="color: #f8f8f2;">│</span>  Task A   <span style="color: #f8f8f2;">│</span>         <span style="color: #f8f8f2;">│</span>  Task E   <span style="color: #f8f8f2;">│</span>                      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                <span style="color: #f8f8f2;">│</span> vrun=200  <span style="color: #f8f8f2;">│</span>         <span style="color: #f8f8f2;">│</span> vrun=800  <span style="color: #f8f8f2;">│</span>                      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                <span style="color: #f8f8f2;">└─────┬─────┘</span>         <span style="color: #f8f8f2;">└───────────┘</span>                      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>           ┌──────────┴──────────┐                                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>           ▼                     ▼                                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>     <span style="color: #50fa7b;">┌───────────┐</span>         <span style="color: #f8f8f2;">┌───────────┐</span>                               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>     <span style="color: #50fa7b;">│</span>  Task B   <span style="color: #50fa7b;">│</span>←LEFTMOST <span style="color: #f8f8f2;">│</span>  Task D   <span style="color: #f8f8f2;">│</span>                               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>     <span style="color: #50fa7b;">│</span> vrun=100  <span style="color: #50fa7b;">│</span>         <span style="color: #f8f8f2;">│</span> vrun=350  <span style="color: #f8f8f2;">│</span>                               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>     <span style="color: #50fa7b;">└───────────┘</span>         <span style="color: #f8f8f2;">└───────────┘</span>                               <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>      <span style="color: #50fa7b;">^ NEXT TO RUN</span>                                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">• Leftmost node = smallest vruntime = most "starved" for CPU</span>             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">• After running, task's vruntime increases, moves right in tree</span>          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">• Nice value affects HOW FAST vruntime increases (lower nice = slower)</span>   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <pre><code class="language-c">/* CFS Scheduler - Red-Black Tree based */
typedef struct cfs_rq {
    struct rb_root tasks_timeline;  // Red-black tree of tasks
    struct rb_node* leftmost;       // Task with smallest vruntime
    uint64_t min_vruntime;          // Minimum vruntime in tree
    uint32_t nr_running;            // Number of runnable tasks
} cfs_rq_t;

typedef struct cfs_task {
    struct task_struct* task;
    struct rb_node run_node;        // RB-tree node
    uint64_t vruntime;              // Virtual runtime
    uint64_t weight;                // Nice-based weight (nice 0 = 1024)
} cfs_task_t;

/* Nice to weight conversion (nice 0 = 1024) */
const uint32_t nice_to_weight[40] = {
 /* -20 */ 88761, 71755, 56483, 46273, 36291,
 /* -15 */ 29154, 23254, 18705, 14949, 11916,
 /* -10 */  9548,  7620,  6100,  4904,  3906,
 /*  -5 */  3121,  2501,  1991,  1586,  1277,
 /*   0 */  1024,   820,   655,   526,   423,
 /*   5 */   335,   272,   215,   172,   137,
 /*  10 */   110,    87,    70,    56,    45,
 /*  15 */    36,    29,    23,    18,    15,
};

/* CFS: Pick task with smallest vruntime */
cfs_task_t* cfs_pick_next(cfs_rq_t* rq) {
    if (!rq->leftmost) return NULL;
    return rb_entry(rq->leftmost, cfs_task_t, run_node);
}

/* CFS: Update vruntime after running */
void cfs_update_vruntime(cfs_task_t* se, uint64_t delta_exec) {
    // Higher weight = vruntime increases slower = more CPU time
    // vruntime += delta_exec * (NICE_0_WEIGHT / se->weight)
    uint64_t weighted = (delta_exec * 1024) / se->weight;
    se->vruntime += weighted;
    
    // Update min_vruntime (never go backwards)
    if (se->vruntime > se->cfs_rq->min_vruntime) {
        se->cfs_rq->min_vruntime = se->vruntime;
    }
}

/* CFS: Insert task into tree */
void cfs_enqueue(cfs_rq_t* rq, cfs_task_t* se) {
    // New task starts at current min_vruntime (fair start)
    if (se->vruntime < rq->min_vruntime) {
        se->vruntime = rq->min_vruntime;
    }
    
    // Insert into RB-tree, sorted by vruntime
    rb_insert(&rq->tasks_timeline, &se->run_node, cfs_compare_vruntime);
    
    // Update leftmost if needed
    if (!rq->leftmost || se->vruntime < cfs_get_vruntime(rq->leftmost)) {
        rq->leftmost = &se->run_node;
    }
    rq->nr_running++;
}
</code></pre>

                    <div class="highlight-box">
                        <i class="fas fa-balance-scale me-2"></i>
                        <strong>Why vruntime is Brilliant:</strong> CFS doesn't need complex priority queues. A task that used 50ms of CPU will have higher vruntime than one that used 10ms—so the 10ms task runs next. The "nice" value affects the <em>rate</em> at which vruntime increases.
                    </div>

                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>Scheduler</th>
                                <th>Data Structure</th>
                                <th>Complexity</th>
                                <th>Best For</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Round-Robin</strong></td>
                                <td>Queue</td>
                                <td>O(1)</td>
                                <td>Simple, equal priority</td>
                            </tr>
                            <tr>
                                <td><strong>MLFQ</strong></td>
                                <td>Multiple Queues</td>
                                <td>O(1)</td>
                                <td>Auto-detects interactive</td>
                            </tr>
                            <tr>
                                <td><strong>CFS</strong></td>
                                <td>Red-Black Tree</td>
                                <td>O(log n)</td>
                                <td>General-purpose fairness</td>
                            </tr>
                            <tr>
                                <td><strong>EDF</strong></td>
                                <td>Sorted by deadline</td>
                                <td>O(n) or O(log n)</td>
                                <td>Real-time systems</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Memory Section -->
                <div id="memory" class="blog-content mt-5">
                    <h2><i class="fas fa-memory me-2 text-teal"></i>Memory Optimization</h2>
                    
                    <p>Memory management has hidden costs that cripple performance when ignored. Every memory access triggers address translation, and every allocation has overhead. Optimizing these paths makes a huge difference.</p>
                    
                    <h3 id="tlb">TLB Efficiency</h3>
                    
                    <p>The <strong>Translation Lookaside Buffer (TLB)</strong> caches recent page table lookups. A TLB hit is ~1 cycle; a TLB miss requires a page table walk (~100 cycles on x86-64 with 4-level paging). With thousands of memory accesses per function call, TLB efficiency is critical!</p>

                    <!-- TLB Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                     TLB HIT vs MISS                                         </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">TLB HIT (~1 cycle)</span>                                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌───────────┐</span>    <span style="color: #50fa7b;">hit!</span>    <span style="color: #f8f8f2;">┌────────────────┐</span>                           <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>   CPU     <span style="color: #f8f8f2;">│</span>─────────▶<span style="color: #f8f8f2;">│</span>   TLB Cache    <span style="color: #f8f8f2;">│</span>──────▶ Physical Address   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> (virtual) <span style="color: #f8f8f2;">│</span>           <span style="color: #f8f8f2;">│</span> (64-1024 entries)<span style="color: #f8f8f2;">│</span>                          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└───────────┘</span>           <span style="color: #f8f8f2;">└────────────────┘</span>                           <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff5555;">TLB MISS (~100+ cycles)</span>                                                   <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌───────────┐</span>    <span style="color: #ff5555;">miss</span>    <span style="color: #f8f8f2;">┌────────────────┐</span>                           <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>   CPU     <span style="color: #f8f8f2;">│</span>─────────▶<span style="color: #f8f8f2;">│</span>   TLB Cache    <span style="color: #f8f8f2;">│</span>                           <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> (virtual) <span style="color: #f8f8f2;">│</span>           <span style="color: #f8f8f2;">│</span>                <span style="color: #f8f8f2;">│</span>                           <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└───────────┘</span>           <span style="color: #f8f8f2;">└───────┬────────┘</span>                           <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                  │                                         <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                  ▼ <span style="color: #6272a4;">Page Table Walk (4 memory accesses!)</span>    <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">┌─────┐</span>──▶<span style="color: #ff79c6;">┌─────┐</span>──▶<span style="color: #ff79c6;">┌─────┐</span>──▶<span style="color: #ff79c6;">┌─────┐</span>──▶ Physical Address          <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">│</span> PML4<span style="color: #ff79c6;">│</span>   <span style="color: #ff79c6;">│</span> PDPT<span style="color: #ff79c6;">│</span>   <span style="color: #ff79c6;">│</span>  PD <span style="color: #ff79c6;">│</span>   <span style="color: #ff79c6;">│</span>  PT <span style="color: #ff79c6;">│</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #ff79c6;">└─────┘</span>   <span style="color: #ff79c6;">└─────┘</span>   <span style="color: #ff79c6;">└─────┘</span>   <span style="color: #ff79c6;">└─────┘</span>                              <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>TLB Size Matters:</strong> A typical CPU has only 64-1024 TLB entries. With 4KB pages, that covers only 256KB-4MB of address space. Access scattered memory and you'll TLB miss constantly!
                    </div>
                    
                    <h3 id="huge-pages">Huge Pages</h3>
                    
                    <p><strong>Huge pages</strong> (2MB or 1GB) cover more memory with fewer TLB entries. One 2MB huge page covers 512× as much memory as a 4KB page—perfect for large allocations!</p>

                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>Page Size</th>
                                <th>TLB Coverage (64 entries)</th>
                                <th>Page Table Levels</th>
                                <th>Use Case</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>4 KB</strong></td>
                                <td>256 KB</td>
                                <td>4 levels (PML4→PDPT→PD→PT)</td>
                                <td>General purpose</td>
                            </tr>
                            <tr>
                                <td><strong>2 MB</strong></td>
                                <td>128 MB</td>
                                <td>3 levels (PML4→PDPT→PD)</td>
                                <td>Large heaps, databases</td>
                            </tr>
                            <tr>
                                <td><strong>1 GB</strong></td>
                                <td>64 GB</td>
                                <td>2 levels (PML4→PDPT)</td>
                                <td>Scientific computing, VMs</td>
                            </tr>
                        </tbody>
                    </table>

                    <pre><code class="language-c">/* Huge Page Allocation */
#define PAGE_SIZE_4K   0x1000       // 4 KB
#define PAGE_SIZE_2M   0x200000     // 2 MB
#define PAGE_SIZE_1G   0x40000000   // 1 GB

/* Page table entry flags for huge pages */
#define PTE_HUGE       (1 << 7)     // PS bit - Page Size (makes PD entry point to 2MB page)

/* Allocate 2MB huge page */
void* alloc_huge_page_2m(void) {
    // Find 2MB-aligned physical frame
    uint64_t phys = alloc_physical_2m_aligned();
    if (!phys) return NULL;
    
    // Map at PD level (skip PT level entirely)
    uint64_t virt = find_free_vm_range(PAGE_SIZE_2M);
    
    // Set huge page flag in PD entry
    uint64_t* pd_entry = get_pd_entry(virt);
    *pd_entry = phys | PTE_PRESENT | PTE_WRITABLE | PTE_HUGE;
    
    return (void*)virt;
}

/* When to use huge pages */
// ✓ Large contiguous allocations (&gt;2MB)
// ✓ Memory-mapped files
// ✓ Database buffer pools
// ✓ Scientific computing arrays
// ✗ Small allocations (wastes memory)
// ✗ Fragmented access patterns
</code></pre>
                    
                    <h3 id="slab">Slab Allocator</h3>
                    
                    <p>The kernel allocates many small, fixed-size objects (task structs, file descriptors, inodes). A general-purpose allocator like malloc has overhead for each allocation. The <strong>slab allocator</strong> pre-allocates "slabs" of memory divided into fixed-size slots.</p>

                    <!-- Slab Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                     SLAB ALLOCATOR STRUCTURE                                </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">kmem_cache "task_struct"</span> <span style="color: #6272a4;">(object_size = 2048 bytes)</span>                      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌────────────────────────────────────────────────────────┐</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  partial ──▶ <span style="color: #50fa7b;">┌───────────────────────────────────┐</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>              <span style="color: #50fa7b;">│</span>  Slab 1 (has free slots)         <span style="color: #50fa7b;">│</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>              <span style="color: #50fa7b;">│</span> <span style="color: #f8f8f2;">┌────┬────┬────┬────┬────┬────┐</span>  <span style="color: #50fa7b;">│</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>              <span style="color: #50fa7b;">│</span> <span style="color: #f8f8f2;">│</span><span style="color: #50fa7b;">used</span><span style="color: #f8f8f2;">│</span><span style="color: #6272a4;">free</span><span style="color: #f8f8f2;">│</span><span style="color: #50fa7b;">used</span><span style="color: #f8f8f2;">│</span><span style="color: #50fa7b;">used</span><span style="color: #f8f8f2;">│</span><span style="color: #6272a4;">free</span><span style="color: #f8f8f2;">│</span><span style="color: #6272a4;">free</span><span style="color: #f8f8f2;">│</span>  <span style="color: #50fa7b;">│</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>              <span style="color: #50fa7b;">│</span> <span style="color: #f8f8f2;">└────┴────┴────┴────┴────┴────┘</span>  <span style="color: #50fa7b;">│</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>              <span style="color: #50fa7b;">└───────────────────────────────────┘</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>                                                          <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>  full ─────▶ <span style="color: #ff5555;">┌───────────────────────────────────┐</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>              <span style="color: #ff5555;">│</span>  Slab 2 (all used)               <span style="color: #ff5555;">│</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>              <span style="color: #ff5555;">│</span> <span style="color: #f8f8f2;">┌────┬────┬────┬────┬────┬────┐</span>  <span style="color: #ff5555;">│</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>              <span style="color: #ff5555;">│</span> <span style="color: #f8f8f2;">│</span><span style="color: #ff5555;">used</span><span style="color: #f8f8f2;">│</span><span style="color: #ff5555;">used</span><span style="color: #f8f8f2;">│</span><span style="color: #ff5555;">used</span><span style="color: #f8f8f2;">│</span><span style="color: #ff5555;">used</span><span style="color: #f8f8f2;">│</span><span style="color: #ff5555;">used</span><span style="color: #f8f8f2;">│</span><span style="color: #ff5555;">used</span><span style="color: #f8f8f2;">│</span>  <span style="color: #ff5555;">│</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>              <span style="color: #ff5555;">│</span> <span style="color: #f8f8f2;">└────┴────┴────┴────┴────┴────┘</span>  <span style="color: #ff5555;">│</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span>              <span style="color: #ff5555;">└───────────────────────────────────┘</span>    <span style="color: #f8f8f2;">│</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└────────────────────────────────────────────────────────┘</span>                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">• Allocation: Find partial slab, flip bit in bitmap, return pointer</span>      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">• Free: Clear bit in bitmap, move to partial list if was full</span>            <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #6272a4;">• No fragmentation—all objects same size!</span>                                <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <pre><code class="language-c">/* Slab Allocator for Fixed-Size Objects */
typedef struct slab {
    void*  base;            // Slab memory base
    size_t object_size;     // Size of each object
    size_t num_objects;     // Objects per slab
    uint64_t* bitmap;       // Allocation bitmap
    struct slab* next;      // Next slab in cache
} slab_t;

typedef struct {
    const char* name;
    size_t object_size;
    slab_t* slabs;
    slab_t* partial;        // Slabs with free space
    uint64_t allocations;
    uint64_t frees;
} slab_cache_t;

/* Allocate object from slab cache */
void* slab_alloc(slab_cache_t* cache) {
    // Find slab with free space
    for (slab_t* slab = cache->partial; slab; slab = slab->next) {
        int idx = find_first_zero_bit(slab->bitmap, slab->num_objects);
        if (idx >= 0) {
            set_bit(slab->bitmap, idx);
            cache->allocations++;
            return slab->base + idx * cache->object_size;
        }
    }
    
    // No space - create new slab
    slab_t* new_slab = create_slab(cache);
    set_bit(new_slab->bitmap, 0);
    new_slab->next = cache->partial;
    cache->partial = new_slab;
    cache->allocations++;
    
    return new_slab->base;
}
</code></pre>
                </div>

                <!-- Profiling Section -->
                <div id="profiling" class="blog-content mt-5">
                    <h2><i class="fas fa-chart-line me-2 text-teal"></i>Profiling Tools</h2>
                    
                    <p>You can't optimize what you can't measure. Modern CPUs provide hardware performance counters that track cache misses, branch mispredictions, and cycles with zero overhead. Building profiling into your OS is essential for finding bottlenecks.</p>
                    
                    <h3 id="counters">Performance Counters (PMC)</h3>
                    
                    <p><strong>Performance Monitoring Counters (PMC)</strong> are special CPU registers that count hardware events. x86 CPUs have 4-8 general-purpose counters that can track various events.</p>

                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>Counter Event</th>
                                <th>What It Measures</th>
                                <th>Optimization Insight</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>CPU_CYCLES</strong></td>
                                <td>Total clock cycles</td>
                                <td>Overall time spent</td>
                            </tr>
                            <tr>
                                <td><strong>INSTRUCTIONS_RETIRED</strong></td>
                                <td>Instructions completed</td>
                                <td>IPC (Instr/Cycle) efficiency</td>
                            </tr>
                            <tr>
                                <td><strong>LLC_MISSES</strong></td>
                                <td>Last-level cache misses</td>
                                <td>Memory bandwidth issues</td>
                            </tr>
                            <tr>
                                <td><strong>BRANCH_MISPREDICT</strong></td>
                                <td>Wrong branch predictions</td>
                                <td>Unpredictable code paths</td>
                            </tr>
                            <tr>
                                <td><strong>DTLB_MISS</strong></td>
                                <td>Data TLB misses</td>
                                <td>Need huge pages?</td>
                            </tr>
                        </tbody>
                    </table>

                    <pre><code class="language-c">/* Read CPU Performance Counter (RDPMC) */
static inline uint64_t read_pmc(uint32_t counter) {
    uint32_t lo, hi;
    __asm__ volatile("rdpmc" : "=a"(lo), "=d"(hi) : "c"(counter));
    return ((uint64_t)hi << 32) | lo;
}

/* Read Time Stamp Counter */
static inline uint64_t read_tsc(void) {
    uint32_t lo, hi;
    __asm__ volatile("rdtsc" : "=a"(lo), "=d"(hi));
    return ((uint64_t)hi << 32) | lo;
}

/* Simple profiling macro */
#define PROFILE_START(name) uint64_t _prof_##name = read_tsc()
#define PROFILE_END(name) do { \
    uint64_t _end = read_tsc(); \
    kprintf("%s: %lu cycles\n", #name, _end - _prof_##name); \
} while(0)

/* Configure PMC to count cache misses */
void setup_pmc_cache_misses(void) {
    // PMC setup via MSRs (Model-Specific Registers)
    // Event 0x2E = LLC_MISSES, Umask 0x41
    uint64_t event_select = 0x412E;  // LLC misses
    event_select |= (1 << 16);       // USR - count in user mode
    event_select |= (1 << 17);       // OS - count in kernel mode
    event_select |= (1 << 22);       // EN - enable counting
    
    wrmsr(MSR_PERFEVTSEL0, event_select);
    wrmsr(MSR_PMC0, 0);  // Reset counter
}

uint64_t read_cache_misses(void) {
    return read_pmc(0);  // Read PMC0
}
</code></pre>
                    
                    <h3 id="tracing">Kernel Tracing</h3>
                    
                    <p><strong>Kernel tracing</strong> records events as they happen—syscalls, interrupts, context switches—creating a timeline you can analyze. This is invaluable for finding why the system "feels slow."</p>

                    <pre><code class="language-c">/* Simple Ring Buffer for Kernel Tracing */
#define TRACE_BUFFER_SIZE 65536

typedef struct trace_event {
    uint64_t timestamp;     // TSC timestamp
    uint32_t event_type;    // TRACE_SYSCALL, TRACE_IRQ, etc.
    uint32_t cpu;           // Which CPU
    uint32_t pid;           // Process ID
    uint64_t arg1, arg2;    // Event-specific data
} trace_event_t;

typedef struct trace_buffer {
    trace_event_t events[TRACE_BUFFER_SIZE];
    volatile uint32_t head;
    volatile uint32_t tail;
    bool enabled;
} trace_buffer_t;

trace_buffer_t trace_buf;

/* Record trace event (called from kernel code) */
void trace_record(uint32_t type, uint64_t arg1, uint64_t arg2) {
    if (!trace_buf.enabled) return;
    
    uint32_t idx = atomic_inc(&trace_buf.head) % TRACE_BUFFER_SIZE;
    trace_event_t* e = &trace_buf.events[idx];
    
    e->timestamp = read_tsc();
    e->event_type = type;
    e->cpu = get_cpu_id();
    e->pid = current->pid;
    e->arg1 = arg1;
    e->arg2 = arg2;
}

/* Trace points in kernel */
#define TRACE_SYSCALL_ENTER  1
#define TRACE_SYSCALL_EXIT   2
#define TRACE_IRQ_ENTER      3
#define TRACE_IRQ_EXIT       4
#define TRACE_SCHED_SWITCH   5
#define TRACE_PAGE_FAULT     6

/* Example: Trace syscall entry */
long syscall_handler(long num, ...) {
    trace_record(TRACE_SYSCALL_ENTER, num, 0);
    
    long result = do_syscall(num, ...);
    
    trace_record(TRACE_SYSCALL_EXIT, num, result);
    return result;
}
</code></pre>

                    <div class="highlight-box highlight-navy">
                        <i class="fas fa-chart-area me-2"></i>
                        <strong>Visualization:</strong> Export trace data to a file, then visualize with tools like Chrome's <code>chrome://tracing</code> or Perfetto. You'll see exactly what the kernel was doing at each microsecond!
                    </div>
                </div>

                <!-- What You Can Build Section -->
                <div id="build" class="blog-content mt-5">
                    <h2><i class="fas fa-hammer me-2 text-teal"></i>What You Can Build</h2>
                    
                    <div class="highlight-box">
                        <i class="fas fa-rocket me-2"></i>
                        <strong>Phase 16 Project:</strong> A fast OS! Your system now has disk caching for fast file access, an optimized scheduler for responsive multitasking, efficient memory allocation, and tools to measure performance.
                    </div>
                    
                    <p>Let's build a performance benchmark suite that measures all the optimizations we've implemented:</p>

                    <pre><code class="language-c">/* performance_benchmark.c - Comprehensive OS Performance Suite */
#include "cache.h"
#include "scheduler.h"
#include "memory.h"
#include "profiling.h"

typedef struct benchmark_result {
    const char* name;
    uint64_t cycles;
    uint64_t cache_misses;
    uint64_t operations;
    double ops_per_second;
} benchmark_result_t;

/* Benchmark 1: Block Cache Performance */
benchmark_result_t bench_block_cache(void) {
    const uint64_t NUM_OPS = 100000;
    uint64_t start_cycles = read_tsc();
    uint64_t start_misses = read_cache_misses();
    
    // First pass: cold cache (all misses)
    for (uint64_t i = 0; i < 1000; i++) {
        cache_get(&block_cache, i);
    }
    
    // Second pass: warm cache (should hit)
    for (uint64_t i = 0; i < NUM_OPS; i++) {
        cache_get(&block_cache, i % 1000);  // Access within cache size
    }
    
    uint64_t end_cycles = read_tsc();
    uint64_t end_misses = read_cache_misses();
    
    benchmark_result_t result = {
        .name = "Block Cache",
        .cycles = end_cycles - start_cycles,
        .cache_misses = end_misses - start_misses,
        .operations = NUM_OPS,
        .ops_per_second = (double)NUM_OPS / ((end_cycles - start_cycles) / cpu_freq)
    };
    
    kprintf("[BENCH] %s: %lu ops, %lu cycles, %.2f ops/sec, hit_rate=%.1f%%\n",
            result.name, result.operations, result.cycles, result.ops_per_second,
            100.0 * block_cache.hits / (block_cache.hits + block_cache.misses));
    
    return result;
}

/* Benchmark 2: Slab Allocator vs Generic Malloc */
benchmark_result_t bench_slab_allocator(void) {
    const uint64_t NUM_ALLOCS = 50000;
    void* ptrs[1000];
    
    // Benchmark slab allocator
    uint64_t slab_start = read_tsc();
    for (uint64_t i = 0; i < NUM_ALLOCS; i++) {
        ptrs[i % 1000] = slab_alloc(&task_cache);  // Pre-sized for task_struct
        if (i >= 1000) slab_free(&task_cache, ptrs[(i - 1000) % 1000]);
    }
    uint64_t slab_cycles = read_tsc() - slab_start;
    
    // Benchmark generic malloc
    uint64_t malloc_start = read_tsc();
    for (uint64_t i = 0; i < NUM_ALLOCS; i++) {
        ptrs[i % 1000] = kmalloc(sizeof(task_t));
        if (i >= 1000) kfree(ptrs[(i - 1000) % 1000]);
    }
    uint64_t malloc_cycles = read_tsc() - malloc_start;
    
    kprintf("[BENCH] Slab: %lu cycles, Malloc: %lu cycles (%.1fx faster)\n",
            slab_cycles, malloc_cycles, (double)malloc_cycles / slab_cycles);
    
    return (benchmark_result_t){
        .name = "Slab Allocator",
        .cycles = slab_cycles,
        .operations = NUM_ALLOCS
    };
}

/* Benchmark 3: Scheduler Latency */
benchmark_result_t bench_scheduler_latency(void) {
    const int NUM_SAMPLES = 1000;
    uint64_t latencies[NUM_SAMPLES];
    
    for (int i = 0; i < NUM_SAMPLES; i++) {
        uint64_t start = read_tsc();
        yield();  // Voluntary context switch
        latencies[i] = read_tsc() - start;
    }
    
    // Calculate statistics
    uint64_t sum = 0, min = UINT64_MAX, max = 0;
    for (int i = 0; i < NUM_SAMPLES; i++) {
        sum += latencies[i];
        if (latencies[i] < min) min = latencies[i];
        if (latencies[i] > max) max = latencies[i];
    }
    
    kprintf("[BENCH] Context Switch: avg=%lu, min=%lu, max=%lu cycles\n",
            sum / NUM_SAMPLES, min, max);
    
    return (benchmark_result_t){
        .name = "Context Switch",
        .cycles = sum / NUM_SAMPLES,
        .operations = NUM_SAMPLES
    };
}

/* Benchmark 4: TLB/Huge Page Impact */
benchmark_result_t bench_huge_pages(void) {
    const size_t SIZE = 64 * 1024 * 1024;  // 64 MB
    
    // Allocate with 4KB pages
    uint64_t start_4k = read_tsc();
    uint64_t start_tlb = read_pmc_tlb_misses();
    char* mem_4k = vmalloc(SIZE);  // Regular pages
    for (size_t i = 0; i < SIZE; i += 4096) {
        mem_4k[i] = 1;  // Touch each page
    }
    uint64_t cycles_4k = read_tsc() - start_4k;
    uint64_t tlb_4k = read_pmc_tlb_misses() - start_tlb;
    vfree(mem_4k);
    
    // Allocate with 2MB huge pages
    uint64_t start_2m = read_tsc();
    start_tlb = read_pmc_tlb_misses();
    char* mem_2m = vmalloc_huge(SIZE);  // Huge pages
    for (size_t i = 0; i < SIZE; i += 4096) {
        mem_2m[i] = 1;
    }
    uint64_t cycles_2m = read_tsc() - start_2m;
    uint64_t tlb_2m = read_pmc_tlb_misses() - start_tlb;
    vfree(mem_2m);
    
    kprintf("[BENCH] 4KB pages: %lu cycles, %lu TLB misses\n", cycles_4k, tlb_4k);
    kprintf("[BENCH] 2MB pages: %lu cycles, %lu TLB misses (%.1fx faster)\n",
            cycles_2m, tlb_2m, (double)cycles_4k / cycles_2m);
    
    return (benchmark_result_t){
        .name = "Huge Pages",
        .cycles = cycles_2m,
        .operations = SIZE / 4096
    };
}

/* Run all benchmarks */
void run_performance_suite(void) {
    kprintf("\n=== WasilOS Performance Benchmark Suite ===\n\n");
    
    // Enable performance counters
    setup_pmc_cache_misses();
    
    benchmark_result_t results[4];
    results[0] = bench_block_cache();
    results[1] = bench_slab_allocator();
    results[2] = bench_scheduler_latency();
    results[3] = bench_huge_pages();
    
    kprintf("\n=== Benchmark Complete ===\n");
}
</code></pre>

                    <h3>Exercises</h3>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-flask me-2"></i>Exercise 1: Implement Read-Ahead</h4>
                        <p>When reading block N, also prefetch blocks N+1, N+2, etc. into the cache. Most file access is sequential, so this dramatically improves performance.</p>
                        <pre><code class="language-c">void cache_readahead(block_cache_t* cache, uint64_t block, int count) {
    for (int i = 1; i <= count; i++) {
        // Async prefetch without blocking
        cache_prefetch(cache, block + i);
    }
}
</code></pre>
                    </div>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-flask me-2"></i>Exercise 2: Implement CLOCK Algorithm</h4>
                        <p>CLOCK is an approximation of LRU that's cheaper to implement. Instead of moving entries on every access, it uses a "second chance" bit.</p>
                    </div>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-flask me-2"></i>Exercise 3: Add Nice Support</h4>
                        <p>Implement the <code>nice()</code> syscall that allows processes to adjust their priority. Higher nice values = lower priority = slower vruntime increase.</p>
                    </div>
                    
                    <div class="experiment-card">
                        <h4><i class="fas fa-flask me-2"></i>Exercise 4: Build a Profiler</h4>
                        <p>Create a simple sampling profiler that uses timer interrupts to record which function is executing. Build a histogram of where time is spent.</p>
                    </div>

                    <!-- Phase Transition Diagram -->
                    <pre style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 8px; padding: 20px; margin: 24px 0; font-family: 'Courier New', monospace; font-size: 14px; color: #a0a0a0; overflow-x: auto; border: 1px solid #3b9797;">
<span style="color: #3b9797;">╔═════════════════════════════════════════════════════════════════════════════╗</span>
<span style="color: #3b9797;">║</span><span style="color: #e94560;">                    PHASE 16 → PHASE 17 TRANSITION                           </span><span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╠═════════════════════════════════════════════════════════════════════════════╣</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #50fa7b;">Phase 16 Complete:</span>                                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌─────────────────────────────────────────────────────────────────────┐</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> ✓ Block cache (90%+ hit rate)                                       <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> ✓ Page cache (memory-mapped files)                                  <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> ✓ LRU eviction policy                                               <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> ✓ MLFQ scheduler (priority queues)                                  <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> ✓ CFS scheduler (red-black tree)                                    <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> ✓ TLB optimization                                                  <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> ✓ Huge pages (2MB/1GB)                                              <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> ✓ Slab allocator                                                    <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> ✓ Performance counters (PMC)                                        <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> ✓ Kernel tracing                                                    <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└─────────────────────────────────────────────────────────────────────┘</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                    │                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                    ▼                                        <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #8be9fd;">Phase 17 Preview - Stability, Security &amp; Finishing:</span>                      <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">┌─────────────────────────────────────────────────────────────────────┐</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> • Kernel debugging (stack traces, panic handling)                   <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> • Security hardening (ASLR, stack canaries, NX)                     <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> • User/kernel separation                                            <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">│</span> • Complete bootable OS image                                        <span style="color: #f8f8f2;">│</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>  <span style="color: #f8f8f2;">└─────────────────────────────────────────────────────────────────────┘</span>  <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">║</span>                                                                             <span style="color: #3b9797;">║</span>
<span style="color: #3b9797;">╚═════════════════════════════════════════════════════════════════════════════╝</span></pre>

                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Concept</th>
                                <th>What We Built</th>
                                <th>Performance Impact</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Block Cache</strong></td>
                                <td>Hash table + LRU list</td>
                                <td>10,000x faster than disk</td>
                            </tr>
                            <tr>
                                <td><strong>Page Cache</strong></td>
                                <td>File pages in memory</td>
                                <td>Enables mmap()</td>
                            </tr>
                            <tr>
                                <td><strong>CFS Scheduler</strong></td>
                                <td>Red-black tree by vruntime</td>
                                <td>Fair + responsive</td>
                            </tr>
                            <tr>
                                <td><strong>Huge Pages</strong></td>
                                <td>2MB/1GB page support</td>
                                <td>10-50% faster for large allocs</td>
                            </tr>
                            <tr>
                                <td><strong>Slab Allocator</strong></td>
                                <td>Fixed-size object pools</td>
                                <td>10x faster than malloc</td>
                            </tr>
                            <tr>
                                <td><strong>Profiling</strong></td>
                                <td>PMC + tracing</td>
                                <td>Find what to optimize</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Next Steps Section -->
                <div id="next-steps" class="blog-content mt-5">
                    <h2><i class="fas fa-arrow-right me-2 text-teal"></i>Next Steps</h2>
                    
                    <p>With performance optimized, it's time to make the OS stable and secure. In Phase 17, we'll add debugging tools, implement security hardening, and put the finishing touches on our complete operating system.</p>

                    <!-- Related Posts -->
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Phase 15: Hardware Discovery & Drivers</h5>
                            <p class="text-muted small mb-2">Review PCI enumeration and driver framework.</p>
                            <a href="kernel-dev-phase-15-hardware-drivers.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Phase 17: Stability, Security & Finishing</h5>
                            <p class="text-muted small mb-2">Complete the OS with debugging and security.</p>
                            <a href="kernel-dev-phase-17-security.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Phase 0: Orientation & Big Picture</h5>
                            <p class="text-muted small mb-2">Revisit the fundamentals and see how far you've come.</p>
                            <a href="kernel-dev-phase-00-orientation.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">
                        I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest">
                            <i class="fab fa-pinterest-p"></i>
                        </a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <hr class="bg-secondary">

            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small">
                        <i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a>
                    </p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">
                        Enjoying this content? ☕ <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Scroll-to-Top Button -->
    <button id="scrollToTop" class="scroll-to-top" title="Back to Top">
        <i class="fas fa-arrow-up"></i>
    </button>
    <!-- Category Indicator -->
    <div id="categoryIndicator" class="category-indicator" title="Current Section">
        <i class="fas fa-tag"></i><span id="categoryText">Technology</span>
    </div>
    
    <!-- Cookie Consent JS -->
    <script src="../../../js/cookie-consent.js"></script>
    
    <!-- Main JS -->
    <script src="../../../js/main.js"></script>

    <!-- Prism.js Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-nasm.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
</body>
</html>
