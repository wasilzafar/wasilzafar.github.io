<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Master API authentication and authorization - JWT deep dive, OAuth2 flows, PKCE, OpenID Connect, RBAC vs ABAC, Auth0, Okta, AWS Cognito, Azure AD, GCP IAM integration." />
    <meta name="author" content="Wasil Zafar" />
    <meta name="keywords" content="JWT, OAuth2, OpenID Connect, Authentication, Authorization, RBAC, ABAC, Auth0, Okta, AWS Cognito, Azure AD" />
    <meta property="og:title" content="API Development Series Part 5: Authentication & Authorization" />
    <meta property="og:description" content="Master JWT, OAuth2, OpenID Connect, and enterprise authentication patterns." />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2026-01-31" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />
    
    <title>API Development Series Part 5: Authentication & Authorization - Wasil Zafar</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />

    <!-- Prism.js Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <!-- Google Consent Mode v2 -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', {
            'ad_storage': 'denied', 'ad_user_data': 'denied', 'ad_personalization': 'denied', 'analytics_storage': 'denied',
            'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE']
        });
        gtag('consent', 'default', { 'ad_storage': 'granted', 'ad_user_data': 'granted', 'ad_personalization': 'granted', 'analytics_storage': 'granted' });
        gtag('set', 'url_passthrough', true);
    </script>

    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
            var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true; j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PBS8M2JR');
    </script>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <!-- GDPR Cookie Consent Banner -->
    <div id="cookieBanner" class="light display-bottom" style="display: none;">
        <div id="closeIcon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path></svg></div>
        <div class="content-wrap">
            <div class="msg-wrap">
                <div class="title-wrap">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20"><path fill="#3B9797" d="M510.52 255.82c-69.97-.85-126.47-57.69-126.47-127.86-70.17 0-127-56.49-127.86-126.45-27.26-4.14-55.13.3-79.72 12.82l-69.13 35.22a132.221 132.221 0 0 0-57.79 57.81l-35.1 68.88a132.645 132.645 0 0 0-12.82 80.95l12.08 76.27a132.521 132.521 0 0 0 37.16 70.37l54.64 54.64a132.036 132.036 0 0 0 70.37 37.16l76.27 12.15c27.51 4.36 55.7-.11 80.95-12.8l68.88-35.08a132.166 132.166 0 0 0 57.79-57.81l35.1-68.88c12.56-24.64 17.01-52.58 12.91-79.91zM176 368c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm32-160c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm160 128c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32z"></path></svg>
                    <h4 style="margin: 0; font-size: 18px; color: var(--color-navy); font-weight: 700;">Cookie Consent</h4>
                </div>
                <p style="font-size: 14px; line-height: 1.6; color: var(--color-navy); margin-bottom: 15px;">We use cookies to enhance your browsing experience, serve personalized content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies. See our <a href="/privacy-policy.html" style="color: var(--color-teal); border-bottom: 1px dotted var(--color-teal);">Privacy Policy</a> for more information.</p>
                <div id="cookieSettings" style="display: none;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="14" height="14"><path fill="currentColor" d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path></svg><span style="margin-left: 5px; font-size: 12px; font-weight: 600; color: var(--color-navy);">Customize Settings</span></div>
                <div id="cookieTypes" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(59, 151, 151, 0.2);">
                    <h5 style="font-size: 12px; font-weight: 700; color: var(--color-navy); margin-bottom: 10px; text-transform: uppercase;">Cookie Preferences</h5>
                    <div style="margin-bottom: 12px;"><label style="display: flex; align-items: start; cursor: pointer;"><input type="checkbox" checked disabled style="margin-top: 2px; margin-right: 8px; cursor: not-allowed;"><div><strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Essential Cookies (Required)</strong><span style="font-size: 12px; color: #666;">Necessary for the website to function properly.</span></div></label></div>
                    <div style="margin-bottom: 12px;"><label style="display: flex; align-items: start; cursor: pointer;"><input type="checkbox" id="analyticsCookies" checked style="margin-top: 2px; margin-right: 8px;"><div><strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Analytics Cookies</strong><span style="font-size: 12px; color: #666;">Help us understand how you interact with the website.</span></div></label></div>
                    <div style="margin-bottom: 12px;"><label style="display: flex; align-items: start; cursor: pointer;"><input type="checkbox" id="marketingCookies" style="margin-top: 2px; margin-right: 8px;"><div><strong style="font-size: 13px; color: var(--color-navy); display: block; margin-bottom: 2px;">Marketing Cookies</strong><span style="font-size: 12px; color: #666;">Used to deliver relevant advertisements.</span></div></label></div>
                </div>
            </div>
            <div class="btn-wrap">
                <button id="cookieAccept" style="background: var(--color-teal); color: white; font-weight: 600;">Accept All</button>
                <button id="cookieReject" style="background: transparent; color: var(--color-navy); border: 2px solid var(--color-teal); font-weight: 600;">Reject All</button>
                <button id="cookieSave" style="background: var(--color-blue); color: white; font-weight: 600; display: none;">Save Preferences</button>
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/"><span class="gradient-text">Wasil Zafar</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#skills">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#certifications">Certifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#interests">Interests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="../../categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
                <h1 class="display-4 fw-bold mb-3">API Development Series Part 5: Authentication & Authorization</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>January 31, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>45 min read</span>
                    <button onclick="window.print()" class="print-btn" title="Print this article"><i class="fas fa-print"></i> Print</button>
                </div>
                <p class="lead">Master enterprise-grade API authentication and authorization including JWT deep dive, OAuth2 flows with PKCE, OpenID Connect, RBAC vs ABAC, and cloud identity providers.</p>
            </div>
        </div>
    </section>

    <!-- Table of Contents Toggle Button -->
    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents" aria-label="Open Table of Contents"><i class="fas fa-list"></i></button>

    <!-- Side Navigation TOC -->
    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header"><h3><i class="fas fa-list me-2"></i>Table of Contents</h3><button class="closebtn" onclick="closeNav()" aria-label="Close Table of Contents">&times;</button></div>
        <ol>
            <li><a href="#authn-authz" onclick="closeNav()">AuthN vs AuthZ Concepts</a></li>
            <li><a href="#jwt" onclick="closeNav()">JWT Deep Dive</a></li>
            <li><a href="#oauth2" onclick="closeNav()">OAuth2 Flows</a></li>
            <li><a href="#oidc" onclick="closeNav()">OpenID Connect</a></li>
            <li><a href="#rbac-abac" onclick="closeNav()">RBAC vs ABAC</a></li>
            <li><a href="#cloud-providers" onclick="closeNav()">Cloud Identity Providers</a></li>
        </ol>
    </div>
    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <!-- Main Content -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                <div class="blog-content">
                    
                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-rocket me-2"></i>
                        <strong>Series Navigation:</strong> This is Part 5 of the 17-part API Development Series. <a href="api-dev-documentation-dx.html">Review Part 4: Documentation & DX</a> first.
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">17-Part Series</span>
                            <span class="badge bg-crimson">API Development Mastery</span>
                        </div>
                        <div class="content">
                            <ol>
                                <li><a href="api-dev-backend-fundamentals.html">Backend API Fundamentals</a> - REST, HTTP, status codes, URI design</li>
                                <li><a href="api-dev-data-persistence.html">Data Layer & Persistence</a> - Database integration, CRUD, transactions, Redis</li>
                                <li><a href="api-dev-openapi-specification.html">OpenAPI Specification</a> - Contract-first design, OpenAPI 3.0/3.1</li>
                                <li><a href="api-dev-documentation-dx.html">Documentation & DX</a> - Swagger UI, Redoc, developer portals</li>
                                <li><strong>Authentication & Authorization (This Guide)</strong> - OAuth 2.0, JWT, RBAC, ABAC</li>
                                <li><a href="api-dev-security-hardening.html">Security Hardening</a> - OWASP Top 10, input validation, CORS</li>
                                <li><a href="api-dev-aws-api-gateway.html">AWS API Gateway</a> - REST/HTTP APIs, Lambda integration, WAF</li>
                                <li><a href="api-dev-azure-apim.html">Azure API Management</a> - Policies, products, developer portal</li>
                                <li><a href="api-dev-gcp-apigee.html">GCP Apigee</a> - API proxies, monetization, analytics</li>
                                <li><a href="api-dev-architecture-patterns.html">Architecture Patterns</a> - Gateway, BFF, microservices, DDD</li>
                                <li><a href="api-dev-versioning-governance.html">Versioning & Governance</a> - SemVer, deprecation, lifecycle</li>
                                <li><a href="api-dev-monitoring-analytics.html">Monitoring & Analytics</a> - Observability, tracing, SLIs/SLOs</li>
                                <li><a href="api-dev-performance-rate-limiting.html">Performance & Rate Limiting</a> - Caching, throttling, load testing</li>
                                <li><a href="api-dev-graphql-grpc.html">GraphQL & gRPC</a> - Alternative API styles, Protocol Buffers</li>
                                <li><a href="api-dev-testing-contracts.html">Testing & Contracts</a> - Contract testing, Pact, Postman/Newman</li>
                                <li><a href="api-dev-cicd-automation.html">CI/CD & Automation</a> - Spectral, GitHub Actions, Terraform</li>
                                <li><a href="api-dev-product-management.html">API Product Management</a> - API as Product, monetization, ecosystems</li>
                            </ol>
                        </div>
                    </div>

                    <h2 id="authn-authz"><i class="fas fa-user-shield me-2 text-teal"></i>AuthN vs AuthZ Concepts</h2>
                    
                    <h3>Understanding the Difference</h3>
                    <p>Authentication (AuthN) and Authorization (AuthZ) are related but distinct security concepts that every API developer must understand.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-user-check me-2"></i>AuthN vs AuthZ</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal">Reference</span>
                        </div>
                        <div class="content">
                            <table class="table table-bordered">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Aspect</th>
                                        <th>Authentication (AuthN)</th>
                                        <th>Authorization (AuthZ)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Question</strong></td>
                                        <td>"Who are you?"</td>
                                        <td>"What can you do?"</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Purpose</strong></td>
                                        <td>Verify identity</td>
                                        <td>Grant permissions</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Happens</strong></td>
                                        <td>First (before access)</td>
                                        <td>Second (after identity known)</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Examples</strong></td>
                                        <td>Login, API key, JWT</td>
                                        <td>Roles, scopes, policies</td>
                                    </tr>
                                    <tr>
                                        <td><strong>HTTP Status</strong></td>
                                        <td>401 Unauthorized</td>
                                        <td>403 Forbidden</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <h3>API Key Authentication</h3>
                    <p>The simplest authentication method—suitable for server-to-server communication.</p>

<pre><code class="language-javascript">// API Key middleware
const apiKeyAuth = (req, res, next) => {
  const apiKey = req.headers['x-api-key'] || req.query.api_key;
  
  if (!apiKey) {
    return res.status(401).json({
      type: 'https://api.example.com/errors/missing-api-key',
      title: 'Authentication Required',
      status: 401,
      detail: 'Provide an API key via X-API-Key header'
    });
  }
  
  // Validate key (in production: check database/cache)
  const keyData = await validateApiKey(apiKey);
  
  if (!keyData) {
    return res.status(401).json({
      type: 'https://api.example.com/errors/invalid-api-key',
      title: 'Invalid API Key',
      status: 401,
      detail: 'The provided API key is invalid or expired'
    });
  }
  
  // Attach key metadata to request
  req.apiKey = keyData;
  req.clientId = keyData.clientId;
  next();
};

// Generate secure API keys
const crypto = require('crypto');

function generateApiKey(prefix = 'myapp') {
  // Format: prefix_env_randomstring (similar to Stripe pattern)
  const random = crypto.randomBytes(24).toString('base64url');
  return `${prefix}_prod_${random}`;
}
// Example output: myapp_prod_Abc123XyzRandomString</code></pre>

                    <h2 id="jwt"><i class="fas fa-key me-2 text-teal"></i>JWT Deep Dive</h2>

                    <h3>JWT Structure</h3>
                    <p>JSON Web Tokens (JWT) are self-contained tokens with three parts: Header, Payload, and Signature.</p>

<pre><code class="language-javascript">// JWT has 3 parts separated by dots: header.payload.signature
// Example JWT:
// eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
// eyJzdWIiOiJ1c2VyXzEyMyIsIm5hbWUiOiJKb2huIiwiZXhwIjoxNzA0MDY3MjAwfQ.
// SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c

// Header (Base64URL decoded):
{
  "alg": "HS256",  // Algorithm: HS256, RS256, ES256
  "typ": "JWT"
}

// Payload (Base64URL decoded):
{
  "sub": "user_123",           // Subject (user ID)
  "name": "John Doe",          // Custom claim
  "email": "john@example.com",
  "roles": ["user", "admin"],
  "iat": 1704063600,           // Issued at
  "exp": 1704067200,           // Expiration time
  "iss": "https://auth.example.com",  // Issuer
  "aud": "https://api.example.com"    // Audience
}

// Signature:
// HMACSHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload), secret)</code></pre>

                    <h4>JWT Implementation</h4>
<pre><code class="language-javascript">const jwt = require('jsonwebtoken');

// Configuration
const JWT_SECRET = process.env.JWT_SECRET; // For HS256
const JWT_PRIVATE_KEY = process.env.JWT_PRIVATE_KEY; // For RS256
const ACCESS_TOKEN_EXPIRY = '15m';
const REFRESH_TOKEN_EXPIRY = '7d';

// Generate tokens
function generateTokens(user) {
  const accessToken = jwt.sign(
    {
      sub: user.id,
      email: user.email,
      roles: user.roles,
      type: 'access'
    },
    JWT_SECRET,
    {
      expiresIn: ACCESS_TOKEN_EXPIRY,
      issuer: 'https://api.example.com',
      audience: 'https://api.example.com'
    }
  );

  const refreshToken = jwt.sign(
    { sub: user.id, type: 'refresh' },
    JWT_SECRET,
    { expiresIn: REFRESH_TOKEN_EXPIRY }
  );

  return { accessToken, refreshToken };
}

// Verify middleware
const verifyJwt = (req, res, next) => {
  const authHeader = req.headers.authorization;
  
  if (!authHeader?.startsWith('Bearer ')) {
    return res.status(401).json({
      type: 'https://api.example.com/errors/missing-token',
      title: 'Authentication Required',
      status: 401
    });
  }

  const token = authHeader.slice(7); // Remove 'Bearer '
  
  try {
    const decoded = jwt.verify(token, JWT_SECRET, {
      issuer: 'https://api.example.com',
      audience: 'https://api.example.com'
    });
    
    req.user = decoded;
    next();
  } catch (err) {
    if (err.name === 'TokenExpiredError') {
      return res.status(401).json({
        type: 'https://api.example.com/errors/token-expired',
        title: 'Token Expired',
        status: 401,
        detail: 'Your access token has expired. Use refresh token.'
      });
    }
    
    return res.status(401).json({
      type: 'https://api.example.com/errors/invalid-token',
      title: 'Invalid Token',
      status: 401
    });
  }
};</code></pre>

                    <div class="highlight-box highlight-crimson">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>JWT Security Rules:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Never store sensitive data in JWT payload (it's only Base64 encoded, not encrypted)</li>
                            <li>Use short expiry for access tokens (15 minutes typical)</li>
                            <li>Always validate <code>iss</code>, <code>aud</code>, and <code>exp</code> claims</li>
                            <li>Use RS256/ES256 for public/private key signing in distributed systems</li>
                        </ul>
                    </div>

                    <h2 id="oauth2"><i class="fas fa-lock me-2 text-teal"></i>OAuth2 Flows</h2>

                    <h3>OAuth 2.0 Grant Types</h3>
                    <p>OAuth 2.0 defines several flows for different client types and use cases.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-project-diagram me-2"></i>OAuth 2.0 Flows</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal">Reference</span>
                        </div>
                        <div class="content">
                            <table class="table table-bordered">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Flow</th>
                                        <th>Use Case</th>
                                        <th>Security</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Authorization Code + PKCE</strong></td>
                                        <td>SPAs, mobile apps, web apps</td>
                                        <td>Most secure, recommended</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Client Credentials</strong></td>
                                        <td>Machine-to-machine (M2M)</td>
                                        <td>Server-side only</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Device Code</strong></td>
                                        <td>Smart TVs, CLIs, IoT</td>
                                        <td>For limited-input devices</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Refresh Token</strong></td>
                                        <td>Token renewal</td>
                                        <td>Secure rotation required</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <h4>Authorization Code Flow with PKCE</h4>
<pre><code class="language-javascript">// Step 1: Client generates PKCE codes
const crypto = require('crypto');

function generatePKCE() {
  // Code verifier: random 43-128 character string
  const codeVerifier = crypto.randomBytes(32).toString('base64url');
  
  // Code challenge: SHA256 hash of verifier
  const codeChallenge = crypto
    .createHash('sha256')
    .update(codeVerifier)
    .digest('base64url');
  
  return { codeVerifier, codeChallenge };
}

// Step 2: Build authorization URL
const { codeVerifier, codeChallenge } = generatePKCE();

const authUrl = new URL('https://auth.example.com/authorize');
authUrl.searchParams.set('client_id', 'your-client-id');
authUrl.searchParams.set('redirect_uri', 'https://app.example.com/callback');
authUrl.searchParams.set('response_type', 'code');
authUrl.searchParams.set('scope', 'openid profile email tasks:read tasks:write');
authUrl.searchParams.set('state', crypto.randomBytes(16).toString('hex'));
authUrl.searchParams.set('code_challenge', codeChallenge);
authUrl.searchParams.set('code_challenge_method', 'S256');

// Step 3: Exchange code for tokens (at callback)
async function exchangeCodeForTokens(authCode, codeVerifier) {
  const response = await fetch('https://auth.example.com/token', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: new URLSearchParams({
      grant_type: 'authorization_code',
      code: authCode,
      redirect_uri: 'https://app.example.com/callback',
      client_id: 'your-client-id',
      code_verifier: codeVerifier  // Proves we initiated the flow
    })
  });
  
  return response.json();
  // { access_token, refresh_token, expires_in, token_type }
}</code></pre>

                    <h4>Client Credentials Flow</h4>
<pre><code class="language-javascript">// For server-to-server (M2M) communication
async function getM2MToken() {
  const response = await fetch('https://auth.example.com/token', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      'Authorization': `Basic ${Buffer.from(
        `${CLIENT_ID}:${CLIENT_SECRET}`
      ).toString('base64')}`
    },
    body: new URLSearchParams({
      grant_type: 'client_credentials',
      scope: 'api:read api:write'
    })
  });
  
  return response.json();
}</code></pre>

                    <h2 id="oidc"><i class="fas fa-id-card me-2 text-teal"></i>OpenID Connect</h2>

                    <h3>OIDC Layer on OAuth 2.0</h3>
                    <p>OpenID Connect adds an identity layer to OAuth 2.0, providing standardized user information.</p>

<pre><code class="language-javascript">// OIDC adds:
// 1. ID Token - JWT with user identity claims
// 2. UserInfo endpoint - /userinfo
// 3. Standard scopes: openid, profile, email, address, phone
// 4. Discovery document: /.well-known/openid-configuration

// ID Token payload example
{
  "iss": "https://auth.example.com",
  "sub": "user_abc123",
  "aud": "your-client-id",
  "exp": 1704067200,
  "iat": 1704063600,
  "nonce": "n-0S6_WzA2Mj",  // Replay attack prevention
  "at_hash": "MTIzNDU2Nzg",  // Access token hash
  
  // Standard claims (from profile scope)
  "name": "John Doe",
  "given_name": "John",
  "family_name": "Doe",
  "picture": "https://example.com/john.jpg",
  "email": "john@example.com",
  "email_verified": true
}

// Fetch user info
async function getUserInfo(accessToken) {
  const response = await fetch('https://auth.example.com/userinfo', {
    headers: { 'Authorization': `Bearer ${accessToken}` }
  });
  return response.json();
}</code></pre>

                    <h2 id="rbac-abac"><i class="fas fa-users-cog me-2 text-teal"></i>RBAC vs ABAC</h2>

                    <h3>Role-Based Access Control (RBAC)</h3>
<pre><code class="language-javascript">// Define roles and permissions
const permissions = {
  admin: ['tasks:create', 'tasks:read', 'tasks:update', 'tasks:delete', 'users:manage'],
  editor: ['tasks:create', 'tasks:read', 'tasks:update'],
  viewer: ['tasks:read']
};

// RBAC middleware
const requirePermission = (permission) => {
  return (req, res, next) => {
    const userRoles = req.user.roles || [];
    
    const hasPermission = userRoles.some(role => 
      permissions[role]?.includes(permission)
    );
    
    if (!hasPermission) {
      return res.status(403).json({
        type: 'https://api.example.com/errors/forbidden',
        title: 'Access Denied',
        status: 403,
        detail: `Missing permission: ${permission}`
      });
    }
    
    next();
  };
};

// Usage
app.delete('/tasks/:id', 
  verifyJwt, 
  requirePermission('tasks:delete'),
  deleteTask
);</code></pre>

                    <h3>Attribute-Based Access Control (ABAC)</h3>
<pre><code class="language-javascript">// ABAC: Access based on attributes of user, resource, and context
const abacPolicy = {
  rules: [
    {
      // Users can edit their own tasks
      effect: 'allow',
      action: ['update', 'delete'],
      resource: 'task',
      condition: (user, resource) => resource.ownerId === user.id
    },
    {
      // Admins can access everything
      effect: 'allow',
      action: '*',
      resource: '*',
      condition: (user) => user.roles.includes('admin')
    },
    {
      // Only during business hours
      effect: 'allow',
      action: ['create'],
      resource: 'task',
      condition: (user, resource, context) => {
        const hour = new Date().getUTCHours();
        return hour >= 9 && hour < 17; // 9 AM - 5 PM UTC
      }
    }
  ]
};

function evaluateAbac(user, action, resource, context = {}) {
  for (const rule of abacPolicy.rules) {
    const actionMatch = rule.action === '*' || rule.action.includes(action);
    const resourceMatch = rule.resource === '*' || rule.resource === resource.type;
    
    if (actionMatch && resourceMatch && rule.condition(user, resource, context)) {
      return rule.effect === 'allow';
    }
  }
  return false; // Deny by default
}</code></pre>

                    <h2 id="cloud-providers"><i class="fas fa-cloud me-2 text-teal"></i>Cloud Identity Providers</h2>

                    <h3>Choosing an Identity Provider</h3>
                    <div class="highlight-box">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Popular Options:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>Auth0:</strong> Full-featured, great DX, generous free tier</li>
                            <li><strong>AWS Cognito:</strong> Deep AWS integration, cost-effective at scale</li>
                            <li><strong>Azure AD B2C:</strong> Enterprise-grade, Microsoft ecosystem</li>
                            <li><strong>Firebase Auth:</strong> Simple, mobile-first, Google ecosystem</li>
                            <li><strong>Clerk/Supabase:</strong> Developer-friendly alternatives</li>
                        </ul>
                    </div>

                    <h4>Auth0 Integration Example</h4>
<pre><code class="language-javascript">// Express middleware for Auth0 JWT validation
const { auth } = require('express-oauth2-jwt-bearer');

const checkJwt = auth({
  audience: 'https://api.example.com',
  issuerBaseURL: 'https://your-tenant.auth0.com/',
  tokenSigningAlg: 'RS256'
});

// Protected route
app.get('/api/private', checkJwt, (req, res) => {
  res.json({ 
    message: 'Authenticated!',
    user: req.auth.payload 
  });
});

// Check permissions (Auth0 RBAC)
const { requiredScopes } = require('express-oauth2-jwt-bearer');

app.delete('/api/tasks/:id',
  checkJwt,
  requiredScopes('delete:tasks'),
  deleteTask
);</code></pre>

                    <h3 id="exercises">Practice Exercises</h3>

                    <div class="experiment-card">
                        <h4><i class="fas fa-laptop-code me-2"></i>Exercise 1: JWT Authentication</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal">Beginner</span>
                            <span class="badge bg-navy">45 minutes</span>
                        </div>
                        <div class="content">
                            <ul>
                                <li>Implement JWT-based login endpoint</li>
                                <li>Create access and refresh token pair</li>
                                <li>Build token refresh endpoint</li>
                                <li>Add JWT verification middleware</li>
                            </ul>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-laptop-code me-2"></i>Exercise 2: OAuth 2.0 PKCE</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal">Intermediate</span>
                            <span class="badge bg-navy">1 hour</span>
                        </div>
                        <div class="content">
                            <ul>
                                <li>Set up Auth0 or similar provider</li>
                                <li>Implement Authorization Code + PKCE flow</li>
                                <li>Handle callback and token exchange</li>
                                <li>Implement secure token storage</li>
                            </ul>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-laptop-code me-2"></i>Exercise 3: RBAC System</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-crimson">Advanced</span>
                            <span class="badge bg-navy">2 hours</span>
                        </div>
                        <div class="content">
                            <ul>
                                <li>Design role hierarchy (admin, manager, user)</li>
                                <li>Define granular permissions</li>
                                <li>Implement permission checking middleware</li>
                                <li>Add role management endpoints</li>
                            </ul>
                        </div>
                    </div>

                    <div class="highlight-box highlight-navy">
                        <i class="fas fa-forward text-primary me-2"></i>
                        <strong>Next Steps:</strong> In <a href="api-dev-security-hardening.html" style="color: var(--color-crimson);">Part 6: Security Hardening</a>, we'll protect your API against OWASP Top 10 vulnerabilities, implement Zero Trust architecture, and configure WAF rules.
                    </div>

                    <!-- Related Posts -->
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 4: Documentation & Developer Experience</h5>
                            <p class="text-muted small mb-2">Master Swagger UI, Redocly, and developer portal design.</p>
                            <a href="api-dev-documentation-dx.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 6: API Security Hardening</h5>
                            <p class="text-muted small mb-2">Learn OWASP API Top 10, Zero Trust, WAF, and secrets management.</p>
                            <a href="api-dev-security-hardening.html" class="text-decoration-none">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>

                </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.</p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest"><i class="fab fa-pinterest-p"></i></a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email"><i class="fas fa-envelope"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-secondary">
            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small"><i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a></p>
                    <p class="small mt-3"><a href="/" class="text-light text-decoration-none">Home</a> | <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a></p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">Enjoying this content? ☕ <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <button id="scrollToTop" class="scroll-to-top" title="Back to Top"><i class="fas fa-arrow-up"></i></button>
    <div id="categoryIndicator" class="category-indicator" title="Current Section"><i class="fas fa-tag"></i><span id="categoryText">Technology</span></div>
    <script src="../../../js/cookie-consent.js"></script>
    <script src="../../../js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
</body>
</html>
