<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Master asynchronous communication patterns for distributed systems. Learn message queues, event-driven architecture, Kafka, RabbitMQ, and event sourcing patterns." />
    <meta name="author" content="Wasil Zafar" />
    <meta name="keywords" content="Message Queues, Event-Driven Architecture, Kafka, RabbitMQ, Pub/Sub, Event Sourcing, CQRS, System Design, Asynchronous" />
    <meta property="og:title" content="System Design Series Part 7: Message Queues & Event-Driven" />
    <meta property="og:description" content="Master message queues and event-driven architecture for building scalable asynchronous systems." />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2026-01-25" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />
    
    <title>System Design Series Part 7: Message Queues & Event-Driven - Wasil Zafar</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', { 'ad_storage': 'denied', 'ad_user_data': 'denied', 'ad_personalization': 'denied', 'analytics_storage': 'denied', 'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE'] });
        gtag('consent', 'default', { 'ad_storage': 'granted', 'ad_user_data': 'granted', 'ad_personalization': 'granted', 'analytics_storage': 'granted' });
        gtag('set', 'url_passthrough', true);
    </script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PBS8M2JR');</script>

    <style>
        .blog-hero { background: linear-gradient(135deg, var(--color-navy) 0%, var(--color-blue) 100%); color: white; padding: 80px 0; }
        .blog-header { margin-bottom: 2rem; }
        .blog-meta { font-size: 0.95rem; color: var(--color-teal); margin-bottom: 1rem; display: flex; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .print-btn { background: var(--color-teal); color: white; border: none; padding: 0.4rem 1rem; border-radius: 4px; font-size: 0.9rem; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; }
        .print-btn:hover { background: var(--color-crimson); }
        @media print { .print-btn, nav, .navbar, footer, .back-link, .related-posts, .scroll-to-top, .toc-toggle-btn, .sidenav-toc, .sidenav-overlay { display: none !important; } }
        .blog-content { max-width: 900px; margin: 0 auto; font-size: 1.05rem; line-height: 1.8; color: #333; }
        .blog-content h2 { font-size: 1.8rem; font-weight: 700; margin-top: 2.5rem; margin-bottom: 1.5rem; color: var(--color-navy); border-bottom: 3px solid var(--color-teal); padding-bottom: 0.5rem; }
        .blog-content h3 { font-size: 1.3rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; color: var(--color-blue); }
        .blog-content p { margin-bottom: 1.2rem; text-align: justify; }
        .blog-content strong { color: var(--color-crimson); }
        .highlight-box { background: rgba(59, 151, 151, 0.1); border-left: 4px solid var(--color-teal); padding: 1.5rem; margin: 2rem 0; border-radius: 4px; }
        .experiment-card { background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; transition: all 0.3s ease; }
        .experiment-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transform: translateY(-2px); }
        .experiment-card h4 { color: var(--color-crimson); font-weight: 700; }
        pre[class*="language-"] { margin: 1.5rem 0; padding-top: 3rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        .toc-toggle-btn { position: fixed; bottom: 2rem; left: 2rem; width: 50px; height: 50px; background: var(--color-teal); color: white; border: none; border-radius: 50%; font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 12px rgba(59, 151, 151, 0.4); transition: all 0.3s ease; z-index: 1049; display: flex; align-items: center; justify-content: center; }
        .toc-toggle-btn:hover { background: var(--color-crimson); transform: scale(1.1); }
        .sidenav-toc { height: calc(100% - 64px); width: 0; position: fixed; z-index: 1050; top: 64px; left: 0; background: linear-gradient(135deg, var(--color-navy) 0%, var(--color-blue) 100%); overflow-x: hidden; overflow-y: auto; transition: width 0.4s ease; padding-top: 30px; box-shadow: 4px 0 15px rgba(0, 0, 0, 0.3); }
        .sidenav-toc.open { width: 350px; }
        .sidenav-toc .toc-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 30px; margin-bottom: 20px; border-bottom: 2px solid var(--color-teal); opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .sidenav-toc.open .toc-header { opacity: 1; visibility: visible; }
        .sidenav-toc .closebtn { font-size: 32px; color: white; background: transparent; border: none; cursor: pointer; }
        .sidenav-toc .closebtn:hover { color: var(--color-crimson); transform: rotate(90deg); }
        .sidenav-toc h3 { color: white; margin: 0; font-weight: 700; font-size: 1.3rem; flex-grow: 1; }
        .sidenav-toc ol { list-style: decimal; padding-left: 30px; color: rgba(255, 255, 255, 0.9); }
        .sidenav-toc ol li { margin-bottom: 8px; }
        .sidenav-toc ul { list-style-type: lower-alpha; padding-left: 30px; margin-top: 8px; }
        .sidenav-toc a { padding: 12px 30px; text-decoration: none; font-size: 0.95rem; color: rgba(255, 255, 255, 0.85); display: block; transition: all 0.3s ease; border-left: 4px solid transparent; }
        .sidenav-toc a:hover { color: white; background: rgba(59, 151, 151, 0.2); border-left-color: var(--color-teal); padding-left: 35px; }
        .sidenav-toc a.active { color: white; background: rgba(191, 9, 47, 0.3); border-left-color: var(--color-crimson); font-weight: 600; }
        .sidenav-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1049; }
        .sidenav-overlay.show { display: block; }
        @media (max-width: 768px) { .sidenav-toc.open { width: 280px; } .toc-toggle-btn { width: 45px; height: 45px; left: 1rem; bottom: 1rem; } }
        html { scroll-behavior: smooth; }
        .reading-time { display: inline-block; background: var(--color-crimson); color: white; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.9rem; }
        .back-link { display: inline-block; color: white; text-decoration: none; transition: all 0.3s ease; margin-bottom: 1rem; opacity: 0.9; }
        .back-link:hover { color: var(--color-teal); opacity: 1; transform: translateX(-5px); }
        .related-posts { background: #f8f9fa; border-radius: 8px; padding: 2rem; margin-top: 3rem; }
        .related-posts h3 { color: var(--color-navy); margin-bottom: 1.5rem; }
        .related-post-item { padding: 1rem; border-left: 3px solid var(--color-teal); margin-bottom: 1rem; }
        .related-post-item:hover { background: white; border-left-color: var(--color-crimson); }
        .related-post-item a { color: var(--color-blue); text-decoration: none; font-weight: 600; }
        .scroll-to-top { position: fixed; bottom: 2rem; right: 2rem; width: 50px; height: 50px; background: var(--color-teal); color: white; border: none; border-radius: 50%; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59, 151, 151, 0.3); z-index: 999; }
        .scroll-to-top.show { opacity: 1; visibility: visible; }
        .scroll-to-top:hover { background: var(--color-crimson); transform: translateY(-3px); }
    </style>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div id="cookieBanner" class="light display-bottom" style="display: none;">
        <div class="content-wrap">
            <div class="msg-wrap"><p style="font-size: 14px; color: var(--color-navy);">We use cookies. See our <a href="/privacy-policy.html" style="color: var(--color-teal);">Privacy Policy</a>.</p></div>
            <div class="btn-wrap">
                <button id="cookieAccept" style="background: var(--color-teal); color: white;">Accept All</button>
                <button id="cookieReject" style="background: transparent; color: var(--color-navy); border: 2px solid var(--color-teal);">Reject All</button>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/"><span class="gradient-text">Wasil Zafar</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#skills">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#certifications">Certifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#interests">Interests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
                <h1 class="display-4 fw-bold mb-3">System Design Series Part 7: Message Queues & Event-Driven</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>January 25, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>40 min read</span>
                    <button onclick="window.print()" class="print-btn"><i class="fas fa-print"></i> Print</button>
                </div>
                <p class="lead">Master asynchronous communication patterns for building resilient distributed systems. Learn message queues, event-driven architecture, Kafka, RabbitMQ, and event sourcing patterns.</p>
            </div>
        </div>
    </section>

    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents"><i class="fas fa-list"></i></button>

    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()">&times;</button>
        </div>
        <ol>
            <li><a href="#message-queues" onclick="closeNav()">Message Queues</a>
                <ul>
                    <li><a href="#message-queues" onclick="closeNav()">Why Message Queues?</a></li>
                    <li><a href="#queue-patterns" onclick="closeNav()">Queue Patterns</a></li>
                </ul>
            </li>
            <li><a href="#event-driven" onclick="closeNav()">Event-Driven Architecture</a>
                <ul>
                    <li><a href="#event-driven" onclick="closeNav()">Event Fundamentals</a></li>
                    <li><a href="#event-sourcing" onclick="closeNav()">Event Sourcing & CQRS</a></li>
                </ul>
            </li>
            <li><a href="#technologies" onclick="closeNav()">Technologies</a>
                <ul>
                    <li><a href="#technologies" onclick="closeNav()">Kafka vs RabbitMQ</a></li>
                    <li><a href="#choosing" onclick="closeNav()">Choosing the Right Tool</a></li>
                </ul>
            </li>
            <li><a href="#stream-processing" onclick="closeNav()">Stream Processing</a>
                <ul>
                    <li><a href="#stream-processing" onclick="closeNav()">Real-Time Processing</a></li>
                    <li><a href="#kafka-streams" onclick="closeNav()">Kafka Streams</a></li>
                    <li><a href="#flink-storm" onclick="closeNav()">Flink & Storm</a></li>
                </ul>
            </li>
            <li><a href="#next-steps" onclick="closeNav()">Next Steps</a></li>
        </ol>
    </div>

    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <div id="message-queues" class="blog-content">
                    <h2><i class="fas fa-envelope me-2 text-teal"></i>Message Queues</h2>
                    
                    <div class="highlight-box" style="background: rgba(191, 9, 47, 0.1); border-left-color: var(--color-crimson);">
                        <i class="fas fa-book me-2"></i>
                        <strong>Series Navigation:</strong> This is Part 7 of the 15-part System Design Series. <a href="system-design-api-rest-graphql.html">Review Part 6: API Design</a> first.
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-map-signs me-2"></i>Complete Series Navigation</h4>
                        <div class="meta mb-2">
                            <span class="badge bg-teal me-2">15-Part Series</span>
                            <span class="badge bg-crimson">System Design Mastery</span>
                        </div>
                        <div class="content">
                            <ol>
                                <li><a href="system-design-introduction.html">Introduction to System Design</a> - Fundamentals, why it matters, key concepts</li>
                                <li><a href="system-design-scalability-fundamentals.html">Scalability Fundamentals</a> - Horizontal vs vertical scaling, stateless design</li>
                                <li><a href="system-design-load-balancing-caching.html">Load Balancing & Caching</a> - Algorithms, Redis, CDN patterns</li>
                                <li><a href="system-design-database-sharding.html">Database Design & Sharding</a> - SQL vs NoSQL, replication, partitioning</li>
                                <li><a href="system-design-microservices-architecture.html">Microservices Architecture</a> - Service decomposition, API gateways, sagas</li>
                                <li><a href="system-design-api-rest-graphql.html">API Design & REST/GraphQL</a> - RESTful principles, GraphQL, gRPC</li>
                                <li><strong>Message Queues & Event-Driven (This Guide)</strong> - Kafka, RabbitMQ, event sourcing</li>
                                <li><a href="system-design-cap-theorem-consistency.html">CAP Theorem & Consistency</a> - Distributed trade-offs, eventual consistency</li>
                                <li><a href="system-design-rate-limiting-security.html">Rate Limiting & Security</a> - Throttling algorithms, DDoS protection</li>
                                <li><a href="system-design-monitoring-observability.html">Monitoring & Observability</a> - Logging, metrics, distributed tracing</li>
                                <li><a href="system-design-real-world-case-studies.html">Real-World Case Studies</a> - URL shortener, chat, feed, video streaming</li>
                                <li><a href="system-design-low-level-design-patterns.html">Low-Level Design Patterns</a> - SOLID, OOP patterns, data modeling</li>
                                <li><a href="system-design-distributed-systems-deep-dive.html">Distributed Systems Deep Dive</a> - Consensus, Paxos, Raft, coordination</li>
                                <li><a href="system-design-authentication-security.html">Authentication & Security</a> - OAuth, JWT, zero trust, compliance</li>
                                <li><a href="system-design-interview-preparation.html">Interview Preparation</a> - 4-step framework, estimation, strategies</li>
                            </ol>
                        </div>
                    </div>
                    
                    <p><strong>Message queues</strong> enable asynchronous communication between services by decoupling the sender from the receiver. This improves system resilience, scalability, and allows services to operate independently.</p>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Key Insight:</strong> Message queues turn synchronous failures into asynchronous retries. When a downstream service is down, messages wait safely in the queue.
                    </div>

                    <h3>Why Use Message Queues?</h3>
                    <ul>
                        <li><strong>Decoupling:</strong> Producers and consumers don't need to know about each other</li>
                        <li><strong>Buffering:</strong> Handle traffic spikes by queuing requests</li>
                        <li><strong>Resilience:</strong> Messages persist even if consumers are temporarily unavailable</li>
                        <li><strong>Scalability:</strong> Add more consumers to process messages in parallel</li>
                        <li><strong>Ordering:</strong> Guarantee message processing order when needed</li>
                    </ul>

                    <div class="experiment-card">
                        <h4><i class="fas fa-code me-2"></i>Basic Queue Producer/Consumer</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># Producer - Sends messages to queue
import pika
import json

connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

# Declare a durable queue (survives broker restart)
channel.queue_declare(queue='order_queue', durable=True)

def send_order(order):
    message = json.dumps(order)
    channel.basic_publish(
        exchange='',
        routing_key='order_queue',
        body=message,
        properties=pika.BasicProperties(
            delivery_mode=2,  # Make message persistent
        )
    )
    print(f"Sent order: {order['id']}")

# Send sample orders
send_order({"id": "order_123", "user": "john", "total": 99.99})
send_order({"id": "order_124", "user": "jane", "total": 149.50})</code></pre>

<pre><code class="language-python"># Consumer - Processes messages from queue
import pika
import json
import time

connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

channel.queue_declare(queue='order_queue', durable=True)

def process_order(ch, method, properties, body):
    order = json.loads(body)
    print(f"Processing order: {order['id']}")
    
    # Simulate processing time
    time.sleep(2)
    
    # Acknowledge message after successful processing
    ch.basic_ack(delivery_tag=method.delivery_tag)
    print(f"Completed order: {order['id']}")

# Fetch one message at a time (fair dispatch)
channel.basic_qos(prefetch_count=1)

# Start consuming
channel.basic_consume(queue='order_queue', on_message_callback=process_order)
print("Waiting for orders...")
channel.start_consuming()</code></pre>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">RabbitMQ</span>
                            <span class="bias-tag">Producer-Consumer</span>
                        </div>
                    </div>
                </div>

                <div id="queue-patterns" class="blog-content mt-5">
                    <h3>Queue Patterns</h3>

                    <div class="experiment-card">
                        <h4><i class="fas fa-users me-2"></i>Point-to-Point (Work Queue)</h4>
                        <div class="experiment-content">
                            <p>Each message is consumed by exactly one consumer. Multiple consumers can compete for messages to distribute workload.</p>
<pre><code class="language-python"># Multiple workers compete for messages
# Message goes to only ONE worker

Producer ---> [Queue] ---> Consumer 1
                      ---> Consumer 2
                      ---> Consumer 3

# Each message processed by exactly one consumer
# Great for distributing work across workers</code></pre>
                            <p><strong>Use cases:</strong> Order processing, background jobs, task distribution</p>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-broadcast-tower me-2"></i>Publish-Subscribe (Fanout)</h4>
                        <div class="experiment-content">
                            <p>Each message is delivered to all subscribed consumers. Publishers don't know about subscribers.</p>
<pre><code class="language-python"># All subscribers receive every message
                           ---> [Queue 1] ---> Email Service
Producer ---> [Exchange] ---> [Queue 2] ---> SMS Service
                           ---> [Queue 3] ---> Push Notification

# Example: User signup triggers multiple notifications
channel.exchange_declare(exchange='user_events', exchange_type='fanout')

def publish_signup(user):
    channel.basic_publish(
        exchange='user_events',
        routing_key='',  # Ignored for fanout
        body=json.dumps({'event': 'signup', 'user': user})
    )

# Each service creates its own queue bound to exchange</code></pre>
                            <p><strong>Use cases:</strong> Notifications, event broadcasting, logging</p>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-route me-2"></i>Topic-Based Routing</h4>
                        <div class="experiment-content">
                            <p>Messages are routed to queues based on routing key patterns.</p>
<pre><code class="language-python"># Route messages based on topic pattern
channel.exchange_declare(exchange='orders', exchange_type='topic')

# Publish with routing key
channel.basic_publish(
    exchange='orders',
    routing_key='order.created.electronics',  # topic pattern
    body=json.dumps(order)
)

# Consumer 1: All order events
channel.queue_bind(exchange='orders', queue='all_orders', routing_key='order.#')

# Consumer 2: Only electronics orders  
channel.queue_bind(exchange='orders', queue='electronics', routing_key='order.*.electronics')

# Consumer 3: Only order creation events
channel.queue_bind(exchange='orders', queue='new_orders', routing_key='order.created.*')

# Patterns: * matches one word, # matches zero or more words</code></pre>
                            <p><strong>Use cases:</strong> Event filtering, multi-tenant systems, log aggregation</p>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-arrow-left me-2"></i>Dead Letter Queue (DLQ)</h4>
                        <div class="experiment-content">
                            <p>Messages that fail processing are moved to a separate queue for investigation.</p>
<pre><code class="language-python"># DLQ Configuration
# Create DLQ
channel.queue_declare(queue='order_queue_dlq', durable=True)

# Create main queue with DLQ routing
channel.queue_declare(
    queue='order_queue',
    durable=True,
    arguments={
        'x-dead-letter-exchange': '',
        'x-dead-letter-routing-key': 'order_queue_dlq',
        'x-message-ttl': 86400000  # 24 hours TTL
    }
)

# Consumer with error handling
def process_order(ch, method, properties, body):
    try:
        order = json.loads(body)
        process(order)
        ch.basic_ack(delivery_tag=method.delivery_tag)
    except Exception as e:
        # Reject message -> goes to DLQ
        ch.basic_nack(delivery_tag=method.delivery_tag, requeue=False)
        log_error(f"Order failed: {e}")</code></pre>
                            <p><strong>Use cases:</strong> Error investigation, retry mechanisms, audit trails</p>
                        </div>
                    </div>

                    <h4>Delivery Guarantees</h4>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Guarantee</th>
                                <th>Description</th>
                                <th>Trade-off</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>At-most-once</strong></td>
                                <td>Message may be lost but never duplicated</td>
                                <td>Highest performance, potential data loss</td>
                            </tr>
                            <tr>
                                <td><strong>At-least-once</strong></td>
                                <td>Message delivered at least once, may duplicate</td>
                                <td>No data loss, consumers must be idempotent</td>
                            </tr>
                            <tr>
                                <td><strong>Exactly-once</strong></td>
                                <td>Message delivered exactly once</td>
                                <td>Most complex, highest latency</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="event-driven" class="blog-content mt-5">
                    <h2><i class="fas fa-bolt me-2 text-teal"></i>Event-Driven Architecture</h2>
                    <p><strong>Event-driven architecture (EDA)</strong> is a design pattern where the flow of the program is determined by eventsâ€”significant changes in state that other parts of the system may need to react to.</p>

                    <h3>Event Types</h3>
                    <ul>
                        <li><strong>Domain Events:</strong> Business-significant occurrences (OrderPlaced, UserRegistered)</li>
                        <li><strong>Integration Events:</strong> Cross-service communication events</li>
                        <li><strong>System Events:</strong> Infrastructure events (ServerStarted, DatabaseConnected)</li>
                    </ul>

                    <div class="experiment-card">
                        <h4><i class="fas fa-sitemap me-2"></i>Event-Driven Design</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># Event definitions
from dataclasses import dataclass
from datetime import datetime
from typing import Optional
import uuid

@dataclass
class Event:
    event_id: str
    event_type: str
    timestamp: datetime
    correlation_id: Optional[str] = None

@dataclass
class OrderPlaced(Event):
    order_id: str
    user_id: str
    items: list
    total: float

@dataclass
class PaymentProcessed(Event):
    order_id: str
    payment_id: str
    amount: float
    status: str

@dataclass
class InventoryReserved(Event):
    order_id: str
    items: list
    warehouse_id: str

# Event publisher
class EventPublisher:
    def __init__(self, message_queue):
        self.mq = message_queue
    
    def publish(self, event):
        self.mq.publish(
            topic=event.event_type,
            message={
                'event_id': event.event_id,
                'event_type': event.event_type,
                'timestamp': event.timestamp.isoformat(),
                'data': event.__dict__
            }
        )

# Event handler
class OrderEventHandler:
    def handle(self, event):
        if isinstance(event, OrderPlaced):
            # Trigger inventory reservation
            self.inventory_service.reserve(event.order_id, event.items)
            # Trigger payment processing
            self.payment_service.process(event.order_id, event.total)</code></pre>
                        </div>
                    </div>

                    <h3>Choreography vs Orchestration</h3>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Aspect</th>
                                <th>Choreography</th>
                                <th>Orchestration</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Coordination</strong></td>
                                <td>Services react to events independently</td>
                                <td>Central orchestrator directs services</td>
                            </tr>
                            <tr>
                                <td><strong>Coupling</strong></td>
                                <td>Loose (event-based)</td>
                                <td>Tighter (orchestrator knows all services)</td>
                            </tr>
                            <tr>
                                <td><strong>Visibility</strong></td>
                                <td>Distributed, harder to trace</td>
                                <td>Centralized, easy to monitor</td>
                            </tr>
                            <tr>
                                <td><strong>Complexity</strong></td>
                                <td>Logic distributed across services</td>
                                <td>Logic centralized in orchestrator</td>
                            </tr>
                            <tr>
                                <td><strong>Best For</strong></td>
                                <td>Simple flows, loose coupling</td>
                                <td>Complex workflows, explicit control</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="event-sourcing" class="blog-content mt-5">
                    <h3>Event Sourcing & CQRS</h3>

                    <div class="experiment-card">
                        <h4><i class="fas fa-history me-2"></i>Event Sourcing</h4>
                        <div class="experiment-content">
                            <p>Store all state changes as a sequence of events. Current state is derived by replaying events.</p>
<pre><code class="language-python"># Event Sourcing Example - Bank Account
class BankAccount:
    def __init__(self, account_id):
        self.account_id = account_id
        self.balance = 0
        self.events = []
    
    # Commands create events
    def deposit(self, amount, timestamp):
        event = DepositEvent(
            account_id=self.account_id,
            amount=amount,
            timestamp=timestamp
        )
        self._apply(event)
        self.events.append(event)
    
    def withdraw(self, amount, timestamp):
        if amount > self.balance:
            raise InsufficientFundsError()
        
        event = WithdrawEvent(
            account_id=self.account_id,
            amount=amount,
            timestamp=timestamp
        )
        self._apply(event)
        self.events.append(event)
    
    # Apply events to update state
    def _apply(self, event):
        if isinstance(event, DepositEvent):
            self.balance += event.amount
        elif isinstance(event, WithdrawEvent):
            self.balance -= event.amount
    
    # Rebuild state from events
    @classmethod
    def rebuild_from_events(cls, account_id, events):
        account = cls(account_id)
        for event in events:
            account._apply(event)
        return account

# Event Store
class EventStore:
    def __init__(self):
        self.events = {}  # account_id -> [events]
    
    def save_events(self, aggregate_id, events, expected_version):
        # Optimistic concurrency check
        current_version = len(self.events.get(aggregate_id, []))
        if current_version != expected_version:
            raise ConcurrencyException()
        
        self.events.setdefault(aggregate_id, []).extend(events)
    
    def get_events(self, aggregate_id):
        return self.events.get(aggregate_id, [])</code></pre>
                            <p><strong>Benefits:</strong> Complete audit trail, temporal queries, debugging, replay</p>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-columns me-2"></i>CQRS (Command Query Responsibility Segregation)</h4>
                        <div class="experiment-content">
                            <p>Separate models for reading (queries) and writing (commands) data.</p>
<pre><code class="language-python"># CQRS Implementation
# Write Model (Commands) - Handles business logic
class OrderCommandHandler:
    def __init__(self, event_store, event_bus):
        self.event_store = event_store
        self.event_bus = event_bus
    
    def handle_create_order(self, command):
        # Load aggregate from events
        events = self.event_store.get_events(command.order_id)
        order = Order.rebuild_from_events(events)
        
        # Execute business logic
        new_events = order.create(command.user_id, command.items)
        
        # Save new events
        self.event_store.save_events(command.order_id, new_events)
        
        # Publish events for read model update
        for event in new_events:
            self.event_bus.publish(event)

# Read Model (Queries) - Optimized for reading
class OrderReadModel:
    def __init__(self):
        self.orders = {}  # Denormalized view
    
    def handle_order_created(self, event):
        self.orders[event.order_id] = {
            'id': event.order_id,
            'user_id': event.user_id,
            'items': event.items,
            'status': 'created',
            'total': sum(item['price'] for item in event.items)
        }
    
    def handle_order_shipped(self, event):
        self.orders[event.order_id]['status'] = 'shipped'
        self.orders[event.order_id]['shipped_at'] = event.timestamp
    
    # Fast queries on denormalized data
    def get_user_orders(self, user_id):
        return [o for o in self.orders.values() if o['user_id'] == user_id]</code></pre>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>When to Use:</strong> Event Sourcing + CQRS shine in domains with complex business logic, audit requirements, or high read/write asymmetry. Overkill for simple CRUD applications.
                    </div>
                </div>

                <div id="technologies" class="blog-content mt-5">
                    <h2><i class="fas fa-tools me-2 text-teal"></i>Technologies</h2>

                    <div class="experiment-card">
                        <h4><i class="fas fa-stream me-2"></i>Apache Kafka</h4>
                        <div class="experiment-content">
                            <p>Distributed streaming platform for high-throughput, fault-tolerant messaging.</p>
<pre><code class="language-python"># Kafka Producer
from kafka import KafkaProducer
import json

producer = KafkaProducer(
    bootstrap_servers=['localhost:9092'],
    value_serializer=lambda v: json.dumps(v).encode('utf-8'),
    acks='all',  # Wait for all replicas
    retries=3
)

def send_event(topic, event):
    future = producer.send(topic, value=event)
    record_metadata = future.get(timeout=10)
    print(f"Sent to {record_metadata.topic} partition {record_metadata.partition}")

send_event('orders', {'order_id': '123', 'status': 'created'})

# Kafka Consumer
from kafka import KafkaConsumer

consumer = KafkaConsumer(
    'orders',
    bootstrap_servers=['localhost:9092'],
    group_id='order-processor',
    auto_offset_reset='earliest',
    enable_auto_commit=False,  # Manual commit for exactly-once
    value_deserializer=lambda m: json.loads(m.decode('utf-8'))
)

for message in consumer:
    print(f"Received: {message.value}")
    process_order(message.value)
    consumer.commit()  # Commit after successful processing</code></pre>
                            <p><strong>Key Features:</strong> Partitions for parallelism, replication for durability, log compaction, exactly-once semantics</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">High Throughput</span>
                            <span class="bias-tag">Event Streaming</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-rabbit me-2"></i>RabbitMQ</h4>
                        <div class="experiment-content">
                            <p>Traditional message broker with flexible routing and multiple protocols (AMQP, MQTT, STOMP).</p>
                            <p><strong>Key Features:</strong> Exchange types (direct, fanout, topic, headers), message acknowledgment, dead letter queues, priority queues</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Flexible Routing</span>
                            <span class="bias-tag">Multiple Protocols</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-cloud me-2"></i>AWS SQS + SNS</h4>
                        <div class="experiment-content">
                            <p>Managed messaging services. SQS for queues, SNS for pub/sub.</p>
<pre><code class="language-python"># AWS SQS
import boto3

sqs = boto3.client('sqs')

# Send message
sqs.send_message(
    QueueUrl='https://sqs.region.amazonaws.com/account/queue-name',
    MessageBody=json.dumps({'order_id': '123'}),
    MessageGroupId='order-group',  # For FIFO queues
    MessageDeduplicationId='unique-id'
)

# Receive and delete
response = sqs.receive_message(
    QueueUrl=queue_url,
    MaxNumberOfMessages=10,
    WaitTimeSeconds=20  # Long polling
)

for message in response.get('Messages', []):
    process(message['Body'])
    sqs.delete_message(
        QueueUrl=queue_url,
        ReceiptHandle=message['ReceiptHandle']
    )</code></pre>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Managed</span>
                            <span class="bias-tag">AWS Native</span>
                        </div>
                    </div>
                </div>

                <div id="choosing" class="blog-content mt-5">
                    <h3>Choosing the Right Tool</h3>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Tool</th>
                                <th>Best For</th>
                                <th>Throughput</th>
                                <th>Features</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Apache Kafka</strong></td>
                                <td>Event streaming, high volume</td>
                                <td>Millions/sec</td>
                                <td>Log retention, replay, exactly-once</td>
                            </tr>
                            <tr>
                                <td><strong>RabbitMQ</strong></td>
                                <td>Complex routing, traditional MQ</td>
                                <td>Tens of thousands/sec</td>
                                <td>Flexible routing, multiple protocols</td>
                            </tr>
                            <tr>
                                <td><strong>AWS SQS</strong></td>
                                <td>Simple queuing, serverless</td>
                                <td>Thousands/sec</td>
                                <td>Managed, pay-per-use, FIFO option</td>
                            </tr>
                            <tr>
                                <td><strong>Redis Streams</strong></td>
                                <td>Lightweight streaming</td>
                                <td>Hundreds of thousands/sec</td>
                                <td>In-memory, consumer groups</td>
                            </tr>
                            <tr>
                                <td><strong>Apache Pulsar</strong></td>
                                <td>Multi-tenant, geo-replication</td>
                                <td>Millions/sec</td>
                                <td>Tiered storage, functions</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Selection Guide:</strong>
                        <ul>
                            <li><strong>High throughput streaming:</strong> Kafka or Pulsar</li>
                            <li><strong>Complex routing needs:</strong> RabbitMQ</li>
                            <li><strong>AWS-native, managed:</strong> SQS/SNS</li>
                            <li><strong>Already using Redis:</strong> Redis Streams</li>
                        </ul>
                    </div>
                </div>

                <div id="stream-processing" class="blog-content mt-5">
                    <h2><i class="fas fa-stream me-2 text-teal"></i>Real-Time Stream Processing</h2>
                    
                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Key Insight:</strong> Stream processing analyzes data in motion, enabling real-time insights and decisions as events flow through the system.
                    </div>
                    
                    <p><strong>Stream processing</strong> differs from batch processing in that it processes data continuously as it arrives, rather than in scheduled batches. This is essential for real-time analytics, fraud detection, and live dashboards.</p>
                    
                    <h4 class="mt-4">Stream vs Batch Processing</h4>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Aspect</th>
                                <th>Batch Processing</th>
                                <th>Stream Processing</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Latency</strong></td>
                                <td>Minutes to hours</td>
                                <td>Milliseconds to seconds</td>
                            </tr>
                            <tr>
                                <td><strong>Data Model</strong></td>
                                <td>Bounded datasets</td>
                                <td>Unbounded data streams</td>
                            </tr>
                            <tr>
                                <td><strong>Use Cases</strong></td>
                                <td>ETL, reports, ML training</td>
                                <td>Real-time analytics, fraud detection</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>Windowing Concepts</h4>
                    <p>Windows group streaming events for aggregation:</p>
                    <ul>
                        <li><strong>Tumbling Window:</strong> Fixed-size, non-overlapping (e.g., count per minute)</li>
                        <li><strong>Sliding Window:</strong> Fixed-size, overlapping (e.g., last 5 minutes, updated every minute)</li>
                        <li><strong>Session Window:</strong> Dynamic size based on activity gaps</li>
                    </ul>
                </div>

                <div id="kafka-streams" class="blog-content mt-5">
                    <h3>Kafka Streams</h3>
                    <p><strong>Kafka Streams</strong> is a lightweight stream processing library built directly on Apache Kafka. It processes data stored in Kafka topics and writes results back to Kafka.</p>
                    
                    <h4 class="mt-3">Key Features</h4>
                    <ul>
                        <li><strong>No external dependencies:</strong> Runs as a library within your application</li>
                        <li><strong>Exactly-once semantics:</strong> Guarantees each record is processed exactly once</li>
                        <li><strong>Stateful processing:</strong> Built-in state stores for aggregations and joins</li>
                        <li><strong>Windowing:</strong> Time-based and session windows for temporal analysis</li>
                    </ul>
                    
<pre><code class="language-java">// Kafka Streams Example
StreamsBuilder builder = new StreamsBuilder();
KStream&lt;String, String&gt; source = builder.stream("input-topic");

source
    .filter((key, value) -> value.contains("important"))
    .mapValues(value -> value.toUpperCase())
    .to("output-topic");

KafkaStreams streams = new KafkaStreams(builder.build(), props);
streams.start();
</code></pre>
                    
                    <p><strong>Use Cases:</strong> Real-time analytics, fraud detection, event-driven microservices, and stream processing that needs to stay close to Kafka.</p>
                </div>

                <div id="flink-storm" class="blog-content mt-5">
                    <h3>Apache Flink & Apache Storm</h3>
                    
                    <h4>Apache Flink</h4>
                    <p><strong>Apache Flink</strong> is a distributed stream processing framework designed for high-throughput, low-latency data processing. It excels at stateful computations over unbounded data streams.</p>
                    
                    <ul>
                        <li><strong>True streaming:</strong> Processes one event at a time (not micro-batches)</li>
                        <li><strong>Exactly-once state consistency:</strong> Via distributed snapshots</li>
                        <li><strong>Event time processing:</strong> Handles out-of-order events</li>
                        <li><strong>Unified batch & stream:</strong> Same API for both paradigms</li>
                    </ul>
                    
                    <h4 class="mt-4">Apache Storm</h4>
                    <p><strong>Apache Storm</strong> is a real-time computation system focused on processing unbounded streams of data reliably.</p>
                    
                    <ul>
                        <li><strong>Spouts:</strong> Sources of streams (read from queues, APIs)</li>
                        <li><strong>Bolts:</strong> Processing units (filter, aggregate, join)</li>
                        <li><strong>Topologies:</strong> Networks of spouts and bolts</li>
                        <li><strong>At-least-once:</strong> Default processing guarantee</li>
                    </ul>
                    
                    <h4 class="mt-4">Comparison</h4>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Framework</th>
                                <th>Best For</th>
                                <th>Latency</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Kafka Streams</strong></td>
                                <td>Kafka-centric applications</td>
                                <td>Low</td>
                            </tr>
                            <tr>
                                <td><strong>Apache Flink</strong></td>
                                <td>Complex event processing, ML</td>
                                <td>Very Low</td>
                            </tr>
                            <tr>
                                <td><strong>Apache Storm</strong></td>
                                <td>Simple, low-latency pipelines</td>
                                <td>Very Low</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <p><strong>Choosing a Framework:</strong> Use Kafka Streams for Kafka-centric apps (simplest), Flink for complex stateful processing and ML, or Storm for legacy compatibility and simple topologies.</p>
                </div>

                <div id="next-steps" class="blog-content mt-5">
                    <h2><i class="fas fa-arrow-right me-2 text-teal"></i>Next Steps</h2>
                    
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 6: API Design & REST/GraphQL</h5>
                            <p class="text-muted small mb-2">Review API design best practices and REST vs GraphQL.</p>
                            <a href="system-design-api-rest-graphql.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 8: CAP Theorem & Consistency</h5>
                            <p class="text-muted small mb-2">Understand distributed systems trade-offs with CAP theorem.</p>
                            <a href="system-design-cap-theorem-consistency.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 9: Rate Limiting & Security</h5>
                            <p class="text-muted small mb-2">Learn rate limiting algorithms and security best practices.</p>
                            <a href="system-design-rate-limiting-security.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">
                        I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest">
                            <i class="fab fa-pinterest-p"></i>
                        </a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <hr class="bg-secondary">

            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small">
                        <i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a>
                    </p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">
                        Enjoying this content? â˜• <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Keep me caffeinated</a> to keep the pixels flowing!
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <button id="scrollToTop" class="scroll-to-top"><i class="fas fa-arrow-up"></i></button>
    <script src="../../../js/cookie-consent.js"></script>
    <script src="../../../js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scrollToTopBtn = document.getElementById('scrollToTop');
            window.addEventListener('scroll', function() { scrollToTopBtn.classList.toggle('show', window.scrollY > 300); });
            scrollToTopBtn.addEventListener('click', function() { window.scrollTo({ top: 0, behavior: 'smooth' }); });
        });
        function openNav() { document.getElementById('tocSidenav').classList.add('open'); document.getElementById('tocOverlay').classList.add('show'); document.body.style.overflow = 'hidden'; }
        function closeNav() { document.getElementById('tocSidenav').classList.remove('open'); document.getElementById('tocOverlay').classList.remove('show'); document.body.style.overflow = 'auto'; }
        document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeNav(); });
        const themes = { 'prism-theme': 'Tomorrow Night', 'prism-default': 'Default', 'prism-dark': 'Dark', 'prism-twilight': 'Twilight', 'prism-okaidia': 'Okaidia', 'prism-solarizedlight': 'Solarized Light' };
        const savedTheme = localStorage.getItem('prism-theme') || 'prism-theme';
        function switchTheme(themeId) { Object.keys(themes).forEach(id => { const link = document.getElementById(id); if (link) link.disabled = true; }); const selectedLink = document.getElementById(themeId); if (selectedLink) { selectedLink.disabled = false; localStorage.setItem('prism-theme', themeId); } setTimeout(() => Prism.highlightAll(), 10); }
        document.addEventListener('DOMContentLoaded', function() { switchTheme(savedTheme); });
        Prism.plugins.toolbar.registerButton('theme-switcher', function() { const select = document.createElement('select'); Object.keys(themes).forEach(id => { const opt = document.createElement('option'); opt.value = id; opt.textContent = themes[id]; if (id === savedTheme) opt.selected = true; select.appendChild(opt); }); select.addEventListener('change', e => switchTheme(e.target.value)); return select; });
    </script>
</body>
</html>
