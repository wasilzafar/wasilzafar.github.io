<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Master monitoring and observability for distributed systems. Learn logging, metrics, distributed tracing, alerting strategies, and the three pillars of observability." />
    <meta name="author" content="Wasil Zafar" />
    <meta name="keywords" content="Monitoring, Observability, Logging, Metrics, Distributed Tracing, Prometheus, Grafana, OpenTelemetry, Alerting, System Design" />
    <meta property="og:title" content="System Design Series Part 10: Monitoring & Observability" />
    <meta property="og:description" content="Master monitoring and observability to gain insights into your distributed systems' health and performance." />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2026-01-25" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />
    
    <title>System Design Series Part 10: Monitoring & Observability - Wasil Zafar</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', { 'ad_storage': 'denied', 'ad_user_data': 'denied', 'ad_personalization': 'denied', 'analytics_storage': 'denied', 'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE'] });
        gtag('consent', 'default', { 'ad_storage': 'granted', 'ad_user_data': 'granted', 'ad_personalization': 'granted', 'analytics_storage': 'granted' });
        gtag('set', 'url_passthrough', true);
    </script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PBS8M2JR');</script>

    <style>
        .blog-hero { background: linear-gradient(135deg, var(--color-navy) 0%, var(--color-blue) 100%); color: white; padding: 80px 0; }
        .blog-header { margin-bottom: 2rem; }
        .blog-meta { font-size: 0.95rem; color: var(--color-teal); margin-bottom: 1rem; display: flex; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .print-btn { background: var(--color-teal); color: white; border: none; padding: 0.4rem 1rem; border-radius: 4px; font-size: 0.9rem; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; }
        .print-btn:hover { background: var(--color-crimson); }
        @media print { .print-btn, nav, .navbar, footer, .back-link, .related-posts, .scroll-to-top, .toc-toggle-btn, .sidenav-toc, .sidenav-overlay { display: none !important; } }
        .blog-content { max-width: 900px; margin: 0 auto; font-size: 1.05rem; line-height: 1.8; color: #333; }
        .blog-content h2 { font-size: 1.8rem; font-weight: 700; margin-top: 2.5rem; margin-bottom: 1.5rem; color: var(--color-navy); border-bottom: 3px solid var(--color-teal); padding-bottom: 0.5rem; }
        .blog-content h3 { font-size: 1.3rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; color: var(--color-blue); }
        .blog-content p { margin-bottom: 1.2rem; text-align: justify; }
        .blog-content strong { color: var(--color-crimson); }
        .highlight-box { background: rgba(59, 151, 151, 0.1); border-left: 4px solid var(--color-teal); padding: 1.5rem; margin: 2rem 0; border-radius: 4px; }
        .experiment-card { background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; transition: all 0.3s ease; }
        .experiment-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transform: translateY(-2px); }
        .experiment-card h4 { color: var(--color-crimson); font-weight: 700; }
        pre[class*="language-"] { margin: 1.5rem 0; padding-top: 3rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        .toc-toggle-btn { position: fixed; bottom: 2rem; left: 2rem; width: 50px; height: 50px; background: var(--color-teal); color: white; border: none; border-radius: 50%; font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 12px rgba(59, 151, 151, 0.4); transition: all 0.3s ease; z-index: 1049; display: flex; align-items: center; justify-content: center; }
        .toc-toggle-btn:hover { background: var(--color-crimson); transform: scale(1.1); }
        .sidenav-toc { height: calc(100% - 64px); width: 0; position: fixed; z-index: 1050; top: 64px; left: 0; background: linear-gradient(135deg, var(--color-navy) 0%, var(--color-blue) 100%); overflow-x: hidden; overflow-y: auto; transition: width 0.4s ease; padding-top: 30px; box-shadow: 4px 0 15px rgba(0, 0, 0, 0.3); }
        .sidenav-toc.open { width: 350px; }
        .sidenav-toc .toc-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 30px; margin-bottom: 20px; border-bottom: 2px solid var(--color-teal); opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .sidenav-toc.open .toc-header { opacity: 1; visibility: visible; }
        .sidenav-toc .closebtn { font-size: 32px; color: white; background: transparent; border: none; cursor: pointer; }
        .sidenav-toc .closebtn:hover { color: var(--color-crimson); transform: rotate(90deg); }
        .sidenav-toc h3 { color: white; margin: 0; font-weight: 700; font-size: 1.3rem; flex-grow: 1; }
        .sidenav-toc ol { list-style: decimal; padding-left: 30px; color: rgba(255, 255, 255, 0.9); }
        .sidenav-toc ol li { margin-bottom: 8px; }
        .sidenav-toc ul { list-style-type: lower-alpha; padding-left: 30px; margin-top: 8px; }
        .sidenav-toc a { padding: 12px 30px; text-decoration: none; font-size: 0.95rem; color: rgba(255, 255, 255, 0.85); display: block; transition: all 0.3s ease; border-left: 4px solid transparent; }
        .sidenav-toc a:hover { color: white; background: rgba(59, 151, 151, 0.2); border-left-color: var(--color-teal); padding-left: 35px; }
        .sidenav-toc a.active { color: white; background: rgba(191, 9, 47, 0.3); border-left-color: var(--color-crimson); font-weight: 600; }
        .sidenav-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1049; }
        .sidenav-overlay.show { display: block; }
        @media (max-width: 768px) { .sidenav-toc.open { width: 280px; } .toc-toggle-btn { width: 45px; height: 45px; left: 1rem; bottom: 1rem; } }
        html { scroll-behavior: smooth; }
        .reading-time { display: inline-block; background: var(--color-crimson); color: white; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.9rem; }
        .back-link { display: inline-block; color: white; text-decoration: none; transition: all 0.3s ease; margin-bottom: 1rem; opacity: 0.9; }
        .back-link:hover { color: var(--color-teal); opacity: 1; transform: translateX(-5px); }
        .related-posts { background: #f8f9fa; border-radius: 8px; padding: 2rem; margin-top: 3rem; }
        .related-posts h3 { color: var(--color-navy); margin-bottom: 1.5rem; }
        .related-post-item { padding: 1rem; border-left: 3px solid var(--color-teal); margin-bottom: 1rem; }
        .related-post-item:hover { background: white; border-left-color: var(--color-crimson); }
        .related-post-item a { color: var(--color-blue); text-decoration: none; font-weight: 600; }
        .scroll-to-top { position: fixed; bottom: 2rem; right: 2rem; width: 50px; height: 50px; background: var(--color-teal); color: white; border: none; border-radius: 50%; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59, 151, 151, 0.3); z-index: 999; }
        .scroll-to-top.show { opacity: 1; visibility: visible; }
        .scroll-to-top:hover { background: var(--color-crimson); transform: translateY(-3px); }
    </style>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div id="cookieBanner" class="light display-bottom" style="display: none;">
        <div class="content-wrap">
            <div class="msg-wrap"><p style="font-size: 14px; color: var(--color-navy);">We use cookies. See our <a href="/privacy-policy.html" style="color: var(--color-teal);">Privacy Policy</a>.</p></div>
            <div class="btn-wrap">
                <button id="cookieAccept" style="background: var(--color-teal); color: white;">Accept All</button>
                <button id="cookieReject" style="background: transparent; color: var(--color-navy); border: 2px solid var(--color-teal);">Reject All</button>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/"><span class="gradient-text">Wasil Zafar</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#skills">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#certifications">Certifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#interests">Interests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
                <h1 class="display-4 fw-bold mb-3">System Design Series Part 10: Monitoring & Observability</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>January 25, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>40 min read</span>
                    <button onclick="window.print()" class="print-btn"><i class="fas fa-print"></i> Print</button>
                </div>
                <p class="lead">Master monitoring and observability to gain deep insights into your distributed systems' health and performance. Learn the three pillars: logs, metrics, and traces.</p>
            </div>
        </div>
    </section>

    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents"><i class="fas fa-list"></i></button>

    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()">&times;</button>
        </div>
        <ol>
            <li><a href="#observability" onclick="closeNav()">Observability</a>
                <ul>
                    <li><a href="#observability" onclick="closeNav()">Three Pillars</a></li>
                    <li><a href="#monitoring-vs" onclick="closeNav()">Monitoring vs Observability</a></li>
                </ul>
            </li>
            <li><a href="#logging" onclick="closeNav()">Logging</a>
                <ul>
                    <li><a href="#logging" onclick="closeNav()">Structured Logging</a></li>
                    <li><a href="#log-aggregation" onclick="closeNav()">Log Aggregation</a></li>
                </ul>
            </li>
            <li><a href="#metrics" onclick="closeNav()">Metrics</a>
                <ul>
                    <li><a href="#metrics" onclick="closeNav()">Key Metrics</a></li>
                    <li><a href="#prometheus" onclick="closeNav()">Prometheus & Grafana</a></li>
                </ul>
            </li>
            <li><a href="#tracing" onclick="closeNav()">Distributed Tracing</a>
                <ul>
                    <li><a href="#tracing" onclick="closeNav()">Trace Context</a></li>
                    <li><a href="#opentelemetry" onclick="closeNav()">OpenTelemetry</a></li>
                </ul>
            </li>
            <li><a href="#alerting" onclick="closeNav()">Alerting</a></li>
            <li><a href="#next-steps" onclick="closeNav()">Next Steps</a></li>
        </ol>
    </div>

    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <div id="observability" class="blog-content">
                    <h2><i class="fas fa-eye me-2 text-teal"></i>Observability</h2>
                    
                    <div class="highlight-box" style="background: rgba(191, 9, 47, 0.1); border-left-color: var(--color-crimson);">
                        <i class="fas fa-book me-2"></i>
                        <strong>Series Navigation:</strong> This is Part 10 of the 15-part System Design Series. <a href="system-design-rate-limiting-security.html">Review Part 9: Rate Limiting & Security</a> first.
                    </div>
                    
                    <p><strong>Observability</strong> is the ability to understand the internal state of your system by examining its outputs: logs, metrics, and traces. Unlike traditional monitoring, observability allows you to ask questions you didn't anticipate.</p>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Key Insight:</strong> Monitoring tells you when something is wrong. Observability helps you understand why.
                    </div>

                    <h3>The Three Pillars</h3>
                    <ul>
                        <li><strong>Logs:</strong> Discrete events with context (what happened)</li>
                        <li><strong>Metrics:</strong> Numeric measurements over time (how much)</li>
                        <li><strong>Traces:</strong> Request journey across services (where/how long)</li>
                    </ul>
                </div>

                <div id="monitoring-vs" class="blog-content mt-5">
                    <h3>Monitoring vs Observability</h3>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Aspect</th>
                                <th>Monitoring</th>
                                <th>Observability</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Approach</strong></td>
                                <td>Predefined checks and alerts</td>
                                <td>Explore and query any dimension</td>
                            </tr>
                            <tr>
                                <td><strong>Questions</strong></td>
                                <td>Known unknowns</td>
                                <td>Unknown unknowns</td>
                            </tr>
                            <tr>
                                <td><strong>Focus</strong></td>
                                <td>Is it working?</td>
                                <td>Why isn't it working?</td>
                            </tr>
                            <tr>
                                <td><strong>Data</strong></td>
                                <td>Aggregated metrics</td>
                                <td>High-cardinality, correlated data</td>
                            </tr>
                            <tr>
                                <td><strong>Example</strong></td>
                                <td>CPU > 80% alert</td>
                                <td>Why is user X experiencing slow responses?</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="logging" class="blog-content mt-5">
                    <h2><i class="fas fa-file-alt me-2 text-teal"></i>Logging</h2>
                    <p>Logs are timestamped records of discrete events. Structured logging makes logs queryable and analyzable.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-code me-2"></i>Structured Logging</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># Structured Logging with Python
import structlog
import logging

# Configure structured logging
structlog.configure(
    processors=[
        structlog.stdlib.filter_by_level,
        structlog.stdlib.add_logger_name,
        structlog.stdlib.add_log_level,
        structlog.processors.TimeStamper(fmt="iso"),
        structlog.processors.JSONRenderer()
    ],
    wrapper_class=structlog.stdlib.BoundLogger,
    logger_factory=structlog.stdlib.LoggerFactory(),
)

logger = structlog.get_logger()

# BAD: Unstructured logging
logger.info("User john created order 123 for $99.99")

# GOOD: Structured logging
logger.info(
    "order_created",
    user_id="john",
    order_id="123",
    amount=99.99,
    currency="USD",
    items_count=3
)

# Output (JSON - easily searchable):
# {
#     "event": "order_created",
#     "user_id": "john",
#     "order_id": "123",
#     "amount": 99.99,
#     "currency": "USD",
#     "items_count": 3,
#     "timestamp": "2024-01-15T10:30:00Z",
#     "level": "info"
# }</code></pre>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-layer-group me-2"></i>Log Levels</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># Log Levels - Use appropriately
import logging

# DEBUG: Detailed diagnostic info (development)
logger.debug("Entering function process_order", order_id="123")

# INFO: Normal operation events
logger.info("Order processed successfully", order_id="123")

# WARNING: Unexpected but handled situations
logger.warning("Payment retry needed", order_id="123", attempt=2)

# ERROR: Operation failed but system continues
logger.error("Payment failed", order_id="123", error="card_declined")

# CRITICAL: System failure, immediate attention needed
logger.critical("Database connection lost", host="db-primary")

# Log level guidelines:
# Production: INFO and above
# Debugging: DEBUG and above
# Never log: passwords, tokens, PII without masking</code></pre>
                        </div>
                    </div>

                    <h4>Logging Best Practices</h4>
                    <ul>
                        <li><strong>Correlation IDs:</strong> Track requests across services with unique IDs</li>
                        <li><strong>Contextual Info:</strong> Include user_id, request_id, service_name</li>
                        <li><strong>Don't Log Secrets:</strong> Mask or exclude sensitive data</li>
                        <li><strong>Log at Boundaries:</strong> Entry/exit of services, APIs, external calls</li>
                    </ul>
                </div>

                <div id="log-aggregation" class="blog-content mt-5">
                    <h3>Log Aggregation</h3>
                    <p>Centralize logs from all services for unified search and analysis.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-database me-2"></i>ELK Stack (Elasticsearch, Logstash, Kibana)</h4>
                        <div class="experiment-content">
<pre><code class="language-yaml"># Logstash Configuration
# logstash.conf
input {
  beats {
    port => 5044
  }
}

filter {
  json {
    source => "message"
  }
  
  date {
    match => ["timestamp", "ISO8601"]
  }
  
  # Add derived fields
  if [response_time] {
    mutate {
      add_field => {
        "is_slow" => "%{[response_time] > 1000}"
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "logs-%{+YYYY.MM.dd}"
  }
}</code></pre>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">Elasticsearch</span>
                            <span class="bias-tag">Kibana</span>
                        </div>
                    </div>

                    <h4>Log Aggregation Comparison</h4>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Tool</th>
                                <th>Type</th>
                                <th>Best For</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>ELK Stack</strong></td>
                                <td>Self-hosted</td>
                                <td>Full control, customization</td>
                            </tr>
                            <tr>
                                <td><strong>Loki + Grafana</strong></td>
                                <td>Self-hosted</td>
                                <td>Low overhead, Prometheus integration</td>
                            </tr>
                            <tr>
                                <td><strong>Datadog</strong></td>
                                <td>SaaS</td>
                                <td>Full observability platform</td>
                            </tr>
                            <tr>
                                <td><strong>CloudWatch</strong></td>
                                <td>AWS</td>
                                <td>AWS-native workloads</td>
                            </tr>
                            <tr>
                                <td><strong>Splunk</strong></td>
                                <td>Enterprise</td>
                                <td>Large-scale, compliance</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="metrics" class="blog-content mt-5">
                    <h2><i class="fas fa-chart-line me-2 text-teal"></i>Metrics</h2>
                    <p>Metrics are numeric measurements collected over time. They're efficient for dashboards, alerts, and trend analysis.</p>

                    <h3>Metric Types</h3>
                    <ul>
                        <li><strong>Counter:</strong> Monotonically increasing value (requests_total, errors_total)</li>
                        <li><strong>Gauge:</strong> Point-in-time value that can increase/decrease (temperature, queue_size)</li>
                        <li><strong>Histogram:</strong> Distribution of values (response_time buckets)</li>
                        <li><strong>Summary:</strong> Pre-calculated quantiles (p50, p95, p99)</li>
                    </ul>

                    <div class="experiment-card">
                        <h4><i class="fas fa-fire me-2"></i>RED Method (Request-focused)</h4>
                        <div class="experiment-content">
                            <p>For every service, measure:</p>
<pre><code class="language-python"># RED Method - Essential service metrics
from prometheus_client import Counter, Histogram

# Rate: Requests per second
requests_total = Counter(
    'http_requests_total',
    'Total HTTP requests',
    ['method', 'endpoint', 'status']
)

# Errors: Failed requests per second
errors_total = Counter(
    'http_errors_total',
    'Total HTTP errors',
    ['method', 'endpoint', 'error_type']
)

# Duration: Response time distribution
request_duration = Histogram(
    'http_request_duration_seconds',
    'HTTP request duration',
    ['method', 'endpoint'],
    buckets=[.005, .01, .025, .05, .1, .25, .5, 1, 2.5, 5, 10]
)

# Usage in request handler
@app.route('/api/orders', methods=['POST'])
def create_order():
    with request_duration.labels(
        method='POST', 
        endpoint='/api/orders'
    ).time():
        try:
            result = process_order(request.json)
            requests_total.labels(
                method='POST',
                endpoint='/api/orders',
                status='200'
            ).inc()
            return result
        except Exception as e:
            errors_total.labels(
                method='POST',
                endpoint='/api/orders',
                error_type=type(e).__name__
            ).inc()
            raise</code></pre>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-server me-2"></i>USE Method (Resource-focused)</h4>
                        <div class="experiment-content">
                            <p>For every resource (CPU, memory, disk, network):</p>
<pre><code class="language-python"># USE Method - Resource metrics
# U - Utilization: % time resource is busy
# S - Saturation: Amount of queued work  
# E - Errors: Error count

# CPU Metrics
cpu_utilization = Gauge('cpu_utilization_percent', 'CPU utilization')
cpu_saturation = Gauge('cpu_load_average', 'CPU load average')

# Memory Metrics
memory_utilization = Gauge('memory_used_bytes', 'Memory used')
memory_saturation = Gauge('memory_swap_used_bytes', 'Swap used')

# Disk Metrics
disk_utilization = Gauge('disk_used_percent', 'Disk used', ['mount'])
disk_io_saturation = Gauge('disk_io_queue_depth', 'IO queue depth', ['device'])

# Network Metrics
network_utilization = Gauge('network_bytes_total', 'Network bytes', ['interface', 'direction'])
network_errors = Counter('network_errors_total', 'Network errors', ['interface', 'type'])</code></pre>
                        </div>
                    </div>
                </div>

                <div id="prometheus" class="blog-content mt-5">
                    <h3>Prometheus & Grafana</h3>

                    <div class="experiment-card">
                        <h4><i class="fas fa-cog me-2"></i>Prometheus Configuration</h4>
                        <div class="experiment-content">
<pre><code class="language-yaml"># prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

alerting:
  alertmanagers:
    - static_configs:
        - targets: ['alertmanager:9093']

rule_files:
  - "alert_rules.yml"

scrape_configs:
  - job_name: 'api-servers'
    static_configs:
      - targets: ['api1:8080', 'api2:8080', 'api3:8080']
    
  - job_name: 'kubernetes-pods'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true</code></pre>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-search me-2"></i>PromQL Queries</h4>
                        <div class="experiment-content">
<pre><code class="language-promql"># Request rate (requests per second)
rate(http_requests_total[5m])

# Error rate percentage
sum(rate(http_requests_total{status=~"5.."}[5m])) 
/ sum(rate(http_requests_total[5m])) * 100

# 95th percentile response time
histogram_quantile(0.95, 
  sum(rate(http_request_duration_seconds_bucket[5m])) by (le)
)

# Top 5 endpoints by request count
topk(5, sum by (endpoint) (rate(http_requests_total[1h])))

# Memory usage per pod
container_memory_usage_bytes{namespace="production"}

# CPU throttling
rate(container_cpu_cfs_throttled_seconds_total[5m])</code></pre>
                        </div>
                    </div>
                </div>

                <div id="tracing" class="blog-content mt-5">
                    <h2><i class="fas fa-route me-2 text-teal"></i>Distributed Tracing</h2>
                    <p>Traces follow requests as they flow through multiple services, revealing latency bottlenecks and dependencies.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-project-diagram me-2"></i>Trace Anatomy</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># Trace structure
# Trace: End-to-end request journey (one trace_id)
# Span: Single operation within a trace (many spans per trace)
# Context: trace_id + span_id propagated between services

"""
Trace: user_checkout (trace_id: abc123)
├── Span: api-gateway (50ms)
│   ├── Span: auth-service.verify_token (10ms)
│   └── Span: order-service.create_order (35ms)
│       ├── Span: inventory-service.reserve (15ms)
│       ├── Span: payment-service.charge (18ms)
│       └── Span: db.insert_order (2ms)
"""

# Each span contains:
# - trace_id: Links all spans in a trace
# - span_id: Unique identifier for this span
# - parent_span_id: Parent span (null for root)
# - operation_name: What operation this represents
# - start_time, duration: Timing
# - tags: Key-value metadata
# - logs: Timestamped events within span</code></pre>
                        </div>
                    </div>
                </div>

                <div id="opentelemetry" class="blog-content mt-5">
                    <h3>OpenTelemetry</h3>
                    <p>OpenTelemetry (OTel) is the standard for instrumenting distributed systems. It provides unified APIs for traces, metrics, and logs.</p>

                    <div class="experiment-card">
                        <h4><i class="fas fa-code me-2"></i>OpenTelemetry Python</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># OpenTelemetry Setup
from opentelemetry import trace
from opentelemetry.sdk.trace import TracerProvider
from opentelemetry.sdk.trace.export import BatchSpanProcessor
from opentelemetry.exporter.otlp.proto.grpc.trace_exporter import OTLPSpanExporter
from opentelemetry.instrumentation.flask import FlaskInstrumentor
from opentelemetry.instrumentation.requests import RequestsInstrumentor

# Configure tracing
trace.set_tracer_provider(TracerProvider())
tracer = trace.get_tracer(__name__)

# Export to Jaeger/Tempo/etc
otlp_exporter = OTLPSpanExporter(endpoint="http://collector:4317")
trace.get_tracer_provider().add_span_processor(
    BatchSpanProcessor(otlp_exporter)
)

# Auto-instrument frameworks
FlaskInstrumentor().instrument()
RequestsInstrumentor().instrument()

# Manual instrumentation
@tracer.start_as_current_span("process_payment")
def process_payment(order_id, amount):
    span = trace.get_current_span()
    span.set_attribute("order_id", order_id)
    span.set_attribute("amount", amount)
    
    with tracer.start_as_current_span("validate_card") as child_span:
        child_span.set_attribute("card_type", "visa")
        validate_card()
    
    with tracer.start_as_current_span("charge_card"):
        result = charge_card(amount)
        span.add_event("payment_completed", {"status": result.status})
    
    return result</code></pre>
                        </div>
                    </div>

                    <h4>Tracing Tools Comparison</h4>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Tool</th>
                                <th>Type</th>
                                <th>Best For</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Jaeger</strong></td>
                                <td>Self-hosted</td>
                                <td>Kubernetes, microservices</td>
                            </tr>
                            <tr>
                                <td><strong>Zipkin</strong></td>
                                <td>Self-hosted</td>
                                <td>Simple setup, Spring Boot</td>
                            </tr>
                            <tr>
                                <td><strong>Tempo</strong></td>
                                <td>Self-hosted</td>
                                <td>Grafana ecosystem, cost-effective</td>
                            </tr>
                            <tr>
                                <td><strong>AWS X-Ray</strong></td>
                                <td>AWS</td>
                                <td>AWS-native workloads</td>
                            </tr>
                            <tr>
                                <td><strong>Datadog APM</strong></td>
                                <td>SaaS</td>
                                <td>Full platform, ML insights</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="alerting" class="blog-content mt-5">
                    <h2><i class="fas fa-bell me-2 text-teal"></i>Alerting</h2>

                    <div class="experiment-card">
                        <h4><i class="fas fa-exclamation-triangle me-2"></i>Alert Rules</h4>
                        <div class="experiment-content">
<pre><code class="language-yaml"># Prometheus Alert Rules
groups:
  - name: sla_alerts
    rules:
      # High error rate
      - alert: HighErrorRate
        expr: |
          sum(rate(http_requests_total{status=~"5.."}[5m])) 
          / sum(rate(http_requests_total[5m])) > 0.01
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Error rate above 1%"
          description: "{{ $value | humanizePercentage }} error rate"
      
      # Slow responses
      - alert: HighLatency
        expr: |
          histogram_quantile(0.95, 
            sum(rate(http_request_duration_seconds_bucket[5m])) by (le)
          ) > 0.5
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "P95 latency above 500ms"
      
      # Service down
      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "{{ $labels.job }} is down"</code></pre>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Alerting Best Practices:</strong>
                        <ul>
                            <li><strong>Alert on symptoms, not causes:</strong> "Users experiencing errors" not "CPU high"</li>
                            <li><strong>Include runbook links:</strong> What to do when alert fires</li>
                            <li><strong>Avoid alert fatigue:</strong> Every alert should be actionable</li>
                            <li><strong>Use severity levels:</strong> Critical (page), Warning (ticket), Info (dashboard)</li>
                        </ul>
                    </div>

                    <h4>SLOs and Error Budgets</h4>
<pre><code class="language-python"># Service Level Objectives (SLOs)
# Define target reliability

# SLI: Service Level Indicator (what you measure)
# SLO: Service Level Objective (target for SLI)
# Error Budget: 100% - SLO (acceptable failure)

# Example SLOs:
# Availability: 99.9% of requests successful
# Latency: 95% of requests < 200ms

# Error Budget Calculation:
# 99.9% availability = 0.1% error budget
# Monthly: 43,200 minutes * 0.001 = 43.2 minutes downtime allowed

# Alert when burning error budget too fast
# burn_rate = error_rate / (1 - SLO)
# Alert if burn_rate > 14.4 (burns monthly budget in 2 days)</code></pre>
                </div>

                <div id="next-steps" class="blog-content mt-5">
                    <h2><i class="fas fa-arrow-right me-2 text-teal"></i>Next Steps</h2>
                    
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 11: Real-World Case Studies</h5>
                            <p class="text-muted small mb-2">Apply system design principles to real-world scenarios like URL shorteners, chat systems, and more.</p>
                            <a href="system-design-real-world-case-studies.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 12: Low-Level Design (LLD) Fundamentals</h5>
                            <p class="text-muted small mb-2">Master object-oriented design, SOLID principles, and design patterns.</p>
                            <a href="system-design-low-level-design-patterns.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 9: Rate Limiting & Security</h5>
                            <p class="text-muted small mb-2">Review rate limiting algorithms and security patterns.</p>
                            <a href="system-design-rate-limiting-security.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">
                        I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest">
                            <i class="fab fa-pinterest-p"></i>
                        </a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <hr class="bg-secondary">

            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small">
                        <i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a>
                    </p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">
                        Enjoying this content? ☕ <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Buy me a coffee</a> to fuel more deep dives!
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <button id="scrollToTop" class="scroll-to-top"><i class="fas fa-arrow-up"></i></button>
    <script src="../../../js/cookie-consent.js"></script>
    <script src="../../../js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scrollToTopBtn = document.getElementById('scrollToTop');
            window.addEventListener('scroll', function() { scrollToTopBtn.classList.toggle('show', window.scrollY > 300); });
            scrollToTopBtn.addEventListener('click', function() { window.scrollTo({ top: 0, behavior: 'smooth' }); });
        });
        function openNav() { document.getElementById('tocSidenav').classList.add('open'); document.getElementById('tocOverlay').classList.add('show'); document.body.style.overflow = 'hidden'; }
        function closeNav() { document.getElementById('tocSidenav').classList.remove('open'); document.getElementById('tocOverlay').classList.remove('show'); document.body.style.overflow = 'auto'; }
        document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeNav(); });
        const themes = { 'prism-theme': 'Tomorrow Night', 'prism-default': 'Default', 'prism-dark': 'Dark', 'prism-twilight': 'Twilight', 'prism-okaidia': 'Okaidia', 'prism-solarizedlight': 'Solarized Light' };
        const savedTheme = localStorage.getItem('prism-theme') || 'prism-theme';
        function switchTheme(themeId) { Object.keys(themes).forEach(id => { const link = document.getElementById(id); if (link) link.disabled = true; }); const selectedLink = document.getElementById(themeId); if (selectedLink) { selectedLink.disabled = false; localStorage.setItem('prism-theme', themeId); } setTimeout(() => Prism.highlightAll(), 10); }
        document.addEventListener('DOMContentLoaded', function() { switchTheme(savedTheme); });
        Prism.plugins.toolbar.registerButton('theme-switcher', function() { const select = document.createElement('select'); Object.keys(themes).forEach(id => { const opt = document.createElement('option'); opt.value = id; opt.textContent = themes[id]; if (id === savedTheme) opt.selected = true; select.appendChild(opt); }); select.addEventListener('change', e => switchTheme(e.target.value)); return select; });
    </script>
</body>
</html>
