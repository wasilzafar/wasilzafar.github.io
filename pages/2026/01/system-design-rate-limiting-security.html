<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index, archive" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Master rate limiting and security patterns for protecting your APIs and systems. Learn token bucket, leaky bucket, sliding window algorithms, and authentication best practices." />
    <meta name="author" content="Wasil Zafar" />
    <meta name="keywords" content="Rate Limiting, API Security, Token Bucket, Leaky Bucket, DDoS Protection, Authentication, Authorization, System Design" />
    <meta property="og:title" content="System Design Series Part 9: Rate Limiting & Security" />
    <meta property="og:description" content="Master rate limiting algorithms and security patterns for building resilient, secure systems." />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2026-01-25" />
    <meta property="article:author" content="Wasil Zafar" />
    <meta property="article:section" content="Technology" />
    
    <title>System Design Series Part 9: Rate Limiting & Security - Wasil Zafar</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-default" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css" id="prism-twilight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" id="prism-okaidia" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-solarizedlight.min.css" id="prism-solarizedlight" disabled />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../../../images/favicon_io/site.webmanifest">

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', { 'ad_storage': 'denied', 'ad_user_data': 'denied', 'ad_personalization': 'denied', 'analytics_storage': 'denied', 'region': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE'] });
        gtag('consent', 'default', { 'ad_storage': 'granted', 'ad_user_data': 'granted', 'ad_personalization': 'granted', 'analytics_storage': 'granted' });
        gtag('set', 'url_passthrough', true);
    </script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PBS8M2JR');</script>

    <style>
        .blog-hero { background: linear-gradient(135deg, var(--color-navy) 0%, var(--color-blue) 100%); color: white; padding: 80px 0; }
        .blog-header { margin-bottom: 2rem; }
        .blog-meta { font-size: 0.95rem; color: var(--color-teal); margin-bottom: 1rem; display: flex; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .print-btn { background: var(--color-teal); color: white; border: none; padding: 0.4rem 1rem; border-radius: 4px; font-size: 0.9rem; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; }
        .print-btn:hover { background: var(--color-crimson); }
        @media print { .print-btn, nav, .navbar, footer, .back-link, .related-posts, .scroll-to-top, .toc-toggle-btn, .sidenav-toc, .sidenav-overlay { display: none !important; } }
        .blog-content { max-width: 900px; margin: 0 auto; font-size: 1.05rem; line-height: 1.8; color: #333; }
        .blog-content h2 { font-size: 1.8rem; font-weight: 700; margin-top: 2.5rem; margin-bottom: 1.5rem; color: var(--color-navy); border-bottom: 3px solid var(--color-teal); padding-bottom: 0.5rem; }
        .blog-content h3 { font-size: 1.3rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; color: var(--color-blue); }
        .blog-content p { margin-bottom: 1.2rem; text-align: justify; }
        .blog-content strong { color: var(--color-crimson); }
        .highlight-box { background: rgba(59, 151, 151, 0.1); border-left: 4px solid var(--color-teal); padding: 1.5rem; margin: 2rem 0; border-radius: 4px; }
        .experiment-card { background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; transition: all 0.3s ease; }
        .experiment-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transform: translateY(-2px); }
        .experiment-card h4 { color: var(--color-crimson); font-weight: 700; }
        pre[class*="language-"] { margin: 1.5rem 0; padding-top: 3rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        .toc-toggle-btn { position: fixed; bottom: 2rem; left: 2rem; width: 50px; height: 50px; background: var(--color-teal); color: white; border: none; border-radius: 50%; font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 12px rgba(59, 151, 151, 0.4); transition: all 0.3s ease; z-index: 1049; display: flex; align-items: center; justify-content: center; }
        .toc-toggle-btn:hover { background: var(--color-crimson); transform: scale(1.1); }
        .sidenav-toc { height: calc(100% - 64px); width: 0; position: fixed; z-index: 1050; top: 64px; left: 0; background: linear-gradient(135deg, var(--color-navy) 0%, var(--color-blue) 100%); overflow-x: hidden; overflow-y: auto; transition: width 0.4s ease; padding-top: 30px; box-shadow: 4px 0 15px rgba(0, 0, 0, 0.3); }
        .sidenav-toc.open { width: 350px; }
        .sidenav-toc .toc-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 30px; margin-bottom: 20px; border-bottom: 2px solid var(--color-teal); opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .sidenav-toc.open .toc-header { opacity: 1; visibility: visible; }
        .sidenav-toc .closebtn { font-size: 32px; color: white; background: transparent; border: none; cursor: pointer; }
        .sidenav-toc .closebtn:hover { color: var(--color-crimson); transform: rotate(90deg); }
        .sidenav-toc h3 { color: white; margin: 0; font-weight: 700; font-size: 1.3rem; flex-grow: 1; }
        .sidenav-toc ol { list-style: decimal; padding-left: 30px; color: rgba(255, 255, 255, 0.9); }
        .sidenav-toc ol li { margin-bottom: 8px; }
        .sidenav-toc ul { list-style-type: lower-alpha; padding-left: 30px; margin-top: 8px; }
        .sidenav-toc a { padding: 12px 30px; text-decoration: none; font-size: 0.95rem; color: rgba(255, 255, 255, 0.85); display: block; transition: all 0.3s ease; border-left: 4px solid transparent; }
        .sidenav-toc a:hover { color: white; background: rgba(59, 151, 151, 0.2); border-left-color: var(--color-teal); padding-left: 35px; }
        .sidenav-toc a.active { color: white; background: rgba(191, 9, 47, 0.3); border-left-color: var(--color-crimson); font-weight: 600; }
        .sidenav-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1049; }
        .sidenav-overlay.show { display: block; }
        @media (max-width: 768px) { .sidenav-toc.open { width: 280px; } .toc-toggle-btn { width: 45px; height: 45px; left: 1rem; bottom: 1rem; } }
        html { scroll-behavior: smooth; }
        .reading-time { display: inline-block; background: var(--color-crimson); color: white; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.9rem; }
        .back-link { display: inline-block; color: white; text-decoration: none; transition: all 0.3s ease; margin-bottom: 1rem; opacity: 0.9; }
        .back-link:hover { color: var(--color-teal); opacity: 1; transform: translateX(-5px); }
        .related-posts { background: #f8f9fa; border-radius: 8px; padding: 2rem; margin-top: 3rem; }
        .related-posts h3 { color: var(--color-navy); margin-bottom: 1.5rem; }
        .related-post-item { padding: 1rem; border-left: 3px solid var(--color-teal); margin-bottom: 1rem; }
        .related-post-item:hover { background: white; border-left-color: var(--color-crimson); }
        .related-post-item a { color: var(--color-blue); text-decoration: none; font-weight: 600; }
        .scroll-to-top { position: fixed; bottom: 2rem; right: 2rem; width: 50px; height: 50px; background: var(--color-teal); color: white; border: none; border-radius: 50%; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59, 151, 151, 0.3); z-index: 999; }
        .scroll-to-top.show { opacity: 1; visibility: visible; }
        .scroll-to-top:hover { background: var(--color-crimson); transform: translateY(-3px); }
    </style>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBS8M2JR" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div id="cookieBanner" class="light display-bottom" style="display: none;">
        <div class="content-wrap">
            <div class="msg-wrap"><p style="font-size: 14px; color: var(--color-navy);">We use cookies. See our <a href="/privacy-policy.html" style="color: var(--color-teal);">Privacy Policy</a>.</p></div>
            <div class="btn-wrap">
                <button id="cookieAccept" style="background: var(--color-teal); color: white;">Accept All</button>
                <button id="cookieReject" style="background: transparent; color: var(--color-navy); border: 2px solid var(--color-teal);">Reject All</button>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/"><span class="gradient-text">Wasil Zafar</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#skills">Skills</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#certifications">Certifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#interests">Interests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="blog-hero">
        <div class="container py-5">
            <div class="blog-header">
                <a href="/pages/categories/technology.html" class="back-link"><i class="fas fa-arrow-left me-2"></i>Back to Technology</a>
                <h1 class="display-4 fw-bold mb-3">System Design Series Part 9: Rate Limiting & Security</h1>
                <div class="blog-meta">
                    <span><i class="fas fa-calendar me-2"></i>January 25, 2026</span>
                    <span><i class="fas fa-user me-2"></i>Wasil Zafar</span>
                    <span class="reading-time"><i class="fas fa-clock me-1"></i>35 min read</span>
                    <button onclick="window.print()" class="print-btn"><i class="fas fa-print"></i> Print</button>
                </div>
                <p class="lead">Master rate limiting algorithms and security patterns for protecting your APIs and systems. Learn token bucket, leaky bucket, sliding window, and authentication best practices.</p>
            </div>
        </div>
    </section>

    <button class="toc-toggle-btn" onclick="openNav()" title="Table of Contents"><i class="fas fa-list"></i></button>

    <div id="tocSidenav" class="sidenav-toc">
        <div class="toc-header">
            <h3><i class="fas fa-list me-2"></i>Table of Contents</h3>
            <button class="closebtn" onclick="closeNav()">&times;</button>
        </div>
        <ol>
            <li><a href="#rate-limiting" onclick="closeNav()">Rate Limiting</a>
                <ul>
                    <li><a href="#rate-limiting" onclick="closeNav()">Why Rate Limit?</a></li>
                    <li><a href="#algorithms" onclick="closeNav()">Rate Limiting Algorithms</a></li>
                </ul>
            </li>
            <li><a href="#security" onclick="closeNav()">Security Patterns</a>
                <ul>
                    <li><a href="#security" onclick="closeNav()">Authentication</a></li>
                    <li><a href="#authorization" onclick="closeNav()">Authorization</a></li>
                </ul>
            </li>
            <li><a href="#ddos" onclick="closeNav()">DDoS Protection</a>
                <ul>
                    <li><a href="#ddos" onclick="closeNav()">Attack Mitigation</a></li>
                    <li><a href="#best-practices" onclick="closeNav()">Best Practices</a></li>
                </ul>
            </li>
            <li><a href="#next-steps" onclick="closeNav()">Next Steps</a></li>
        </ol>
    </div>

    <div id="tocOverlay" class="sidenav-overlay" onclick="closeNav()"></div>

    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">

                <div id="rate-limiting" class="blog-content">
                    <h2><i class="fas fa-tachometer-alt me-2 text-teal"></i>Rate Limiting</h2>
                    
                    <div class="highlight-box" style="background: rgba(191, 9, 47, 0.1); border-left-color: var(--color-crimson);">
                        <i class="fas fa-book me-2"></i>
                        <strong>Series Navigation:</strong> This is Part 9 of the 15-part System Design Series. <a href="system-design-cap-theorem-consistency.html">Review Part 8: CAP Theorem</a> first.
                    </div>
                    
                    <p><strong>Rate limiting</strong> controls the number of requests a client can make to your API within a given time window. It protects your services from abuse, ensures fair usage, and maintains system stability under load.</p>

                    <div class="highlight-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Key Insight:</strong> Rate limiting isn't just about security—it's about fairness. Without limits, one misbehaving client can degrade service for everyone.
                    </div>

                    <h3>Why Rate Limit?</h3>
                    <ul>
                        <li><strong>Prevent abuse:</strong> Stop malicious actors from overwhelming your system</li>
                        <li><strong>Ensure fairness:</strong> Give all users equal access to resources</li>
                        <li><strong>Control costs:</strong> Limit expensive operations and API calls</li>
                        <li><strong>Protect downstream:</strong> Prevent cascading failures to dependent services</li>
                        <li><strong>Maintain SLAs:</strong> Guarantee performance for paying customers</li>
                    </ul>
                </div>

                <div id="algorithms" class="blog-content mt-5">
                    <h3>Rate Limiting Algorithms</h3>

                    <div class="experiment-card">
                        <h4><i class="fas fa-bucket me-2"></i>Token Bucket</h4>
                        <div class="experiment-content">
                            <p>Tokens are added to a bucket at a fixed rate. Requests consume tokens. If bucket is empty, requests are rejected.</p>
<pre><code class="language-python"># Token Bucket Algorithm
import time
import threading

class TokenBucket:
    def __init__(self, capacity, fill_rate):
        """
        capacity: Maximum tokens in bucket
        fill_rate: Tokens added per second
        """
        self.capacity = capacity
        self.fill_rate = fill_rate
        self.tokens = capacity
        self.last_time = time.time()
        self.lock = threading.Lock()
    
    def _refill(self):
        """Add tokens based on elapsed time"""
        now = time.time()
        elapsed = now - self.last_time
        tokens_to_add = elapsed * self.fill_rate
        self.tokens = min(self.capacity, self.tokens + tokens_to_add)
        self.last_time = now
    
    def consume(self, tokens=1):
        """Try to consume tokens. Returns True if successful."""
        with self.lock:
            self._refill()
            if self.tokens >= tokens:
                self.tokens -= tokens
                return True
            return False

# Usage
bucket = TokenBucket(capacity=100, fill_rate=10)  # 100 max, 10/sec refill

for i in range(120):
    if bucket.consume():
        print(f"Request {i}: Allowed")
    else:
        print(f"Request {i}: Rate limited")</code></pre>
                            <p><strong>Pros:</strong> Allows bursts up to capacity, smooth rate limiting</p>
                            <p><strong>Cons:</strong> Memory per user, complexity for distributed systems</p>
                        </div>
                        <div class="experiment-tags">
                            <span class="bias-tag">AWS API Gateway</span>
                            <span class="bias-tag">Stripe</span>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-tint me-2"></i>Leaky Bucket</h4>
                        <div class="experiment-content">
                            <p>Requests enter a queue and are processed at a constant rate. Overflow is rejected.</p>
<pre><code class="language-python"># Leaky Bucket Algorithm
import time
import threading
from collections import deque

class LeakyBucket:
    def __init__(self, capacity, leak_rate):
        """
        capacity: Maximum queue size
        leak_rate: Requests processed per second
        """
        self.capacity = capacity
        self.leak_rate = leak_rate
        self.queue = deque()
        self.lock = threading.Lock()
        
        # Start leaking thread
        self.running = True
        self.leak_thread = threading.Thread(target=self._leak)
        self.leak_thread.start()
    
    def _leak(self):
        """Process requests at constant rate"""
        while self.running:
            time.sleep(1 / self.leak_rate)
            with self.lock:
                if self.queue:
                    request = self.queue.popleft()
                    self._process(request)
    
    def _process(self, request):
        print(f"Processing: {request}")
    
    def add(self, request):
        """Add request to queue if space available"""
        with self.lock:
            if len(self.queue) < self.capacity:
                self.queue.append(request)
                return True
            return False  # Queue full, reject

# Usage
bucket = LeakyBucket(capacity=10, leak_rate=5)  # 10 queue, 5/sec process</code></pre>
                            <p><strong>Pros:</strong> Smooths out bursts, predictable output rate</p>
                            <p><strong>Cons:</strong> Can introduce latency, no burst allowance</p>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-clock me-2"></i>Fixed Window Counter</h4>
                        <div class="experiment-content">
                            <p>Count requests in fixed time windows. Reset counter when window expires.</p>
<pre><code class="language-python"># Fixed Window Counter
import time
import redis

class FixedWindowCounter:
    def __init__(self, redis_client, limit, window_seconds):
        self.redis = redis_client
        self.limit = limit
        self.window = window_seconds
    
    def is_allowed(self, client_id):
        """Check if request is allowed"""
        # Window key based on current time
        window_key = f"rate:{client_id}:{int(time.time() // self.window)}"
        
        # Increment and get count
        count = self.redis.incr(window_key)
        
        # Set expiration on first request
        if count == 1:
            self.redis.expire(window_key, self.window)
        
        return count <= self.limit

# Usage
redis_client = redis.Redis()
limiter = FixedWindowCounter(redis_client, limit=100, window_seconds=60)

# Each user gets 100 requests per minute
if limiter.is_allowed("user_123"):
    process_request()
else:
    return_429_error()</code></pre>
                            <p><strong>Pros:</strong> Simple, low memory</p>
                            <p><strong>Cons:</strong> Burst at window boundaries (2x limit possible)</p>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-window-maximize me-2"></i>Sliding Window Log</h4>
                        <div class="experiment-content">
                            <p>Track timestamps of all requests. Count requests in sliding window.</p>
<pre><code class="language-python"># Sliding Window Log
import time
import redis

class SlidingWindowLog:
    def __init__(self, redis_client, limit, window_seconds):
        self.redis = redis_client
        self.limit = limit
        self.window = window_seconds
    
    def is_allowed(self, client_id):
        """Check if request is allowed"""
        now = time.time()
        window_start = now - self.window
        key = f"rate:{client_id}"
        
        # Use Redis sorted set (timestamp as score)
        pipe = self.redis.pipeline()
        
        # Remove old entries
        pipe.zremrangebyscore(key, 0, window_start)
        
        # Count current entries
        pipe.zcard(key)
        
        # Add current request
        pipe.zadd(key, {str(now): now})
        
        # Set expiration
        pipe.expire(key, self.window)
        
        results = pipe.execute()
        count = results[1]
        
        return count < self.limit

# Usage - More accurate but more memory
limiter = SlidingWindowLog(redis_client, limit=100, window_seconds=60)</code></pre>
                            <p><strong>Pros:</strong> Most accurate, no boundary issues</p>
                            <p><strong>Cons:</strong> Higher memory (stores all timestamps)</p>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-balance-scale me-2"></i>Sliding Window Counter</h4>
                        <div class="experiment-content">
                            <p>Hybrid approach: weighted combination of current and previous window counters.</p>
<pre><code class="language-python"># Sliding Window Counter (Best of both worlds)
import time
import redis

class SlidingWindowCounter:
    def __init__(self, redis_client, limit, window_seconds):
        self.redis = redis_client
        self.limit = limit
        self.window = window_seconds
    
    def is_allowed(self, client_id):
        """Weighted count from current and previous window"""
        now = time.time()
        current_window = int(now // self.window)
        previous_window = current_window - 1
        
        # Position within current window (0 to 1)
        position = (now % self.window) / self.window
        
        # Get counts from both windows
        current_key = f"rate:{client_id}:{current_window}"
        previous_key = f"rate:{client_id}:{previous_window}"
        
        current_count = int(self.redis.get(current_key) or 0)
        previous_count = int(self.redis.get(previous_key) or 0)
        
        # Weighted count
        # More weight to previous window at start of current window
        weighted_count = previous_count * (1 - position) + current_count
        
        if weighted_count < self.limit:
            # Increment current window
            self.redis.incr(current_key)
            self.redis.expire(current_key, self.window * 2)
            return True
        return False

# Example: At 30 seconds into 60-second window
# weighted = previous * 0.5 + current * 1.0
# Smooths the boundary between windows</code></pre>
                            <p><strong>Pros:</strong> Accurate, low memory, smooth boundaries</p>
                            <p><strong>Cons:</strong> Approximate (not exact count)</p>
                        </div>
                    </div>

                    <h4>Algorithm Comparison</h4>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Algorithm</th>
                                <th>Burst</th>
                                <th>Memory</th>
                                <th>Accuracy</th>
                                <th>Use Case</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Token Bucket</strong></td>
                                <td>✅ Allows</td>
                                <td>Low</td>
                                <td>High</td>
                                <td>API rate limiting</td>
                            </tr>
                            <tr>
                                <td><strong>Leaky Bucket</strong></td>
                                <td>❌ No burst</td>
                                <td>Low</td>
                                <td>High</td>
                                <td>Traffic shaping</td>
                            </tr>
                            <tr>
                                <td><strong>Fixed Window</strong></td>
                                <td>⚠️ At edges</td>
                                <td>Very Low</td>
                                <td>Medium</td>
                                <td>Simple limits</td>
                            </tr>
                            <tr>
                                <td><strong>Sliding Log</strong></td>
                                <td>✅ Controlled</td>
                                <td>High</td>
                                <td>Very High</td>
                                <td>Precise limits</td>
                            </tr>
                            <tr>
                                <td><strong>Sliding Counter</strong></td>
                                <td>✅ Controlled</td>
                                <td>Low</td>
                                <td>High</td>
                                <td>Production APIs</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="security" class="blog-content mt-5">
                    <h2><i class="fas fa-shield-alt me-2 text-teal"></i>Security Patterns</h2>
                    
                    <h3>Authentication vs Authorization</h3>
                    <ul>
                        <li><strong>Authentication:</strong> Who are you? (Identity verification)</li>
                        <li><strong>Authorization:</strong> What can you do? (Permission check)</li>
                    </ul>

                    <div class="experiment-card">
                        <h4><i class="fas fa-key me-2"></i>JWT Authentication</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># JWT (JSON Web Token) Authentication
import jwt
from datetime import datetime, timedelta
from functools import wraps
from flask import request, jsonify

SECRET_KEY = "your-secret-key"
ALGORITHM = "HS256"

def create_token(user_id, roles):
    """Generate JWT token"""
    payload = {
        "sub": user_id,
        "roles": roles,
        "iat": datetime.utcnow(),
        "exp": datetime.utcnow() + timedelta(hours=1)
    }
    return jwt.encode(payload, SECRET_KEY, algorithm=ALGORITHM)

def verify_token(token):
    """Verify and decode JWT token"""
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        return payload
    except jwt.ExpiredSignatureError:
        raise AuthError("Token expired")
    except jwt.InvalidTokenError:
        raise AuthError("Invalid token")

def require_auth(f):
    """Decorator to require authentication"""
    @wraps(f)
    def decorated(*args, **kwargs):
        auth_header = request.headers.get("Authorization")
        if not auth_header or not auth_header.startswith("Bearer "):
            return jsonify({"error": "Missing token"}), 401
        
        token = auth_header.split(" ")[1]
        payload = verify_token(token)
        request.user = payload
        return f(*args, **kwargs)
    return decorated

@app.route("/api/orders")
@require_auth
def get_orders():
    user_id = request.user["sub"]
    return get_user_orders(user_id)</code></pre>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-lock me-2"></i>API Key Authentication</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># API Key Authentication with Rate Limiting
import hashlib
import redis
from functools import wraps

class APIKeyAuth:
    def __init__(self, redis_client):
        self.redis = redis_client
    
    def verify_key(self, api_key):
        """Verify API key and return associated metadata"""
        # Hash key for storage lookup
        key_hash = hashlib.sha256(api_key.encode()).hexdigest()
        
        # Get key metadata
        key_data = self.redis.hgetall(f"apikey:{key_hash}")
        if not key_data:
            return None
        
        return {
            "client_id": key_data.get("client_id"),
            "tier": key_data.get("tier"),  # free, pro, enterprise
            "rate_limit": int(key_data.get("rate_limit", 100))
        }
    
    def create_key(self, client_id, tier="free"):
        """Create new API key"""
        import secrets
        api_key = f"sk_{secrets.token_hex(32)}"
        key_hash = hashlib.sha256(api_key.encode()).hexdigest()
        
        rate_limits = {"free": 100, "pro": 1000, "enterprise": 10000}
        
        self.redis.hset(f"apikey:{key_hash}", mapping={
            "client_id": client_id,
            "tier": tier,
            "rate_limit": rate_limits[tier]
        })
        
        return api_key  # Return only once, store securely

def require_api_key(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        api_key = request.headers.get("X-API-Key")
        if not api_key:
            return jsonify({"error": "API key required"}), 401
        
        key_data = auth.verify_key(api_key)
        if not key_data:
            return jsonify({"error": "Invalid API key"}), 401
        
        request.client = key_data
        return f(*args, **kwargs)
    return decorated</code></pre>
                        </div>
                    </div>
                </div>

                <div id="authorization" class="blog-content mt-5">
                    <h3>Authorization</h3>

                    <div class="experiment-card">
                        <h4><i class="fas fa-user-shield me-2"></i>Role-Based Access Control (RBAC)</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># RBAC Implementation
from functools import wraps

# Define permissions per role
ROLE_PERMISSIONS = {
    "admin": ["read", "write", "delete", "manage_users"],
    "editor": ["read", "write"],
    "viewer": ["read"]
}

class RBAC:
    def __init__(self, redis_client):
        self.redis = redis_client
    
    def get_user_roles(self, user_id):
        """Get user's assigned roles"""
        return self.redis.smembers(f"user:{user_id}:roles")
    
    def has_permission(self, user_id, permission):
        """Check if user has specific permission"""
        roles = self.get_user_roles(user_id)
        for role in roles:
            if permission in ROLE_PERMISSIONS.get(role, []):
                return True
        return False
    
    def assign_role(self, user_id, role):
        """Assign role to user"""
        self.redis.sadd(f"user:{user_id}:roles", role)

def require_permission(permission):
    """Decorator to require specific permission"""
    def decorator(f):
        @wraps(f)
        def decorated(*args, **kwargs):
            user_id = request.user["sub"]
            if not rbac.has_permission(user_id, permission):
                return jsonify({"error": "Permission denied"}), 403
            return f(*args, **kwargs)
        return decorated
    return decorator

@app.route("/api/users", methods=["DELETE"])
@require_auth
@require_permission("manage_users")
def delete_user():
    # Only admins can reach here
    pass</code></pre>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-sitemap me-2"></i>Attribute-Based Access Control (ABAC)</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># ABAC - More flexible than RBAC
# Decisions based on attributes of user, resource, action, and context

class ABAC:
    def __init__(self):
        self.policies = []
    
    def add_policy(self, policy):
        self.policies.append(policy)
    
    def is_allowed(self, user, resource, action, context=None):
        """Evaluate all policies"""
        for policy in self.policies:
            if policy.evaluate(user, resource, action, context):
                return True
        return False

class Policy:
    def __init__(self, name, conditions, effect="allow"):
        self.name = name
        self.conditions = conditions
        self.effect = effect
    
    def evaluate(self, user, resource, action, context):
        """Check if all conditions are met"""
        for condition in self.conditions:
            if not condition(user, resource, action, context):
                return False
        return self.effect == "allow"

# Example policies
abac = ABAC()

# Policy: Users can only access their own orders
abac.add_policy(Policy(
    name="own_orders",
    conditions=[
        lambda u, r, a, c: r["type"] == "order",
        lambda u, r, a, c: r["owner_id"] == u["id"]
    ]
))

# Policy: Admins can access all orders
abac.add_policy(Policy(
    name="admin_all_orders",
    conditions=[
        lambda u, r, a, c: "admin" in u["roles"],
        lambda u, r, a, c: r["type"] == "order"
    ]
))

# Policy: Working hours only for non-admins
abac.add_policy(Policy(
    name="business_hours",
    conditions=[
        lambda u, r, a, c: "admin" not in u["roles"],
        lambda u, r, a, c: 9 <= c["hour"] <= 17
    ]
))</code></pre>
                        </div>
                    </div>
                </div>

                <div id="ddos" class="blog-content mt-5">
                    <h2><i class="fas fa-user-shield me-2 text-teal"></i>DDoS Protection</h2>
                    
                    <h3>Attack Types</h3>
                    <ul>
                        <li><strong>Volumetric:</strong> Flood with traffic (UDP flood, DNS amplification)</li>
                        <li><strong>Protocol:</strong> Exploit protocol weaknesses (SYN flood, Ping of Death)</li>
                        <li><strong>Application:</strong> Target application layer (HTTP flood, Slowloris)</li>
                    </ul>

                    <div class="experiment-card">
                        <h4><i class="fas fa-filter me-2"></i>Defense Layers</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># Multi-layer DDoS defense architecture

# Layer 1: CDN/Edge (Cloudflare, AWS Shield)
# - Absorb volumetric attacks
# - Geographic distribution
# - Anycast routing

# Layer 2: Load Balancer
# - Connection limits per IP
# - SYN cookies for SYN flood
# - Rate limiting

# Layer 3: Application
class ApplicationDDoSProtection:
    def __init__(self, redis_client):
        self.redis = redis_client
    
    def check_request(self, ip, user_agent, request_path):
        """Multi-signal threat detection"""
        score = 0
        
        # Check request rate
        rate = self.get_request_rate(ip)
        if rate > 100:  # requests per second
            score += 30
        
        # Check for suspicious patterns
        if self.is_known_bad_agent(user_agent):
            score += 50
        
        # Check geographic velocity
        if self.impossible_travel(ip):
            score += 40
        
        # Check request patterns
        if self.is_automated(ip):
            score += 20
        
        # Decision
        if score >= 100:
            self.block_ip(ip)
            return "block"
        elif score >= 50:
            return "challenge"  # CAPTCHA
        else:
            return "allow"
    
    def is_automated(self, ip):
        """Detect bot-like behavior"""
        # Check for uniform request timing
        timestamps = self.redis.lrange(f"req_times:{ip}", 0, 100)
        if len(timestamps) < 10:
            return False
        
        intervals = []
        for i in range(1, len(timestamps)):
            intervals.append(float(timestamps[i]) - float(timestamps[i-1]))
        
        # Bots often have very uniform timing
        variance = sum((i - sum(intervals)/len(intervals))**2 
                       for i in intervals) / len(intervals)
        return variance < 0.01  # Suspiciously uniform</code></pre>
                        </div>
                    </div>

                    <h4>DDoS Mitigation Strategies</h4>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Strategy</th>
                                <th>Layer</th>
                                <th>Effectiveness</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>CDN/Anycast</strong></td>
                                <td>Network</td>
                                <td>High for volumetric</td>
                            </tr>
                            <tr>
                                <td><strong>Rate Limiting</strong></td>
                                <td>Application</td>
                                <td>Medium</td>
                            </tr>
                            <tr>
                                <td><strong>CAPTCHA</strong></td>
                                <td>Application</td>
                                <td>High for bots</td>
                            </tr>
                            <tr>
                                <td><strong>Web Application Firewall</strong></td>
                                <td>Application</td>
                                <td>High for known patterns</td>
                            </tr>
                            <tr>
                                <td><strong>Auto-scaling</strong></td>
                                <td>Infrastructure</td>
                                <td>Medium (costly)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="best-practices" class="blog-content mt-5">
                    <h3>Best Practices</h3>

                    <div class="highlight-box">
                        <i class="fas fa-check-circle"></i>
                        <strong>Security Best Practices:</strong>
                        <ul>
                            <li><strong>Defense in depth:</strong> Multiple layers of security</li>
                            <li><strong>Least privilege:</strong> Grant minimum necessary permissions</li>
                            <li><strong>Fail securely:</strong> Default to deny on errors</li>
                            <li><strong>Audit everything:</strong> Log all security-relevant events</li>
                            <li><strong>Rotate secrets:</strong> Regular key/token rotation</li>
                        </ul>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-headers me-2"></i>Security Headers</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># Essential Security Headers (Flask example)
from flask import Flask
from flask_talisman import Talisman

app = Flask(__name__)
Talisman(app, 
    force_https=True,
    strict_transport_security=True,
    content_security_policy={
        'default-src': "'self'",
        'script-src': ["'self'", 'cdn.example.com'],
        'style-src': ["'self'", "'unsafe-inline'"]
    }
)

# Manual header setting
@app.after_request
def set_security_headers(response):
    # Prevent clickjacking
    response.headers['X-Frame-Options'] = 'DENY'
    
    # XSS protection
    response.headers['X-XSS-Protection'] = '1; mode=block'
    
    # Prevent MIME sniffing
    response.headers['X-Content-Type-Options'] = 'nosniff'
    
    # Referrer policy
    response.headers['Referrer-Policy'] = 'strict-origin-when-cross-origin'
    
    return response</code></pre>
                        </div>
                    </div>

                    <div class="experiment-card">
                        <h4><i class="fas fa-database me-2"></i>Input Validation & SQL Injection Prevention</h4>
                        <div class="experiment-content">
<pre><code class="language-python"># NEVER do this (SQL Injection vulnerable)
query = f"SELECT * FROM users WHERE id = {user_id}"

# ALWAYS use parameterized queries
cursor.execute("SELECT * FROM users WHERE id = %s", (user_id,))

# For ORMs, use built-in protection
user = User.query.filter_by(id=user_id).first()

# Input validation
from pydantic import BaseModel, validator
import re

class UserInput(BaseModel):
    username: str
    email: str
    
    @validator('username')
    def validate_username(cls, v):
        if not re.match(r'^[a-zA-Z0-9_]{3,20}$', v):
            raise ValueError('Invalid username format')
        return v
    
    @validator('email')
    def validate_email(cls, v):
        if not re.match(r'^[\w\.-]+@[\w\.-]+\.\w+$', v):
            raise ValueError('Invalid email format')
        return v</code></pre>
                        </div>
                    </div>
                </div>

                <div id="next-steps" class="blog-content mt-5">
                    <h2><i class="fas fa-arrow-right me-2 text-teal"></i>Next Steps</h2>
                    
                    <div class="related-posts">
                        <h3><i class="fas fa-book-reader me-2"></i>Continue the Series</h3>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 8: CAP Theorem & Consistency</h5>
                            <p class="text-muted small mb-2">Review CAP theorem and consistency models.</p>
                            <a href="system-design-cap-theorem-consistency.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 10: Monitoring & Observability</h5>
                            <p class="text-muted small mb-2">Master monitoring, logging, and distributed tracing.</p>
                            <a href="system-design-monitoring-observability.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                        <div class="related-post-item">
                            <h5 class="mb-2">Part 11: Real-World Case Studies</h5>
                            <p class="text-muted small mb-2">Apply system design principles to real-world scenarios.</p>
                            <a href="system-design-real-world-case-studies.html">Read Article <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </section>

    <footer id="social-media" class="bg-dark text-light py-5">
        <div class="container py-5">
            <div class="row mb-4">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h5 class="fw-bold mb-3">Let's Connect</h5>
                    <p class="text-light">
                        I'm always interested in sharing content about my interests on different topics. Read disclaimer and feel free to share further.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold mb-3">Follow Me</h5>
                    <div class="social-links d-flex gap-2 flex-wrap">
                        <a href="https://www.facebook.com/wasil.zafar/" target="_blank" class="social-icon" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/wasilzafar" target="_blank" class="social-icon" title="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/wasilzafar" target="_blank" class="social-icon" title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="https://www.youtube.com/@wasilzafar" target="_blank" class="social-icon" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="https://www.instagram.com/itswzee/" target="_blank" class="social-icon" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://in.pinterest.com/wasilz/" target="_blank" class="social-icon" title="Pinterest">
                            <i class="fab fa-pinterest-p"></i>
                        </a>
                        <a href="mailto:wasil.zafar@gmail.com" class="social-icon" title="Email">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <hr class="bg-secondary">

            <div class="row mt-4">
                <div class="col-md-6">
                    <p class="small">
                        <i class="fas fa-icons me-2"></i>Icons from <a href="https://www.flaticon.com/" target="_blank" class="text-light">Flaticon</a> &amp; <a href="https://fontawesome.com/" target="_blank" class="text-light">Font Awesome</a>
                    </p>
                    <p class="small mt-3">
                        <a href="/" class="text-light text-decoration-none">Home</a> | 
                        <a href="/disclaimer.html" class="text-light text-decoration-none">Disclaimer</a> | 
                        <a href="/privacy-policy.html" class="text-light text-decoration-none">Privacy Policy</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">
                        Enjoying this content? ☕ <a href="https://buymeacoffee.com/itswzee" target="_blank" class="text-light" style="text-decoration: underline;">Buy me a coffee</a> to fuel more deep dives!
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <button id="scrollToTop" class="scroll-to-top"><i class="fas fa-arrow-up"></i></button>
    <script src="../../../js/cookie-consent.js"></script>
    <script src="../../../js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scrollToTopBtn = document.getElementById('scrollToTop');
            window.addEventListener('scroll', function() { scrollToTopBtn.classList.toggle('show', window.scrollY > 300); });
            scrollToTopBtn.addEventListener('click', function() { window.scrollTo({ top: 0, behavior: 'smooth' }); });
        });
        function openNav() { document.getElementById('tocSidenav').classList.add('open'); document.getElementById('tocOverlay').classList.add('show'); document.body.style.overflow = 'hidden'; }
        function closeNav() { document.getElementById('tocSidenav').classList.remove('open'); document.getElementById('tocOverlay').classList.remove('show'); document.body.style.overflow = 'auto'; }
        document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeNav(); });
        const themes = { 'prism-theme': 'Tomorrow Night', 'prism-default': 'Default', 'prism-dark': 'Dark', 'prism-twilight': 'Twilight', 'prism-okaidia': 'Okaidia', 'prism-solarizedlight': 'Solarized Light' };
        const savedTheme = localStorage.getItem('prism-theme') || 'prism-theme';
        function switchTheme(themeId) { Object.keys(themes).forEach(id => { const link = document.getElementById(id); if (link) link.disabled = true; }); const selectedLink = document.getElementById(themeId); if (selectedLink) { selectedLink.disabled = false; localStorage.setItem('prism-theme', themeId); } setTimeout(() => Prism.highlightAll(), 10); }
        document.addEventListener('DOMContentLoaded', function() { switchTheme(savedTheme); });
        Prism.plugins.toolbar.registerButton('theme-switcher', function() { const select = document.createElement('select'); Object.keys(themes).forEach(id => { const opt = document.createElement('option'); opt.value = id; opt.textContent = themes[id]; if (id === savedTheme) opt.selected = true; select.appendChild(opt); }); select.addEventListener('change', e => switchTheme(e.target.value)); return select; });
    </script>
</body>
</html>
